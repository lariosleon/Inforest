Attribute VB_Name = "modProcedimiento"

Enum TQRCodeEncoding
    ceALPHA
    ceBYTE
    ceNUMERIC
    ceKANJI
    ceAUTO
End Enum

Enum TQRCodeECLevel
    LEVEL_L
    LEVEL_M
    LEVEL_Q
    LEVEL_H
End Enum

Private Declare Sub FullQRCode Lib "qrcodelib.dll" (ByVal autoConfigurate As Boolean, ByVal AutoFit As Boolean, ByVal backColor As Long, ByVal barColor As Long, ByVal texto As String, ByVal correctionLevel As TQRCodeECLevel, ByVal encoding As TQRCodeEncoding, ByVal marginpixels As Integer, ByVal moduleWidth As Integer, ByVal Height As Integer, ByVal Width As Integer, ByVal FileName As String)

Private Declare Sub FastQRCode Lib "qrcodelib.dll" (ByVal texto As String, ByVal FileName As String)

Private Declare Function QRCodeLibVer Lib "qrcodelib.dll" ()

'tipo de cambio en impresion
Dim IsqlTC As String
Dim RsParametroTC As Recordset
'-----------------------------

Public pasa As Boolean

Dim xproducto As String
Dim ximprimeDetallado As Boolean
Dim PropiedadTem As String ' para for de propiedades
Declare Function GetWindowsDirectoryA Lib "kernel32" _
() '   (ByVal lpBuffer As String, ByVal nSize As Long) As Long
   Declare Function GetSystemDirectoryA Lib "kernel32" _
() '   (ByVal lpBuffer As String, ByVal nSize As Long) As Long
   
Public Sub MatrizBotones(Cantidad As Integer, Columna As Integer, EspacioH As Integer, EspacioV As Integer, cmdBoton As Object)
    Dim margentop As Integer
    Dim margenleft As Integer
    
    cmdBoton(0).Visible = False
    j = 0
    margentop = cmdBoton(0).Top
    margenleft = cmdBoton(0).Left
    For i = 1 To Cantidad
        With cmdBoton(i)
        j = j + 1
        Load cmdBoton(i)
            .Left = (j * EspacioH) + ((j - 1) * cmdBoton(0).Width) + margenleft
            .Top = margentop
            .Visible = True
        End With
        'Cantidad de Columnas
        If i Mod Columna = 0 Then
           j = 0
           margentop = margentop + cmdBoton(0).Height + EspacioV
        End If
    Next i
End Sub

Public Sub AsignaBoton(nBoton As Integer, RsAsigna As Recordset, cmdBoton As Object)
   Screen.MousePointer = vbHourglass
   With RsAsigna
        If .RecordCount > 0 Then
           For i = 1 To nBoton
               .MoveFirst
               .Find "nboton = " & Trim(str(i))
               If Not .EOF Then
                  cmdBoton(i).Visible = True
                  cmdBoton(i).Caption = !tResumido
                Else
                  cmdBoton(i).Visible = False
                End If
           Next i
        Else
           For i = 1 To nBoton
               cmdBoton(i).Visible = False
           Next i
        End If
  End With
  Screen.MousePointer = vbDefault
End Sub
'origen de ventas
Public Sub AsignaBotonOrigenVentas(nBoton As Integer, RsAsigna As Recordset, cmdBoton As Object)
   Screen.MousePointer = vbHourglass
   With RsAsigna
        If .RecordCount > 0 Then
           For i = 1 To nBoton
               .MoveFirst
               .Find "boton = " & Trim(str(i))
               If Not .EOF Then
                  cmdBoton(i).Visible = True
                  cmdBoton(i).Caption = !Descripcion
                Else
                  cmdBoton(i).Visible = False
                End If
           Next i
        Else
           For i = 1 To nBoton
               cmdBoton(i).Visible = False
           Next i
        End If
  End With
  Screen.MousePointer = vbDefault
End Sub
'--------------------------------------
Public Sub AsignaBotonProducto(nBoton As Integer, RsAsigna As Recordset, cmdBoton As Object, tipopedido As String, UnidadNegocio As String)
   Screen.MousePointer = vbHourglass
   With RsAsigna
        If .RecordCount > 0 Then
           For i = 1 To nBoton
               .MoveFirst
               .Find "nboton = " & Trim(str(i))
               If Not .EOF Then
                  cmdBoton(i).Caption = !tResumido
                  cmdBoton(i).Visible = True
                  
                  'If ((tipopedido = "01" And !lLocal) Or (tipopedido = "02" And !lDelivery) Or (tipopedido = "03" And !lLlevar) Or (tipopedido = "04" And !lCanal4) Or (tipopedido = "05" And !lCanal5)) And (!tUnidadNegocio = UnidadNegocio Or !tUnidadNegocio = "00") Then
                  If ((tipopedido = "01" And !lLocal) Or (tipopedido = "02" And !lDelivery) Or (tipopedido = "03" And !lLlevar) Or (tipopedido = "04" And !lCanal4) Or (tipopedido = "05" And !lCanal5)) And (!tUnidadNegocio = UnidadNegocio) Then
                     cmdBoton(i).Enabled = True
                  Else
                     cmdBoton(i).Enabled = False
                  End If
                  
                Else
                    cmdBoton(i).Visible = False
                End If
           Next i
        Else
           For i = 1 To nBoton
               cmdBoton(i).Visible = False
           Next i
        End If
  End With
  Screen.MousePointer = vbDefault
End Sub

Public Sub MoverPuntero(direccion As UbicaPuntero, Grd As TDBGrid)
   Select Case direccion
          Case Is = 1
               Grd.MoveFirst
          Case Is = 2
               Grd.MoveLast
          Case Is = 3
               Grd.MovePrevious
               If Grd.BOF Then
                  Grd.MoveFirst
               End If
          Case Is = 4
               Grd.MoveNext
               If Grd.EOF Then
                  Grd.MoveLast
               End If
          Case Is = 5
               Grd.MoveRelative -18
               If Grd.BOF Then
                  Grd.MoveFirst
               End If
          Case Is = 6
               Grd.MoveRelative 18
               If Grd.EOF Then
                  Grd.MoveLast
               End If
   End Select
End Sub

Function dbTemporal(Usuario As String, nCampo As Integer, ParamArray Lista())
   On Error GoTo err
   Do While True
      'sNombre = "TMP" & Usuario & Mid("000000", 1, 6 - Len(Trim(str(DateDiff("s", Date, Now))))) + Trim(str(DateDiff("s", Date, Now)))
      'If Calcular("select count(name) as Codigo from dbo.sysobjects where id = object_id(N'[dbo].[" & sNombre & "]')", Cn) < 1 Then
      sNombre = "#TMP" & Replace(Usuario, " ", "") & Mid("000000", 1, 6 - Len(Trim(str(DateDiff("s", Date, Now))))) + Trim(str(DateDiff("s", Date, Now)))
      If Calcular("select count(name) as Codigo from tempdb.dbo.sysobjects where id = object_id(N'tempdb.[dbo].[" & sNombre & "]')", Cn) < 1 Then
         Exit Do
      End If
   Loop
   
   Isql = "Create Table " & sNombre & " ( "
   For i = 0 To nCampo - 1
       If UCase(Left(LTrim(Lista((i * 2) + 1)), 8)) = "NVARCHAR" Or UCase(Left(LTrim(Lista((i * 2) + 1)), 7)) = "VARCHAR" Then
        Isql = Isql & Lista(i * 2) & " " & Lista((i * 2) + 1) & " COLLATE Modern_Spanish_CI_AS, "
       Else
        Isql = Isql & Lista(i * 2) & " " & Lista((i * 2) + 1) & ", "
       End If
   Next i
   Isql = Mid(Isql, 1, Len(Trim(Isql)) - 1) & " )"
   
   Cn.Execute Isql
   dbTemporal = sNombre
Exit Function
err:

End Function
Public Function Imprimir(codigoImpresora As String) As Boolean
On Error GoTo Er
    Dim p As Object
    Dim RsPuerto As Recordset
    
    Isql = "Select * from tImpresora where tCaja ='" & sCaja & "' and tImpresora='" + Trim(codigoImpresora) + "'"
    Set RsPuerto = Lib.OpenRecordset(Isql, Cn)
    If RsPuerto.EOF = True Then
        MsgBox "Error en Configuración de Impresión", vbCritical, "Mensaje del Sistema"
        Imprimir = False
    Else
        For Each p In Printers
            'If UCase(P.Port) = UCase(RsPuerto.Fields("tRuta").Value) Then
            If UCase(p.DeviceName) = UCase(RsPuerto.Fields("tDevice").value) Then
               'Set Printer = p '003 - 4 - 89 - 2017
               Set Printer = p
                   sFont = IIf(IsNull(RsPuerto!tFont), "Arial", RsPuerto!tFont)
                   sFont1 = IIf(IsNull(RsPuerto!tFont1), "Arial", RsPuerto!tFont1)
                   sFont2 = IIf(IsNull(RsPuerto!tFont2), "Arial", RsPuerto!tFont2)
                   sSerieCaja = IIf(IsNull(RsPuerto!tNumeroSerie), "", RsPuerto!tNumeroSerie)
                   
                   If lLogCajaRapida = True Then
                     'LOG
                   Cn.Execute "update tlog_impresion set timpresorasEncontradas= '" & p.DeviceName & "' where tdocumento='" & sDocumento & "'"
                   End If
               Exit For
            End If
        Next p
    End If
    RsPuerto.Close
    Set RsPuerto = Nothing
    Imprimir = True
    Exit Function
Er:
    'MsgBox (error)
    Imprimir = False
End Function

Public Sub Blanquear(wFormulario As Form)
    For Each Control In wFormulario.Controls
        'If (TypeOf Control Is TextBox) Or (TypeOf Control Is ComboBox) Then
        If (TypeOf Control Is TextBox) Then
            Control.Text = ""
        ElseIf (TypeOf Control Is ComboBox) Then
           Control.ListIndex = -1
        ElseIf TypeOf Control Is DataCombo Then
            Control.BoundText = ""
        End If
    Next Control
End Sub
'anulacion de documentos por nota de credito
Public Function aNotaCredito(formulario As String)
    If formulario = "notaCredito" Then
        pasa = True
            Else
                pasa = False
    End If
End Function
Public Function Encapsula(sPalabra As String)
   Dim sRet As String
   sRet = ""
   nlen = Len(Trim(sPalabra))
   For i = 1 To nlen
       sRet = sRet & Relacion(Mid(sPalabra, i, 1), 1)
   Next
   Encapsula = sRet
End Function

Public Function Relacion(sLetra As String, iFlag As Integer)
   Dim sEnc, sDes As String
   Dim sLet As Long
   sLetra = UCase(sLetra)
   ' iFlag = 1 es encapsula, 0 desencapsula
'   sDes = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789 "
'   sEnc = "!·¿ª$%&/(,.-)=?º{Ç}*<;+[]^¡5\@>:#_¬|´"
'

   sDes = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789 Ñ.*,-·$&/()=?¿!#@ºª\"
   sEnc = "!·¿ª$%&/(,.-)=?º{Ç}*<;+[]^¡5\@>:#_¬|q•1njklmr0abcdefghpoz"
   
   If iFlag = 1 Then
       sLet = InStr(1, sDes, sLetra)
       If sLet = 0 Then
          Relacion = "´"
       Else
          Relacion = Mid(sEnc, sLet, 1)
       End If
   Else
       sLet = InStr(1, sEnc, sLetra)
       If sLet = 0 Then
          Relacion = "´"
       Else
          Relacion = Mid(sDes, sLet, 1)
       End If
   End If
End Function

Public Function Desencapsula(sPalabra As String)
   Dim sRet As String
   sRet = ""
   nlen = Len(Trim(sPalabra))
   For i = 1 To nlen
       sRet = sRet & Relacion(Mid(sPalabra, i, 1), 0)
   Next
   Desencapsula = sRet
End Function

Public Function Calcular(fIsql As String, Coneccion As Connection) As String
   Dim RsTemp As Recordset
    Set RsTemp = Lib.OpenRecordset(fIsql, Coneccion)
   If RsTemp.RecordCount = 0 Then
      Calcular = 0
   Else
      Calcular = IIf(IsNull(RsTemp!codigo), 0, RsTemp!codigo)
   End If
   Set RsTemp = Nothing
 End Function

Public Sub AsignaComando(nBoton As Integer, RsAsigna As Recordset, cmdBoton As Object)
    Screen.MousePointer = vbHourglass
   With RsAsigna
        If .RecordCount > 0 Then
           .MoveFirst
           For i = 1 To IIf(.RecordCount > nBoton, nBoton, .RecordCount)
               cmdBoton(i).Visible = True
               cmdBoton(i).Caption = !Descripcion
               .MoveNext
           Next i
           
           For i = IIf(.RecordCount > nBoton, nBoton, .RecordCount) + 1 To nBoton
               cmdBoton(i).Visible = False
           Next i
        Else
           For i = 1 To nBoton
               cmdBoton(i).Visible = False
           Next i
        End If
  End With
  Screen.MousePointer = vbDefault
End Sub
Public Sub ImprimeCortesia(ByVal RsImpresion As Recordset, Optional tTipoDoc As String, Optional Cabecera As Image, Optional pie As Image)
    On Error Resume Next
    Dim Item As String
    Dim sLinea As String
    
    lImprimeImagCabDocumento = Calcular("select lImprimeImageCab as codigo  from ttipodocumentoimpresora where ttipoemision='" & tTipoDoc & "' and  tcaja='" & sCaja & "'", Cn)
    lImprimeImagPieDocumento = Calcular("select lImprimeImagePie as codigo from ttipodocumentoimpresora where ttipoemision='" & tTipoDoc & "' and  tcaja='" & sCaja & "'", Cn)
    ximprimeDetallado = Calcular("select lImprimeresumen as codigo from ttipodocumentoimpresora where ttipoemision='" & tTipoDoc & "' and  tcaja='" & sCaja & "'", Cn)
    
    Dim CANT, Valor As Integer
    Dim ProductoTem As String
    
     If lImprimeImagCabDocumento Then
                                    If Cabecera <> 0 Then
                                    Printer.PaintPicture Cabecera, Printer.CurrentX, Printer.CurrentY, 4005, 3000
                                    For p = 1 To 17
                                    Printer.Print
                                    Next p
                                    End If
     End If
    'Cabecera
    RsImpresion.MoveFirst
    ImprimeXCentro sRazonSocial, 40
    ImprimeXCentro sRazonComercial, 40
    sLinea = String((40 - Len(Trim("R.U.C.: " + sRUC))) / 2, " ") & "R.U.C.: " + sRUC
    Printer.Print sLinea
    ImprimeXCentro sDireccion, 40
    sLinea = String((40 - Len(Trim("Telefono: " + sTelefono))) / 2, " ") & "Telefono: " + sTelefono
    Printer.Print sLinea
    Printer.Print
    
    Printer.Print "V.Cortes.: " & Mid(RsImpresion!tDocumento, 1, 1) & "-" & Mid(RsImpresion!tDocumento, 2, 5) & "-" & Mid(RsImpresion!tDocumento, 7)
    Printer.Print "Fecha    : " & RsImpresion!fRegistro
    Printer.Print "Cortesia : " & RsImpresion!Cortesia
    Printer.Print "Pedido   : " & RsImpresion!tCodigoPedido
    Printer.Print "Caja     : " & RsImpresion!tCaja & " - " & RsImpresion!tUsuario
    Printer.Print "Mesero   : " & RsImpresion!Mozo
    Printer.Print
    Printer.FontBold = True
    Printer.Print "MESA     : " & RsImpresion!Mesa
    If lObservacionCabDoc Then
        Printer.Print "Observac.: " & RsImpresion!tObservacion
    End If
    Printer.FontBold = False
    Printer.Print
    Printer.Print String(40, "-")
    Printer.Print "Cantid. Producto                SubTotal"
    Printer.Print String(40, "-")
    
    Item = ""
    'Cuerpo
    Do While Not RsImpresion.EOF
    If ximprimeDetallado = False Then
        xproducto = RsImpresion!Producto
    Else
        xproducto = RsImpresion!ProductoDetallado
    End If
 
    
       If Item <> RsImpresion!tItem Then
          'Printer.Print
          If IsNull(RsImpresion!tOferta) Or RsImpresion!tOferta = "" Then
          
            CANT = Len(Trim(xproducto))
            ProductoTem = xproducto
regreso:
            If Valor = 0 Then
                sLinea = Right(String(7, " ") & Format(RsImpresion!nCantidad, "###0.00"), 7) & " " & Mid(xproducto & String(19, " "), 1, 19) & " " & IIf(lValorCortesia, Right(String(12, " ") & Format(RsImpresion!nCantidad * RsImpresion!nprecioVenta, "#,###,##0.00"), 12), "")
                Valor = 1
                CANT = Len(Mid(ProductoTem, 20))
                ProductoTem = Mid(ProductoTem, 20)
                Printer.Print sLinea
            Else
                sLinea = Right(String(7, " ") & "       ", 7) & " " & Mid(ProductoTem & String(19, " "), 1, 19) & " " & IIf(lValorCortesia, Right(String(12, " ") & "            ", 12), "")
                CANT = Len(Mid(ProductoTem, 20))
                ProductoTem = Mid(ProductoTem, 20)
                Printer.Print sLinea
            End If
            
            If CANT > 0 And ximprimeDetallado = True Then
            GoTo regreso
            End If
          
          
             'sLinea = Right(String(7, " ") & Format(RsImpresion!nCantidad, "###0.00"), 7) & " " & Mid(xproducto & String(19, " "), 1, 19) & " " & IIf(lValorCortesia, Right(String(12, " ") & Format(RsImpresion!nCantidad * RsImpresion!nprecioVenta, "#,###,##0.00"), 12), "")
          Else
          
                      CANT = Len(Trim(xproducto))
            ProductoTem = xproducto
regreso1:
            If Valor = 0 Then
                sLinea = Right(String(7, " ") & Format(RsImpresion!nCantidad, "###0.00"), 7) & " " & Mid(xproducto & String(19, " "), 1, 19)
                Valor = 1
                CANT = Len(Mid(ProductoTem, 20))
                ProductoTem = Mid(ProductoTem, 20)
                Printer.Print sLinea
            Else
                sLinea = Right(String(7, " ") & "       ", 7) & " " & Mid(ProductoTem & String(19, " "), 1, 19)
                CANT = Len(Mid(ProductoTem, 20))
                ProductoTem = Mid(ProductoTem, 20)
                Printer.Print sLinea
            End If
            
            If CANT > 0 And ximprimeDetallado = True Then
            GoTo regreso1
            End If

             'sLinea = Right(String(7, " ") & Format(RsImpresion!nCantidad, "###0.00"), 7) & " " & Mid(xproducto & String(19, " "), 1, 19)
             
             sLinea = String(8, " ") & Mid(RsImpresion!tOferta & String(19, " "), 1, 19) & " " & IIf(lValorCortesia, Right(String(12, " ") & Format(RsImpresion!nCantidad * RsImpresion!nprecioVenta, "#,###,##0.00"), 12), "")
             Printer.Print sLinea
          End If
          Valor = 0
          'Printer.Print sLinea
          
          If lComboDocumento And IIf(IsNull(RsImpresion!Combo), 0, Len(Trim(RsImpresion!Combo))) > 0 Then
             sLinea = Mid("        " & Right(String(5, " ") & Format(RsImpresion!nCombo, "#0.00"), 5) & " " & RsImpresion!Combo, 1, 40)
             Printer.Print sLinea
          End If
       Else
          If lComboDocumento And IIf(IsNull(RsImpresion!Combo), 0, Len(Trim(RsImpresion!Combo))) > 0 Then
             sLinea = Mid("        " & Right(String(5, " ") & Format(RsImpresion!nCombo, "#0.00"), 5) & " " & RsImpresion!Combo, 1, 40)
             Printer.Print sLinea
          End If
       End If
       Item = RsImpresion!tItem
       RsImpresion.MoveNext
    Loop
        
    'Printer.Print
    Printer.Print String(40, "-")
    Printer.Print
    RsImpresion.MoveLast
    If lValorCortesia Then
        If RsImpresion!nRecargo > 0 Then
           Printer.Print
           Printer.Print Right(String(27, " ") & "Recargo " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nRecargo, "##,###,##0.00"), 13)
        End If
        
        If RsImpresion!nDescuento > 0 Then
           Printer.Print
           Printer.Print Right(String(27, " ") & "Descuento " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nDescuento, "##,###,##0.00"), 13)
        End If
        Printer.Print Right(String(27, " ") & "Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 13)
          '====================== nov 2010
        If lDocumEquivaPrecuenta Then
            Printer.Print " "
            Printer.Print Right(String(27, " ") & "Total " & sMonE & " :", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 13)
            End If
    '====================== nov 2010
        Printer.Print
    Else
       Printer.Print ""
    End If
    Printer.Print String(40, "-")
    Printer.Print
    Printer.Print
    Printer.Print String(25, " ") & String(15, "-")
    Printer.Print String(25, " ") & "  AUTORIZADO   "
    Printer.Print
    Printer.Print String((40 - Len(Trim(sPie))) / 2, " ") & Trim(sPie)
    Printer.Print
    If lImprimeImagPieDocumento Then
                                    If pie <> 0 Then
                                        Printer.PaintPicture pie, Printer.CurrentX, Printer.CurrentY, 4005, 3000
                                    End If
    End If
    Printer.EndDoc

End Sub

Public Sub ImprimeBoletaN(ByVal RsImpresion As Recordset, ByVal Empresa As String, Optional ByVal tTipoDoc As String)
    ximprimeDetallado = Calcular("select lImprimeresumen as codigo from ttipodocumentoimpresora where ttipoemision='" & tTipoDoc & "' and  tcaja='" & sCaja & "'", Cn)

    On Error Resume Next
    Dim Item As String
    Dim sLinea As String
    Dim sNum As String
    Dim i As Integer
    
    Dim nDescBolJA As Integer
    
    Dim sImportes As String
    
    'CESAR---
    Dim sImportes1 As String
    Dim sImportes2 As String
    Dim sImportes3 As String



    
    'Cabecera
    Printer.PaperSize = vbPRPSUser
    Printer.Orientation = vbPRORPortrait
    RsImpresion.MoveFirst
    
    Select Case Empresa
           Case Is = "002"       ' Brujas
                 For i = 1 To nCabecera
                     Printer.Print
                 Next i
                 Printer.Print String(58, " ") & "   Pedido : " & sPedido
                 Printer.Print "            " & Mid(RsImpresion!tDocumento & String(45, " "), 1, 45) & "    Caja   : " & RsImpresion!tCaja & " - " & RsImpresion!tUsuario
                 Printer.Print "            " & Mid(RsImpresion!Cliente & String(60, " "), 1, 60)
                 Printer.Print ""
                 Printer.Print String(61, " ") & Format(RsImpresion!fRegistro, "dd MMMM yyyy")
                 Printer.Print String(51, " ") & "          Mesa   : " & IIf((RsImpresion!tMesa = "000" Or Len(Trim(RsImpresion!tMesa)) = 0 Or IsNull(RsImpresion!tMesa)), RsImpresion!tObservacion, RsImpresion!Mesa)
                                                 
                 For i = 1 To nDetalle
                     Printer.Print
                 Next i
                 
                 'Cuerpo
                 Item = ""
                 i = 0
                 j = 0
                 
                 'Cuerpo
                 Item = ""
                 Do While Not RsImpresion.EOF
                 If ximprimeDetallado = False Then
                        xproducto = RsImpresion!Producto
                    Else
                        xproducto = RsImpresion!ProductoDetallado
                    End If
                    
                    If Item <> RsImpresion!tCodigoPedido + RsImpresion!tItem Then
                       i = i + 1
                       'Printer.Print
                       sNum = Mid("000", 1, 3 - Len(Trim(str(i)))) & Trim(str(i))
                       sLinea = "   " & sNum & "  " & Right(String(7, " ") & Format(RsImpresion!nCantidad, "###0.00"), 7) & "  " & Mid(xproducto & String(55, " "), 1, 55) & " " & Right(String(9, " ") & Format(RsImpresion!nprecioVenta, "##,##0.00"), 9) & " " & Right(String(12, " ") & Format(RsImpresion!nCantidad * RsImpresion!nprecioVenta, "#,###,##0.00"), 12)
                       Printer.Print sLinea
                    End If
                    Item = RsImpresion!tCodigoPedido + RsImpresion!tItem
                    RsImpresion.MoveNext
                 Loop
                 
                 For j = i To nFItem
                     Printer.Print " "
                 Next j
                 
                 Printer.Print
                 RsImpresion.MoveLast
                 Printer.Print "                  Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
                 If RsImpresion!nRecargo > 0 Then
                    Printer.Print Right(String(82, " ") & "Recargo : ", 64) & Right(String(13, " ") & Format(RsImpresion!nRecargo, "##,###,##0.00"), 13)
                 Else
                    Printer.Print
                 End If
                     
                 If RsImpresion!nDescuento > 0 Then
                    Printer.Print Right(String(82, " ") & "Descuento : ", 64) & Right(String(13, " ") & Format(RsImpresion!nDescuento, "##,###,##0.00"), 13)
                 Else
                    Printer.Print
                 End If
                 
                 Printer.Print ""
                 Printer.Print ""
                 'Humberto 15/10/2008, se agrego la condición para saber si se debe o no imprimir el impuesto
                 If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
                    Printer.Print String(82, " ") & Right(String(13, " ") & Format(RsImpresion!nNeto, "##,###,##0.00"), 13)
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                    If RsImpresion!nprecioImpuesto1 > 0 Then
                       Printer.Print String(82, " ") & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,##0.00"), 13)
                    Else
                       Printer.Print ""
                    End If
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                    If RsImpresion!nprecioImpuesto2 > 0 Then
                       Printer.Print String(82, " ") & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto2, "##,###,##0.00"), 13)
                    Else
                       Printer.Print ""
                    End If
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                    If RsImpresion!nprecioImpuesto3 > 0 Then
                       Printer.Print String(82, " ") & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto3, "##,###,##0.00"), 13)
                    Else
                       Printer.Print ""
                    End If
                 End If
                 'Humberto 15/10/2008, fin
                 Printer.Print String(82, " ") & Right(String(13, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 13)
                 '====================== nov 2010
                   If lDocumEquivaPrecuenta Then
                        Printer.Print " "
                       Printer.Print Right(String(82, " ") & "Total " & sMonE & " :", 82) & Right(String(13, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 13)
                   End If
                   '====================== nov 2010
           Case Is = "005" 'Ancel
                 For i = 1 To nCabecera
                     Printer.Print
                 Next i
                 
                 Printer.Print "            " & RsImpresion!tDocumento
                 Printer.Print
                 Printer.Print
                 Printer.Print "      " & Mid(Format(RsImpresion!fRegistro, "dd    MMMM ") & String(20, " "), 1, 20) & "     " & Mid(Format(RsImpresion!fRegistro, "yy"), 2, 1)
                 Printer.Print
                 Printer.Print "          " & Mid(RsImpresion!Cliente & String(66, " "), 1, 66) & RsImpresion!Ruc
                 Printer.Print
                 Printer.Print "          " & Mid(RsImpresion!direccion & String(50, " "), 1, 50)
                 
                 For i = 1 To nDetalle
                     Printer.Print
                 Next i
                 
                 'Cuerpo
                 Item = ""
                 i = 0
                 j = 0
                 
                 'Cuerpo
                 Item = ""
                 Do While Not RsImpresion.EOF
                 If ximprimeDetallado = False Then
                        xproducto = RsImpresion!Producto
                    Else
                        xproducto = RsImpresion!ProductoDetallado
                    End If
                    
                    If Item <> RsImpresion!tCodigoPedido + RsImpresion!tItem Then
                       i = i + 1
                       'Printer.Print
                       sLinea = "  " & Mid(xproducto & String(12, "  "), 1, 12) & "  " & Mid(xproducto & String(40, " "), 1, 40) & Right(String(7, " ") & Format(RsImpresion!nCantidad, "###0.00"), 7) & " " & Right(String(9, "  ") & Format(RsImpresion!nprecioVenta, "##,##0.00"), 9) & "   " & Right(String(16, " ") & Format(RsImpresion!nCantidad * RsImpresion!nprecioVenta, "#,###,###,##0.00"), 16)
                       Printer.Print sLinea
                    End If
                    Item = RsImpresion!tCodigoPedido + RsImpresion!tItem
                    RsImpresion.MoveNext
                 Loop
                                  
                 For j = i To nFItem
                     Printer.Print " "
                 Next j
                 
                 RsImpresion.MoveLast
                 If RsImpresion!nRecargo > 0 Then
                    Printer.Print " " & Right(String(78, " ") & "Recargo : ", 78) & Right(String(17, " ") & Format(RsImpresion!nRecargo, "##,###,###,##0.00"), 17)
                 Else
                    Printer.Print
                 End If
                     
                 If RsImpresion!nDescuento > 0 Then
                    Printer.Print " " & Right(String(74, " ") & "Descuento : ", 74) & Right(String(17, " ") & Format(RsImpresion!nDescuento, "##,###,###,##0.00"), 17)
                 Else
                    Printer.Print
                 End If
                 
                 Printer.Print " "
                 Printer.Print " " & Right(String(74, " ") & "Total " & sMonN & " : ", 74) & Right(String(17, " ") & Format(RsImpresion!nVenta, "##,##,###,##0.00"), 17)
                 '====================== nov 2010
                   If lDocumEquivaPrecuenta Then
                        Printer.Print " "
                       Printer.Print Right(String(74, " ") & "Total " & sMonE & " :", 74) & Right(String(17, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 17)
                   End If
                   '====================== nov 2010
                 Printer.Print " "
                 Printer.Print UCase("        " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN)
        
           Case Is = "006" 'Atlantic
                 For i = 1 To nCabecera
                     Printer.Print
                 Next i
                 
                 Printer.Print "   Documento        : " & RsImpresion!tDocumento
                 Printer.Print "   Fecha de Emisión : " & Format(RsImpresion!fRegistro, "dd MMMM yyyy")
                 Printer.Print "   Cliente          : " & RsImpresion!Cliente
                 Printer.Print "   Dirección        : " & RsImpresion!direccion
                 Printer.Print "   Pedido           : " & sPedido
                 Printer.Print Mid("   Caja             : " & RsImpresion!tCaja & " - " & RsImpresion!tUsuario & String(53, " "), 1, 53) & "Mesero  : " & RsImpresion!Mozo
                 Printer.Print "   MESA             : " & IIf((RsImpresion!tMesa = "000" Or Len(Trim(RsImpresion!tMesa)) = 0 Or IsNull(RsImpresion!tMesa)), RsImpresion!tObservacion, RsImpresion!Mesa)
                 For i = 1 To nDetalle
                     Printer.Print
                 Next i
                 
                 'Cuerpo
                 Item = ""
                 i = 0
                 j = 0
                                  
                 Item = ""
                 Do While Not RsImpresion.EOF
                 If ximprimeDetallado = False Then
                        xproducto = RsImpresion!Producto
                    Else
                        xproducto = RsImpresion!ProductoDetallado
                    End If
                    
                    If Item <> RsImpresion!tCodigoPedido + RsImpresion!tItem Then
                       i = i + 1
                       'Printer.Print
                       sLinea = Right(String(11, " ") & Format(RsImpresion!nCantidad, "###0.00"), 7) & "  " & Mid(xproducto & String(58, " "), 1, 58) & " " & Right(String(9, " ") & Format(RsImpresion!nprecioVenta, "##,##0.00"), 9) & "     " & Right(String(12, " ") & Format(RsImpresion!nCantidad * RsImpresion!nprecioVenta, "#,###,##0.00"), 12)
                       Printer.Print sLinea
                    End If
                    Item = RsImpresion!tCodigoPedido + RsImpresion!tItem
                    RsImpresion.MoveNext
                 Loop
                 
                 For j = i To nFItem
                     Printer.Print " "
                 Next j
                 
                 RsImpresion.MoveLast
                 If RsImpresion!nRecargo > 0 Then
                    Printer.Print Right(String(77, " ") & "Recargo : ", 77) & Right(String(17, " ") & Format(RsImpresion!nRecargo, "##,###,###,##0.00"), 17)
                 Else
                    Printer.Print
                 End If
                     
                 If RsImpresion!nDescuento > 0 Then
                    Printer.Print Right(String(77, " ") & "Descuento : ", 77) & Right(String(17, " ") & Format(RsImpresion!nDescuento, "##,###,###,##0.00"), 17)
                 Else
                    Printer.Print
                 End If
                 'Humberto 15/10/2008, se agrego la condición para saber si se debe o no imprimir el impuesto
                 If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
                    Printer.Print Right(String(77, " ") & "Valor Venta :", 77) & Right(String(17, " ") & Format(RsImpresion!nNeto, "##,##,###,##0.00"), 17)
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                    If RsImpresion!nprecioImpuesto1 > 0 Then
                       Printer.Print Right(String(77, " ") & sImpuesto1 & " " & Format(nPorcentaje1, "##0.00") & "% :", 77) & Right(String(17, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,###,##0.00"), 17)
                    End If
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                    If RsImpresion!nprecioImpuesto2 > 0 Then
                        Printer.Print Right(String(77, " ") & sImpuesto2 & " " & Format(nPorcentaje2, "##0.00") & "% :", 77) & Right(String(17, " ") & Format(RsImpresion!nprecioImpuesto2, "##,##,###,##0.00"), 17)
                    End If
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                    If RsImpresion!nprecioImpuesto3 > 0 Then
                       Printer.Print Right(String(77, " ") & sImpuesto3 & " " & Format(nPorcentaje3, "##0.00") & "% :", 77) & Right(String(17, " ") & Format(RsImpresion!nprecioImpuesto3, "##,##,###,##0.00"), 17)
                    End If
                 End If
                
                If Calcular(" SELECT case when  lImpresionRetencion=1 then 1 else 0 end  as codigo FROM vTipodocumento WHERE Codigo=(SELECT TTIPODOCUMENTO FROM MDOCUMENTO WHERE tDocumento='" & RsImpresion!tDocumento & "')", Cn) = 1 Then
                    Printer.Print tTextoAgenteRetencion
                End If
                 
                 'Humberto 15/10/2008, fin
                 Printer.Print Right(String(77, " ") & "Total " & sMonN & " : ", 77) & Right(String(17, " ") & Format(RsImpresion!nVenta, "##,##,###,##0.00"), 17)
                 '====================== nov 2010
                   If lDocumEquivaPrecuenta Then
                        Printer.Print " "
                       Printer.Print Right(String(77, " ") & "Total " & sMonE & " :", 77) & Right(String(17, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 17)
                   End If
                   '====================== nov 2010
                 Printer.Print UCase("SON: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN)
                                                                                      
           Case Is = "007" ' DUZKA
                 For i = 1 To nCabecera
                     Printer.Print
                 Next i
            
                 Printer.Print " "
                 Printer.Print " "
                 Printer.Print " " & RsImpresion!tDocumento
                 Printer.Print " "
                 Printer.Print " " & Day(RsImpresion!fRegistro) & "    " & Format(RsImpresion!fRegistro, "MMM") & "    " & Year(RsImpresion!fRegistro)
                 
                 For i = 1 To nDetalle
                     Printer.Print
                 Next i
                 
                 'Cuerpo
                 Item = ""
                 i = 0
                 j = 0
                                  
                 Item = ""
                 Do While Not RsImpresion.EOF
                    If ximprimeDetallado = False Then
                        xproducto = RsImpresion!Producto
                    Else
                        xproducto = RsImpresion!ProductoDetallado
                    End If
                    If Item <> RsImpresion!tCodigoPedido + RsImpresion!tItem Then
                       i = i + 1
                      sNum = Mid("000", 1, 3 - Len(Trim(str(i)))) & Trim(str(i))
                      sLinea = Right(String(7, " ") & Format(RsImpresion!nCantidad, "###0.00"), 7) & " " & Mid(xproducto & String(60, " "), 1, 60) & " " & Right(String(9, " ") & Format(RsImpresion!nprecioVenta / RsImpresion!nCantidad, "##,##0.00"), 9) & " " & Right(String(12, " ") & Format(RsImpresion!nprecioVenta, "#,###,##0.00"), 12)
                      Printer.Print sLinea
                    End If
                    Item = RsImpresion!tCodigoPedido + RsImpresion!tItem
                    RsImpresion.MoveNext
                 Loop
                                  
                 For j = i To nFItem
                     Printer.Print " "
                 Next j
            
                 Printer.Print
                 RsImpresion.MoveLast
                 
                 Printer.Print "        Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
                 If RsImpresion!nRecargo > 0 Then
                    Printer.Print Right(String(64, " ") & "Recargo : ", 64) & Right(String(13, " ") & Format(RsImpresion!nRecargo, "##,###,##0.00"), 13)
                 Else
                    Printer.Print
                 End If
                     
                 If RsImpresion!nDescuento > 0 Then
                    Printer.Print Right(String(64, " ") & "Descuento : ", 64) & Right(String(13, " ") & Format(RsImpresion!nDescuento, "##,###,##0.00"), 13)
                 Else
                    Printer.Print
                 End If
                 'Humberto 15/10/2008, se agrego la condición para saber si se debe o no imprimir el impuesto
                 If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
                    Printer.Print Right(String(78, " "), 78) & Right(String(13, " ") & Format(RsImpresion!nNeto, "##,###,##0.00"), 13)
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                     If RsImpresion!nprecioImpuesto1 > 0 Then
                        Printer.Print Right(String(78, " "), 78) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,##0.00"), 13)
                     End If
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                    If RsImpresion!nprecioImpuesto2 > 0 Then
                        Printer.Print Right(String(78, " "), 78) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto2, "##,###,##0.00"), 13)
                    End If
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                    If RsImpresion!nprecioImpuesto3 > 0 Then
                        Printer.Print Right(String(78, " "), 78) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto3, "##,###,##0.00"), 13)
                    End If
                 End If
                 'Humberto 15/10/2008, fin
                 Printer.Print Right(String(78, " "), 78) & Right(String(13, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 13)
                 '====================== nov 2010
                   If lDocumEquivaPrecuenta Then
                        Printer.Print " "
                       Printer.Print Right(String(78, " ") & "Total " & sMonE & " :", 78) & Right(String(13, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 13)
                   End If
                   '====================== nov 2010
                 
           Case Is = "008"       ' Herve
                 For i = 1 To nCabecera - 3
                     Printer.Print
                 Next i
                 Printer.Print "                              " & Mid(RsImpresion!tDocumento & String(45, " "), 1, 45)
                 Printer.Print "                     Pedido : " & sPedido
                 Printer.Print "                     Caja   : " & RsImpresion!tCaja & " - " & RsImpresion!tUsuario
                 Printer.Print "                     Mesa   : " & IIf((RsImpresion!tMesa = "000" Or Len(Trim(RsImpresion!tMesa)) = 0 Or IsNull(RsImpresion!tMesa)), RsImpresion!tObservacion, RsImpresion!Mesa)
                 Printer.Print Format(RsImpresion!fRegistro, "dd MMMM yyyy")
                 Printer.Print " "
                 
                 For i = 1 To nDetalle - 3
                     Printer.Print
                 Next i
                 
                 'Cuerpo
                 Item = ""
                 i = 0
                 j = 0
                 
                 'Cuerpo
                 Item = ""
                 Do While Not RsImpresion.EOF
                    If ximprimeDetallado = False Then
                        xproducto = RsImpresion!Producto
                    Else
                        xproducto = RsImpresion!ProductoDetallado
                    End If
                    If Item <> RsImpresion!tCodigoPedido + RsImpresion!tItem Then
                       i = i + 1
                       'Printer.Print
                       sNum = Mid("000", 1, 3 - Len(Trim(str(i)))) & Trim(str(i))
                       sLinea = sNum & " " & Mid(xproducto & String(26, " "), 1, 26) & " " & Right(String(5, " ") & Format(RsImpresion!nCantidad, "###0.00"), 5) & " " & Right(String(6, " ") & Format(RsImpresion!nprecioVenta, "#,###,##0.00"), 6) & " " & Right(String(6, " ") & Format(RsImpresion!nCantidad * RsImpresion!nprecioVenta, "#,###,##0.00"), 6) 'oSCAR
                       Printer.Print sLinea
                    End If
                    Item = RsImpresion!tCodigoPedido + RsImpresion!tItem
                    RsImpresion.MoveNext
                 Loop
                 
                 For j = i To nFItem + 3
                     Printer.Print " "
                 Next j
                 
                 Printer.Print
                 RsImpresion.MoveLast
                 Printer.Print "Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
                 
                 If RsImpresion!nRecargo > 0 Then
                    Printer.Print Right(String(33, " ") & "Recargo : ", 33) & Right(String(17, " ") & Format(RsImpresion!nRecargo, "##,###,###,##0.00"), 17)
                 Else
                    Printer.Print
                 End If
                     
                 If RsImpresion!nDescuento > 0 Then
                    Printer.Print Right(String(33, " ") & "Descuento : ", 33) & Right(String(17, " ") & Format(RsImpresion!nDescuento, "##,###,###,##0.00"), 17)
                 Else
                    Printer.Print
                 End If
                 
                 'Humberto 15/10/2008, se agrego la condición para saber si se debe o no imprimir el impuesto
                 If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
                    Printer.Print Right(String(33, " ") & "Valor Venta :", 33) & Right(String(17, " ") & Format(RsImpresion!nNeto, "##,##,###,##0.00"), 17)
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                    If RsImpresion!nprecioImpuesto1 > 0 Then
                       Printer.Print Right(String(33, " ") & sImpuesto1 & " " & Format(nPorcentaje1, "##0.00") & "% :", 33) & Right(String(17, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,###,##0.00"), 17)
                    End If
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                    If RsImpresion!nprecioImpuesto2 > 0 Then
                        Printer.Print Right(String(33, " ") & sImpuesto2 & " " & Format(nPorcentaje2, "##0.00") & "% :", 33) & Right(String(17, " ") & Format(RsImpresion!nprecioImpuesto2, "##,##,###,##0.00"), 17)
                    End If
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                    If RsImpresion!nprecioImpuesto3 > 0 Then
                       Printer.Print Right(String(33, " ") & sImpuesto3 & " " & Format(nPorcentaje3, "##0.00") & "% :", 33) & Right(String(17, " ") & Format(RsImpresion!nprecioImpuesto3, "##,##,###,##0.00"), 17)
                    End If
                 End If
                 
                 'Humberto 15/10/2008, fin
                 Printer.Print
                 Printer.Print Right(String(33, " ") & " Total " & sMonN & " : ", 33) & Right(String(17, " ") & Format(RsImpresion!nVenta, "##,##,###,##0.00"), 17)
                 '====================== nov 2010
                   If lDocumEquivaPrecuenta Then
                        Printer.Print " "
                       Printer.Print Right(String(33, " ") & "Total " & sMonE & " :", 33) & Right(String(17, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 17)
                   End If
                   '====================== nov 2010
                 Printer.Print " "
                 Printer.Print " "
                 Printer.Print " "
                 Printer.Print " "
                 Printer.Print " " & Mid(RsImpresion!Cliente & String(40, " "), 1, 40)
                 
            Case Is = "009" ' La Gloria
                 Dim RsPropiedad As ADODB.Recordset
                 Dim RsPropiedadCombo As ADODB.Recordset
                 
                 Isql = "SELECT dbo.TPRODUCTOPROPIEDAD.tItem, dbo.TOPERADOR.tDetallado AS Operador, dbo.TPROPIEDAD.tDetallado AS Descripcion " & _
                        "FROM dbo.TPRODUCTOPROPIEDAD INNER JOIN dbo.TPROPIEDAD ON dbo.TPRODUCTOPROPIEDAD.tCodigoPropiedad = dbo.TPROPIEDAD.tCodigoPropiedad AND dbo.TPRODUCTOPROPIEDAD.tProducto = dbo.TPROPIEDAD.tProducto INNER JOIN dbo.TOPERADOR ON dbo.TPROPIEDAD.tOperador = dbo.TOPERADOR.tOperador " & _
                        "where tCodigoPedido='" & sPedido & "' and TOPERADOR.lImprime=1"
                 Set RsPropiedad = Lib.OpenRecordset(Isql, Cn)
                 
                 Isql = "SELECT dbo.TCOMBOPROPIEDAD.tItem, dbo.TCOMBOPROPIEDAD.tItemCombo, dbo.TOPERADOR.tDetallado AS Operador, dbo.TPROPIEDAD.tDetallado AS Descripcion " & _
                        "FROM dbo.TCOMBOPROPIEDAD INNER JOIN dbo.TPROPIEDAD ON dbo.TCOMBOPROPIEDAD.tCodigoPropiedad = dbo.TPROPIEDAD.tCodigoPropiedad INNER JOIN dbo.TOPERADOR ON dbo.TPROPIEDAD.tOperador = dbo.TOPERADOR.tOperador " & _
                        "where tCodigoPedido='" & sPedido & "'  and TOPERADOR.lImprime=1"
                 Set RsPropiedadCombo = Lib.OpenRecordset(Isql, Cn)
            
                 For i = 1 To nCabecera - 5
                     Printer.Print
                 Next i
                             
                 Printer.Print "                         " & RsImpresion!tDocumento
                 Printer.Print "  " & Mid(RsImpresion!Cliente & String(40, " "), 1, 40) & "  " & Format(RsImpresion!fRegistro, "dd-MM-yy")
                 
                 For i = 1 To nDetalle - 2
                     Printer.Print
                 Next i
                 
                 'Cuerpo
                 Item = ""
                 i = 0
                 j = 0
                                  
                 Item = ""
                 Do While Not RsImpresion.EOF
                    If ximprimeDetallado = False Then
                        xproducto = RsImpresion!Producto
                    Else
                        xproducto = RsImpresion!ProductoDetallado
                    End If
                    
                    If Item <> RsImpresion!tCodigoPedido + RsImpresion!tItem Then
                       i = i + 1
                       sLinea = Right(Format("       " & RsImpresion!nCantidad, "###0.00"), 7) & "  " & Mid(xproducto & String(24, " "), 1, 24) & "        " & Right(String(15, " ") & Format(RsImpresion!nprecioVenta * RsImpresion!nCantidad, "#,###,##0.00"), 10)
                       Printer.Print sLinea
                    End If
                    
                    'Impresion de Propiedades
                    RsPropiedad.Filter = "tItem='" & RsImpresion!tItem & "'"
                    If Not RsPropiedad.EOF Then
                       RsPropiedad.MoveFirst
                       Do While Not RsPropiedad.EOF
                          i = i + 1
                          Printer.Print "      " & RsPropiedad!Operador & " " & RsPropiedad!Descripcion
                          RsPropiedad.MoveNext
                       Loop
                    End If
                             
                    'Impresion de la Observacion
                    If lPropiedadDocumento And Len(Trim(RsImpresion!tObservacionPedido)) > 0 Then
                       i = i + 1
                       ImprimeXLinea "      *" & Trim(RsImpresion!tObservacionPedido), 42, 2
                    End If
                    
                    Item = RsImpresion!tCodigoPedido + RsImpresion!tItem
                    RsImpresion.MoveNext
                 Loop
                                  
                 For j = i To nFItem - 4
                     Printer.Print " "
                 Next j
                             
                 RsImpresion.MoveLast
                                  
                 Printer.Print "      Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
                 Printer.Print " "
                 Printer.Print " "
                 Printer.Print String(35, " ") & Right(String(13, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 13)
                 '====================== nov 2010
                   If lDocumEquivaPrecuenta Then
                        Printer.Print " "
                       Printer.Print Right(String(35, " ") & "Total " & sMonE & " :", 35) & Right(String(13, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 13)
                   End If
                   '====================== nov 2010
                   
                   
            Case Is = "010" ' Mangos administracion 35 14 3

            
                 For i = 1 To nCabecera
                     Printer.Print
                 Next i
                 
                 If (RsImpresion!Cliente <> nulo) Then
                    Printer.Print "Cliente:   " & Left(Mid(RsImpresion!Cliente, 1, 60) & String(60, " "), 60)
                    Printer.Print "Dirección: " & Left(Mid(RsImpresion!direccion, 1, 60) & String(60, " "), 60)
                 Else
                    Printer.Print ""
                    Printer.Print ""
                 End If
                 
                 Printer.Print "Fecha:     " & Format(RsImpresion!fRegistro, " dd  MMMM  yyyy ") & String(3, " ") & Left("Usuario: " & RsImpresion!tUsuario & String(50, " "), 50)
                                                   
                 For i = 1 To nDetalle
                     Printer.Print
                 Next i
                 
                 'Cuerpo
                 Item = ""
                 i = 0
                 j = 0
                 
                 'Cuerpo
                 Item = ""
                 sLinea = "   " & Right(String(6, " ") & "CANT.", 6) & "     " & UCase(Mid("PRODUCTO" & String(48, " "), 1, 48)) & " " & Right(String(10, " ") & "PRECIO UNI", 10) & " " & Right(String(14, " ") & Format("SUBTOTAL"), 14)
                 Printer.Print sLinea
                 
                 Do While Not RsImpresion.EOF
                    If ximprimeDetallado = False Then
                        xproducto = RsImpresion!Producto
                    Else
                        xproducto = RsImpresion!ProductoDetallado
                    End If
                    
                    If Item <> RsImpresion!tCodigoPedido + RsImpresion!tItem Then
                       'Genera la cadena las Propiedades

                       i = i + 1
                       Producto = xproducto
                       
                       sLinea = "   " & Right(String(6, " ") & Format(RsImpresion!nCantidad, "###0.00"), 6) & "     " & UCase(Mid(Producto & String(48, " "), 1, 48)) & " " & Right(String(10, " ") & Format(RsImpresion!nprecioVenta, "##,##0.00"), 10) & " " & Right(String(14, " ") & Format(RsImpresion!nCantidad * RsImpresion!nprecioVenta, "#,###,##0.00"), 14)
                       Printer.Print sLinea
                    End If
                    
                    Item = RsImpresion!tCodigoPedido + RsImpresion!tItem
                    RsImpresion.MoveNext
                 Loop
                 
                
                 
                    For j = i To nFItem
                        Printer.Print " "
                    Next j
                 
                 
                 Printer.Print
                 RsImpresion.MoveLast
                 Printer.Print "              Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
 
                 Printer.Print ""
                 Printer.Print ""

                 If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
                    sImportes = Right(String(22, " ") & "NETO " & sMonN & Format(RsImpresion!nNeto, "##,###,##0.00"), 22) & _
                                Right(String(18, " ") & UCase(sImpuesto1) & " " & sMonN & Format(RsImpresion!nprecioImpuesto1, "##,###,##0.00"), 19) & _
                                Right(String(18, " ") & UCase(sImpuesto2) & " " & sMonN & Format(RsImpresion!nprecioImpuesto2, "##,###,##0.00"), 19) & _
                                Right(String(20, " ") & "TOTAL " & sMonN & Format(RsImpresion!nVenta, "##,###,##0.00"), 21)
                    Printer.Print String(6, " ") & sImportes
                 End If
                                  
      'cgmiranda*********************************************************************************
            Case Is = "011"  ' LIBER
                    
                 For i = 1 To nCabecera
                     Printer.Print
                 Next i
                 
                 Printer.Print "   Documento        : " & RsImpresion!tDocumento
                 Printer.Print "   Fecha de Emisión : " & Format(RsImpresion!fRegistro, "dd MMMM yyyy")
                 Printer.Print "   Cliente          : " & RsImpresion!Cliente
                 Printer.Print "   Dirección        : " & RsImpresion!direccion
                 Printer.Print "   Pedido           : " & sPedido
                 Printer.Print Mid("   Caja             : " & RsImpresion!tCaja & " - " & RsImpresion!tUsuario & String(53, " "), 1, 53) & "Mesero  : " & RsImpresion!Mozo
                 Printer.Print "   MESA             : " & IIf((RsImpresion!tMesa = "000" Or Len(Trim(RsImpresion!tMesa)) = 0 Or IsNull(RsImpresion!tMesa)), RsImpresion!tObservacion, RsImpresion!Mesa)
                 For i = 1 To nDetalle
                     Printer.Print
                 Next i
                 
                 'Cuerpo
                 Item = ""
                 i = 0
                 j = 0
                                  
                 Item = ""
                 Do While Not RsImpresion.EOF
                    If ximprimeDetallado = False Then
                        xproducto = RsImpresion!Producto
                    Else
                        xproducto = RsImpresion!ProductoDetallado
                    End If
                    
                    If Item <> RsImpresion!tCodigoPedido + RsImpresion!tItem Then
                       i = i + 1
                       'Printer.Print  ##,##0.00
                       sLinea = Right(String(11, " ") & Format(RsImpresion!nCantidad, "###0.00"), 7) & "  " & Mid(xproducto & String(58, " "), 1, 58) & " " & Right(String(9, " ") & Format(RsImpresion!nprecioVenta, "##,####0.0000"), 9) & "     " & Right(String(12, " ") & Format(RsImpresion!nCantidad * RsImpresion!nprecioVenta, "#,###,##0.00"), 12)
                       Printer.Print sLinea
                    End If
                    Item = RsImpresion!tCodigoPedido + RsImpresion!tItem
                    RsImpresion.MoveNext
                 Loop
                 
                 For j = i To nFItem
                     Printer.Print " "
                 Next j
                 
                 RsImpresion.MoveLast
                 If RsImpresion!nRecargo > 0 Then
                    Printer.Print Right(String(77, " ") & "Recargo : ", 77) & Right(String(17, " ") & Format(RsImpresion!nRecargo, "##,###,###,##0.00"), 17)
                 Else
                    Printer.Print
                 End If
                     
                 If RsImpresion!nDescuento > 0 Then
                    Printer.Print Right(String(77, " ") & "Descuento : ", 77) & Right(String(17, " ") & Format(RsImpresion!nDescuento, "##,###,###,##0.00"), 17)
                 Else
                    Printer.Print
                 End If
                 'Humberto 15/10/2008, se agrego la condición para saber si se debe o no imprimir el impuesto
                 If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
                    Printer.Print Right(String(77, " ") & "Valor Venta :", 77) & Right(String(17, " ") & Format(RsImpresion!nNeto, "##,##,###,##0.00"), 17)
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                    If RsImpresion!nprecioImpuesto1 > 0 Then
                       Printer.Print Right(String(77, " ") & sImpuesto1 & " " & Format(nPorcentaje1, "##0.00") & "% :", 77) & Right(String(17, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,###,##0.00"), 17)
                    End If
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                    If RsImpresion!nprecioImpuesto2 > 0 Then
                        Printer.Print Right(String(77, " ") & sImpuesto2 & " " & Format(nPorcentaje2, "##0.00") & "% :", 77) & Right(String(17, " ") & Format(RsImpresion!nprecioImpuesto2, "##,##,###,##0.00"), 17)
                    End If
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                    If RsImpresion!nprecioImpuesto3 > 0 Then
                       Printer.Print Right(String(77, " ") & sImpuesto3 & " " & Format(nPorcentaje3, "##0.00") & "% :", 77) & Right(String(17, " ") & Format(RsImpresion!nprecioImpuesto3, "##,##,###,##0.00"), 17)
                    End If
                 End If
                 'Humberto 15/10/2008, fin
                 Printer.Print Right(String(77, " ") & "Total " & sMonN & " : ", 77) & Right(String(17, " ") & Format(RsImpresion!nVenta, "##,##,###,##0.00"), 17)
                 '====================== nov 2010
                   If lDocumEquivaPrecuenta Then
                        Printer.Print " "
                       Printer.Print Right(String(77, " ") & "Total " & sMonE & " :", 77) & Right(String(17, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 17)
                   End If
                   '====================== nov 2010
                 Printer.Print UCase("SON: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN)
             'fin cgmiranda****************************************************************************
                                  
                    
             'CESAR NINAHUANCA
             Case Is = "013" 'COSTANERA 700

                 For i = 1 To nCabecera
                     Printer.Print
                 Next i
                 
                    Printer.Print " "
                    Printer.Print String(12, " ") & Left(Mid(RsImpresion!Cliente, 1, 60) & String(60, " "), 66)
                    Printer.Print String(12, " ") & Left(Mid(RsImpresion!direccion, 1, 60) & String(60, " "), 66)
                    Printer.Print String(12, " ") & Left(Mid(RsImpresion!Ruc, 1, 60) & String(60, " "), 66)
                    Printer.Print String(12, " ") & Left(Mid(RsImpresion!Mesa, 1, 28) & String(10, " "), 34) & "Mz: " & Left(Mid(RsImpresion!Mozo, 1, 20), 20) & "                 " & Format(RsImpresion!fRegistro, "  dd" & "  " & " MM" & " " & "  yyyy ")
                    
                    
                 For i = 1 To nDetalle
                     Printer.Print
                 Next i
                 
                 'Cuerpo
                 Item = ""
                 i = 0
                 j = 0
                 
                 'Cuerpo
                 Item = ""
                 Printer.Print sLinea
                 
                 Do While Not RsImpresion.EOF
                    If ximprimeDetallado = False Then
                        xproducto = RsImpresion!Producto
                    Else
                        xproducto = RsImpresion!ProductoDetallado
                    End If
                    
                    If Item <> RsImpresion!tCodigoPedido + RsImpresion!tItem Then
                       i = i + 1
                       Producto = xproducto
                       
                       sLinea = Right(String(6, " ") & Format(RsImpresion!nCantidad, "##0.00"), 6) & "    " & UCase(Mid(Producto & String(48, " "), 1, 48)) & "          " & Right(String(12, " ") & Format(RsImpresion!nprecioVenta, "##,##0.00"), 12) & " " & Right(String(14, " ") & Format(RsImpresion!nCantidad * RsImpresion!nprecioVenta, "#,###,##0.00"), 14)
                       Printer.Print sLinea
                    End If
                    
                    Item = RsImpresion!tCodigoPedido + RsImpresion!tItem
                    RsImpresion.MoveNext
                 Loop
                 
                    For j = i To nFItem
                        Printer.Print " "
                    Next j

                 Printer.Print

                 RsImpresion.MoveLast
                 
                     sImportes = Right(String(16, " ") & Format(RsImpresion!nNeto, "##,###,##0.00"), 16)
                    sImportes1 = Right(String(15, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,##0.00"), 15)
                    sImportes2 = Right(String(15, " ") & Format(RsImpresion!nprecioImpuesto2, "##,###,##0.00"), 15)
                    sImportes3 = Right(String(20, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 20)
                                  
                 Printer.Print "        Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
                 Printer.Print " "
                 'Printer.Print " "
                 'Printer.Print " "
                 'Printer.Print " "
                 Printer.Print String(69, " ") & "SUB TOTAL" & sImportes
                 'Printer.Print String(69, " ") & "I.G.V." & Format(nPorcentaje1, " ##0") & "% " & sImportes1
                 'Printer.Print String(63, " ") & sImpuesto2 & Format(nPorcentaje2, " ##0") & "% " & sImportes2
                 Printer.Print String(72, " ") & "I.G.V." & " " & sImportes1
                 Printer.Print String(76, " ") & sImpuesto2 & " " & sImportes2
                 Printer.Print " "
                 Printer.Print String(6, " ") & Format(RsImpresion!fRegistro, " dd" & "    " & " MMMM" & "        " & " yyyy ") & String(47, " ") & Right(String(13, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 13)
               
             'CESAR NINAHUANCA
             Case Is = "014" 'QUEIROLO

                 'Impresion de Observacion
                 Dim ObsPedido As String
                 Dim tTipoDocumento As String
                 
                 tTipoDocumento = Calcular("select ISNULL(t.lImpObs, '0') As Codigo from TTIPODOCUMENTO t INNER JOIN MDOCUMENTO m ON t.tCodigoTipoDocumento = m.tTipoDocumento where m.tDocumento ='" & RsImpresion!tDocumento & "'", Cn)

                 If tTipoDocumento = "Verdadero" Then
                     ObsPedido = Calcular("select ISNULL(MAX(m.tobservacion),'') As Codigo from mpedido m INNER JOIN ddocumento d ON m.tcodigopedido = d.tCodigoPedido where d.tdocumento ='" & RsImpresion!tDocumento & "'", Cn)
                 Else
                     ObsPedido = " "
                 End If
                 '--------------------------------------------------
                 
                 For i = 1 To nCabecera
                     Printer.Print
                 Next i
                 
                    Printer.Print "             LIMA - PERU"
                    Printer.Print ""
                    Printer.Print ""
                    Printer.Print String(5, " ") & Format(RsImpresion!fRegistro, "dd /" & " " & "MM /" & " " & "yyyy") & "              " & "Mesa: " & Left(Mid(RsImpresion!Mesa, 1, 30) & String(30, " "), 36)
                    Printer.Print String(5, " ") & Left(Mid(RsImpresion!Cliente, 1, 46) & String(46, " "), 50)
                    Printer.Print String(5, " ") & Left(Mid(ObsPedido, 1, 46) & String(46, " "), 50) 'Obrservacion
                    Printer.Print ""
                    Printer.Print ""
                    
                 For i = 1 To nDetalle
                     Printer.Print
                 Next i
                 
                 'Cuerpo
                 Item = ""
                 i = 0
                 j = 0
                 
                 'Cuerpo
                 Item = ""
                 Printer.Print sLinea
                 
                 Do While Not RsImpresion.EOF
                    If ximprimeDetallado = False Then
                        xproducto = RsImpresion!Producto
                    Else
                        xproducto = RsImpresion!ProductoDetallado
                    End If
                    
                    If Item <> RsImpresion!tCodigoPedido + RsImpresion!tItem Then
                       i = i + 1
                       Producto = xproducto
                       
                       'sLinea = Right(String(6, " ") & Format(RsImpresion!nCantidad, "##0.00"), 6) & String(14, " ") & UCase(Mid(Producto & String(48, " "), 1, 48)) & " " & Right(String(14, " ") & Format(RsImpresion!nCantidad * RsImpresion!nprecioVenta, "#,###,##0.00"), 14)
                       sLinea = Right(String(0, " ") & Format(RsImpresion!nCantidad, "##0.00"), 6) & String(4, " ") & UCase(Mid(Producto & String(48, " "), 1, 48)) & String(11, " ") & Right(String(14, " ") & Format(RsImpresion!nCantidad * RsImpresion!nprecioVenta, "#,###,##0.00"), 14)
                       Printer.Print sLinea
                    End If
                    
                    Item = RsImpresion!tCodigoPedido + RsImpresion!tItem
                    RsImpresion.MoveNext
                 Loop
                 
                    For j = i To nFItem
                        Printer.Print " "
                    Next j

                 Printer.Print

                 RsImpresion.MoveLast
                 
                 Printer.Print " "
                 Printer.Print " "
                 Printer.Print " "
                 Printer.Print "        Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
                 Printer.Print String(55, " ") & "TOTAL: " & sMonN & " " & Right(String(15, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 15)
                '-------------------------------------------
                
                               
            'CESAR NINAHUANCA
            Case Is = "015"  ' PIKALO
                    
                 For i = 1 To nCabecera
                     Printer.Print
                 Next i
                 
                 Printer.Print "   Documento        : " & RsImpresion!tDocumento
                 Printer.Print "   Fecha de Emisión : " & Format(RsImpresion!fRegistro, "dd MMMM yyyy")
                 Printer.Print "   Cliente          : " & RsImpresion!Cliente
                 Printer.Print "   Dirección        : " & RsImpresion!direccion
                 Printer.Print "   Pedido           : " & sPedido
                 Printer.Print Mid("   Caja             : " & RsImpresion!tCaja & " - " & RsImpresion!tUsuario & String(53, " "), 1, 53) & "Transportista    : " & RsImpresion!Mozo
                 Printer.Print "   Destino          : " & IIf((RsImpresion!tMesa = "000" Or Len(Trim(RsImpresion!tMesa)) = 0 Or IsNull(RsImpresion!tMesa)), RsImpresion!tObservacion, RsImpresion!Mesa)
                 For i = 1 To nDetalle
                     Printer.Print
                 Next i
                 
                 'Cuerpo
                 Item = ""
                 i = 0
                 j = 0
                                  
                 Item = ""
                 Do While Not RsImpresion.EOF
                    If ximprimeDetallado = False Then
                        xproducto = RsImpresion!Producto
                    Else
                        xproducto = RsImpresion!ProductoDetallado
                    End If
                    
                    If Item <> RsImpresion!tCodigoPedido + RsImpresion!tItem Then
                       i = i + 1
                       sLinea = Right(String(11, " ") & Format(RsImpresion!nCantidad, "###0.00"), 7) & "  " & Mid(xproducto & String(58, " "), 1, 58) & " " & Right(String(9, " ") & Format(RsImpresion!nprecioVenta, "##,####0.0000"), 9) & "     " & Right(String(12, " ") & Format(RsImpresion!nCantidad * RsImpresion!nprecioVenta, "#,###,##0.00"), 12)
                       Printer.Print sLinea
                    End If
                    Item = RsImpresion!tCodigoPedido + RsImpresion!tItem
                    RsImpresion.MoveNext
                 Loop
                 
                 For j = i To nFItem
                     Printer.Print " "
                 Next j
                 
                 RsImpresion.MoveLast
                 If RsImpresion!nRecargo > 0 Then
                    Printer.Print Right(String(77, " ") & "Recargo : ", 77) & Right(String(17, " ") & Format(RsImpresion!nRecargo, "##,###,###,##0.00"), 17)
                 Else
                    Printer.Print
                 End If
                     
                 If RsImpresion!nDescuento > 0 Then
                    Printer.Print Right(String(77, " ") & "Descuento : ", 77) & Right(String(17, " ") & Format(RsImpresion!nDescuento, "##,###,###,##0.00"), 17)
                 Else
                    Printer.Print
                 End If

                 If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
                    Printer.Print Right(String(77, " ") & "Valor Venta :", 77) & Right(String(17, " ") & Format(RsImpresion!nNeto, "##,##,###,##0.00"), 17)
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                    If RsImpresion!nprecioImpuesto1 > 0 Then
                       Printer.Print Right(String(77, " ") & sImpuesto1 & " " & Format(nPorcentaje1, "##0.00") & "% :", 77) & Right(String(17, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,###,##0.00"), 17)
                    End If
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                    If RsImpresion!nprecioImpuesto2 > 0 Then
                        Printer.Print Right(String(77, " ") & sImpuesto2 & " " & Format(nPorcentaje2, "##0.00") & "% :", 77) & Right(String(17, " ") & Format(RsImpresion!nprecioImpuesto2, "##,##,###,##0.00"), 17)
                    End If
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                    If RsImpresion!nprecioImpuesto3 > 0 Then
                       Printer.Print Right(String(77, " ") & sImpuesto3 & " " & Format(nPorcentaje3, "##0.00") & "% :", 77) & Right(String(17, " ") & Format(RsImpresion!nprecioImpuesto3, "##,##,###,##0.00"), 17)
                    End If
                 End If

                 Printer.Print Right(String(77, " ") & "Total " & sMonN & " : ", 77) & Right(String(17, " ") & Format(RsImpresion!nVenta, "##,##,###,##0.00"), 17)

                   If lDocumEquivaPrecuenta Then
                        Printer.Print " "
                       Printer.Print Right(String(77, " ") & "Total " & sMonE & " :", 77) & Right(String(17, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 17)
                   End If

                 Printer.Print UCase("SON: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN)
                               
                               
                               
                Case Is = "017" ' saint
                 For i = 1 To 7
                     Printer.Print
                 Next i
              
                 Printer.Print String(45, " ") & RsImpresion!tDocumento
                  For i = 1 To 2
                     Printer.Print
                 Next i
                 
                Printer.Print String(8, " ") & Left(Mid(RsImpresion!Cliente, 1, 30) & String(30, " "), 33) & String(7, " ") & Format(RsImpresion!fRegistro, "dd MMMM yyyy")
                Printer.Print String(8, " ") & Left(Mid(RsImpresion!direccion, 1, 30) & String(30, " "), 33) & String(10, " ") & IIf(IsNull(RsImpresion!Ruc), "", RsImpresion!Ruc)
                 For i = 1 To 2
                     Printer.Print
                 Next i
                
   
                 'Cuerpo
                 Item = ""
                 i = 0
                 j = 0
                                  
                 Item = ""
                 Do While Not RsImpresion.EOF
                    If ximprimeDetallado = False Then
                        xproducto = RsImpresion!Producto
                    Else
                        xproducto = RsImpresion!ProductoDetallado
                    End If
                    
                    If Item <> RsImpresion!tCodigoPedido + RsImpresion!tItem Then
                       i = i + 1
                       sLinea = Right(String(18, " ") & Format(RsImpresion!nCantidad, "###0.00"), 7) & "  " & Mid(xproducto & String(35, " "), 1, 35) & " " & String(4, " ") & Right(String(12, " ") & Format(RsImpresion!nCantidad * RsImpresion!nprecioVenta, "#,###,##0.00"), 12)
                       Printer.Print sLinea
                    End If
                    Item = RsImpresion!tCodigoPedido + RsImpresion!tItem
                    RsImpresion.MoveNext
                 Loop
                                 
                                 
                 For j = i To 20
                     Printer.Print " "
                 Next j
                 
                 RsImpresion.MoveLast
                 Printer.Print String(8, " ") & UCase("SON: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN)

                 Printer.Print Right(String(49, " "), 77) & Right(String(18, " ") & Format(RsImpresion!nVenta, "##,##,###,##0.00"), 12)
                 Printer.Print " "
                 Printer.Print String(23, " ") & "HORA: " & Format(RsImpresion!fRegistro, "HH:MM:SS")
            'Luis Chumpitaz
            Case Is = "020" ' Jose Antonio
        
                 For i = 1 To nCabecera
                     Printer.Print
                 Next i
                 
                 'Printer.Print "        " & Left(Mid(RsImpresion!Cliente, 1, 60) & String(60, " "), 60)
                 If IsNull(RsImpresion!Ruc) = False Or Len(RsImpresion!Ruc) > 0 Then
                    Printer.Print "       " & Left("DNI " & Right(IIf(IsNull(RsImpresion!Ruc), "", RsImpresion!Ruc), 8) & String(55, " "), 55)
                 Else
                    Printer.Print "       " & Left("" & Right(IIf(IsNull(RsImpresion!Ruc), "", RsImpresion!Ruc), 8) & String(55, " "), 55)
                 End If
                 If IsNull(RsImpresion!Cliente) = True Or Len(RsImpresion!Cliente) = 0 Then
                    Printer.Print "       " & Left(Mid(IIf(IsNull(RsImpresion!tObservacion), "", RsImpresion!tObservacion), 1, 65) & String(65, " "), 65)
                 Else
                    Printer.Print "       " & Left(Mid(RsImpresion!Cliente, 1, 55) & String(55, " "), 55)
                 End If
                 Printer.Print ""
                 Printer.Print Left(RsImpresion!tUsuario & String(10, " "), 10) & String(2, " ") & Mid(WeekdayName(Weekday(Format(RsImpresion!fRegistro, "dd/MM/yyyy"))), 1, 3) & String(1, " ") & Format(RsImpresion!fRegistro, "dd/MM/yyyy") & String(1, " ") & Right(sTurno, 5) & String(1, " ") & Left(RsImpresion!Mozo & String(6, " "), 6) & String(1, " ") & Left(RsImpresion!Mesa & String(10, " "), 10) & String(7, " "); RsImpresion!tDocumento
                 'Printer.Print "            " & Mid(RsImpresion!tDocumento & String(45, " "), 1, 45) & "    Caja   : " & RsImpresion!tCaja & " - " & RsImpresion!tUsuario
                                                 
                 For i = 1 To nDetalle
                     Printer.Print
                 Next i
                 
                 'Cuerpo
                 Item = ""
                 i = 0
                 j = 0
                 
                 'Cuerpo
                 Item = ""
                 nPorcDscto = RsImpresion!PorcDscto
                 sMotivoDscto = RsImpresion!DESCUENTO
                 nMontoDscto = Calcular("select sum(ndescuento*ncantidad) as codigo from ddocumento where tdocumento='" & RsImpresion!tDocumento & "'", Cn)
                 nDescBolJA = RsImpresion!nDescuento
                 
                 Do While Not RsImpresion.EOF
                    If ximprimeDetallado = False Then
                        xproducto = RsImpresion!Producto
                    Else
                        xproducto = RsImpresion!ProductoDetallado
                    End If
                    
                    If Item <> RsImpresion!tCodigoPedido + RsImpresion!tItem Then
                       i = i + 1
                       If Len(RsImpresion!Propiedad) > 0 Then
                        Producto = xproducto & ", " & Mid(RsImpresion!Propiedad, 1, Len(RsImpresion!Propiedad) - 1)
                       Else
                        Producto = xproducto
                       End If
                       sNum = "   "
                       sLinea = "   " & sNum & " " & Right(String(6, " ") & Format(RsImpresion!nCantidad, "###0.00"), 6) & " " & UCase(Mid(Producto & String(48, " "), 1, 48)) & " " & Right(String(10, " ") & Format(RsImpresion!nprecioVenta, "##,##0.00"), 10) & " " & Right(String(14, " ") & Format(RsImpresion!nCantidad * RsImpresion!nprecioVenta, "#,###,##0.00"), 14)
                       Printer.Print sLinea
                    End If
                                        
                    Item = RsImpresion!tCodigoPedido + RsImpresion!tItem
                    RsImpresion.MoveNext
                 Loop
                                  
                 'Imprime el Descuento
'                 If nPorcDscto > 0 Then
'                    For j = i To nFItem - 1
'                        Printer.Print " "
'                    Next j
'
'                    sLinea = "Descuento " & sMotivoDscto & ". Monto S/." & Format(nMontoDscto, "##,###,##0.00")
'                    Printer.Print "              " & sLinea
'                 Else
'                    For j = i To nFItem
'                        Printer.Print " "
'                    Next j
'                 End If

                 '-------DESCUENTOS
                 If nDescBolJA > 0 Then
                    For j = i To nFItem - 1
                        Printer.Print " "
                    Next j
                    sLinea = "Descuento " & sMotivoDscto & ". Monto S/." & Format(nMontoDscto, "##,###,##0.00")
                    Printer.Print "              " & sLinea
        
                 Else
                    For j = i To nFItem
                        Printer.Print " "
                    Next j
                 End If
                 
                 Printer.Print
                 RsImpresion.MoveLast
                 Printer.Print "              Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
                 
                 Printer.Print ""
                 Printer.Print ""

                 If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
                    sImportes = Right(String(10, " ") & Format(RsImpresion!nNeto, "##,###,##0.00"), 10) & _
                                Right(String(10, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,##0.00"), 10) & _
                                Right(String(10, " ") & Format(RsImpresion!nprecioImpuesto2, "##,###,##0.00"), 10) & _
                                Right(String(15, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 15)
                    'Printer.Print String(39, " ") & sImportes
                    Printer.FontBold = True
                    Printer.Print String(20, " ") & Format(RsImpresion!fRegistro, " dd     MM       yyyy ") & sImportes
                    Printer.FontBold = False
                 End If
                   
        End Select
        Printer.EndDoc
End Sub


Public Sub ImprimeFacturaConsumoEmpresa15(RsImpresion As Recordset, sConsumo As String, Empresa As String)

                 For i = 1 To nCabecera
                     Printer.Print
                 Next i
                 
                 Printer.Print "   Documento        : " & RsImpresion!tDocumento
                 Printer.Print "   Fecha de Emisión : " & Format(RsImpresion!fRegistro, "dd MMMM yyyy") & "                  RUC     : " & RsImpresion!Ruc
                 Printer.Print "   Cliente          : " & RsImpresion!Cliente
                 Printer.Print "   Dirección        : " & RsImpresion!direccion
                 Printer.Print "   Pedido           : " & sPedido
                 Printer.Print Mid("   Caja             : " & RsImpresion!tCaja & " - " & RsImpresion!tUsuario & String(53, " "), 1, 53) & "Transportista    : " & RsImpresion!Mozo
                 Printer.Print "   Destino             : " & IIf((RsImpresion!tMesa = "000" Or Len(Trim(RsImpresion!tMesa)) = 0 Or IsNull(RsImpresion!tMesa)), RsImpresion!tObservacion, RsImpresion!Mesa)
                 For i = 1 To nDetalle
                     Printer.Print
                 Next i
                 
                 'Cuerpo
                 Printer.Print
                 txt = sConsumo
                 tOt = Len(Trim(txt))
                 pri = True
                 j = 0
                 Do While tOt <> 0
                    j = j + 1
                    lin = Mid(txt & " ", 1, 45)
                    For i = 45 To 1 Step -1
                        If Mid(lin, i, 1) = " " Then
                           pos = i
                           Exit For
                        End If
                    Next i
                    If pri Then
                       sLinea = "              " & Mid(Mid(txt, 1, pos - 1) & String(45, " "), 1, 45) & "                " & Right(String(12, " ") & Format(RsImpresion!nVenta, "#,###,##0.00"), 12)
                       pri = False
                    Else
                       sLinea = "              " & Mid(txt, 1, pos - 1)
                    End If
                    txt = Mid(txt, pos + 1, tOt)
                    tOt = Len(txt)
                    Printer.Print sLinea
                 Loop
                    
                 For i = j To nFItem - 1
                     Printer.Print " "
                 Next i
                 
                 RsImpresion.MoveLast
                 If RsImpresion!nRecargo > 0 Then
                    Printer.Print Right(String(77, " ") & "Recargo : ", 77) & Right(String(17, " ") & Format(RsImpresion!nRecargo, "##,###,###,##0.00"), 17)
                 Else
                    Printer.Print
                 End If
                     
                 If RsImpresion!nDescuento > 0 Then
                    Printer.Print Right(String(77, " ") & "Descuento : ", 77) & Right(String(17, " ") & Format(RsImpresion!nDescuento, "##,###,###,##0.00"), 17)
                 Else
                    Printer.Print
                 End If
                 
                 'Humberto 15/10/2008, se agrego la condición para saber si se debe o no imprimir el impuesto
                 If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
                    Printer.Print Right(String(77, " ") & "Valor Venta :", 77) & Right(String(17, " ") & Format(RsImpresion!nNeto, "##,##,###,##0.00"), 17)
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                    If RsImpresion!nprecioImpuesto1 > 0 Then
                       Printer.Print Right(String(77, " ") & sImpuesto1 & " " & Format(nPorcentaje1, "##0.00") & "% :", 77) & Right(String(17, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,###,##0.00"), 17)
                    End If
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                    If RsImpresion!nprecioImpuesto2 > 0 Then
                        Printer.Print Right(String(77, " ") & sImpuesto2 & " " & Format(nPorcentaje2, "##0.00") & "% :", 77) & Right(String(17, " ") & Format(RsImpresion!nprecioImpuesto2, "##,##,###,##0.00"), 17)
                    End If
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                    If RsImpresion!nprecioImpuesto3 > 0 Then
                        Printer.Print Right(String(77, " ") & sImpuesto3 & " " & Format(nPorcentaje3, "##0.00") & "% :", 77) & Right(String(17, " ") & Format(RsImpresion!nprecioImpuesto3, "##,##,###,##0.00"), 17)
                    End If
                 End If
                 'Humberto 15/10/2008, FIN
                 Printer.Print Right(String(77, " ") & "Total " & sMonN & " : ", 77) & Right(String(17, " ") & Format(RsImpresion!nVenta, "##,##,###,##0.00"), 17)
                   '====================== nov 2010
                If lDocumEquivaPrecuenta Then
                     Printer.Print " "
                    Printer.Print Right(String(77, " ") & "Total " & sMonE & " :", 77) & Right(String(17, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 17)
                End If
                '====================== nov 2010
                 Printer.Print UCase("SON: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN)

End Sub



Public Sub ImprimeFacturaConsumoEmpresa16(RsImpresion As Recordset, sConsumo As String, Empresa As String)

                 For i = 1 To nCabecera
                     Printer.Print
                 Next i
                 
                 Printer.Print "   " & Format(RsImpresion!fRegistro, "dd") & "      " & Mid(Format(RsImpresion!fRegistro, "MMMM") & String(14, " "), 1, 14) & "      " & Mid(Format(RsImpresion!fRegistro, "yyyy"), 4, 1)
                 Printer.Print " "
                 Printer.Print " "
                 Printer.Print "       " & Mid(RsImpresion!Cliente & String(58, " "), 1, 58) & "  " & RsImpresion!Ruc
                 Printer.Print " "
                 Printer.Print "       " & RsImpresion!direccion
                 
                 For i = 1 To nDetalle
                     Printer.Print
                 Next i
                 
                 'Cuerpo
                 Printer.Print
                 txt = sConsumo
                 tOt = Len(Trim(txt))
                 pri = True
                 j = 0
                 Do While tOt <> 0
                    j = j + 1
                    lin = Mid(txt & " ", 1, 45)
                    For i = 45 To 1 Step -1
                        If Mid(lin, i, 1) = " " Then
                           pos = i
                           Exit For
                        End If
                    Next i
                    If pri Then
                       sLinea = "              " & Mid(Mid(txt, 1, pos - 1) & String(45, " "), 1, 45) & "                " & Right(String(12, " ") & Format(RsImpresion!nVenta, "#,###,##0.00"), 12)
                       pri = False
                    Else
                       sLinea = "              " & Mid(txt, 1, pos - 1)
                    End If
                    txt = Mid(txt, pos + 1, tOt)
                    tOt = Len(txt)
                    Printer.Print sLinea
                 Loop
                    
                 For i = j To nFItem - 1
                     Printer.Print " "
                 Next i
                 
                 Printer.Print
                 RsImpresion.MoveLast
                 
                 Printer.Print " "
                 Printer.Print " "
                 Printer.Print " "
                 Printer.Print "           " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
 
                 Printer.Print " "
                 
                 sImportes = Right(String(90, " ") & Format(RsImpresion!nNeto, "##,###,##0.00"), 90)
                 sImportes1 = Right(String(90, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,##0.00"), 90)
                 sImportes2 = Right(String(90, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 90)
                 
                 Printer.Print sImportes
                 Printer.Print " "
                 Printer.Print sImportes1
                 Printer.Print sImportes2
                 
End Sub
Public Sub ImprimeFacturaNEmpresa15(RsImpresion As Recordset, Empresa As String, Optional tTipoDoc As String)
                ximprimeDetallado = Calcular("select lImprimeresumen as codigo from ttipodocumentoimpresora where ttipoemision='" & tTipoDoc & "' and  tcaja='" & sCaja & "'", Cn)

                 For i = 1 To nCabecera
                     Printer.Print
                 Next i
                 
                 Printer.Print "   Documento        : " & RsImpresion!tDocumento
                 Printer.Print "   Fecha de Emisión : " & Format(RsImpresion!fRegistro, "dd MMMM yyyy") & "                  RUC     : " & RsImpresion!Ruc
                 Printer.Print "   Cliente          : " & RsImpresion!Cliente
                 Printer.Print "   Dirección        : " & RsImpresion!direccion
                 Printer.Print "   Pedido           : " & sPedido
                 Printer.Print Mid("   Caja             : " & RsImpresion!tCaja & " - " & RsImpresion!tUsuario & String(53, " "), 1, 53) & "Transportista    : " & RsImpresion!Mozo
                 Printer.Print "   Destino          : " & IIf((RsImpresion!tMesa = "000" Or Len(Trim(RsImpresion!tMesa)) = 0 Or IsNull(RsImpresion!tMesa)), RsImpresion!tObservacion, RsImpresion!Mesa)
                 
                 For i = 1 To nDetalle
                     Printer.Print
                 Next i
                 
                 'Cuerpo
                 Item = ""
                 i = 0
                 j = 0
                                  
                 Item = ""
                 Do While Not RsImpresion.EOF
                   If ximprimeDetallado = False Then
                        xproducto = RsImpresion!Producto
                    Else
                        xproducto = RsImpresion!ProductoDetallado
                    End If
                    
                    If Item <> RsImpresion!tCodigoPedido + RsImpresion!tItem Then
                       i = i + 1
                       'Printer.Print
                       sLinea = Right(String(11, " ") & Format(RsImpresion!nCantidad, "###0.00"), 7) & "  " & Mid(xproducto & String(58, " "), 1, 58) & " " & Right(String(9, " ") & Format(RsImpresion!nprecioVenta, "##,####0.0000"), 9) & "     " & Right(String(12, " ") & Format(RsImpresion!nCantidad * RsImpresion!nprecioVenta, "#,###,##0.00"), 12)
                       Printer.Print sLinea
                    End If
                    Item = RsImpresion!tCodigoPedido + RsImpresion!tItem
                    RsImpresion.MoveNext
                 Loop
                                  
                 For j = i To nFItem
                     Printer.Print " "
                 Next j
                 
                 RsImpresion.MoveLast
                 If RsImpresion!nRecargo > 0 Then
                    Printer.Print Right(String(77, " ") & "Recargo : ", 77) & Right(String(17, " ") & Format(RsImpresion!nRecargo, "##,###,###,##0.00"), 17)
                 Else
                    Printer.Print
                 End If
                     
                 If RsImpresion!nDescuento > 0 Then
                    Printer.Print Right(String(77, " ") & "Descuento : ", 77) & Right(String(17, " ") & Format(RsImpresion!nDescuento, "##,###,###,##0.00"), 17)
                 Else
                    Printer.Print
                 End If

                 If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
                    Printer.Print Right(String(77, " ") & "Valor Venta :", 77) & Right(String(17, " ") & Format(RsImpresion!nNeto, "##,##,###,##0.00"), 17)
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                    If RsImpresion!nprecioImpuesto1 > 0 Then
                        Printer.Print Right(String(77, " ") & sImpuesto1 & " " & Format(nPorcentaje1, "##0.00") & "% :", 77) & Right(String(17, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,###,##0.00"), 17)
                    End If
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                    If RsImpresion!nprecioImpuesto2 > 0 Then
                       Printer.Print Right(String(77, " ") & sImpuesto2 & " " & Format(nPorcentaje2, "##0.00") & "% :", 77) & Right(String(17, " ") & Format(RsImpresion!nprecioImpuesto2, "##,##,###,##0.00"), 17)
                    End If
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                    If RsImpresion!nprecioImpuesto3 > 0 Then
                       Printer.Print Right(String(77, " ") & sImpuesto3 & " " & Format(nPorcentaje3, "##0.00") & "% :", 77) & Right(String(17, " ") & Format(RsImpresion!nprecioImpuesto3, "##,##,###,##0.00"), 17)
                    End If
                 End If

                 Printer.Print Right(String(77, " ") & "Total " & sMonN & " : ", 77) & Right(String(17, " ") & Format(RsImpresion!nVenta, "##,##,###,##0.00"), 17)

                If lDocumEquivaPrecuenta Then
                     Printer.Print " "
                    Printer.Print Right(String(77, " ") & "Total " & sMonE & " :", 77) & Right(String(17, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 17)
                End If

                 Printer.Print UCase("SON: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN)

End Sub
Public Sub ImprimeFacturaNEmpresa100(RsImpresion As Recordset, Empresa As String, Optional tTipoDoc As String)
                ximprimeDetallado = Calcular("select lImprimeresumen as codigo from ttipodocumentoimpresora where ttipoemision='" & tTipoDoc & "' and  tcaja='" & sCaja & "'", Cn)

                 For i = 1 To nCabecera
                     Printer.Print
                 Next i
                 
                nAlto = Printer.TextHeight("A")
                nSalto = 0.254
                 
                 
                Printer.CurrentY = nAlto * 11
                Printer.Print "   Fecha de Emisión : " & Format(RsImpresion!fRegistro, "dd        MMMM            yyyy") & "                   Documento : " & RsImpresion!tDocumento   '& "-" & RsImpresion!tNumGuia
                Printer.CurrentY = nAlto * 12 + nAlto * nSalto * 1
                Printer.Print "   Nombre           : " & RsImpresion!Cliente & String(106 - Len(RsImpresion!Cliente), " ") '& RsImpresion!Motivo
                Printer.CurrentY = nAlto * 13 + nAlto * nSalto * 2
                Printer.Print "   Dirección        : " & RsImpresion!direccion & String(114 - Len(RsImpresion!direccion), " ")
                Printer.CurrentY = nAlto * 14 + nAlto * nSalto * 3
                Printer.Print "   R.U.C.           : " & RsImpresion!Ruc & String(114 - Len(RsImpresion!Ruc), " ")
                Printer.CurrentY = nAlto * 15 + nAlto * nSalto * 4
               ' Printer.Print "   Transportista    : " & RsImpresion!Mozo & String(56 - Len(RsImpresion!Mozo), " ") '& RsImpresion!Placa & String(32 - Len(RsImpresion!Placa), " ") '& RsImpresion!tLicencia
                'Printer.CurrentY = nAlto * 16 + nAlto * nSalto * 5
                'Printer.Print String(18, " ") & RsImpresion!DireccionTransportista & String(114 - Len(RsImpresion!DireccionTransportista), " ")
                'Printer.CurrentY = nAlto * 17 + nAlto * nSalto * 6
                'Printer.Print String(18, " ") & RsImpresion!IdentidadTransportista & String(24, " ")
               ' Printer.CurrentY = nAlto * 18 + nAlto * nSalto * 7
                'nAncho = Len(RsImpresion!tDomicilioPartida)
                'Printer.Print String(22, " ") & RsImpresion!tDomicilioPartida & String(74 - nAncho, " ") & RsImpresion!tDomicilioDestino
                'Printer.Print String(22, " ") + Left(sDireccion, 50) & String(35, " ") & IIf(RsImpresion!Tienda = "", RsImpresion!direccion, RsImpresion!DireccionTienda)
                'Printer.Print "   Destino          : " & IIf((RsImpresion!tMesa = "000" Or Len(Trim(RsImpresion!tMesa)) = 0 Or IsNull(RsImpresion!tMesa)), RsImpresion!tObservacion, RsImpresion!Mesa)

                 
'                 Printer.Print "   Documento        : " & RsImpresion!tDocumento
'                 Printer.Print "   Fecha de Emisión : " & Format(RsImpresion!fRegistro, "dd MMMM yyyy") & "                  RUC     : " & RsImpresion!RUC
'                 Printer.Print "   Cliente          : " & RsImpresion!Cliente
'                 Printer.Print "   Dirección        : " & RsImpresion!direccion
'                 Printer.Print "   Pedido           : " & sPedido
'                 Printer.Print Mid("   Caja             : " & RsImpresion!tCaja & " - " & RsImpresion!tUsuario & String(53, " "), 1, 53) & "Transportista    : " & RsImpresion!Mozo
'                 Printer.Print "   Destino          : " & IIf((RsImpresion!tMesa = "000" Or Len(Trim(RsImpresion!tMesa)) = 0 Or IsNull(RsImpresion!tMesa)), RsImpresion!tObservacion, RsImpresion!Mesa)
'
                 For i = 1 To nDetalle
                     Printer.Print
                 Next i
                 
                 'Cuerpo
                 Item = ""
                 i = 0
                 j = 0
                                  
                 Item = ""
                 Do While Not RsImpresion.EOF
                   If ximprimeDetallado = False Then
                        xproducto = RsImpresion!Producto
                    Else
                        xproducto = RsImpresion!ProductoDetallado
                    End If
                    
                    If Item <> RsImpresion!tCodigoPedido + RsImpresion!tItem Then
                       i = i + 1
                       'Printer.Print
                       sLinea = Right(String(6, " ") & Format(RsImpresion!nCantidad, "###,##0.00"), 10) & String(4, " ") & Mid(xproducto & String(58, " "), 1, 58) & String(32, " ") & Right(String(9, " ") & Format(RsImpresion!nprecioVenta, "##,####0.0000"), 9) & "      " & Right(String(12, " ") & Format(RsImpresion!nCantidad * RsImpresion!nprecioVenta, "#,###,##0.00"), 12)
                       Printer.Print sLinea
                    End If
                    Item = RsImpresion!tCodigoPedido + RsImpresion!tItem
                    RsImpresion.MoveNext
                 Loop
                                  
                 For j = i To nFItem
                     Printer.Print " "
                 Next j
                 
                 RsImpresion.MoveLast
                 If RsImpresion!nRecargo > 0 Then
                    Printer.Print Right(String(110, " ") & "Recargo : ", 110) & Right(String(17, " ") & Format(RsImpresion!nRecargo, "##,###,###,##0.00"), 17)
                 Else
                    Printer.Print
                 End If
                     
                 If RsImpresion!nDescuento > 0 Then
                    Printer.Print Right(String(110, " ") & "Descuento : ", 110) & Right(String(17, " ") & Format(RsImpresion!nDescuento, "##,###,###,##0.00"), 17)
                 Else
                    Printer.Print
                 End If

                 If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
                    Printer.Print Right(String(110, " ") & "Valor Venta :", 110) & Right(String(17, " ") & Format(RsImpresion!nNeto, "##,##,###,##0.00"), 17)
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                    If RsImpresion!nprecioImpuesto1 > 0 Then
                        Printer.Print Right(String(110, " ") & sImpuesto1 & " " & Format(nPorcentaje1, "##0.00") & "% :", 110) & Right(String(17, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,###,##0.00"), 17)
                    End If
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                    If RsImpresion!nprecioImpuesto2 > 0 Then
                       Printer.Print Right(String(110, " ") & sImpuesto2 & " " & Format(nPorcentaje2, "##0.00") & "% :", 110) & Right(String(17, " ") & Format(RsImpresion!nprecioImpuesto2, "##,##,###,##0.00"), 17)
                    End If
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                    If RsImpresion!nprecioImpuesto3 > 0 Then
                       Printer.Print Right(String(110, " ") & sImpuesto3 & " " & Format(nPorcentaje3, "##0.00") & "% :", 110) & Right(String(17, " ") & Format(RsImpresion!nprecioImpuesto3, "##,##,###,##0.00"), 17)
                    End If
                 End If

                 Printer.Print Right(String(110, " ") & "Total " & sMonN & " :", 110) & Right(String(17, " ") & Format(RsImpresion!nVenta, "##,##,###,##0.00"), 17)

                If lDocumEquivaPrecuenta Then
                     Printer.Print " "
                    Printer.Print Right(String(110, " ") & "Total " & sMonE & " :", 110) & Right(String(17, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 17)
                End If

                Printer.Print UCase("SON: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN)

End Sub



Public Sub ImprimeFacturaNEmpresa16(RsImpresion As Recordset, Empresa As String, Optional tTipoDoc As String)
                ximprimeDetallado = Calcular("select lImprimeresumen as codigo from ttipodocumentoimpresora where ttipoemision='" & tTipoDoc & "' and  tcaja='" & sCaja & "'", Cn)

                    
                 For i = 1 To nCabecera
                     Printer.Print
                 Next i
                 
                 Printer.Print "   " & Format(RsImpresion!fRegistro, "dd") & "      " & Mid(Format(RsImpresion!fRegistro, "MMMM") & String(14, " "), 1, 14) & "      " & Mid(Format(RsImpresion!fRegistro, "yyyy"), 4, 1)
                 Printer.Print " "
                 Printer.Print " "
                 Printer.Print "       " & Mid(RsImpresion!Cliente & String(58, " "), 1, 58) & "  " & RsImpresion!Ruc
                 Printer.Print " "
                 Printer.Print "       " & RsImpresion!direccion
 
                 For i = 1 To nDetalle
                     Printer.Print
                 Next i
                 
                 'Cuerpo
                 Item = ""
                 i = 0
                 j = 0
                                  
                 Item = ""
                 Do While Not RsImpresion.EOF
                    If ximprimeDetallado = False Then
                        xproducto = RsImpresion!Producto
                    Else
                        xproducto = RsImpresion!ProductoDetallado
                    End If
                    
                    If Item <> RsImpresion!tCodigoPedido + RsImpresion!tItem Then
                       i = i + 1
                       'Printer.Print
                       sLinea = Right(String(2, " ") & Format(RsImpresion!nCantidad, "##0.00"), 6) & "    " & UCase(Mid(xproducto & String(46, " "), 1, 46)) & "         " & Right(String(11, " ") & Format(RsImpresion!nprecioVenta, "##,##0.00"), 11) & " " & Right(String(12, " ") & Format(RsImpresion!nCantidad * RsImpresion!nprecioVenta, "#,###,##0.00"), 12)
                       Printer.Print sLinea
                    End If
                    Item = RsImpresion!tCodigoPedido + RsImpresion!tItem
                    RsImpresion.MoveNext
                 Loop
                                  
                 For j = i To nFItem
                     Printer.Print " "
                 Next j
                 
                 Printer.Print
                 RsImpresion.MoveLast
                 
                 Printer.Print " "
                 Printer.Print " "
                 Printer.Print " "
                 Printer.Print "           " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
 
                 Printer.Print " "
                 
                 sImportes = Right(String(90, " ") & Format(RsImpresion!nNeto, "##,###,##0.00"), 90)
                 sImportes1 = Right(String(90, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,##0.00"), 90)
                 sImportes2 = Right(String(90, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 90)
                 
                 Printer.Print sImportes
                 Printer.Print " "
                 Printer.Print sImportes1
                 Printer.Print sImportes2
                   

End Sub
Public Sub ImprimeBoletaT(ByVal RsImpresion As Recordset, Optional tTipoDoc As String, Optional Cabecera As Image, Optional pie As Image, Optional ByVal ImpDolarDelivery As Boolean)
    On Error Resume Next
    Dim Item As String
    Dim xObservacion As String
    Dim sLinea As String
    Dim txt As String
    Dim xRsPropiedad As ADODB.Recordset
    Dim xRsPropiedadCombo As ADODB.Recordset
    Dim nSumaNeto As Double
    Dim lcuentaCobrar As Boolean
    Dim xTotalS As Double
    
    lImprimeImagCabDocumento = Calcular("select lImprimeImageCab as codigo from ttipodocumentoimpresora where ttipoemision='" & tTipoDoc & "' and  tcaja='" & sCaja & "'", Cn)
    lImprimeImagPieDocumento = Calcular("select lImprimeImagePie as codigo from ttipodocumentoimpresora where ttipoemision='" & tTipoDoc & "' and  tcaja='" & sCaja & "'", Cn)
    ximprimeDetallado = Calcular("select lImprimeresumen as codigo from ttipodocumentoimpresora where ttipoemision='" & tTipoDoc & "' and  tcaja='" & sCaja & "'", Cn)
    
    Dim CANT, Valor As Integer
    Dim ProductoTem As String
       
    Isql = "SELECT tCodigoPedido, dbo.TPRODUCTOPROPIEDAD.tItem, dbo.TOPERADOR.tDetallado AS Operador, dbo.TPROPIEDAD.tDetallado AS Descripcion, dbo.TPRODUCTOPROPIEDAD.nCantidad  " & _
           "FROM dbo.TPRODUCTOPROPIEDAD INNER JOIN dbo.TPROPIEDAD ON dbo.TPRODUCTOPROPIEDAD.tCodigoPropiedad = dbo.TPROPIEDAD.tCodigoPropiedad AND dbo.TPRODUCTOPROPIEDAD.tProducto = dbo.TPROPIEDAD.tProducto INNER JOIN dbo.TOPERADOR ON dbo.TPROPIEDAD.tOperador = dbo.TOPERADOR.tOperador " & _
           "where tCodigoPedido='" & RsImpresion!tCodigoPedido & "' and TOPERADOR.lImprime=1 Order by dbo.TOPERADOR.nBoton"
    Set xRsPropiedad = Lib.OpenRecordset(Isql, Cn)
    Isql = "SELECT dbo.TCOMBOPROPIEDAD.tItem, dbo.TCOMBOPROPIEDAD.tItemCombo, dbo.TOPERADOR.tDetallado AS Operador, dbo.TPROPIEDAD.tDetallado AS Descripcion, dbo.TCOMBOPROPIEDAD.tCodigoPedido, dbo.TCOMBOPROPIEDAD.nCantidad " & _
           "FROM dbo.TOPERADOR INNER JOIN dbo.TPROPIEDAD ON dbo.TOPERADOR.tOperador = dbo.TPROPIEDAD.tOperador RIGHT OUTER JOIN dbo.TCOMBOPROPIEDAD ON dbo.TPROPIEDAD.tProducto = dbo.TCOMBOPROPIEDAD.tProducto AND dbo.TPROPIEDAD.tCodigoPropiedad = dbo.TCOMBOPROPIEDAD.tCodigoPropiedad " & _
           "where tCodigoPedido='" & RsImpresion!tCodigoPedido & "'  and TOPERADOR.lImprime=1 Order by dbo.TOPERADOR.nBoton"
    Set xRsPropiedadCombo = Lib.OpenRecordset(Isql, Cn)
    
    xTotalS = 0
        
    Select Case pais
        Case "001" ' Bolivia
                    'OBTIENE DATOS A IMPRIMIR
                    Dim tAutorizacion As String '  del documento
                    Dim tcodigoControl As String ' del documento
                    Dim RsDatos As Recordset
                    Dim fLimite As Date ' de la caja
                    Dim tSfc As String ' de la caja
                    
                    'CGMiranda******************************
                    Dim tSucursal As String
                    'fin CGMiranda************************
                    
                    Dim cadenaxx As String
                    tSfc = ""
                    fLimite = Now
                    tAutorizacion = Calcular("select tautorizacion as codigo from mdocumento where tdocumento ='" & RsImpresion!tDocumento & "'", Cn)
                    tcodigoControl = Calcular("select tcodigoControl as codigo from mdocumento where tdocumento ='" & RsImpresion!tDocumento & "'", Cn)
                    cadenaxx = "SELECT tsfc,ffin FROM TORIGENCODIGOCONTROL WHERE TCAJA='" & RsImpresion!tCaja & "' AND TAUTORIZACION='" & Trim(tAutorizacion) & "' AND ((FINICIO <= '" & Format(RsImpresion!fRegistro, "YYYYmmdd HH:mm") & "') AND (ffin>='" & Format(RsImpresion!fRegistro, "YYYYmmdd HH:mm") & "'))"
                    Set RsDatos = Lib.OpenRecordset(cadenaxx, Cn)
                    If Not (RsDatos.EOF Or RsDatos.BOF) Then
                           ' rsDatos.MoveFirst
                            tSfc = RsDatos!tSfc
                            fLimite = Format(RsDatos!fFin, "dd/MM/yyyy")
                    End If
                    
                    If lImprimeImagCabDocumento Then
                                    If Cabecera <> 0 Then
                                    Printer.PaintPicture Cabecera, 500, Printer.CurrentY, 2860, 1600
                                    For p = 1 To 10
                                    Printer.Print
                                    Next p
                                    End If
                    End If
                    
                    'Cabecera
                    RsImpresion.MoveFirst
                    ImprimeXCentro sRazonSocial, 40
                    ImprimeXCentro sRazonComercial, 40
                    'CGMiranda******************************************************
                    tSucursal = Calcular("select vs.tResumido as codigo from vsucursal vs inner join TCAJA tc on vs.Codigo = tc.tSucursal where tc.tCaja='" & sCaja & "'", Cn)
                    ImprimeXCentro "Sucursal Nº " & IIf(tSucursal = 0, "", tSucursal), 40
                    ImprimeXCentro sDireccion, 40
                    ImprimeXCentro "Telefono: " & sTelefono, 40
                    ImprimeXCentro "SFC: " & tSfc & "   La Paz Bolivia", 40
                    If estadoReimpresion = True Then
                        ImprimeXCentro "COMPROBANTE - COPIA", 40
                        estadoReimpresion = False
                    Else
                        ImprimeXCentro "COMPROBANTE", 40
                    End If
                    'Fin CGMiranda**********************************************************
                    Printer.Print
                    
                    Printer.Print String(40, "-")
                    sLinea = String((40 - Len(Trim("NIT: " + sRUC))) / 2, " ") & "NIT: " + sRUC
                    Printer.Print sLinea
                    Printer.Print "Comprobante  Nº " & Mid(RsImpresion!tDocumento, 7)
                    Printer.Print "Autorización Nº " & tAutorizacion
                    Printer.Print String(40, "-")
                    
                             'impresiondiacontable
                            If lImpresionDiaContable Then
                                If lReimpresion = True Then
                                    Printer.Print "Fecha    : " & Format(Calcular("select fdiacontable as codigo from mdocumento where tdocumento ='" & RsImpresion!tDocumento & "'", Cn), "dd/MM/yyyy") & " " & Calcular("exec DiacontableHora '" & fImpresionDiaContable & "'", Cn)
                                    Else
                                    Printer.Print "Fecha    : " & fImpresionDiaContable & " " & Calcular("exec DiacontableHora '" & fImpresionDiaContable & "'", Cn)
                                End If
                                Else
                                 Printer.Print "Fecha    : " & RsImpresion!fRegistro
                            End If
                            
                                       
                    'Printer.Print "Fecha    : " & RsImpresion!fRegistro
                    If Not IsNull(RsImpresion!Cliente) Or Len(Trim(RsImpresion!Cliente)) > 0 Then
                        ImprimeXLinea "Señores  : " & RsImpresion!Cliente, 40, 9
                        Printer.Print "NIT/CI   : " & RsImpresion!Ruc
                        Printer.Print "Direccion: " & Mid(RsImpresion!direccion, 1, 30)
                    End If
                    Printer.Print String(40, "-")
                    
                    Printer.Print
                    Printer.Print "Pedido   : " & RsImpresion!tCodigoPedido
                    Printer.Print "Tipo     : " & RsImpresion!tipopedido
                    Printer.Print "Caja     : " & RsImpresion!tCaja & " - " & RsImpresion!tUsuario
                    Printer.Print "Mesero   : " & IIf(IsNull(RsImpresion!Mozo), "", RsImpresion!Mozo)
                    Printer.Print "Nro.Serie: " & Calcular("select isnull(tSerieImpresora,'') codigo from MDOCUMENTO where tDocumento ='" & RsImpresion!tDocumento & "'", Cn)
                    Printer.Print "Descuento: " & Mid(Trim(RsImpresion!DESCUENTO), 1, 30)
                    Printer.Print
                    Printer.Print "MESA     : " & RsImpresion!Mesa
                    If lObservacionCabDoc Then
                        Printer.Print "Observac.: " & RsImpresion!tObservacion
                    End If
                    Printer.Print
                    Printer.Print String(40, "-")
                    Printer.Print "Cantid. Producto                SubTotal"
                    Printer.Print String(40, "-")
                        
                    Item = ""
                    'Cuerpo
                    Do While Not RsImpresion.EOF
                    If ximprimeDetallado = False Then
                        xproducto = RsImpresion!Producto
                    Else
                        xproducto = RsImpresion!ProductoDetallado
                    End If
                       If Item <> RsImpresion!tCodigoPedido + RsImpresion!tItem Then
                          'Impresion de Propiedades
                          If lPropiedadDocumento Then
                             xRsPropiedad.Filter = "tCodigoPedido='" & Mid(Item, 1, 10) & "' and tItem='" & Mid(Item, 11, 3) & "'"
                             If Not xRsPropiedad.EOF Then
                                xRsPropiedad.MoveFirst
                                Do While Not xRsPropiedad.EOF
                                   Printer.Print "        * " & xRsPropiedad!Operador & " " & xRsPropiedad!Descripcion
                                   xRsPropiedad.MoveNext
                                Loop
                             End If
                                         
                             'Impresion de la Observacion
                             If lObservacionDocumento And Len(Trim(xObservacion)) > 0 Then
                                ImprimeXLinea "        - " & Trim(xObservacion), 33, 2
                             End If
                          End If
                          
                          If IsNull(RsImpresion!tOferta) Or RsImpresion!tOferta = "" Then
                          
                            CANT = Len(Trim(xproducto))
                            ProductoTem = xproducto
regreso:
                            If Valor = 0 Then
                                sLinea = Right(String(7, " ") & Format(RsImpresion!nCantidad, "###0.00"), 7) & " " & Mid(xproducto & String(19, " "), 1, 19) & " " & Right(String(12, " ") & Format(RsImpresion!nCantidad * RsImpresion!nprecioVenta, "#,###,##0.00"), 12)
                                Valor = 1
                                CANT = Len(Mid(ProductoTem, 20))
                                ProductoTem = Mid(ProductoTem, 20)
                                Printer.Print sLinea
                            Else
                                sLinea = Right(String(7, " ") & "       ", 7) & " " & Mid(ProductoTem & String(19, " "), 1, 19) & " " & Right(String(12, " ") & "            ", 12)
                                CANT = Len(Mid(ProductoTem, 20))
                                ProductoTem = Mid(ProductoTem, 20)
                                Printer.Print sLinea
                            End If
                            
                            If CANT > 0 And ximprimeDetallado = True Then
                            GoTo regreso
                            End If

                             'sLinea = Right(String(7, " ") & Format(RsImpresion!nCantidad, "###0.00"), 7) & " " & Mid(xproducto & String(19, " "), 1, 19) & " " & Right(String(12, " ") & Format(RsImpresion!nCantidad * RsImpresion!nprecioVenta, "#,###,##0.00"), 12)
                          Else
                          
                             CANT = Len(Trim(xproducto))
                            ProductoTem = xproducto
regreso1:
                            If Valor = 0 Then
                                sLinea = Right(String(7, " ") & Format(RsImpresion!nCantidad, "###0.00"), 7) & " " & Mid(xproducto & String(19, " "), 1, 19)
                                Valor = 1
                                CANT = Len(Mid(ProductoTem, 20))
                                ProductoTem = Mid(ProductoTem, 20)
                                Printer.Print sLinea
                            Else
                                sLinea = Right(String(7, " ") & "       ", 7) & " " & Mid(ProductoTem & String(19, " "), 1, 19)
                                CANT = Len(Mid(ProductoTem, 20))
                                ProductoTem = Mid(ProductoTem, 20)
                                Printer.Print sLinea
                            End If
                            
                            If CANT > 0 And ximprimeDetallado = True Then
                            GoTo regreso1
                            End If
                          

                             'sLinea = Right(String(7, " ") & Format(RsImpresion!nCantidad, "###0.00"), 7) & " " & Mid(xproducto & String(19, " "), 1, 19)
                             sLinea = String(7, " ") & " " & Mid(RsImpresion!tOferta & String(19, " "), 1, 19) & " " & Right(String(12, " ") & Format(RsImpresion!nCantidad * RsImpresion!nprecioVenta, "#,###,##0.00"), 12)
                             Printer.Print sLinea
                          End If
                          Valor = 0
                         ' Printer.Print sLinea
                       End If
                       
                       'Combos
                       If lComboDocumento And IIf(IsNull(RsImpresion!Combo), 0, Len(Trim(RsImpresion!Combo))) > 0 Then
                          sLinea = Mid("       " & Right(String(5, " ") & Format(RsImpresion!nCombo, "#0.00"), 5) & " " & RsImpresion!Combo, 1, 22)
                          Printer.Print sLinea
                          
                          'Combos Propiedades
                          If lPropiedadDocumento And Len(Trim(IIf(IsNull(RsImpresion!Combo), "", RsImpresion!Combo))) > 0 Then
                             xRsPropiedadCombo.Filter = "tCodigoPedido='" & RsImpresion!tCodigoPedido & "' and tItem='" & RsImpresion!tItem & "' and tItemCombo='" & RsImpresion!tItemCombo & "'"
                             If Not xRsPropiedadCombo.EOF Then
                                xRsPropiedadCombo.MoveFirst
                                Do While Not xRsPropiedadCombo.EOF
                                
                                    CANT = CInt((Len(xRsPropiedadCombo!Operador & " " & xRsPropiedadCombo!Descripcion) / 22))
                                    PropiedadTem = xRsPropiedadCombo!Operador & " " & xRsPropiedadCombo!Descripcion
                                    For i = 1 To CANT
                                        If Valor = 0 Then
                                            sLinea = "        * " & Mid(PropiedadTem, 1, 22)
                                            Valor = 1
                                            Printer.Print sLinea
                                        Else
                                            sLinea = "          " & Mid(PropiedadTem, 1, 22)
                                            Printer.Print sLinea
                                        End If
                                    Next
                                    Valor = 0
                                    'Printer.Print sLinea '"        * " & xRsPropiedadCombo!Operador & " " & xRsPropiedadCombo!Descripcion
                                    xRsPropiedadCombo.MoveNext
                                Loop
                             End If
                          
                             'Impresion de la Observacion
                              If lObservacionDocumento And Len(Trim(RsImpresion!tObservacionCombo)) > 0 Then
                                 ImprimeXLinea "        - " & Trim(RsImpresion!tObservacionCombo), 33, 10
                              End If
                          End If
                       End If
                       xObservacion = IIf(IsNull(RsImpresion!tObservacionPedido), "", RsImpresion!tObservacionPedido)
                       Item = RsImpresion!tCodigoPedido + RsImpresion!tItem
                       RsImpresion.MoveNext
                    Loop
                    
                    If lPropiedadDocumento Then
                       xRsPropiedad.Filter = "tCodigoPedido='" & Mid(Item, 1, 10) & "' and tItem='" & Mid(Item, 11, 3) & "'"
                       If Not xRsPropiedad.EOF Then
                          xRsPropiedad.MoveFirst
                          Do While Not xRsPropiedad.EOF
                             Printer.Print "        * " & xRsPropiedad!Operador & " " & xRsPropiedad!Descripcion
                             xRsPropiedad.MoveNext
                          Loop
                       End If
                                   
                       'Impresion de la Observacion
                       If lObservacionDocumento And Len(Trim(xObservacion)) > 0 Then
                          ImprimeXLinea "        - " & Trim(xObservacion), 33, 10
                       End If
                    End If
                    
                    Printer.Print String(40, "-")
                    RsImpresion.MoveLast
                    
                    If RsImpresion!nRecargo > 0 Then
                       Printer.Print
                       Printer.Print Right(String(27, " ") & "Recargo " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nRecargo, "##,###,##0.00"), 13)
                    End If
                    
                    If RsImpresion!nDescuento > 0 Then
                       Printer.Print
                       Printer.Print Right(String(27, " ") & "Descuento " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nDescuento, "##,###,##0.00"), 13)
                    End If
                    
                
                    nSumaNeto = RsImpresion!nNeto
                    
                    If IsNull(RsImpresion!lImpuesto1) Or Not RsImpresion!lImpuesto1 Then
                       nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto1
                    End If
                    
                    If IsNull(RsImpresion!lImpuesto2) Or Not RsImpresion!lImpuesto2 Then
                       nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto2
                    End If
                    
                    If IsNull(RsImpresion!lImpuesto3) Or Not RsImpresion!lImpuesto3 Then
                       nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto3
                    End If
                    'CESAR Solo Para Bolivia
                    If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
                       Printer.Print Right(String(27, " ") & "Valor Venta " & sMonN & " : ", 27) & Right(String(13, " ") & Format(nSumaNeto, "##,###,##0.00"), 13)
                    End If
                    
                    If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                       Printer.Print Right(String(27, " ") & sImpuesto1 & " " & Format(nPorcentaje1, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,##0.00"), 13)
                    End If
                       
                    If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                       Printer.Print Right(String(27, " ") & sImpuesto2 & " " & Format(nPorcentaje2, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto2, "##,###,##0.00"), 13)
                    End If
                    
                    If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                       Printer.Print Right(String(27, " ") & sImpuesto3 & " " & Format(nPorcentaje3, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto3, "##,###,##0.00"), 13)
                    End If
                    'CarlosD
                    Printer.Print Right(String(27, " ") & "Total " & sMonN & " :", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 13)
                    
                    'CarlosD 01/12/2006
                    If lEquivalencia = True Or lDocumEquivaPrecuenta = True Then
                    Printer.Print " "
                    Printer.Print Right(String(27, " ") & "Total " & sMonE & " :", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 13)
                    End If
                    'End CarlosD
                    
                    Printer.Print
                    txt = "Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
                    ImprimeXLinea txt, 40, 5
                    Printer.Print
                    
                    Printer.Print String(40, "-")
                    Printer.Print "Código de Control      : " & tcodigoControl
                    Printer.Print "Fecha Límite de Emisión: " & Format(fLimite, "dd/MM/yyyy")
                    Printer.Print String(40, "-")
                    If Calcular("select ISNULL(lImprimeQR,0) as codigo from TTIPODOCUMENTO where tCodigoTipoDocumento='" & tTipoDoc & "'", Cn) = 1 Then
                        If pais = "001" Then
                        
                        Set rsQr = Lib.OpenRecordset("usp_Inforest_ObtieneCodigoQR_Bol " + RsImpresion!tDocumento, Cn)
                    
'                            FastQRCode rsQr.Fields(0), App.Path & "\BaseTempQr.bmp"
                    
                            Set imgDocumento = CreateObject("Scripting.FileSystemObject")
                            If imgDocumento.FileExists(App.Path & "\BaseTempQr.bmp") Then
                                Printer.PaintPicture LoadPicture(App.Path & "\BaseTempQr.bmp"), 1400, Printer.CurrentY, 1323, 1323
                                 For p = 1 To 8
                                    Printer.Print
                                 Next p
                            End If
                       End If
                    End If
                    Printer.Print '.'
                    ImprimeXLinea textoComprobanteBolivia, 40, 5
                    Printer.Print String(40, "-")
                    ImprimeXCentro sPie, 40
                    Set xRsPropiedad = Nothing
                    Set xRsPropiedadCombo = Nothing
                     Printer.Print
                    If lImprimeImagPieDocumento Then
                                    If pie <> 0 Then
                                        Printer.PaintPicture pie, 500, Printer.CurrentY, 2860, 1600
                                    End If
                    End If
                    Printer.EndDoc
        
        Case Else 'Peru, Ecuador
                    
                    'Cabecera
                    RsImpresion.MoveFirst
                    If estadoReimpresion = True Then
                        ImprimeXCentro "REIMPRESION", 40
                        estadoReimpresion = False
                    End If
                    
                    If lImprimeImagCabDocumento Then
                                    If Cabecera <> 0 Then
                                    Printer.PaintPicture Cabecera, 500, Printer.CurrentY, 2860, 1600
                                    For p = 1 To 10
                                    Printer.Print
                                    Next p
                                    End If
                    End If
                    
                    
                    'Log
                    If lLogCajaRapida = True Then
                        Cn.Execute "UPDATE TLOG_IMPRESION SET TPOSICION5='PASO 1 ' + '" & RsImpresion!tDocumento & "' WHERE TDOCUMENTO='" & sDocumento & "'"
                    End If
                    

                    ImprimeXCentro sRazonSocial, 40
                    ImprimeXCentro sRazonComercial, 40
                    sLinea = String((40 - Len(Trim("R.U.C.: " + sRUC))) / 2, " ") & "R.U.C.: " + sRUC
                    Printer.Print sLinea
                    ImprimeXCentro sDireccion, 40
                    If Trim(sDireccion2) <> "" Then
                        ImprimeXCentro sDireccion2, 40
                    End If
                    sLinea = String((40 - Len(Trim("Telefono: " + sTelefono))) / 2, " ") & "Telefono: " + sTelefono

                    
                    Printer.Print sLinea
                    Printer.Print
                    Printer.Print Mid(RsImpresion!tDocumento, 1, 1) & "-" & Mid(RsImpresion!tDocumento, 2, 5) & "-" & Mid(RsImpresion!tDocumento, 7)
                    Printer.Print
                    Printer.Print "Pedido   : " & RsImpresion!tCodigoPedido
                    
                            'impresiondiacontable
                            If lImpresionDiaContable Then
                                If lReimpresion = True Then
                                    Printer.Print "Fecha    : " & Format(Calcular("select fdiacontable as codigo from mdocumento where tdocumento ='" & RsImpresion!tDocumento & "'", Cn), "dd/MM/yyyy") & " " & Calcular("exec DiacontableHora '" & fImpresionDiaContable & "'", Cn)
                                    Else
                                    Printer.Print "Fecha    : " & fImpresionDiaContable & " " & Calcular("exec DiacontableHora '" & fImpresionDiaContable & "'", Cn)
                                End If
                                Else
                                 Printer.Print "Fecha    : " & RsImpresion!fRegistro
                            End If
                            
                                               'Printer.Print "Fecha    : " & RsImpresion!fRegistro
                    Printer.Print "Tipo     : " & RsImpresion!tipopedido
                    Printer.Print "Caja     : " & RsImpresion!tCaja & " - " & RsImpresion!tUsuario
                    If RsImpresion!Mozo <> "" Then
                    Printer.Print "Mesero   : " & IIf(IsNull(RsImpresion!Mozo), "", RsImpresion!Mozo)
                    End If
                    Printer.Print "Nro.Serie: " & Calcular("select isnull(tSerieImpresora,'') codigo from MDOCUMENTO where tDocumento ='" & RsImpresion!tDocumento & "'", Cn)
                    If Mid(Trim(RsImpresion!DESCUENTO), 1, 30) <> "" Then
                    Printer.Print "Descuento: " & Mid(Trim(RsImpresion!DESCUENTO), 1, 30)
                    End If
                    Printer.Print
                    If RsImpresion!Mesa <> "" Then
                    Printer.Print "MESA     : " & RsImpresion!Mesa
                    End If
                    If lObservacionCabDoc Then
                        If RsImpresion!tObservacion <> "" Then
                        Printer.Print "Observac.: " & RsImpresion!tObservacion
                        End If
                    End If
                    
                    Printer.Print
                    Printer.Print String(40, "-")
                    Printer.Print "Cantid. Producto                SubTotal"
                    Printer.Print String(40, "-")
                        
                    Item = ""
                    'Cuerpo
                    Do While Not RsImpresion.EOF
                    If ximprimeDetallado = False Then
                        xproducto = RsImpresion!Producto
                    Else
                        xproducto = RsImpresion!ProductoDetallado
                    End If
                       If Item <> RsImpresion!tCodigoPedido + RsImpresion!tItem Then
                          'Impresion de Propiedades
                          If lPropiedadDocumento Then
                             xRsPropiedad.Filter = "tCodigoPedido='" & Mid(Item, 1, 10) & "' and tItem='" & Mid(Item, 11, 3) & "'"
                             If Not xRsPropiedad.EOF Then
                                xRsPropiedad.MoveFirst
                                Do While Not xRsPropiedad.EOF
                                   'Printer.Print "        * " & xRsPropiedad!Operador & " " & xRsPropiedad!Descripcion
                                   'ImprimeXLinea "        * " & xRsPropiedad!Operador & " " & xRsPropiedad!Descripcion, 40, 8
                                   ImprimeXLinea "        * " & IIf(xRsPropiedad!nCantidad = 1, "", "(" & xRsPropiedad!nCantidad & ")") & xRsPropiedad!Operador & " " & xRsPropiedad!Descripcion, 31, 10
                                   xRsPropiedad.MoveNext
                                Loop
                             End If
                                         
                             'Impresion de la Observacion
                             If lObservacionDocumento And Len(Trim(xObservacion)) > 0 Then
                                ImprimeXLinea "        - " & Trim(xObservacion), 33, 10
                             End If
                          End If
                          
                          If IsNull(RsImpresion!tOferta) Or RsImpresion!tOferta = "" Then
                          
                            CANT = Len(Trim(xproducto))
                            ProductoTem = xproducto
regreso2:
                            If Valor = 0 Then
                                If ImpDolarDelivery Then
                                    sLinea = Right(String(8, " ") & Format(RsImpresion!nCantidad, "#,##0.00"), 8) & " " & Mid(xproducto & String(21, " "), 1, 21) & " " & Right(String(9, " ") & Format((RsImpresion!nCantidad * RsImpresion!nPrecioOficial) / nTC, "##,##0.00"), 9)
                                Else
                                    sLinea = Right(String(8, " ") & Format(RsImpresion!nCantidad, "#,##0.00"), 8) & " " & Mid(xproducto & String(21, " "), 1, 21) & " " & Right(String(9, " ") & Format(RsImpresion!nCantidad * RsImpresion!nPrecioOficial, "##,##0.00"), 9)
                                End If
                                Valor = 1
                                CANT = Len(Mid(ProductoTem, 22))
                                ProductoTem = Mid(ProductoTem, 22)
                                Printer.Print sLinea
                            Else
                                sLinea = Right(String(8, " ") & "        ", 8) & " " & Mid(ProductoTem & String(21, " "), 1, 21) & " " & Right(String(9, " ") & "         ", 9)
                                CANT = Len(Mid(ProductoTem, 22))
                                ProductoTem = Mid(ProductoTem, 22)
                                Printer.Print sLinea
                            End If
                            
                            If CANT > 0 And ximprimeDetallado = True Then
                            GoTo regreso2
                            End If

                             'sLinea = Right(String(7, " ") & Format(RsImpresion!nCantidad, "###0.00"), 7) & " " & Mid(xproducto & String(19, " "), 1, 19) & " " & Right(String(12, " ") & Format(RsImpresion!nCantidad * RsImpresion!nPrecioOficial, "#,###,##0.00"), 12)
                          Else
                            CANT = Len(Trim(xproducto))
                            ProductoTem = xproducto
regreso3:
                            If Valor = 0 Then
                                sLinea = Right(String(8, " ") & Format(RsImpresion!nCantidad, "###0.00"), 8) & " " & Mid(xproducto & String(21, " "), 1, 21)
                                Valor = 1
                                CANT = Len(Mid(ProductoTem, 22))
                                ProductoTem = Mid(ProductoTem, 22)
                                Printer.Print sLinea
                            Else
                                sLinea = Right(String(8, " ") & "        ", 8) & " " & Mid(ProductoTem & String(21, " "), 1, 21)
                                CANT = Len(Mid(ProductoTem, 22))
                                ProductoTem = Mid(ProductoTem, 22)
                                Printer.Print sLinea
                            End If
                            
                            If CANT > 0 And ximprimeDetallado = True Then
                            GoTo regreso3
                            End If

                             'sLinea = Right(String(7, " ") & Format(RsImpresion!nCantidad, "###0.00"), 7) & " " & Mid(xproducto & String(19, " "), 1, 19)
                            If ImpDolarDelivery Then
                                sLinea = String(8, " ") & " " & Mid(RsImpresion!tOferta & String(20, " "), 1, 20) & " " & Right(String(10, " ") & Format(RsImpresion!nCantidad * RsImpresion!nPrecioOficial / nTC, "###,##0.00"), 10)
                            Else
                                sLinea = String(8, " ") & " " & Mid(RsImpresion!tOferta & String(20, " "), 1, 20) & " " & Right(String(10, " ") & Format(RsImpresion!nCantidad * RsImpresion!nPrecioOficial, "###,##0.00"), 10)
                            End If
                            
                             Printer.Print sLinea
                          End If
                          Valor = 0
                          xTotalS = xTotalS + (RsImpresion!nCantidad * RsImpresion!nPrecioOficial)
                          'Printer.Print sLinea
                       End If
                       
                       'Combos
                       If lComboDocumento And IIf(IsNull(RsImpresion!Combo), 0, Len(Trim(RsImpresion!Combo))) > 0 Then
                          sLinea = Mid("       " & Right(String(5, " ") & Format(RsImpresion!nCombo, "#0.00"), 5) & " " & RsImpresion!Combo, 1, 40)
                          Printer.Print sLinea
                          
                          'Combos Propiedades
                          If lPropiedadDocumento And Len(Trim(IIf(IsNull(RsImpresion!Combo), "", RsImpresion!Combo))) > 0 Then
                             xRsPropiedadCombo.Filter = "tCodigoPedido='" & RsImpresion!tCodigoPedido & "' and tItem='" & RsImpresion!tItem & "' and tItemCombo='" & RsImpresion!tItemCombo & "'"
                             If Not xRsPropiedadCombo.EOF Then
                                xRsPropiedadCombo.MoveFirst
                                Do While Not xRsPropiedadCombo.EOF
                                   'Printer.Print "        * " & xRsPropiedadCombo!Operador & " " & xRsPropiedadCombo!Descripcion
                                   'ImprimeXLinea "             * " & xRsPropiedadCombo!Operador & " " & xRsPropiedadCombo!Descripcion, 40, 13
                                   ImprimeXLinea "             * " & xRsPropiedadCombo!Operador & " " & xRsPropiedadCombo!Descripcion, 29, 7
                                   xRsPropiedadCombo.MoveNext
                                Loop
                             End If
                          
                             'Impresion de la Observacion
                              If lObservacionDocumento And Len(Trim(RsImpresion!tObservacionCombo)) > 0 Then
                                 ImprimeXLinea "        - " & Trim(RsImpresion!tObservacionCombo), 33, 2
                              End If
                          End If
                       End If
                       xObservacion = IIf(IsNull(RsImpresion!tObservacionPedido), "", RsImpresion!tObservacionPedido)
                       Item = RsImpresion!tCodigoPedido + RsImpresion!tItem
                       RsImpresion.MoveNext
                    Loop
                    
                    If lPropiedadDocumento Then
                       xRsPropiedad.Filter = "tCodigoPedido='" & Mid(Item, 1, 10) & "' and tItem='" & Mid(Item, 11, 3) & "'"
                       If Not xRsPropiedad.EOF Then
                          xRsPropiedad.MoveFirst
                          Do While Not xRsPropiedad.EOF
                             'Printer.Print "        * " & xRsPropiedad!Operador & " " & xRsPropiedad!Descripcion
                              ImprimeXLinea "        * " & IIf(xRsPropiedad!nCantidad = 1, "", "(" & xRsPropiedad!nCantidad & ")") & xRsPropiedad!Operador & " " & xRsPropiedad!Descripcion, 35, 10
                             xRsPropiedad.MoveNext
                          Loop
                       End If
                                   
                       'Impresion de la Observacion
                       If lObservacionDocumento And Len(Trim(xObservacion)) > 0 Then
                          ImprimeXLinea "        - " & Trim(xObservacion), 33, 2
                       End If
                    End If
                    
                    Printer.Print String(40, "-")
                    RsImpresion.MoveLast
                    
                    '0035-2013 CESAR
                    If lPagoAntesImpresion Then
                        lcuentaCobrar = True
                        If lcuentaCobrar And lPagocortesiaAI = False Then
                            If ImpDolarDelivery Then
                                Printer.Print Right(String(27, " ") & " Total a Pagar " & sMonE & " : ", 27) & Right(String(13, " ") & Format(xTotalS / nTC, "##,###,##0.00"), 13)
                            Else
                                Printer.Print Right(String(27, " ") & " Total a Pagar " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xTotalS, "##,###,##0.00"), 13)
                            End If
                        Else
                            If ImpDolarDelivery Then
                                Printer.Print Right(String(27, " ") & " Total a Pagar " & sMonE & " : ", 27) & Right(String(13, " ") & Format(0, "##,###,##0.00"), 13)
                            Else
                                Printer.Print Right(String(27, " ") & " Total a Pagar " & sMonN & " : ", 27) & Right(String(13, " ") & Format(0, "##,###,##0.00"), 13)
                            End If
                        End If
                    Else
                        If ImpDolarDelivery Then
                            Printer.Print Right(String(27, " ") & " Total a Pagar " & sMonE & " : ", 27) & Right(String(13, " ") & Format(xTotalS / nTC, "##,###,##0.00"), 13)
                        Else
                            Printer.Print Right(String(27, " ") & " Total a Pagar " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xTotalS, "##,###,##0.00"), 13)
                        End If
                    End If
                    'Printer.Print Right(String(27, " ") & " Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta + RsImpresion!nDescuento - RsImpresion!nRecargo, "##,###,##0.00"), 13)
                    Printer.Print String(40, " ")
                    
                    If RsImpresion!nRecargo > 0 Then
                       Printer.Print
                        If ImpDolarDelivery Then
                            Printer.Print Right(String(27, " ") & "Recargo " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nRecargo / nTC, "##,###,##0.00"), 13)
                        Else
                            Printer.Print Right(String(27, " ") & "Recargo " & sMon & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nRecargo, "##,###,##0.00"), 13)
                        End If
                    End If
                    
                    If RsImpresion!nDescuento > 0 Then
                       Printer.Print
                        If ImpDolarDelivery Then
                            Printer.Print Right(String(27, " ") & "Descuento " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nDescuento / nTC, "##,###,##0.00"), 13)
                        Else
                            Printer.Print Right(String(27, " ") & "Descuento " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nDescuento, "##,###,##0.00"), 13)
                        End If
                    End If
                    
                
                    nSumaNeto = RsImpresion!nNeto
                    
                    If IsNull(RsImpresion!lImpuesto1) Or Not RsImpresion!lImpuesto1 Then
                       nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto1
                    End If
                    
                    If IsNull(RsImpresion!lImpuesto2) Or Not RsImpresion!lImpuesto2 Then
                       nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto2
                    End If
                    
                    If IsNull(RsImpresion!lImpuesto3) Or Not RsImpresion!lImpuesto3 Then
                       nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto3
                    End If
                    If ImpDolarDelivery Then
                        If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
                           Printer.Print Right(String(27, " ") & "Sub Total " & sMonE & " : ", 27) & Right(String(13, " ") & Format(nSumaNeto / nTC, "##,###,##0.00"), 13)
                        End If
                        
                        If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                           Printer.Print Right(String(27, " ") & sImpuesto1 & " " & Format(nPorcentaje1, "##0.00") & "% " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto1 / nTC, "##,###,##0.00"), 13)
                        End If
                           
                        If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                           Printer.Print Right(String(27, " ") & sImpuesto2 & " " & Format(nPorcentaje2, "##0.00") & "% " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto2 / nTC, "##,###,##0.00"), 13)
                        End If
                        
                        If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                           Printer.Print Right(String(27, " ") & sImpuesto3 & " " & Format(nPorcentaje3, "##0.00") & "% " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto3 / nTC, "##,###,##0.00"), 13)
                        End If
                    Else
                        'CESAR 'Por Consumo No - TICKET
                        If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
                           Printer.Print Right(String(27, " ") & "Sub Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(nSumaNeto, "##,###,##0.00"), 13)
                        End If
                        
                        If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                           Printer.Print Right(String(27, " ") & sImpuesto1 & " " & Format(nPorcentaje1, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,##0.00"), 13)
                        End If
                           
                        If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                           Printer.Print Right(String(27, " ") & sImpuesto2 & " " & Format(nPorcentaje2, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto2, "##,###,##0.00"), 13)
                        End If
                        
                        If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                           Printer.Print Right(String(27, " ") & sImpuesto3 & " " & Format(nPorcentaje3, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto3, "##,###,##0.00"), 13)
                        End If
                    End If
                    'CarlosD
                    If lPagoAntesImpresion Then
                         lcuentaCobrar = True
                                If lcuentaCobrar And lPagocortesiaAI = False Then
                                    If ImpDolarDelivery Then
                                        Printer.Print Right(String(27, " ") & "Importe Total " & sMonE & " :", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 13)
                                    Else
                                        Printer.Print Right(String(27, " ") & "Importe Total " & sMonN & " :", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 13)
                                    End If
                                Else
                                    If ImpDolarDelivery Then
                                        Printer.Print Right(String(27, " ") & "Importe Total " & sMonE & " :", 27) & Right(String(13, " ") & Format(0, "##,###,##0.00"), 13)
                                    Else
                                        Printer.Print Right(String(27, " ") & "Importe Total " & sMonN & " :", 27) & Right(String(13, " ") & Format(0, "##,###,##0.00"), 13)
                                    End If
                                End If
                        Else
                            If ImpDolarDelivery Then
                                Printer.Print Right(String(27, " ") & "Importe Total " & sMonE & " :", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 13)
                            Else
                                Printer.Print Right(String(27, " ") & "Importe Total " & sMonN & " :", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 13)
                            End If
                        End If
                    'Printer.Print Right(String(27, " ") & "Total " & sMonN & " :", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 13)
                    
                    If ImpDolarDelivery Then
                    
                    Else
                        'CarlosD 01/12/2006
                        If lEquivalencia = True Or lDocumEquivaPrecuenta = True Then
                            If lPagoAntesImpresion Then
                             lcuentaCobrar = True
                                    If lcuentaCobrar And lPagocortesiaAI = False Then
                                        Printer.Print " "
                                        Printer.Print Right(String(27, " ") & "Importe Total " & sMonE & " :", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 13)
                                    Else
                                        Printer.Print " "
                                        Printer.Print Right(String(27, " ") & "Importe Total " & sMonE & " :", 27) & Right(String(13, " ") & Format(0, "##,###,##0.00"), 13)
                                    End If
                                'Printer.Print " "
                                'Printer.Print Right(String(27, " ") & "Total " & sMonE & " :", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 13)
                            Else
                                Printer.Print " "
                                Printer.Print Right(String(27, " ") & "Importe Total " & sMonE & " :", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 13)
                            End If
                        End If
                        'End CarlosD
                    End If
                    
                    Printer.Print
                    If Calcular(" SELECT case when  lImpresionRetencion=1 then 1 else 0 end  as codigo FROM vTipodocumento WHERE Codigo=(SELECT TTIPODOCUMENTO FROM MDOCUMENTO WHERE tDocumento='" & RsImpresion!tDocumento & "')", Cn) = 1 Then
                    'ImprimeXCentro tTextoAgenteRetencion, 70
                    ImprimeXLinea tTextoAgenteRetencion, 40, 5
                    End If
                    If ImpDolarDelivery Then
                        If lPagoAntesImpresion Then
                        lcuentaCobrar = True
                                If lcuentaCobrar And lPagocortesiaAI = False Then
                                    Printer.Print
                                    txt = "Son: " & NumeroCadena(str(RsImpresion!nVenta / nTC)) & " " & sMonedaE
                                    ImprimeXLinea txt, 40, 5
                                    Printer.Print
                                Else
                                    Printer.Print
                                    txt = "Son: " & NumeroCadena(str(0)) & " " & sMonedaE
                                    ImprimeXLinea txt, 40, 5
                                    Printer.Print
                                End If
                            'Printer.Print " "
                            'Printer.Print Right(String(27, " ") & "Total " & sMonE & " :", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 13)
                        Else
                            Printer.Print
                            txt = "Son: " & NumeroCadena(str(RsImpresion!nVenta / nTC)) & " " & sMonedaE
                            ImprimeXLinea txt, 40, 5
                            Printer.Print
                        End If
                    Else
                        If lPagoAntesImpresion Then
                        lcuentaCobrar = True
                                If lcuentaCobrar And lPagocortesiaAI = False Then
                                    Printer.Print
                                    txt = "Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
                                    ImprimeXLinea txt, 40, 5
                                    Printer.Print
                                Else
                                    Printer.Print
                                    txt = "Son: " & NumeroCadena(str(0)) & " " & sMonedaN
                                    ImprimeXLinea txt, 40, 5
                                    Printer.Print
                                End If
                            'Printer.Print " "
                            'Printer.Print Right(String(27, " ") & "Total " & sMonE & " :", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 13)
                        Else
                            Printer.Print
                            txt = "Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
                            ImprimeXLinea txt, 40, 5
                            Printer.Print
                        End If
                    End If
'                    Printer.Print
'                    txt = "Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
'                    ImprimeXLinea txt, 40, 5
'                    Printer.Print
                    
                    If Not IsNull(RsImpresion!Cliente) Or Len(Trim(RsImpresion!Cliente)) > 0 Then
                       ImprimeXLinea "Cliente: " & RsImpresion!Cliente, 40, 9
                       
                    End If
                    
                    xTipoIdentidad = ""
                    xTipoIdentidad = Calcular("select upper(tResumido) as Codigo from vTipoIdentidad inner join TCLIENTE on vTipoIdentidad.Codigo=tcliente.tTipoIdentidad where tcliente.tCodigoCliente= (select isnull(tCodigoCliente,'') as codigo From MDOCUMENTO where tDocumento='" & RsImpresion!tDocumento & "')", Cn)
                       If xTipoIdentidad = "0" Then
                        xTipoIdentidad = "Iden."
                    End If
                    
                    If IsNull(RsImpresion!Ruc) Or RsImpresion!Ruc = "" Then
                    Else
                        Printer.Print xTipoIdentidad & "    : " & RsImpresion!Ruc
                    
                        Printer.Print
                    End If
                    
                    
                    'Forma de Pago
                    If lPagoAntesImpresion Then
                        Dim RsPagoDocumento As ADODB.Recordset
                        
                        lcuentaCobrar = True
                        'Set RsPagoDocumento = Lib.OpenRecordset("select Distinct v.tResumido + ' ' + M.tResumido as pago , Sum(D.nMonto) as monto from DPAGODOCUMENTO D inner join vTipoPago v on d.tTipoPago = v.Codigo inner join vMoneda M on M.Codigo = D.tMoneda Where D.tDocumento = '" & RsImpresion!tDocumento & "' group by v.tResumido,  M.tResumido", Cn)
                        Set RsPagoDocumento = Lib.OpenRecordset("exec usp_Inforest_Impresion '" & RsImpresion!tDocumento & "', 9 ", Cn)
                        Printer.Print " "
                        
                        If pais = "000" Then 'PERU
                            Printer.Print String(40, "-")
                            
                            If RsPagoDocumento.RecordCount > 0 Then
                                Printer.Print "Forma de Pago:"
                                For i = 0 To RsPagoDocumento.RecordCount - 1
                                    lcuentaCobrar = False
                                        Printer.Print RsPagoDocumento!pago & " " & Format(RsPagoDocumento!Monto, "##,###,##0.00")
                                    RsPagoDocumento.MoveNext
                                Next i
                                Printer.Print "Vuelto       :" & sMonN & " " & Format(RsImpresion!Vuelto, "##,###,##0.00")
                            Else
                                If lcuentaCobrar And lPagocortesiaAI = False Then
                                    Printer.Print "Forma de Pago:Enviado a Cuenta por Cobrar"
                                Else
                                    ' Printer.Print "Forma de Pago:Cortesia"
                                    ImprimeXLinea "Forma de Pago: " & lGlosaTrans, 40, 15
                                End If
                            End If
                            Printer.Print String(40, "-")
                            
                        Else 'ECUADOR
                            If RsPagoDocumento.RecordCount > 0 Then
                                For i = 0 To RsPagoDocumento.RecordCount - 1
                                    lcuentaCobrar = False
                                    Printer.Print "Forma de Pago:" & RsPagoDocumento!pago & " " & Format(RsPagoDocumento!Monto, "##,###,##0.00")
                                    RsPagoDocumento.MoveNext
                                Next i
                            Else
                                If lcuentaCobrar And lPagocortesiaAI = False Then
                                    Printer.Print "Forma de Pago:Enviado a Cuenta por Cobrar"
                                Else
                                   ' Printer.Print "Forma de Pago:Cortesia"
                                   ImprimeXLinea "Forma de Pago: " & lGlosaTrans, 40, 15
                                End If
                            End If
                        End If
                        
                        Printer.Print " "
                    End If
                    
                    
                    Printer.Print String(40, "-")
                    ImprimeXCentro sPie, 40
                    
'                    'On Error Resume Next
'                    Set imgDocumento = CreateObject("Scripting.FileSystemObject")
'                    If imgDocumento.FileExists(App.Path & "\bmps\ImgDocumento.jpg") Then
'                        Printer.Print
'                        Printer.PaintPicture LoadPicture(App.Path & "\bmps\ImgDocumento.jpg"), 400, Printer.CurrentY, 2800, 1000
'
'                    End If
                    
                   'LOG
                    If lLogCajaRapida = True Then
                        Cn.Execute "UPDATE TLOG_IMPRESION SET TPOSICION6='PASO 2 ' + '" & RsImpresion!tDocumento & "' WHERE TDOCUMENTO='" & sDocumento & "'"
                    End If
                    
                    Set xRsPropiedad = Nothing
                    Set xRsPropiedadCombo = Nothing

                    If lImprimeImagPieDocumento Then
                                        If pie <> 0 Then
                                        Printer.PaintPicture pie, 500, Printer.CurrentY, 2860, 1600
                                        End If
                    End If
                    Printer.EndDoc
                    
    End Select
End Sub

Public Sub ImprimeBoletaElectronica(ByVal RsImpresion As Recordset, Optional CodigoHash As Image, Optional tTipoDoc As String, Optional Cabecera As Image, Optional pie As Image, Optional ByVal cadenaCodigoHash As String, Optional ByVal ImpDolarDelivery As Boolean)
    On Error Resume Next
    Dim Item As String
    Dim xObservacion As String
    Dim sLinea As String
    Dim sLinea2 As String
    Dim txt As String
    Dim xRsPropiedad As ADODB.Recordset
    Dim xRsPropiedadCombo As ADODB.Recordset
    Dim nSumaNeto As Double
     Dim lcuentaCobrar As Boolean
    
    Dim xImpresionFE As String
    
    Dim xTotalS As Double
    
    'imprime tipo de cambio
    IsqlTC = "select lVerTCImp from TPARAMETRO"
    Set RsParametroTC = Lib.OpenRecordset(IsqlTC, Cn)
    '------------------------------------------
    
        Dim nDescuentoNeto As Double

    lImprimeImagCabDocumento = Calcular("select lImprimeImageCab as codigo from ttipodocumentoimpresora where ttipoemision='" & tTipoDoc & "' and  tcaja='" & sCaja & "'", Cn)
    lImprimeImagPieDocumento = Calcular("select lImprimeImagePie as codigo from ttipodocumentoimpresora where ttipoemision='" & tTipoDoc & "' and  tcaja='" & sCaja & "'", Cn)
    ximprimeDetallado = Calcular("select lImprimeresumen as codigo from ttipodocumentoimpresora where ttipoemision='" & tTipoDoc & "' and  tcaja='" & sCaja & "'", Cn)
    
     Dim CANT, Valor As Integer
    Dim ProductoTem As String
       
    Isql = "SELECT tCodigoPedido, dbo.TPRODUCTOPROPIEDAD.tItem, dbo.TOPERADOR.tDetallado AS Operador, dbo.TPROPIEDAD.tDetallado AS Descripcion,dbo.TPRODUCTOPROPIEDAD.nCantidad " & _
           "FROM dbo.TPRODUCTOPROPIEDAD INNER JOIN dbo.TPROPIEDAD ON dbo.TPRODUCTOPROPIEDAD.tCodigoPropiedad = dbo.TPROPIEDAD.tCodigoPropiedad AND dbo.TPRODUCTOPROPIEDAD.tProducto = dbo.TPROPIEDAD.tProducto INNER JOIN dbo.TOPERADOR ON dbo.TPROPIEDAD.tOperador = dbo.TOPERADOR.tOperador " & _
           "where tCodigoPedido='" & RsImpresion!tCodigoPedido & "' and TOPERADOR.lImprime=1 Order by dbo.TOPERADOR.nBoton"
    Set xRsPropiedad = Lib.OpenRecordset(Isql, Cn)
    
    Isql = "SELECT dbo.TCOMBOPROPIEDAD.tItem, dbo.TCOMBOPROPIEDAD.tItemCombo, dbo.TOPERADOR.tDetallado AS Operador, dbo.TPROPIEDAD.tDetallado AS Descripcion, dbo.TCOMBOPROPIEDAD.tCodigoPedido,dbo.TCOMBOPROPIEDAD.nCantidad " & _
           "FROM dbo.TOPERADOR INNER JOIN dbo.TPROPIEDAD ON dbo.TOPERADOR.tOperador = dbo.TPROPIEDAD.tOperador RIGHT OUTER JOIN dbo.TCOMBOPROPIEDAD ON dbo.TPROPIEDAD.tProducto = dbo.TCOMBOPROPIEDAD.tProducto AND dbo.TPROPIEDAD.tCodigoPropiedad = dbo.TCOMBOPROPIEDAD.tCodigoPropiedad " & _
           "where tCodigoPedido='" & RsImpresion!tCodigoPedido & "'  and TOPERADOR.lImprime=1 Order by dbo.TOPERADOR.nBoton"
    Set xRsPropiedadCombo = Lib.OpenRecordset(Isql, Cn)
    
    xTotalS = 0
    
    Dim xUnidadNegocio As String
    xUnidadNegocio = Calcular("SELECT tDetallado As Codigo FROM TTABLA WHERE TTABLA = 'UNIDADNEGOCIO' AND TCODIGO = (SELECT tUnidadNegocio FROM TCAJA WHERE TCAJA='" & RsImpresion!tCaja & "')", Cn)
        
    Select Case pais
        Case "001" ' BOLIVIA
                    'OBTIENE DATOS A IMPRIMIR
                    Dim tAutorizacion As String '  del documento
                    Dim tcodigoControl As String ' del documento
                    Dim RsDatos As Recordset
                    Dim fLimite As Date ' de la caja
                    Dim tSfc As String ' de la caja

                    Dim tSucursal As String

                    Dim cadenaxx As String
                    tSfc = ""
                    fLimite = Now
                    tAutorizacion = Calcular("select tautorizacion as codigo from mdocumento where tdocumento ='" & RsImpresion!tDocumento & "'", Cn)
                    tcodigoControl = Calcular("select tcodigoControl as codigo from mdocumento where tdocumento ='" & RsImpresion!tDocumento & "'", Cn)
                    cadenaxx = "SELECT tsfc,ffin FROM TORIGENCODIGOCONTROL WHERE TCAJA='" & RsImpresion!tCaja & "' AND TAUTORIZACION='" & Trim(tAutorizacion) & "' AND ((FINICIO <= '" & Format(RsImpresion!fRegistro, "YYYYmmdd HH:mm") & "') AND (ffin>='" & Format(RsImpresion!fRegistro, "YYYYmmdd HH:mm") & "'))"
                    Set RsDatos = Lib.OpenRecordset(cadenaxx, Cn)
                    If Not (RsDatos.EOF Or RsDatos.BOF) Then
                           ' rsDatos.MoveFirst
                            tSfc = RsDatos!tSfc
                            fLimite = Format(RsDatos!fFin, "dd/MM/yyyy")
                    End If
                    
                    If lImprimeImagCabDocumento Then
                                    If Cabecera <> 0 Then
                                    Printer.PaintPicture Cabecera, 500, Printer.CurrentY, 2860, 1600
                                    For p = 1 To 10
                                    Printer.Print
                                    Next p
                                    End If
                    End If
                    
                    'Cabecera
                    RsImpresion.MoveFirst
                    ImprimeXCentro sRazonSocial, 40
                    ImprimeXCentro sRazonComercial, 40

                    tSucursal = Calcular("select vs.tResumido as codigo from vsucursal vs inner join TCAJA tc on vs.Codigo = tc.tSucursal where tc.tCaja='" & sCaja & "'", Cn)
                    ImprimeXCentro "Sucursal Nº " & IIf(tSucursal = 0, "", tSucursal), 40
                    ImprimeXCentro sDireccion, 40
                    ImprimeXCentro "Telefono: " & sTelefono, 40
                    ImprimeXCentro "SFC: " & tSfc & "   La Paz Bolivia", 40
                    If estadoReimpresion = True Then
                        ImprimeXCentro "COMPROBANTE - COPIA", 40
                        estadoReimpresion = False
                    Else
                        ImprimeXCentro "COMPROBANTE", 40
                    End If

                    Printer.Print
                    
                    Printer.Print String(40, "-")
                    sLinea = String((40 - Len(Trim("NIT: " + sRUC))) / 2, " ") & "NIT: " + sRUC
                    Printer.Print sLinea
                    Printer.Print "Comprobante  Nº " & Mid(RsImpresion!tDocumento, 7)
                    Printer.Print "Autorización Nº " & tAutorizacion
                    Printer.Print String(40, "-")
                    
                             'impresiondiacontable
                            If lImpresionDiaContable Then
                                If lReimpresion = True Then
                                    Printer.Print "Fecha    : " & Format(Calcular("select fdiacontable as codigo from mdocumento where tdocumento ='" & RsImpresion!tDocumento & "'", Cn), "dd/MM/yyyy") & " " & Calcular("exec DiacontableHora '" & fImpresionDiaContable & "'", Cn)
                                    Else
                                    Printer.Print "Fecha    : " & fImpresionDiaContable & " " & Calcular("exec DiacontableHora '" & fImpresionDiaContable & "'", Cn)
                                End If
                                Else
                                 Printer.Print "Fecha    : " & RsImpresion!fRegistro
                            End If
                            
                    If Not IsNull(RsImpresion!Cliente) Or Len(Trim(RsImpresion!Cliente)) > 0 Then
                        ImprimeXLinea "Señores  : " & RsImpresion!Cliente, 40, 9
                        Printer.Print "NIT/CI   : " & RsImpresion!Ruc
                        Printer.Print "Direccion: " & Mid(RsImpresion!direccion, 1, 30)
                    End If
                    Printer.Print String(40, "-")
                    
                    Printer.Print
                    Printer.Print "Pedido   : " & RsImpresion!tCodigoPedido
                    Printer.Print "Tipo     : " & RsImpresion!tipopedido
                    Printer.Print "Caja     : " & RsImpresion!tCaja & " - " & RsImpresion!tUsuario
                    Printer.Print "Mesero   : " & IIf(IsNull(RsImpresion!Mozo), "", RsImpresion!Mozo)
                    Printer.Print "Nro.Serie: " & Calcular("select isnull(tSerieImpresora,'') codigo from MDOCUMENTO where tDocumento ='" & RsImpresion!tDocumento & "'", Cn)
                    Printer.Print "Descuento: " & Mid(Trim(RsImpresion!DESCUENTO), 1, 30)
                    Printer.Print
                    Printer.Print "MESA     : " & RsImpresion!Mesa
                    If lObservacionCabDoc Then
                        Printer.Print "Observac.: " & RsImpresion!tObservacion
                    End If
                    
                    Printer.Print
                    Printer.Print String(40, "-")
                    Printer.Print "Cantid. Producto                SubTotal"
                    Printer.Print String(40, "-")
                        
                    Item = ""
                    'Cuerpo
                    Do While Not RsImpresion.EOF
                    If ximprimeDetallado = False Then
                        xproducto = RsImpresion!Producto
                    Else
                        xproducto = RsImpresion!ProductoDetallado
                    End If
                       If Item <> RsImpresion!tCodigoPedido + RsImpresion!tItem Then
                          'Impresion de Propiedades
                          If lPropiedadDocumento Then
                             xRsPropiedad.Filter = "tCodigoPedido='" & Mid(Item, 1, 10) & "' and tItem='" & Mid(Item, 11, 3) & "'"
                             If Not xRsPropiedad.EOF Then
                                xRsPropiedad.MoveFirst
                                Do While Not xRsPropiedad.EOF
                                   ImprimeXLinea "        * " & xRsPropiedad!Operador & " " & xRsPropiedad!Descripcion, 31, 10
                                   'Printer.Print "        * " & xRsPropiedad!Operador & " " & xRsPropiedad!Descripcion
                                   xRsPropiedad.MoveNext
                                Loop
                             End If
                                         
                             'Impresion de la Observacion
                             If lObservacionDocumento And Len(Trim(xObservacion)) > 0 Then
                                ImprimeXLinea "        - " & Trim(xObservacion), 33, 2
                             End If
                          End If
                          If IsNull(RsImpresion!tOferta) Or RsImpresion!tOferta = "" Then
                          
                                CANT = Len(Trim(xproducto))
                                ProductoTem = xproducto
regreso:
                                If Valor = 0 Then
                                    sLinea = Right(String(7, " ") & Format(RsImpresion!nCantidad, "###0.00"), 7) & " " & Mid(xproducto & String(19, " "), 1, 19) & " " & Right(String(12, " ") & Format(RsImpresion!nCantidad * RsImpresion!nprecioVenta, "#,###,##0.00"), 12)
                                    Valor = 1
                                    CANT = Len(Mid(ProductoTem, 20))
                                    ProductoTem = Mid(ProductoTem, 20)
                                    Printer.Print sLinea
                                Else
                                    sLinea = Right(String(7, " ") & "       ", 7) & " " & Mid(ProductoTem & String(19, " "), 1, 19) & " " & Right(String(12, " ") & "            ", 12)
                                    CANT = Len(Mid(ProductoTem, 20))
                                    ProductoTem = Mid(ProductoTem, 20)
                                    Printer.Print sLinea
                                End If
                                
                                If CANT > 0 And ximprimeDetallado = True Then
                                GoTo regreso
                                End If
  
                             'sLinea = Right(String(7, " ") & Format(RsImpresion!nCantidad, "###0.00"), 7) & " " & Mid(xproducto & String(19, " "), 1, 19) & " " & Right(String(12, " ") & Format(RsImpresion!nCantidad * RsImpresion!nprecioVenta, "#,###,##0.00"), 12)
                          Else
                          CANT = Len(Trim(xproducto))
                                ProductoTem = xproducto
regreso1:
                                If Valor = 0 Then
                                    sLinea = Right(String(7, " ") & Format(RsImpresion!nCantidad, "###0.00"), 7) & " " & Mid(xproducto & String(19, " "), 1, 19)
                                    Valor = 1
                                    CANT = Len(Mid(ProductoTem, 20))
                                    ProductoTem = Mid(ProductoTem, 20)
                                    Printer.Print sLinea
                                Else
                                    sLinea = Right(String(7, " ") & "       ", 7) & " " & Mid(ProductoTem & String(19, " "), 1, 19)
                                    CANT = Len(Mid(ProductoTem, 20))
                                    ProductoTem = Mid(ProductoTem, 20)
                                    Printer.Print sLinea
                                End If
                                
                                If CANT > 0 And ximprimeDetallado = True Then
                                GoTo regreso1
                                End If
                          
                          
                             'sLinea = Right(String(7, " ") & Format(RsImpresion!nCantidad, "###0.00"), 7) & " " & Mid(xproducto & String(19, " "), 1, 19)
                             
                             sLinea = String(7, " ") & " " & Mid(RsImpresion!tOferta & String(19, " "), 1, 19) & " " & Right(String(12, " ") & Format(RsImpresion!nCantidad * RsImpresion!nprecioVenta, "#,###,##0.00"), 12)
                             Printer.Print sLinea
                          End If
                          Valor = 0
                          'Printer.Print sLinea
                       End If
                       
                       'Combos
                       If lComboDocumento And IIf(IsNull(RsImpresion!Combo), 0, Len(Trim(RsImpresion!Combo))) > 0 Then
                          sLinea = Mid("       " & Right(String(5, " ") & Format(RsImpresion!nCombo, "#0.00"), 5) & " " & RsImpresion!Combo, 1, 40)
                          Printer.Print sLinea
                          
                          'Combos Propiedades
                          If lPropiedadDocumento And Len(Trim(IIf(IsNull(RsImpresion!Combo), "", RsImpresion!Combo))) > 0 Then
                             xRsPropiedadCombo.Filter = "tCodigoPedido='" & RsImpresion!tCodigoPedido & "' and tItem='" & RsImpresion!tItem & "' and tItemCombo='" & RsImpresion!tItemCombo & "'"
                             If Not xRsPropiedadCombo.EOF Then
                                xRsPropiedadCombo.MoveFirst
                                Do While Not xRsPropiedadCombo.EOF
                                ImprimeXLinea "        * " & xRsPropiedadCombo!Operador & " " & xRsPropiedadCombo!Descripcion, 31, 10
                                   'Printer.Print "        * " & xRsPropiedadCombo!Operador & " " & xRsPropiedadCombo!Descripcion
                                   xRsPropiedadCombo.MoveNext
                                Loop
                             End If
                          
                             'Impresion de la Observacion
                              If lObservacionDocumento And Len(Trim(RsImpresion!tObservacionCombo)) > 0 Then
                                 ImprimeXLinea "        - " & Trim(RsImpresion!tObservacionCombo), 33, 2
                              End If
                          End If
                       End If
                       xObservacion = IIf(IsNull(RsImpresion!tObservacionPedido), "", RsImpresion!tObservacionPedido)
                       Item = RsImpresion!tCodigoPedido + RsImpresion!tItem
                       RsImpresion.MoveNext
                    Loop
                    
                    If lPropiedadDocumento Then
                       xRsPropiedad.Filter = "tCodigoPedido='" & Mid(Item, 1, 10) & "' and tItem='" & Mid(Item, 11, 3) & "'"
                       If Not xRsPropiedad.EOF Then
                          xRsPropiedad.MoveFirst
                          Do While Not xRsPropiedad.EOF
                          
                          
                             Printer.Print "        * " & xRsPropiedad!Operador & " " & xRsPropiedad!Descripcion
                             xRsPropiedad.MoveNext
                          Loop
                       End If
                                   
                       'Impresion de la Observacion
                       If lObservacionDocumento And Len(Trim(xObservacion)) > 0 Then
                          ImprimeXLinea "        - " & Trim(xObservacion), 33, 2
                       End If
                    End If
                    
                    Printer.Print String(40, "-")
                    RsImpresion.MoveLast
                    
                    If RsImpresion!nRecargo > 0 Then
                       Printer.Print
                       Printer.Print Right(String(27, " ") & "Recargo " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nRecargo, "##,###,##0.00"), 13)
                    End If
                    
                    If RsImpresion!nDescuento > 0 Then
                       Printer.Print
                       Printer.Print Right(String(27, " ") & "Descuento " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nDescuento, "##,###,##0.00"), 13)
                    End If
                    
                
                    nSumaNeto = RsImpresion!nNeto
                    
                    If IsNull(RsImpresion!lImpuesto1) Or Not RsImpresion!lImpuesto1 Then
                       nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto1
                    End If
                    
                    If IsNull(RsImpresion!lImpuesto2) Or Not RsImpresion!lImpuesto2 Then
                       nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto2
                    End If
                    
                    If IsNull(RsImpresion!lImpuesto3) Or Not RsImpresion!lImpuesto3 Then
                       nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto3
                    End If
                    'CESAR Solo Para Bolivia
                    If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
                       Printer.Print Right(String(27, " ") & "Valor Venta " & sMonN & " : ", 27) & Right(String(13, " ") & Format(nSumaNeto, "##,###,##0.00"), 13)
                    End If
                    
                    If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                       Printer.Print Right(String(27, " ") & sImpuesto1 & " " & Format(nPorcentaje1, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,##0.00"), 13)
                    End If
                       
                    If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                       Printer.Print Right(String(27, " ") & sImpuesto2 & " " & Format(nPorcentaje2, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto2, "##,###,##0.00"), 13)
                    End If
                    
                    If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                       Printer.Print Right(String(27, " ") & sImpuesto3 & " " & Format(nPorcentaje3, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto3, "##,###,##0.00"), 13)
                    End If
                    'CarlosD
                    Printer.Print Right(String(27, " ") & "Total " & sMonN & " :", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 13)
                    
                    'CarlosD 01/12/2006
                    If lEquivalencia = True Or lDocumEquivaPrecuenta = True Then
                    Printer.Print " "
                    Printer.Print Right(String(27, " ") & "Total " & sMonE & " :", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 13)
                    End If
                    'End CarlosD
                     
                    Printer.Print
                    txt = "Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
                    ImprimeXLinea txt, 40, 5
                    Printer.Print
                    
                    Printer.Print String(40, "-")
                    Printer.Print "Código de Control      : " & tcodigoControl
                    Printer.Print "Fecha Límite de Emisión: " & Format(fLimite, "dd/MM/yyyy")
                    Printer.Print String(40, "-")
                    If Calcular("select ISNULL(lImprimeQR,0) as codigo from TTIPODOCUMENTO where tCodigoTipoDocumento='" & tTipoDoc & "'", Cn) = 1 Then
                        If pais = "001" Then
                        
                        Set rsQr = Lib.OpenRecordset("usp_Inforest_ObtieneCodigoQR_Bol " + RsImpresion!tDocumento, Cn)
                                   
                            Set imgDocumento = CreateObject("Scripting.FileSystemObject")
                            If imgDocumento.FileExists(App.Path & "\BaseTempQr.bmp") Then
                                Printer.PaintPicture LoadPicture(App.Path & "\BaseTempQr.bmp"), 1400, Printer.CurrentY, 1323, 1323
                                 For p = 1 To 8
                                    Printer.Print
                                 Next p
                            End If
                       End If
                    End If
                    Printer.Print '.'
                    ImprimeXLinea textoComprobanteBolivia, 40, 5
                    Printer.Print String(40, "-")
                    ImprimeXCentro sPie, 40
                    Set xRsPropiedad = Nothing
                    Set xRsPropiedadCombo = Nothing
                     Printer.Print
                    If lImprimeImagPieDocumento Then
                                    If pie <> 0 Then
                                        Printer.PaintPicture pie, 500, Printer.CurrentY, 2860, 1600
                                    End If
                    End If
                    Printer.EndDoc
                    
                    
                    
                    
        
        Case Else 'PERU , ECUADOR
                    
                    RsImpresion.MoveFirst
'                    If estadoReimpresion = True Then
'                        ImprimeXCentro "REIMPRESION", 40
'                        estadoReimpresion = False
'                    End If
                    
                    If lImprimeImagCabDocumento Then
                        If Cabecera <> 0 Then
                            Printer.PaintPicture Cabecera, 500, Printer.CurrentY, 2860, 1600
                            For p = 1 To 10
                                Printer.Print
                            Next p
                        End If
                    End If
                    
                    ImprimeXCentro sRazonSocial, 40
                    ImprimeXCentro sRazonComercial, 40
                    sLinea = String((40 - Len(Trim("R.U.C.: " + sRUC))) / 2, " ") & "R.U.C.: " + sRUC
                    Printer.Print sLinea
                    ImprimeXCentro sDireccion, 40
                    If Trim(sDireccion2) <> "" Then
                        ImprimeXCentro sDireccion2, 40
                    End If
                    sLinea = String((40 - Len(Trim("Telefono: " + sTelefono))) / 2, " ") & "Telefono: " + sTelefono
                    Printer.Print sLinea
                    If sFax <> "" Then
                        sLinea = String((40 - Len(Trim("Fax: " + sFax))) / 2, " ") & "Fax: " + sFax
                        Printer.Print sLinea
                    End If
                    
                    
                    If tCodigoFE <> "999" Then
                        Printer.Print " "
                        ImprimeXCentro "BOLETA DE VENTA ELECTRONICA", 40
                        Printer.Print " "
                    End If
                    
                    'Printer.Print Mid(RsImpresion!tDocumento, 1, 1) & "-" & Mid(RsImpresion!tDocumento, 2, 5) & "-" & Mid(RsImpresion!tDocumento, 7)
                    ImprimeXCentro Mid(RsImpresion!tDocumento, 1, 1) & Mid(RsImpresion!tDocumento, 4, 3) & "-" & Mid(RsImpresion!tDocumento, 8, 8), 40
                    Printer.Print " "
                    Printer.Print "Pedido        : " & RsImpresion!tCodigoPedido
                    Printer.Print "Fecha Emision : " & RsImpresion!fRegistro
                    Printer.Print "Tipo          : " & RsImpresion!tipopedido
                    Printer.Print "Local         : " & xUnidadNegocio
                    Printer.Print "Caja          : " & RsImpresion!tCaja & " - " & RsImpresion!tUsuario
                    Printer.Print "Mesero        : " & IIf(IsNull(RsImpresion!Mozo), "", RsImpresion!Mozo)
                    If ImpDolarDelivery Then
                        Printer.Print "Tipo Moneda   : " & sMonedaE
                    Else
                        Printer.Print "Tipo Moneda   : " & sMonedaN
                    End If
                    
                    'tipo de cambio
                    If RsParametroTC!lVerTCImp = True Then
                    Printer.Print "T/Cambio  : " & Format(nTC, "###,##0.00")
                    End If
                    '-----------------------------------------------------------
                                       
                    
                    'Printer.Print "Nro.Serie     : " & Calcular("select isnull(tSerieImpresora,'') codigo from MDOCUMENTO where tDocumento ='" & RsImpresion!tDocumento & "'", Cn)
                    Printer.Print "Mesa          : " & RsImpresion!Mesa
                    If lImprimeMotivoDescuentoFB And RsImpresion!MotivoDescuento <> "" Then
                        ImprimeXLinea "Descuento     : " & RsImpresion!MotivoDescuento, 40, 16
                    End If
                    If lObservacionCabDoc Then
                        ImprimeXLinea "Observacion   : " & RsImpresion!tObservacion, 40, 16
                    End If
                    Printer.Print " "
                    Printer.Print String(40, "-")
                    
                    If Not IsNull(RsImpresion!lImpProdDesc) And (RsImpresion!lImpProdDesc) Then
                        Printer.Print "Codigo      Cant. UM   P.Unit      Total"
                        Printer.Print "Producto                          Dscto."
                    Else
                        Printer.Print "Producto         Cant. P.Unit      Total"
                    End If
                    'Printer.Print "Producto         Cant. P.Unit      Total"
                    'Printer.Print "Cantid. Producto                SubTotal"
                    Printer.Print String(40, "-")
                        
                    Item = ""
                    'Cuerpo
                    Do While Not RsImpresion.EOF
                    If ximprimeDetallado = False Then
                        xproducto = RsImpresion!Producto
                    Else
                        xproducto = RsImpresion!ProductoDetallado
                    End If
                       If Item <> RsImpresion!tCodigoPedido + RsImpresion!tItem Then
                          'Impresion de Propiedades
                          If lPropiedadDocumento Then
                             xRsPropiedad.Filter = "tCodigoPedido='" & Mid(Item, 1, 10) & "' and tItem='" & Mid(Item, 11, 3) & "'"
                             If Not xRsPropiedad.EOF Then
                                xRsPropiedad.MoveFirst
                                Do While Not xRsPropiedad.EOF
                                   'Printer.Print "        * " & xRsPropiedad!Operador & " " & xRsPropiedad!Descripcion
                                   'ImprimeXLinea "        * " & xRsPropiedad!Operador & " " & xRsPropiedad!Descripcion, 40, 8
                                   ImprimeXLinea "        * " & IIf(xRsPropiedad!nCantidad = 1, "", "(" & xRsPropiedad!nCantidad & ")") & xRsPropiedad!Operador & " " & xRsPropiedad!Descripcion, 31, 10
                                   xRsPropiedad.MoveNext
                                Loop
                             End If
                                         
                             'Impresion de la Observacion
                             If lObservacionDocumento And Len(Trim(xObservacion)) > 0 Then
                                ImprimeXLinea "        - " & Trim(xObservacion), 33, 2
                             End If
                          End If
                          If IsNull(RsImpresion!tOferta) Or RsImpresion!tOferta = "" Then
                            If Not (RsImpresion!lImpProdDesc) Then
                                CANT = Len(Trim(xproducto))
                                ProductoTem = xproducto
regreso2:
                                If Valor = 0 Then
                                    If ImpDolarDelivery Then
                                        sLinea = Mid(xproducto & String(15, " "), 1, 15) & " " & Right(String(6, " ") & Format(RsImpresion!nCantidad, "##0.00"), 6) & " " & Right(String(6, " ") & Format(RsImpresion!nPrecioOficial / nTC, "##0.00"), 6) & " " & Right(String(10, " ") & Format((RsImpresion!nCantidad * RsImpresion!nPrecioOficial) / nTC, "##,##0.00"), 10)
                                    Else
                                        sLinea = Mid(xproducto & String(15, " "), 1, 15) & " " & Right(String(6, " ") & Format(RsImpresion!nCantidad, "##0.00"), 6) & " " & Right(String(6, " ") & Format(RsImpresion!nPrecioOficial, "##0.00"), 6) & " " & Right(String(10, " ") & Format(RsImpresion!nCantidad * RsImpresion!nPrecioOficial, "##,##0.00"), 10)
                                    End If
                                    Valor = 1
                                    CANT = Len(Mid(ProductoTem, 16))
                                    ProductoTem = Mid(ProductoTem, 16)
                                    Printer.Print sLinea
                                Else
                                    sLinea = Mid(ProductoTem & String(15, " "), 1, 15) & " " & Right(String(6, " ") & "      ", 6) & " " & Right(String(6, " ") & "      ", 6) & " " & Right(String(10, " ") & "        ", 10)
                                    CANT = Len(Mid(ProductoTem, 16))
                                    ProductoTem = Mid(ProductoTem, 16)
                                    Printer.Print sLinea
                                End If
                                
                                If CANT > 0 And ximprimeDetallado = True Then
                                GoTo regreso2
                                End If
                            End If
                            If (RsImpresion!lImpProdDesc) Then ' Para impresion con formato 2
                                If ImpDolarDelivery Then
                                    sLinea = Mid(RsImpresion!tCodigoProducto & String(8, " "), 1, 8) & " " & Right(String(7, " ") & Format(RsImpresion!nCantidad, "##0.00"), 7) & " " & Right(String(3, " ") & "UN", 3) & " " & Right(String(9, " ") & Format(RsImpresion!nPrecioOficial / nTC, "##0.00"), 9) & " " & Right(String(9, " ") & Format((RsImpresion!nCantidad * RsImpresion!nPrecioOficial) / nTC, "##,##0.00"), 9)
                                    sLinea2 = Mid(xproducto & String(30, " "), 1, 30) & " " & Right(String(9, " ") & Format((RsImpresion!DescUnitario) / nTC, "##,##0.00"), 9)
                                Else
                                    sLinea = Mid(RsImpresion!tCodigoProducto & String(8, " "), 1, 8) & " " & Right(String(7, " ") & Format(RsImpresion!nCantidad, "##0.00"), 7) & " " & Right(String(3, " ") & "UN", 3) & " " & Right(String(9, " ") & Format(RsImpresion!nPrecioOficial, "##0.00"), 9) & " " & Right(String(9, " ") & Format(RsImpresion!nCantidad * RsImpresion!nPrecioOficial, "##,##0.00"), 9)
                                    sLinea2 = Mid(xproducto & String(30, " "), 1, 30) & " " & Right(String(9, " ") & Format(RsImpresion!DescUnitario, "##,##0.00"), 9)
                                End If
                                Printer.Print sLinea
                                Printer.Print sLinea2
                            End If
                             'sLinea = Mid(xproducto & String(15, " "), 1, 15) & " " & Right(String(6, " ") & Format(RsImpresion!nCantidad, "##0.00"), 6) & " " & Right(String(6, " ") & Format(RsImpresion!nPrecioOficial, "##0.00"), 6) & " " & Right(String(10, " ") & Format(RsImpresion!nCantidad * RsImpresion!nPrecioOficial, "###,##0.00"), 10)
                          Else
                            If Not (RsImpresion!lImpProdDesc) Then
                                CANT = Len(Trim(xproducto))
                                ProductoTem = xproducto
regreso3:
                                If Valor = 0 Then
                                    sLinea = Right(String(8, " ") & Format(RsImpresion!nCantidad, "#,##0.00"), 8) & " " & Mid(xproducto & String(21, " "), 1, 21)
                                    Valor = 1
                                    CANT = Len(Mid(ProductoTem, 22))
                                    ProductoTem = Mid(ProductoTem, 22)
                                    Printer.Print sLinea
                                Else
                                    sLinea = Right(String(8, " ") & "        ", 8) & " " & Mid(ProductoTem & String(21, " "), 1, 21)
                                    CANT = Len(Mid(ProductoTem, 22))
                                    ProductoTem = Mid(ProductoTem, 22)
                                    Printer.Print sLinea
                                End If
                                
                                If CANT > 0 And ximprimeDetallado = True Then
                                GoTo regreso3
                                End If
                                If ImpDolarDelivery Then
                                    sLinea = String(8, " ") & " " & Mid(RsImpresion!tOferta & String(20, " "), 1, 20) & " " & Right(String(10, " ") & Format((RsImpresion!nCantidad * RsImpresion!nPrecioOficial) / nTC, "###,##0.00"), 10)
                                Else
                                    sLinea = String(8, " ") & " " & Mid(RsImpresion!tOferta & String(20, " "), 1, 20) & " " & Right(String(10, " ") & Format(RsImpresion!nCantidad * RsImpresion!nPrecioOficial, "###,##0.00"), 10)
                                End If
                                
                                Printer.Print sLinea
                            End If
                            If (RsImpresion!lImpProdDesc) Then ' Para impresion con formato 2
                                If ImpDolarDelivery Then
                                    sLinea = Mid(RsImpresion!tCodigoProducto & String(8, " "), 1, 8) & " " & Right(String(7, " ") & Format(RsImpresion!nCantidad, "##0.00"), 7) & " " & Right(String(3, " ") & "UN", 3) & " " & Right(String(9, " ") & Format(RsImpresion!nPrecioOficial / nTC, "##0.00"), 9) & " " & Right(String(9, " ") & Format((RsImpresion!nCantidad * RsImpresion!nPrecioOficial) / nTC, "##,##0.00"), 9)
                                    sLinea2 = Mid(xproducto & String(30, " "), 1, 30) & " " & Right(String(9, " ") & Format((RsImpresion!DescUnitario) / nTC, "##,##0.00"), 9)
                                Else
                                    sLinea = Mid(RsImpresion!tCodigoProducto & String(8, " "), 1, 8) & " " & Right(String(7, " ") & Format(RsImpresion!nCantidad, "##0.00"), 7) & " " & Right(String(3, " ") & "UN", 3) & " " & Right(String(9, " ") & Format(RsImpresion!nPrecioOficial, "##0.00"), 9) & " " & Right(String(9, " ") & Format(RsImpresion!nCantidad * RsImpresion!nPrecioOficial, "##,##0.00"), 9)
                                    sLinea2 = Mid(xproducto & String(30, " "), 1, 30) & " " & Right(String(9, " ") & Format(RsImpresion!DescUnitario, "##,##0.00"), 9)
                                End If
                                Printer.Print sLinea
                                Printer.Print sLinea2
                            End If
                        End If
                          Valor = 0
                          xTotalS = xTotalS + (RsImpresion!nCantidad * RsImpresion!nPrecioOficial)
                          'Printer.Print sLinea
                    End If
                       
                       'Combos
                       If lComboDocumento And IIf(IsNull(RsImpresion!Combo), 0, Len(Trim(RsImpresion!Combo))) > 0 Then
                          sLinea = Mid("       " & Right(String(5, " ") & Format(RsImpresion!nCombo, "#0.00"), 5) & " " & RsImpresion!Combo, 1, 35)
                          Printer.Print sLinea
                          
                          'Combos Propiedades
                          If lPropiedadDocumento And Len(Trim(IIf(IsNull(RsImpresion!Combo), "", RsImpresion!Combo))) > 0 Then
                             xRsPropiedadCombo.Filter = "tCodigoPedido='" & RsImpresion!tCodigoPedido & "' and tItem='" & RsImpresion!tItem & "' and tItemCombo='" & RsImpresion!tItemCombo & "'"
                             If Not xRsPropiedadCombo.EOF Then
                                xRsPropiedadCombo.MoveFirst
                                Do While Not xRsPropiedadCombo.EOF
                                   'Printer.Print "        * " & xRsPropiedadCombo!Operador & " " & xRsPropiedadCombo!Descripcion
                                    ImprimeXLinea "             * " & xRsPropiedadCombo!Operador & " " & xRsPropiedadCombo!Descripcion, 33, 13
                                   xRsPropiedadCombo.MoveNext
                                Loop
                             End If
                          
                             'Impresion de la Observacion
                              If lObservacionDocumento And Len(Trim(RsImpresion!tObservacionCombo)) > 0 Then
                                 ImprimeXLinea "        - " & Trim(RsImpresion!tObservacionCombo), 33, 2
                              End If
                          End If
                       End If
                       xObservacion = IIf(IsNull(RsImpresion!tObservacionPedido), "", RsImpresion!tObservacionPedido)
                       Item = RsImpresion!tCodigoPedido + RsImpresion!tItem
                       RsImpresion.MoveNext
                    Loop
                    
                    If lPropiedadDocumento Then
                       xRsPropiedad.Filter = "tCodigoPedido='" & Mid(Item, 1, 10) & "' and tItem='" & Mid(Item, 11, 3) & "'"
                       If Not xRsPropiedad.EOF Then
                          xRsPropiedad.MoveFirst
                          Do While Not xRsPropiedad.EOF
                              'ImprimeXLinea "        * " & xRsPropiedad!Operador & " " & xRsPropiedad!Descripcion, 40, 8
                              ImprimeXLinea "        * " & IIf(xRsPropiedad!nCantidad = 1, "", "(" & xRsPropiedad!nCantidad & ")") & xRsPropiedad!Operador & " " & xRsPropiedad!Descripcion, 31, 10
                             xRsPropiedad.MoveNext
                          Loop
                       End If
                                   
                       'Impresion de la Observacion
                       If lObservacionDocumento And Len(Trim(xObservacion)) > 0 Then
                          ImprimeXLinea "        - " & Trim(xObservacion), 33, 2
                       End If
                    End If
                    
                    Printer.Print String(40, "-")
                    RsImpresion.MoveLast
                    
                    If ImpDolarDelivery Then
                        
                        If lPagoAntesImpresion Then
                            lcuentaCobrar = True
                            If lcuentaCobrar And lPagocortesiaAI = False Then
                                Printer.Print Right(String(27, " ") & " Total a Pagar " & sMonE & " : ", 27) & Right(String(13, " ") & Format(xTotalS / nTC, "##,###,##0.00"), 13)
                            Else
                                Printer.Print Right(String(27, " ") & " Total a Pagar " & sMonE & " : ", 27) & Right(String(13, " ") & Format(0, "##,###,##0.00"), 13)
                            End If
                        Else
                            Printer.Print Right(String(27, " ") & " Total a Pagar " & sMonE & " : ", 27) & Right(String(13, " ") & Format(xTotalS / nTC, "##,###,##0.00"), 13)
                        End If
                    Else
                        '0035-2013 CESAR
                        If lPagoAntesImpresion Then
                            lcuentaCobrar = True
                            If lcuentaCobrar And lPagocortesiaAI = False Then
                                Printer.Print Right(String(27, " ") & " Total a Pagar " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xTotalS, "##,###,##0.00"), 13)
                            Else
                                Printer.Print Right(String(27, " ") & " Total a Pagar " & sMonN & " : ", 27) & Right(String(13, " ") & Format(0, "##,###,##0.00"), 13)
                            End If
                        Else
                            Printer.Print Right(String(27, " ") & " Total a Pagar " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xTotalS, "##,###,##0.00"), 13)
                        End If

                    End If
                    Printer.Print String(40, " ")
                    
                    Dim xGravada As Double
                    Dim xInafecta As Double
                    
                    xGravada = Calcular("SELECT SUM(D.nPrecioNeto*nCantidad) As Codigo FROM dDocumento D WHERE D.tDocumento = '" & RsImpresion!tDocumento & "' AND ((D.nPrecioImpuesto1>0 AND D.nPrecioImpuesto2=0) OR (D.nPrecioImpuesto1>0 AND D.nPrecioImpuesto2>0))", Cn)
                    xInafecta = Calcular("SELECT ISNULL(SUM(D.nPrecioNeto*nCantidad),0) As Codigo FROM dDocumento D WHERE ((D.nPrecioImpuesto1<=0 AND D.nPrecioImpuesto2>0)OR(D.nPrecioImpuesto1<=0 AND D.nPrecioImpuesto2<=0)) AND D.tDocumento = '" & RsImpresion!tDocumento & "'", Cn)
                    
                    'FE SPRING
                    If lFESpring Then
                       If ImpDolarDelivery Then
                            
                            If RsImpresion!nRecargo > 0 Then
                               Printer.Print
                               Printer.Print Right(String(27, " ") & "Recargo " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nRecargo / nTC, "##,###,##0.00"), 13)
                            End If
                            
                            If RsImpresion!nDescuento > 0 Then
                               Printer.Print
                               nDescuentoNeto = Calcular("select IsNull(nDescuentoNeto,0) as Codigo from mDocumento where tdocumento = '" & RsImpresion!tDocumento & "'", Cn)
                               Printer.Print Right(String(27, " ") & "Descuento " & sMonE & " : ", 27) & Right(String(13, " ") & Format(nDescuentoNeto / nTC, "##,###,##0.00"), 13)
                            End If
                            
                            If Not (IsNull(RsImpresion!lOpGravInaf) Or RsImpresion!lOpGravInaf = 0) Then
                                If lPagoAntesImpresion And lPagocortesiaAI Then
                                    Printer.Print Right(String(27, " ") & "Op. Gratuita " & sMonE & " : ", 27) & Right(String(13, " ") & Format(0 / nTC, "##,###,##0.00"), 13)
                                Else
                                    Printer.Print Right(String(27, " ") & "Op. Gravadas " & sMonE & " : ", 27) & Right(String(13, " ") & Format(xGravada / nTC, "##,###,##0.00"), 13)
                                    Printer.Print Right(String(27, " ") & "Op. Inafecta " & sMonE & " : ", 27) & Right(String(13, " ") & Format(xInafecta / nTC, "##,###,##0.00"), 13)
                                End If
                            End If
                        Else
                            If RsImpresion!nRecargo > 0 Then
                               Printer.Print
                               Printer.Print Right(String(27, " ") & "Recargo " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nRecargo, "##,###,##0.00"), 13)
                            End If
                            
                            If RsImpresion!nDescuento > 0 Then
                               Printer.Print
                               nDescuentoNeto = Calcular("select IsNull(nDescuentoNeto,0) as Codigo from mDocumento where tdocumento = '" & RsImpresion!tDocumento & "'", Cn)
                               Printer.Print Right(String(27, " ") & "Descuento " & sMonN & " : ", 27) & Right(String(13, " ") & Format(nDescuentoNeto, "##,###,##0.00"), 13)
                            End If
                            
                            If Not (IsNull(RsImpresion!lOpGravInaf) Or RsImpresion!lOpGravInaf = 0) Then
                                If lPagoAntesImpresion And lPagocortesiaAI Then
                                    Printer.Print Right(String(27, " ") & "Op. Gratuita " & sMonN & " : ", 27) & Right(String(13, " ") & Format(0, "##,###,##0.00"), 13)
                                Else
                                    Printer.Print Right(String(27, " ") & "Op. Gravadas " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xGravada, "##,###,##0.00"), 13)
                                    Printer.Print Right(String(27, " ") & "Op. Inafecta " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xInafecta, "##,###,##0.00"), 13)
                                End If
                            End If
                        End If

                    Else
                        If ImpDolarDelivery Then
                            If Not (IsNull(RsImpresion!lOpGravInaf) Or RsImpresion!lOpGravInaf = 0) Then
                                Printer.Print Right(String(27, " ") & "Op. Gravadas " & sMonE & " : ", 27) & Right(String(13, " ") & Format(xGravada / nTC, "##,###,##0.00"), 13)
                                Printer.Print Right(String(27, " ") & "Op. Inafecta " & sMonE & " : ", 27) & Right(String(13, " ") & Format(xInafecta / nTC, "##,###,##0.00"), 13)
                            End If
                            
                            If RsImpresion!nRecargo > 0 Then
                               'Printer.Print
                               Printer.Print Right(String(27, " ") & "Recargo " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nRecargo / nTC, "##,###,##0.00"), 13)
                            End If
                            
                            If RsImpresion!nDescuento > 0 Then
                               'Printer.Print
                               Printer.Print Right(String(27, " ") & "Total Descuento " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nDescuento / nTC, "##,###,##0.00"), 13)
                            Else
                               Printer.Print Right(String(27, " ") & "Total Descuento " & sMonE & " : ", 27) & Right(String(13, " ") & Format(0, "##,###,##0.00"), 13)
                            End If
                        Else
                            If Not (IsNull(RsImpresion!lOpGravInaf) Or RsImpresion!lOpGravInaf = 0) Then
                                Printer.Print Right(String(27, " ") & "Op. Gravadas " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xGravada, "##,###,##0.00"), 13)
                                Printer.Print Right(String(27, " ") & "Op. Inafecta " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xInafecta, "##,###,##0.00"), 13)
                            End If
                            
                            If RsImpresion!nRecargo > 0 Then
                               'Printer.Print
                               Printer.Print Right(String(27, " ") & "Recargo " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nRecargo, "##,###,##0.00"), 13)
                            End If
                            
                            If RsImpresion!lAnticipo Then
                                Printer.Print Right(String(27, " ") & "Total Anticipo  " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nDescuento, "##,###,##0.00"), 13)
                            Else
                                If RsImpresion!nDescuento > 0 Then
                                   'Printer.Print
                                   Printer.Print Right(String(27, " ") & "Total Descuento " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nDescuento, "##,###,##0.00"), 13)
                                Else
                                   Printer.Print Right(String(27, " ") & "Total Descuento " & sMonN & " : ", 27) & Right(String(13, " ") & Format(0, "##,###,##0.00"), 13)
                                End If
                            End If
                        End If
                    End If
                    
                    nSumaNeto = RsImpresion!nNeto
                    
                    If IsNull(RsImpresion!lImpuesto1) Or Not RsImpresion!lImpuesto1 Then
                       nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto1
                    End If
                    
                    If IsNull(RsImpresion!lImpuesto2) Or Not RsImpresion!lImpuesto2 Then
                       nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto2
                    End If
                    
                    If IsNull(RsImpresion!lImpuesto3) Or Not RsImpresion!lImpuesto3 Then
                       nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto3
                    End If
                    
                    'CESAR 'Por Consumo No - TICKET
'                    If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
'                       Printer.Print Right(String(27, " ") & "Sub Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(nSumaNeto, "##,###,##0.00"), 13)
'                    End If
                    If ImpDolarDelivery Then
                        If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                           Printer.Print Right(String(27, " ") & sImpuesto1 & " " & Format(nPorcentaje1, "##0.00") & "% " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto1 / nTC, "##,###,##0.00"), 13)
                        End If
                           
                        If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                           Printer.Print Right(String(27, " ") & sImpuesto2 & " " & Format(nPorcentaje2, "##0.00") & "% " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto2 / nTC, "##,###,##0.00"), 13)
                        End If
                        
                        If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                           Printer.Print Right(String(27, " ") & sImpuesto3 & " " & Format(nPorcentaje3, "##0.00") & "% " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto3 / nTC, "##,###,##0.00"), 13)
                        End If
                            
                            
                         If lPagoAntesImpresion Then
                            lcuentaCobrar = True
                                If lcuentaCobrar And lPagocortesiaAI = False Then
                                    Printer.Print Right(String(27, " ") & "Importe Total " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 13)
                                Else
                                    Printer.Print Right(String(27, " ") & "Importe Total " & sMonE & " : ", 27) & Right(String(13, " ") & Format(0, "##,###,##0.00"), 13)
                                End If
                         Else
                            
                            Printer.Print Right(String(27, " ") & "Importe Total " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 13)
                        End If
                    Else
                        If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                           Printer.Print Right(String(27, " ") & sImpuesto1 & " " & Format(nPorcentaje1, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,##0.00"), 13)
                        End If
                           
                        If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                           Printer.Print Right(String(27, " ") & sImpuesto2 & " " & Format(nPorcentaje2, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto2, "##,###,##0.00"), 13)
                        End If
                        
                        If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                           Printer.Print Right(String(27, " ") & sImpuesto3 & " " & Format(nPorcentaje3, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto3, "##,###,##0.00"), 13)
                        End If
                            
                            
                         If lPagoAntesImpresion Then
                            lcuentaCobrar = True
                                If lcuentaCobrar And lPagocortesiaAI = False Then
                                    Printer.Print Right(String(27, " ") & "Importe Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 13)
                                Else
                                    Printer.Print Right(String(27, " ") & "Importe Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(0, "##,###,##0.00"), 13)
                                End If
                         Else
                            
                            Printer.Print Right(String(27, " ") & "Importe Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 13)
                        End If

                        If lEquivalencia = True Or lDocumEquivaPrecuenta = True Then
                           If lPagoAntesImpresion Then
                            lcuentaCobrar = True
                                If lcuentaCobrar And lPagocortesiaAI = False Then
                                    Printer.Print " "
                                    Printer.Print Right(String(27, " ") & "Total " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 13)
                                Else
                                    Printer.Print " "
                                    Printer.Print Right(String(27, " ") & "Total " & sMonE & " : ", 27) & Right(String(13, " ") & Format(0, "##,###,##0.00"), 13)
                                End If
                            Else
                            
                            Printer.Print " "
                            Printer.Print Right(String(27, " ") & "Total " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 13)
                            End If
    
                        End If
                    End If
                    
                    'TEXTO AGENTE RETENCION
                    Printer.Print " "
                    If Calcular(" SELECT case when  lImpresionRetencion=1 then 1 else 0 end  as codigo FROM vTipodocumento WHERE Codigo=(SELECT TTIPODOCUMENTO FROM MDOCUMENTO WHERE tDocumento='" & RsImpresion!tDocumento & "')", Cn) = 1 Then
                        ImprimeXLinea tTextoAgenteRetencion, 40, 5
                    End If
                    Printer.Print " "
                    If ImpDolarDelivery Then
                        If lPagoAntesImpresion Then
                            lcuentaCobrar = True
                                    If lcuentaCobrar And lPagocortesiaAI = False Then
                                        txt = "Son: " & NumeroCadena(str(RsImpresion!nVenta / nTC)) & " " & sMonedaE
                                        ImprimeXLinea txt, 40, 5
                                        Printer.Print
                                    Else
                                         txt = "Son: " & NumeroCadena(str(0)) & " " & sMonedaE
                                        ImprimeXLinea txt, 40, 5
                                        Printer.Print
                                    End If
                         Else
                            
                            txt = "Son: " & NumeroCadena(str(RsImpresion!nVenta / nTC)) & " " & sMonedaE
                            ImprimeXLinea txt, 40, 5
                            Printer.Print
                        End If
                    Else
                        If lPagoAntesImpresion Then
                            lcuentaCobrar = True
                                    If lcuentaCobrar And lPagocortesiaAI = False Then
                                        txt = "Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
                                        ImprimeXLinea txt, 40, 5
                                        Printer.Print
                                    Else
                                         txt = "Son: " & NumeroCadena(str(0)) & " " & sMonedaN
                                        ImprimeXLinea txt, 40, 5
                                        Printer.Print
                                    End If
                         Else
                            
                            txt = "Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
                            ImprimeXLinea txt, 40, 5
                            Printer.Print
                        End If
                    End If
                     If lPagoAntesImpresion Then
                        lcuentaCobrar = True
                        'Set RsPagoDocumento = Lib.OpenRecordset("select Distinct v.tResumido + ' ' + M.tResumido as pago , Sum(D.nMonto) as monto from DPAGODOCUMENTO D inner join vTipoPago v on d.tTipoPago = v.Codigo inner join vMoneda M on M.Codigo = D.tMoneda Where D.tDocumento = '" & RsImpresion!tDocumento & "' group by v.tResumido,  M.tResumido", Cn)
                        Set RsPagoDocumento = Lib.OpenRecordset("exec usp_Inforest_Impresion '" & RsImpresion!tDocumento & "', 9 ", Cn)
                        Printer.Print " "
                            If RsPagoDocumento.RecordCount > 0 Then
                                For i = 0 To RsPagoDocumento.RecordCount - 1
                                    lcuentaCobrar = False
                                        Printer.Print "Forma de Pago:" & RsPagoDocumento!pago & " " & Format(RsPagoDocumento!Monto, "##,###,##0.00")
                                    RsPagoDocumento.MoveNext
                                Next i
                                Printer.Print "Vuelto       :" & sMonN & " " & Format(RsImpresion!Vuelto, "##,###,##0.00")
                            Else
                                If lcuentaCobrar And lPagocortesiaAI = False Then
                                    Printer.Print "Forma de Pago:Enviado a Cuenta por Cobrar"
                                Else
                                    ImprimeXLinea "Forma de Pago: " & lGlosaTrans, 40, 15
                                End If
                            End If
                        Printer.Print " "
                    End If
                    
                    If Not IsNull(RsImpresion!Cliente) Or Len(Trim(RsImpresion!Cliente)) > 0 Then
                       ImprimeXLinea "Cliente: " & RsImpresion!Cliente, 40, 9
                    End If
                    xTipoIdentidad = ""
                    xTipoIdentidad = Calcular("select upper(tResumido) as Codigo from vTipoIdentidad inner join TCLIENTE on vTipoIdentidad.Codigo=tcliente.tTipoIdentidad where tcliente.tCodigoCliente= (select isnull(tCodigoCliente,'') as codigo From MDOCUMENTO where tDocumento='" & RsImpresion!tDocumento & "')", Cn)
                    If xTipoIdentidad = "0" Then
                        xTipoIdentidad = "Iden."
                    End If
                    Printer.Print xTipoIdentidad & "    : " & RsImpresion!Ruc
                    'Printer.Print
                    If lFEBiz Then
                        Dim tUbigeo As String
                        Dim sUbigeo As String
                        tUbigeo = Calcular("select top 1 isnull(tUbigeo,'') as Codigo from tcliente where tIdentidad='" & RsImpresion!Ruc & "'", Cn)
                        sUbigeo = Calcular("select isnull(tdistrito+'-'+tprovincia+'-'+tDepartamento,'') as codigo from tubigeo where tcodigo='" & tUbigeo & "'", Cn)
                        ImprimeXLinea "Ubigeo : " & tUbigeo & " " & sUbigeo, 40, 9
                    End If
                    Printer.Print String(40, "-")
                    ImprimeXCentro sPie, 40
                                       
                    Set xRsPropiedad = Nothing
                    Set xRsPropiedadCombo = Nothing
                    
                    
                    Printer.Print " "
                    'FACTURACION_E_PERU
                    If lQRFE Then
                        Printer.PaintPicture CodigoHash, 1400, Printer.CurrentY, 1323, 1323
                        Dim d As Integer
                        For d = 1 To 8
                            Printer.Print
                         Next d
                    Else

                         If lImpresionCodigoBarras Then
                            Printer.PaintPicture CodigoHash, 250, Printer.CurrentY, 3400, 1200
                            Printer.CurrentY = Printer.CurrentY + 1200
                         Else
                            ImprimeXCentro cadenaCodigoHash, 40
                         End If
                     End If
                     
                    Printer.Print " "
                    xImpresionFE = Calcular(" SELECT tImpresionFE as codigo FROM vTipodocumento WHERE Codigo=(SELECT TTIPODOCUMENTO FROM MDOCUMENTO WHERE tDocumento='" & RsImpresion!tDocumento & "')", Cn)
                    ImprimeXCentro xImpresionFE, 40
                    Printer.Print " "
                    '------------------
                    
                    If lImprimeImagPieDocumento Then
                            If pie <> 0 Then
                            Printer.Print " "
                            Printer.PaintPicture pie, 500, Printer.CurrentY, 2860, 1600
                            End If
                    End If
                    
                    
                    Printer.EndDoc
    End Select
    
End Sub



Public Sub ImprimeBoletaConsumoN(ByVal RsImpresion As Recordset, ByVal sConsumo As String, ByVal Empresa As String)
    On Error Resume Next
    Dim Item As String
    Dim sLinea As String
    Dim i As Integer
    Dim j As Integer
    Dim txt As String
    Dim lin As String
    Dim tOt As Integer
    Dim pos As Integer
    Dim pri As Boolean
        
    'Cabecera
    Printer.PaperSize = vbPRPSUser
    Printer.Orientation = vbPRORPortrait
    RsImpresion.MoveFirst
    
    Select Case Empresa
           Case Is = "002"
                 For i = 1 To nCabecera
                     Printer.Print
                 Next i
                    
                 Printer.Print String(58, " ") & "   Pedido : " & sPedido
                 Printer.Print "            " & Mid(RsImpresion!tDocumento & String(45, " "), 1, 45) & "    Caja   : " & RsImpresion!tCaja & " - " & RsImpresion!tUsuario
                 Printer.Print "            " & Mid(RsImpresion!Cliente & String(60, " "), 1, 60)
                 Printer.Print ""
                 Printer.Print ""
                 'Printer.Print "            " & Mid(RsImpresion!Direccion & String(60, " "), 1, 60)
                 Printer.Print String(61, " ") & Format(RsImpresion!fRegistro, "dd MMMM yyyy")
                 Printer.Print String(51, " ") & "          Mesa   : " & IIf((RsImpresion!tMesa = "000" Or Len(Trim(RsImpresion!tMesa)) = 0 Or IsNull(RsImpresion!tMesa)), RsImpresion!tObservacion, RsImpresion!Mesa)
                                                 
                 For i = 1 To nDetalle
                     Printer.Print
                 Next i
                    
                 'Cuerpo
                 Printer.Print
                 txt = sConsumo
                 tOt = Len(Trim(txt))
                 pri = True
                 j = 0
                 Do While tOt <> 0
                    j = j + 1
                    lin = Mid(txt & " ", 1, 50)
                    For i = 50 To 1 Step -1
                        If Mid(lin, i, 1) = " " Then
                           pos = i
                           Exit For
                        End If
                    Next i
                    If pri Then
                       sLinea = "                   " & Mid(Mid(txt, 1, pos - 1) & String(56, " "), 1, 56) & "        " & Right(String(12, " ") & Format(RsImpresion!nVenta, "#,###,##0.00"), 12)
                       pri = False
                    Else
                       sLinea = "                   " & Mid(txt, 1, pos - 1)
                    End If
                    txt = Mid(txt, pos + 1, tOt)
                    tOt = Len(txt)
                    Printer.Print sLinea
                 Loop
                    
                 For i = j To nFItem - 1
                     Printer.Print " "
                 Next i
                 
                 RsImpresion.MoveLast
                 Printer.Print
                 RsImpresion.MoveLast
                 Printer.Print "                  Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
                 If RsImpresion!nRecargo > 0 Then
                    Printer.Print Right(String(82, " ") & "Recargo : ", 64) & Right(String(13, " ") & Format(RsImpresion!nRecargo, "##,###,##0.00"), 13)
                 Else
                    Printer.Print
                 End If
                     
                 If RsImpresion!nDescuento > 0 Then
                    Printer.Print Right(String(82, " ") & "Descuento : ", 64) & Right(String(13, " ") & Format(RsImpresion!nDescuento, "##,###,##0.00"), 13)
                 Else
                    Printer.Print
                 End If
                 
                 Printer.Print ""
                 Printer.Print ""
                 'Humberto 15/10/2008, se agrego la condición para saber si se debe o no imprimir el impuesto
                 If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
                    Printer.Print String(82, " ") & Right(String(13, " ") & Format(RsImpresion!nNeto, "##,###,##0.00"), 13)
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                    If RsImpresion!nprecioImpuesto1 > 0 Then
                        Printer.Print String(82, " ") & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,##0.00"), 13)
                    Else
                        Printer.Print ""
                    End If
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                    If RsImpresion!nprecioImpuesto2 > 0 Then
                        Printer.Print String(82, " ") & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto2, "##,###,##0.00"), 13)
                    Else
                        Printer.Print ""
                    End If
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                    If RsImpresion!nprecioImpuesto3 > 0 Then
                        Printer.Print String(82, " ") & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto3, "##,###,##0.00"), 13)
                    Else
                        Printer.Print ""
                    End If
                 End If
                 'Humberto 15/10/2008, fin
                 Printer.Print String(82, " ") & Right(String(13, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 13)
                 'nov 2010
                  '====================== nov 2010
                If lDocumEquivaPrecuenta Then
                     Printer.Print " "
                    Printer.Print Right(String(82, " ") & "Total " & sMonE & " :", 82) & Right(String(13, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 13)
                End If
    '====================== nov 2010
           Case Is = "005" 'Ancel
                 For i = 1 To nCabecera
                     Printer.Print
                 Next i
                 
                 Printer.Print "            " & RsImpresion!tDocumento
                 Printer.Print
                 Printer.Print
                 Printer.Print "      " & Mid(Format(RsImpresion!fRegistro, "dd    MMMM ") & String(20, " "), 1, 20) & "     " & Mid(Format(RsImpresion!fRegistro, "yy"), 2, 1)
                 Printer.Print
                 Printer.Print "          " & Mid(RsImpresion!Cliente & String(66, " "), 1, 66) & RsImpresion!Ruc
                 Printer.Print
                 Printer.Print "          " & Mid(RsImpresion!direccion & String(50, " "), 1, 50)
                 
                 For i = 1 To nDetalle
                     Printer.Print
                 Next i
                 
                 'Cuerpo
                 Printer.Print
                 txt = sConsumo
                 tOt = Len(Trim(txt))
                 pri = True
                 j = 0
                 Do While tOt <> 0
                    j = j + 1
                    lin = Mid(txt & " ", 1, 45)
                    For i = 45 To 1 Step -1
                        If Mid(lin, i, 1) = " " Then
                           pos = i
                           Exit For
                        End If
                    Next i
                    If pri Then
                       sLinea = "              " & Mid(Mid(txt, 1, pos - 1) & String(45, " "), 1, 45) & "                " & Right(String(12, " ") & Format(RsImpresion!nVenta, "#,###,##0.00"), 12)
                       pri = False
                    Else
                       sLinea = "              " & Mid(txt, 1, pos - 1)
                    End If
                    txt = Mid(txt, pos + 1, tOt)
                    tOt = Len(txt)
                    Printer.Print sLinea
                 Loop
                 
                                  
                 For j = i To nFItem
                     Printer.Print " "
                 Next j
                 
                 RsImpresion.MoveLast
                 If RsImpresion!nRecargo > 0 Then
                    Printer.Print " " & Right(String(78, " ") & "Recargo : ", 78) & Right(String(17, " ") & Format(RsImpresion!nRecargo, "##,###,###,##0.00"), 17)
                 Else
                    Printer.Print
                 End If
                     
                 If RsImpresion!nDescuento > 0 Then
                    Printer.Print " " & Right(String(74, " ") & "Descuento : ", 74) & Right(String(17, " ") & Format(RsImpresion!nDescuento, "##,###,###,##0.00"), 17)
                 Else
                    Printer.Print
                 End If
                 
                 Printer.Print " "
                 Printer.Print " " & Right(String(74, " ") & "Total " & sMonN & " : ", 74) & Right(String(17, " ") & Format(RsImpresion!nVenta, "##,##,###,##0.00"), 17)
                  '====================== nov 2010
                If lDocumEquivaPrecuenta Then
                    Printer.Print " "
                    Printer.Print Right(String(74, " ") & "Total " & sMonE & " :", 74) & Right(String(17, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 17)
                End If
                  '====================== nov 2010
                 Printer.Print " "
                 Printer.Print UCase("        " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN)
                 
                    
                 
           Case Is = "006"       ' Atlantic
                 For i = 1 To nCabecera
                     Printer.Print
                 Next i
                 
                 Printer.Print "   Documento        : " & RsImpresion!tDocumento
                 Printer.Print "   Fecha de Emisión : " & Format(RsImpresion!fRegistro, "dd MMMM yyyy")
                 Printer.Print "   Cliente          : " & RsImpresion!Cliente
                 Printer.Print "   Dirección        : " & RsImpresion!direccion
                 Printer.Print "   Pedido           : " & sPedido
                 Printer.Print Mid("   Caja             : " & RsImpresion!tCaja & " - " & RsImpresion!tUsuario & String(53, " "), 1, 53) & "Mesero  : " & RsImpresion!Mozo
                 Printer.Print "   MESA             : " & IIf((RsImpresion!tMesa = "000" Or Len(Trim(RsImpresion!tMesa)) = 0 Or IsNull(RsImpresion!tMesa)), RsImpresion!tObservacion, RsImpresion!Mesa)
                 For i = 1 To nDetalle
                     Printer.Print
                 Next i
                 
                 'Cuerpo
                 Printer.Print
                 txt = sConsumo
                 tOt = Len(Trim(txt))
                 pri = True
                 j = 0
                 Do While tOt <> 0
                    j = j + 1
                    lin = Mid(txt & " ", 1, 45)
                    For i = 45 To 1 Step -1
                        If Mid(lin, i, 1) = " " Then
                           pos = i
                           Exit For
                        End If
                    Next i
                    If pri Then
                       sLinea = "              " & Mid(Mid(txt, 1, pos - 1) & String(45, " "), 1, 45) & "                " & Right(String(12, " ") & Format(RsImpresion!nVenta, "#,###,##0.00"), 12)
                       pri = False
                    Else
                       sLinea = "              " & Mid(txt, 1, pos - 1)
                    End If
                    txt = Mid(txt, pos + 1, tOt)
                    tOt = Len(txt)
                    Printer.Print sLinea
                 Loop
                    
                 For i = j To nFItem - 1
                     Printer.Print " "
                 Next i
                 
                 RsImpresion.MoveLast
                 If RsImpresion!nRecargo > 0 Then
                    Printer.Print Right(String(77, " ") & "Recargo : ", 77) & Right(String(17, " ") & Format(RsImpresion!nRecargo, "##,###,###,##0.00"), 17)
                 Else
                    Printer.Print
                 End If
                     
                 If RsImpresion!nDescuento > 0 Then
                    Printer.Print Right(String(77, " ") & "Descuento : ", 77) & Right(String(17, " ") & Format(RsImpresion!nDescuento, "##,###,###,##0.00"), 17)
                 Else
                    Printer.Print
                 End If
                 'Humberto 15/10/2008, se agrego la condición para saber si se debe o no imprimir el impuesto
                 If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
                    Printer.Print Right(String(77, " ") & "Valor Venta :", 77) & Right(String(17, " ") & Format(RsImpresion!nNeto, "##,##,###,##0.00"), 17)
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                    If RsImpresion!nprecioImpuesto1 > 0 Then
                        Printer.Print Right(String(77, " ") & sImpuesto1 & " " & Format(nPorcentaje1, "##0.00") & "% :", 77) & Right(String(17, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,###,##0.00"), 17)
                    End If
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                    If RsImpresion!nprecioImpuesto2 > 0 Then
                        Printer.Print Right(String(77, " ") & sImpuesto2 & " " & Format(nPorcentaje2, "##0.00") & "% :", 77) & Right(String(17, " ") & Format(RsImpresion!nprecioImpuesto2, "##,##,###,##0.00"), 17)
                    End If
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                    If RsImpresion!nprecioImpuesto3 > 0 Then
                        Printer.Print Right(String(77, " ") & sImpuesto3 & " " & Format(nPorcentaje3, "##0.00") & "% :", 77) & Right(String(17, " ") & Format(RsImpresion!nprecioImpuesto3, "##,##,###,##0.00"), 17)
                    End If
                 End If
                 'Humberto 15/10/2008, fin
                 Printer.Print Right(String(77, " ") & "Total " & sMonN & " : ", 77) & Right(String(17, " ") & Format(RsImpresion!nVenta, "##,##,###,##0.00"), 17)
                '====================== nov 2010
                   If lDocumEquivaPrecuenta Then
                        Printer.Print " "
                       Printer.Print Right(String(77, " ") & "Total " & sMonE & " :", 77) & Right(String(17, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 17)
                   End If
                   '====================== nov 2010
                   
                If Calcular(" SELECT case when  lImpresionRetencion=1 then 1 else 0 end  as codigo FROM vTipodocumento WHERE Codigo=(SELECT TTIPODOCUMENTO FROM MDOCUMENTO WHERE tDocumento='" & RsImpresion!tDocumento & "')", Cn) = 1 Then
                    Printer.Print tTextoAgenteRetencion
                End If
                   
                 Printer.Print UCase("SON: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN)
                 
           Case Is = "007" ' DUZKA
                 For i = 1 To nCabecera
                     Printer.Print
                 Next i
            
                 Printer.Print " "
                 Printer.Print " "
                 Printer.Print " " & RsImpresion!tDocumento
                 Printer.Print " "
                 Printer.Print " " & Day(RsImpresion!fRegistro) & "    " & Format(RsImpresion!fRegistro, "MMM") & "    " & Year(RsImpresion!fRegistro)
                 
                 For i = 1 To nDetalle
                     Printer.Print
                 Next i
                 
                 'Cuerpo
                 Printer.Print
                 txt = sConsumo
                 tOt = Len(Trim(txt))
                 pri = True
                 j = 0
                 Do While tOt <> 0
                    j = j + 1
                    lin = Mid(txt & " ", 1, 45)
                    For i = 45 To 1 Step -1
                        If Mid(lin, i, 1) = " " Then
                           pos = i
                           Exit For
                        End If
                    Next i
                    If pri Then
                       sLinea = "              " & Mid(Mid(txt, 1, pos - 1) & String(45, " "), 1, 45) & "                    " & Right(String(12, " ") & Format(RsImpresion!nVenta, "#,###,##0.00"), 12)
                       pri = False
                    Else
                       sLinea = "              " & Mid(txt, 1, pos - 1)
                    End If
                    txt = Mid(txt, pos + 1, tOt)
                    tOt = Len(txt)
                    Printer.Print sLinea
                 Loop
                                                   
                 For j = i To nFItem
                     Printer.Print " "
                 Next j
            
                 Printer.Print
                 RsImpresion.MoveLast
                 
                 Printer.Print "        Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
                 If RsImpresion!nRecargo > 0 Then
                    Printer.Print Right(String(64, " ") & "Recargo : ", 64) & Right(String(13, " ") & Format(RsImpresion!nRecargo, "##,###,##0.00"), 13)
                 Else
                    Printer.Print
                 End If
                     
                 If RsImpresion!nDescuento > 0 Then
                    Printer.Print Right(String(64, " ") & "Descuento : ", 64) & Right(String(13, " ") & Format(RsImpresion!nDescuento, "##,###,##0.00"), 13)
                 Else
                    Printer.Print
                 End If
                 'Humberto 15/10/2008, se agrego la condición para saber si se debe o no imprimir el impuesto
                 If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
                    Printer.Print Right(String(78, " "), 78) & Right(String(13, " ") & Format(RsImpresion!nNeto, "##,###,##0.00"), 13)
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                    If RsImpresion!nprecioImpuesto1 > 0 Then
                        Printer.Print Right(String(78, " "), 78) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,##0.00"), 13)
                    End If
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                    If RsImpresion!nprecioImpuesto2 > 0 Then
                        Printer.Print Right(String(78, " "), 78) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto2, "##,###,##0.00"), 13)
                    End If
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                    If RsImpresion!nprecioImpuesto3 > 0 Then
                        Printer.Print Right(String(78, " "), 78) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto3, "##,###,##0.00"), 13)
                    End If
                 End If
                 'Humberto 15/10/2008, fin
                 Printer.Print Right(String(78, " "), 78) & Right(String(13, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 13)
                 '====================== nov 2010
                   If lDocumEquivaPrecuenta Then
                        Printer.Print " "
                       Printer.Print Right(String(78, " ") & "Total " & sMonE & " :", 78) & Right(String(13, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 13)
                   End If
                   '====================== nov 2010
                 
            Case Is = "009" ' La Gloria
                 For i = 1 To nCabecera - 5
                     Printer.Print
                 Next i
                             
                 Printer.Print "                         " & RsImpresion!tDocumento
                 Printer.Print "  " & Mid(RsImpresion!Cliente & String(40, " "), 1, 40) & "  " & Format(RsImpresion!fRegistro, "dd-MM-yy")
                 
                 For i = 1 To nDetalle - 2
                     Printer.Print
                 Next i
                 
                 'Cuerpo
                 Printer.Print
                 txt = sConsumo
                 tOt = Len(Trim(txt))
                 pri = True
                 j = 0
                 Do While tOt <> 0
                    j = j + 1
                    lin = Mid(txt & " ", 1, 45)
                    For i = 45 To 1 Step -1
                        If Mid(lin, i, 1) = " " Then
                           pos = i
                           Exit For
                        End If
                    Next i
                    If pri Then
                       sLinea = "              " & Mid(Mid(txt, 1, pos - 1) & String(45, " "), 1, 45) & "                    " & Right(String(12, " ") & Format(RsImpresion!nVenta, "#,###,##0.00"), 12)
                       pri = False
                    Else
                       sLinea = "              " & Mid(txt, 1, pos - 1)
                    End If
                    txt = Mid(txt, pos + 1, tOt)
                    tOt = Len(txt)
                    Printer.Print sLinea
                 Loop
                                                   
                 For j = i To nFItem - 4
                     Printer.Print " "
                 Next j
                                                               
                 RsImpresion.MoveLast
                                  
                 Printer.Print "      Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
                 Printer.Print " "
                 Printer.Print " "
                 Printer.Print String(35, " ") & Right(String(13, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 13)
                 '====================== nov 2010
                   If lDocumEquivaPrecuenta Then
                        Printer.Print " "
                       Printer.Print Right(String(35, " ") & "Total " & sMonE & " :", 35) & Right(String(13, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 13)
                   End If
                   '====================== nov 2010
            'LG
            Case Is = "010" ' Mangos
                 For i = 1 To nCabecera
                     Printer.Print
                 Next i
                 
                 If (RsImpresion!Cliente <> nulo) Then
                    Printer.Print "Cliente:   " & Left(Mid(RsImpresion!Cliente, 1, 60) & String(60, " "), 60)
                    Printer.Print "Dirección: " & Left(Mid(RsImpresion!direccion, 1, 60) & String(60, " "), 60)
                 Else
                    Printer.Print ""
                    Printer.Print ""
                 End If
                 
                 Printer.Print "Fecha:     " & Format(RsImpresion!fRegistro, " dd  MMMM  yyyy ") & String(3, " ") & Left("Usuario: " & RsImpresion!tUsuario & String(50, " "), 50)
                                              
                 For i = 1 To nDetalle
                     Printer.Print
                 Next i
                 
                 'Cuerpo
                 'Printer.Print
                 txt = sConsumo
                 tOt = Len(Trim(txt))
                 pri = True
                 j = 0
                 Do While tOt <> 0
                    j = j + 1
                    lin = Mid(txt & " ", 1, 50)
                    For i = 50 To 1 Step -1
                        If Mid(lin, i, 1) = " " Then
                           pos = i
                           Exit For
                        End If
                    Next i
                    If pri Then
                       sLinea = "                " & Mid(Mid(txt, 1, pos - 1) & String(50, " "), 1, 50) & "         " & Right(String(14, " ") & Format(RsImpresion!nVenta, "#,###,##0.00"), 14)
                       pri = False
                    Else
                       sLinea = "              " & Mid(txt, 1, pos - 1)
                    End If
                    txt = Mid(txt, pos + 1, tOt)
                    tOt = Len(txt)
                    Printer.Print sLinea
                 Loop
                 
                 Printer.Print " "
                 For i = j To nFItem - 1
                     Printer.Print " "
                 Next i
                 
                 Printer.Print
                 RsImpresion.MoveLast
                 Printer.Print "              Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
                 
                 Printer.Print ""
                 Printer.Print ""

                 If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
                    sImportes = Right(String(22, " ") & "NETO " & sMonN & Format(RsImpresion!nNeto, "##,###,##0.00"), 22) & _
                                Right(String(18, " ") & UCase(sImpuesto1) & " " & sMonN & Format(RsImpresion!nprecioImpuesto1, "##,###,##0.00"), 19) & _
                                Right(String(18, " ") & UCase(sImpuesto2) & " " & sMonN & Format(RsImpresion!nprecioImpuesto2, "##,###,##0.00"), 19) & _
                                Right(String(20, " ") & "TOTAL " & sMonN & Format(RsImpresion!nVenta, "##,###,##0.00"), 21)
                    Printer.Print String(6, " ") & sImportes
                 End If
                         
             'CGMIRANDA------------------------------------
             
                Case Is = "011"       ' LIBER
                 For i = 1 To nCabecera
                     Printer.Print
                 Next i
                 
                 Printer.Print "   Documento        : " & RsImpresion!tDocumento
                 Printer.Print "   Fecha de Emisión : " & Format(RsImpresion!fRegistro, "dd MMMM yyyy")
                 Printer.Print "   Cliente          : " & RsImpresion!Cliente
                 Printer.Print "   Dirección        : " & RsImpresion!direccion
                 Printer.Print "   Pedido           : " & sPedido
                 Printer.Print Mid("   Caja             : " & RsImpresion!tCaja & " - " & RsImpresion!tUsuario & String(53, " "), 1, 53) & "Mozo    : " & RsImpresion!Mozo
                 Printer.Print "   MESA             : " & IIf((RsImpresion!tMesa = "000" Or Len(Trim(RsImpresion!tMesa)) = 0 Or IsNull(RsImpresion!tMesa)), RsImpresion!tObservacion, RsImpresion!Mesa)
                 For i = 1 To nDetalle
                     Printer.Print
                 Next i
                 
                 'Cuerpo
                 Printer.Print
                 txt = sConsumo
                 tOt = Len(Trim(txt))
                 pri = True
                 j = 0
                 Do While tOt <> 0
                    j = j + 1
                    lin = Mid(txt & " ", 1, 45)
                    For i = 45 To 1 Step -1
                        If Mid(lin, i, 1) = " " Then
                           pos = i
                           Exit For
                        End If
                    Next i
                    If pri Then
                       sLinea = "              " & Mid(Mid(txt, 1, pos - 1) & String(45, " "), 1, 45) & "                " & Right(String(12, " ") & Format(RsImpresion!nVenta, "#,###,##0.00"), 12)
                       pri = False
                    Else
                       sLinea = "              " & Mid(txt, 1, pos - 1)
                    End If
                    txt = Mid(txt, pos + 1, tOt)
                    tOt = Len(txt)
                    Printer.Print sLinea
                 Loop
                    
                 For i = j To nFItem - 1
                     Printer.Print " "
                 Next i
                 
                 RsImpresion.MoveLast
                 If RsImpresion!nRecargo > 0 Then
                    Printer.Print Right(String(77, " ") & "Recargo : ", 77) & Right(String(17, " ") & Format(RsImpresion!nRecargo, "##,###,###,##0.00"), 17)
                 Else
                    Printer.Print
                 End If
                     
                 If RsImpresion!nDescuento > 0 Then
                    Printer.Print Right(String(77, " ") & "Descuento : ", 77) & Right(String(17, " ") & Format(RsImpresion!nDescuento, "##,###,###,##0.00"), 17)
                 Else
                    Printer.Print
                 End If
                 'Humberto 15/10/2008, se agrego la condición para saber si se debe o no imprimir el impuesto
                 If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
                    Printer.Print Right(String(77, " ") & "Valor Venta :", 77) & Right(String(17, " ") & Format(RsImpresion!nNeto, "##,##,###,##0.00"), 17)
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                    If RsImpresion!nprecioImpuesto1 > 0 Then
                        Printer.Print Right(String(77, " ") & sImpuesto1 & " " & Format(nPorcentaje1, "##0.00") & "% :", 77) & Right(String(17, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,###,##0.00"), 17)
                    End If
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                    If RsImpresion!nprecioImpuesto2 > 0 Then
                        Printer.Print Right(String(77, " ") & sImpuesto2 & " " & Format(nPorcentaje2, "##0.00") & "% :", 77) & Right(String(17, " ") & Format(RsImpresion!nprecioImpuesto2, "##,##,###,##0.00"), 17)
                    End If
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                    If RsImpresion!nprecioImpuesto3 > 0 Then
                        Printer.Print Right(String(77, " ") & sImpuesto3 & " " & Format(nPorcentaje3, "##0.00") & "% :", 77) & Right(String(17, " ") & Format(RsImpresion!nprecioImpuesto3, "##,##,###,##0.00"), 17)
                    End If
                 End If
                 'Humberto 15/10/2008, fin
                 Printer.Print Right(String(77, " ") & "Total " & sMonN & " : ", 77) & Right(String(17, " ") & Format(RsImpresion!nVenta, "##,##,###,##0.00"), 17)
                '====================== nov 2010
                   If lDocumEquivaPrecuenta Then
                        Printer.Print " "
                       Printer.Print Right(String(77, " ") & "Total " & sMonE & " :", 77) & Right(String(17, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 17)
                   End If
                   '====================== nov 2010
                 Printer.Print UCase("SON: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN)
             
             'FIN CGMIRANDA--------------------------------
                                            
             'CESAR NINAHUANCA
              Case Is = "013" 'COSTANERA 700
                               
                 For i = 1 To nCabecera
                     Printer.Print
                 Next i
                 
                    Printer.Print String(12, " ") & Left(Mid(RsImpresion!Cliente, 1, 60) & String(60, " "), 66)
                    Printer.Print String(12, " ") & Left(Mid(RsImpresion!direccion, 1, 60) & String(60, " "), 66)
                    Printer.Print String(12, " ") & Left(Mid(RsImpresion!Ruc, 1, 60) & String(60, " "), 66)
                    Printer.Print String(12, " ") & Left(Mid(RsImpresion!Mesa, 1, 28) & String(10, " "), 34) & "Mz: " & Left(Mid(RsImpresion!Mozo, 1, 20), 30) & "               " & Format(RsImpresion!fRegistro, "  dd" & "  " & " MM" & " " & "  yyyy ") & String(3, " ")
                    Printer.Print " "
                 For i = 1 To nDetalle
                     Printer.Print
                 Next i
                        
                 'Cuerpo
                 'Printer.Print
                 txt = sConsumo
                 tOt = Len(Trim(txt))
                 pri = True
                 j = 0
                 Do While tOt <> 0
                    j = j + 1
                    lin = Mid(txt & " ", 1, 50)
                    For i = 50 To 1 Step -1
                        If Mid(lin, i, 1) = " " Then
                           pos = i
                           Exit For
                        End If
                    Next i
                    If pri Then
                       sLinea = "                " & Mid(Mid(txt, 1, pos - 1) & String(50, " "), 1, 50) & "                " & Right(String(14, " ") & Format(RsImpresion!nVenta, "#,###,##0.00"), 14)
                       pri = False
                    Else
                       sLinea = "              " & Mid(txt, 1, pos - 1)
                    End If
                    txt = Mid(txt, pos + 1, tOt)
                    tOt = Len(txt)
                    Printer.Print sLinea
                 Loop
                    
                 Printer.Print " "
                 For i = j To nFItem - 1
                     Printer.Print " "
                 Next i
                 
                 Printer.Print
                 RsImpresion.MoveLast
                 
                 Printer.Print "        Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
                 Printer.Print " "
                 'Printer.Print " "
                 'Printer.Print " "
                 'Printer.Print " "
                 Printer.Print String(69, " ") & "SUB TOTAL" & sImportes
                 'Printer.Print String(69, " ") & "I.G.V." & Format(nPorcentaje1, " ##0") & "% " & sImportes1
                 'Printer.Print String(63, " ") & sImpuesto2 & Format(nPorcentaje2, " ##0") & "% " & sImportes2
                 Printer.Print String(72, " ") & "I.G.V." & " " & sImportes1
                 Printer.Print String(76, " ") & sImpuesto2 & " " & sImportes2
                 Printer.Print " "
                 Printer.Print String(6, " ") & Format(RsImpresion!fRegistro, " dd" & "    " & " MMMM" & "        " & " yyyy ") & String(47, " ") & Right(String(13, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 13)

                                  
'                 Printer.Print "        Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
'                 Printer.Print " "
'                 Printer.Print " "
'                 Printer.Print " "
'                 Printer.Print " "
'                 Printer.Print String(4, " ") & Format(RsImpresion!fRegistro, " dd" & "    " & " MMMM" & "        " & " yyyy ") & String(46, " ") & Right(String(13, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 13)

                                                   
              Case Is = "014" 'QUEIROLO
              
                 'Impresion de Observacion
                 Dim ObsPedido As String
                 Dim tTipoDocumento As String
                 
                 tTipoDocumento = Calcular("select ISNULL(t.lImpObs, '0') As Codigo from TTIPODOCUMENTO t INNER JOIN MDOCUMENTO m ON t.tCodigoTipoDocumento = m.tTipoDocumento where m.tDocumento ='" & RsImpresion!tDocumento & "'", Cn)

                 If tTipoDocumento = "Verdadero" Then
                     ObsPedido = Calcular("select ISNULL(MAX(m.tobservacion),'') As Codigo from mpedido m INNER JOIN ddocumento d ON m.tcodigopedido = d.tCodigoPedido where d.tdocumento ='" & RsImpresion!tDocumento & "'", Cn)
                 Else
                     ObsPedido = " "
                 End If
                 '--------------------------------------------------
                 
                 For i = 1 To nCabecera
                     Printer.Print
                 Next i
                 
                    Printer.Print "             LIMA - PERU"
                    Printer.Print ""
                    Printer.Print ""
                    Printer.Print String(5, " ") & Format(RsImpresion!fRegistro, "dd /" & " " & "MM /" & " " & "yyyy") & "              " & "Mesa: " & Left(Mid(RsImpresion!Mesa, 1, 30) & String(30, " "), 36)
                    Printer.Print String(5, " ") & Left(Mid(RsImpresion!Cliente, 1, 46) & String(46, " "), 50)
                    Printer.Print String(5, " ") & Left(Mid(ObsPedido, 1, 46) & String(46, " "), 50) 'Obrservacion
                    Printer.Print ""
                    Printer.Print ""
                    
                 For i = 1 To nDetalle
                     Printer.Print
                 Next i
                        
                 'Cuerpo
                 'Printer.Print
                 txt = sConsumo
                 tOt = Len(Trim(txt))
                 pri = True
                 j = 0
                 Do While tOt <> 0
                    j = j + 1
                    lin = Mid(txt & " ", 1, 50)
                    For i = 50 To 1 Step -1
                        If Mid(lin, i, 1) = " " Then
                           pos = i
                           Exit For
                        End If
                    Next i
                    If pri Then
                       sLinea = "                  " & Mid(Mid(txt, 1, pos - 1) & String(50, " "), 1, 50) & " " & Right(String(14, " ") & Format(RsImpresion!nVenta, "#,###,##0.00"), 14)
                       pri = False
                    Else
                       sLinea = "              " & Mid(txt, 1, pos - 1)
                    End If
                    txt = Mid(txt, pos + 1, tOt)
                    tOt = Len(txt)
                    Printer.Print sLinea
                 Loop
                    
                 Printer.Print " "
                 For i = j To nFItem - 1
                     Printer.Print " "
                 Next i
                 
                 Printer.Print
                 RsImpresion.MoveLast
                                  
                 Printer.Print " "
                 Printer.Print " "
                 Printer.Print " "
                 Printer.Print "        Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
                 Printer.Print String(57, " ") & "TOTAL: " & sMonN & " " & Right(String(15, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 15)
                '-------------------------------------------
                                            
            '----CESAR NINAHUANCA
            Case Is = "015"       ' PIKALO
                 For i = 1 To nCabecera
                     Printer.Print
                 Next i
                 
                 Printer.Print "   Documento        : " & RsImpresion!tDocumento
                 Printer.Print "   Fecha de Emisión : " & Format(RsImpresion!fRegistro, "dd MMMM yyyy")
                 Printer.Print "   Cliente          : " & RsImpresion!Cliente
                 Printer.Print "   Dirección        : " & RsImpresion!direccion
                 Printer.Print "   Pedido           : " & sPedido
                 Printer.Print Mid("   Caja             : " & RsImpresion!tCaja & " - " & RsImpresion!tUsuario & String(53, " "), 1, 53) & "Transportista    : " & RsImpresion!Mozo
                 Printer.Print "   Destino             : " & IIf((RsImpresion!tMesa = "000" Or Len(Trim(RsImpresion!tMesa)) = 0 Or IsNull(RsImpresion!tMesa)), RsImpresion!tObservacion, RsImpresion!Mesa)
                 For i = 1 To nDetalle
                     Printer.Print
                 Next i
                 
                 'Cuerpo
                 Printer.Print
                 txt = sConsumo
                 tOt = Len(Trim(txt))
                 pri = True
                 j = 0
                 Do While tOt <> 0
                    j = j + 1
                    lin = Mid(txt & " ", 1, 45)
                    For i = 45 To 1 Step -1
                        If Mid(lin, i, 1) = " " Then
                           pos = i
                           Exit For
                        End If
                    Next i
                    If pri Then
                       sLinea = "              " & Mid(Mid(txt, 1, pos - 1) & String(45, " "), 1, 45) & "                " & Right(String(12, " ") & Format(RsImpresion!nVenta, "#,###,##0.00"), 12)
                       pri = False
                    Else
                       sLinea = "              " & Mid(txt, 1, pos - 1)
                    End If
                    txt = Mid(txt, pos + 1, tOt)
                    tOt = Len(txt)
                    Printer.Print sLinea
                 Loop
                    
                 For i = j To nFItem - 1
                     Printer.Print " "
                 Next i
                 
                 RsImpresion.MoveLast
                 If RsImpresion!nRecargo > 0 Then
                    Printer.Print Right(String(77, " ") & "Recargo : ", 77) & Right(String(17, " ") & Format(RsImpresion!nRecargo, "##,###,###,##0.00"), 17)
                 Else
                    Printer.Print
                 End If
                     
                 If RsImpresion!nDescuento > 0 Then
                    Printer.Print Right(String(77, " ") & "Descuento : ", 77) & Right(String(17, " ") & Format(RsImpresion!nDescuento, "##,###,###,##0.00"), 17)
                 Else
                    Printer.Print
                 End If

                 If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
                    Printer.Print Right(String(77, " ") & "Valor Venta :", 77) & Right(String(17, " ") & Format(RsImpresion!nNeto, "##,##,###,##0.00"), 17)
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                    If RsImpresion!nprecioImpuesto1 > 0 Then
                        Printer.Print Right(String(77, " ") & sImpuesto1 & " " & Format(nPorcentaje1, "##0.00") & "% :", 77) & Right(String(17, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,###,##0.00"), 17)
                    End If
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                    If RsImpresion!nprecioImpuesto2 > 0 Then
                        Printer.Print Right(String(77, " ") & sImpuesto2 & " " & Format(nPorcentaje2, "##0.00") & "% :", 77) & Right(String(17, " ") & Format(RsImpresion!nprecioImpuesto2, "##,##,###,##0.00"), 17)
                    End If
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                    If RsImpresion!nprecioImpuesto3 > 0 Then
                        Printer.Print Right(String(77, " ") & sImpuesto3 & " " & Format(nPorcentaje3, "##0.00") & "% :", 77) & Right(String(17, " ") & Format(RsImpresion!nprecioImpuesto3, "##,##,###,##0.00"), 17)
                    End If
                 End If
                 Printer.Print Right(String(77, " ") & "Total " & sMonN & " : ", 77) & Right(String(17, " ") & Format(RsImpresion!nVenta, "##,##,###,##0.00"), 17)
                   If lDocumEquivaPrecuenta Then
                        Printer.Print " "
                       Printer.Print Right(String(77, " ") & "Total " & sMonE & " :", 77) & Right(String(17, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 17)
                   End If
                 Printer.Print UCase("SON: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN)
                                            
                                            
                                            
         Case Is = "017" ' EL HORNERO
                 For i = 1 To 7
                     Printer.Print
                 Next i
              

                 Printer.Print String(45, " ") & RsImpresion!tDocumento
                  For i = 1 To 2
                     Printer.Print
                 Next i
                Printer.Print String(8, " ") & Left(Mid(RsImpresion!Cliente, 1, 30) & String(30, " "), 33) & String(7, " ") & Format(RsImpresion!fRegistro, "dd MMMM yyyy")
                Printer.Print String(8, " ") & Left(Mid(RsImpresion!direccion, 1, 30) & String(30, " "), 33) & String(10, " ") & IIf(IsNull(RsImpresion!Ruc), "", RsImpresion!Ruc)
                 For i = 1 To 2
                     Printer.Print
                 Next i
                 
                 
                 'Cuerpo
                 Printer.Print
                 txt = sConsumo
                 tOt = Len(Trim(txt))
                 pri = True
                 j = 0
                 Do While tOt <> 0
                    j = j + 1
                    lin = Mid(txt & " ", 1, 30)
                    For i = 45 To 1 Step -1
                        If Mid(lin, i, 1) = " " Then
                           pos = i
                           Exit For
                        End If
                    Next i
                    If pri Then
                       sLinea = "              " & Mid(Mid(txt, 1, pos - 1) & String(30, " "), 1, 30) & "     " & Right(String(12, " ") & Format(RsImpresion!nVenta, "#,###,##0.00"), 12)
                       pri = False
                    Else
                       sLinea = "              " & Mid(txt, 1, pos - 1)
                    End If
                    txt = Mid(txt, pos + 1, tOt)
                    tOt = Len(txt)
                    Printer.Print sLinea
                 Loop
                 k = 0
                 For k = 1 To 19
                     Printer.Print " "
                 Next k
                 
                 RsImpresion.MoveLast
                 Printer.Print String(2, " ") & UCase("SON: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN)

                 Printer.Print Right(String(49, " "), 77) & Right(String(18, " ") & Format(RsImpresion!nVenta, "##,##,###,##0.00"), 12)
                 Printer.Print " "
                 Printer.Print String(23, " ") & "HORA: " & Format(RsImpresion!fRegistro, "HH:MM:SS")
                                            
            'Luis Chumpitaz
            Case Is = "020" ' Jose Antonio
                 For i = 1 To nCabecera
                     Printer.Print
                 Next i
'                 Printer.Print "        " & Left(Mid(RsImpresion!Cliente, 1, 60) & String(60, " "), 60)
                 If IsNull(RsImpresion!Ruc) = False Or Len(RsImpresion!Ruc) > 0 Then
                    Printer.Print "       " & Left("DNI " & Right(IIf(IsNull(RsImpresion!Ruc), "", RsImpresion!Ruc), 8) & String(55, " "), 55)
                 Else
                    Printer.Print "       " & Left("" & Right(IIf(IsNull(RsImpresion!Ruc), "", RsImpresion!Ruc), 8) & String(55, " "), 55)
                 End If
                 'Printer.Print "    " & Left(Mid(RsImpresion!cliente, 1, 55) & String(55, " "), 55)
                 If IsNull(RsImpresion!Cliente) = True Or Len(RsImpresion!Cliente) = 0 Then
                    Printer.Print "       " & Left(Mid(IIf(IsNull(RsImpresion!tObservacion), "", RsImpresion!tObservacion), 1, 65) & String(65, " "), 65)
                 Else
                    Printer.Print "       " & Left(Mid(RsImpresion!Cliente, 1, 55) & String(55, " "), 55)
                 End If
                
                 Printer.Print ""
                 Printer.Print Left(RsImpresion!tUsuario & String(10, " "), 10) & String(2, " ") & Mid(WeekdayName(Weekday(Format(RsImpresion!fRegistro, "dd/MM/yyyy"))), 1, 3) & String(1, " ") & Format(RsImpresion!fRegistro, "dd/MM/yyyy") & String(1, " ") & Right(sTurno, 5) & String(1, " ") & Left(RsImpresion!Mozo & String(6, " "), 6) & String(1, " ") & Left(RsImpresion!Mesa & String(10, " "), 10) & String(7, " "); RsImpresion!tDocumento
                 'Printer.Print "            " & Mid(RsImpresion!tDocumento & String(45, " "), 1, 45) & "    Caja   : " & RsImpresion!tCaja & " - " & RsImpresion!tUsuario
                                                 
                 For i = 1 To nDetalle
                     Printer.Print
                 Next i
                 
                 'Cuerpo
                 'Printer.Print
                 txt = sConsumo
                 tOt = Len(Trim(txt))
                 pri = True
                 j = 0
                 Do While tOt <> 0
                    j = j + 1
                    lin = Mid(txt & " ", 1, 50)
                    For i = 50 To 1 Step -1
                        If Mid(lin, i, 1) = " " Then
                           pos = i
                           Exit For
                        End If
                    Next i
                    If pri Then
                       sLinea = "                " & Mid(Mid(txt, 1, pos - 1) & String(50, " "), 1, 50) & "         " & Right(String(14, " ") & Format(RsImpresion!nVenta, "#,###,##0.00"), 14)
                       pri = False
                    Else
                       sLinea = "              " & Mid(txt, 1, pos - 1)
                    End If
                    txt = Mid(txt, pos + 1, tOt)
                    tOt = Len(txt)
                    Printer.Print sLinea
                 Loop
                 
                 Printer.Print " "
                 For i = j To nFItem - 1
                     Printer.Print " "
                 Next i
                 
                 Printer.Print
                 RsImpresion.MoveLast
                 Printer.Print "              Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
                 
                 Printer.Print ""
                 Printer.Print ""

                 If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
                    sImportes = Right(String(10, " ") & Format(RsImpresion!nNeto, "##,###,##0.00"), 10) & _
                                Right(String(10, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,##0.00"), 10) & _
                                Right(String(10, " ") & Format(RsImpresion!nprecioImpuesto2, "##,###,##0.00"), 10) & _
                                Right(String(15, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 15)
                    'Printer.Print String(39, " ") & sImportes
                    Printer.FontBold = True
                    Printer.Print String(20, " ") & Format(RsImpresion!fRegistro, " dd     MM       yyyy ") & sImportes
                    Printer.FontBold = False
                 End If
                   
           End Select
    Printer.EndDoc
End Sub


Public Sub ImprimeBoletaConsumoT(ByVal RsImpresion As Recordset, sConsumo As String, Optional tTipoDoc As String, Optional Cabecera As Image, Optional pie As Image, Optional ByVal ImpDolarDelivery As Boolean)
    On Error Resume Next
    Dim Item As String
    Dim sLinea As String
    
    Dim txt As String
    Dim lin As String
    Dim i As Integer
    Dim tOt As Integer
    Dim pos As Integer
    Dim pri As Boolean
    Dim nSumaNeto As Double
    Dim lcuentaCobrar As Boolean
    
    Dim xTotalS As Double
    
    lImprimeImagCabDocumento = Calcular("select lImprimeImageCab as codigo from ttipodocumentoimpresora where ttipoemision='" & tTipoDoc & "' and  tcaja='" & sCaja & "'", Cn)
    lImprimeImagPieDocumento = Calcular("select lImprimeImagePie as codigo from ttipodocumentoimpresora where ttipoemision='" & tTipoDoc & "' and  tcaja='" & sCaja & "'", Cn)
'    ximprimeDetallado = Calcular("select lImprimeresumen as codigo from ttipodocumentoimpresora where ttipoemision='" & tTipoDoc & "' and  tcaja='" & sCaja & "'", Cn)
'
'    Dim cant, Valor As Integer ' no tiene xproducto revisar
'    Dim ProductoTem As String
    
    Select Case pais
        Case "001" 'Bolivia
                    'OBTIENE DATOS A IMPRIMIR
                    Dim tAutorizacion As String '  del documento
                    Dim tcodigoControl As String ' del documento
                    Dim RsDatos As Recordset
                    Dim fLimite As Date ' de la caja
                    Dim tSfc As String ' de la caja
                    
                    'CGMiranda******************************
                    Dim tSucursal As String
                    'fin CGMiranda************************
                    
                    Dim cadenaxx As String
                    tSfc = ""
                    fLimite = Now
                    
                    tAutorizacion = Calcular("select tautorizacion as codigo from mdocumento where tdocumento ='" & RsImpresion!tDocumento & "'", Cn)
                    tcodigoControl = Calcular("select tcodigoControl as codigo from mdocumento where tdocumento ='" & RsImpresion!tDocumento & "'", Cn)
                    cadenaxx = "SELECT tsfc,ffin FROM TORIGENCODIGOCONTROL WHERE TCAJA='" & RsImpresion!tCaja & "' AND TAUTORIZACION='" & Trim(tAutorizacion) & "' AND ((FINICIO <= '" & Format(RsImpresion!fRegistro, "YYYYmmdd HH:mm") & "') AND (ffin>='" & Format(RsImpresion!fRegistro, "YYYYmmdd HH:mm") & "'))"
                    Set RsDatos = Lib.OpenRecordset(cadenaxx, Cn)
                    If Not (RsDatos.EOF Or RsDatos.BOF) Then
                           ' rsDatos.MoveFirst
                            tSfc = RsDatos!tSfc
                            fLimite = Format(RsDatos!fFin, "dd/MM/yyyy")
                    End If
    
                            'Cabecera
                            
                        
                            If lImprimeImagCabDocumento Then
                                    If Cabecera <> 0 Then
                                    Printer.PaintPicture Cabecera, 500, Printer.CurrentY, 2860, 1600
                                    For p = 1 To 10
                                    Printer.Print
                                    Next p
                                    End If
                            End If
                            RsImpresion.MoveFirst
                            ImprimeXCentro sRazonSocial, 40
                            ImprimeXCentro sRazonComercial, 40
                            'CGMiranda******************************************************
                            tSucursal = Calcular("select vs.tResumido as codigo from vsucursal vs inner join TCAJA tc on vs.Codigo = tc.tSucursal where tc.tCaja='" & sCaja & "'", Cn)
                            ImprimeXCentro "Sucursal Nº " & IIf(tSucursal = 0, "", tSucursal), 40
                            ImprimeXCentro sDireccion, 40
                            ImprimeXCentro "Telefono: " & sTelefono, 40
                            ImprimeXCentro "SFC: " & tSfc & "   La Paz Bolivia", 40
                            If estadoReimpresion = True Then
                                ImprimeXCentro "COMPROBANTE - COPIA", 40
                                estadoReimpresion = False
                            Else
                                ImprimeXCentro "COMPROBANTE", 40
                            End If
                            'Fin CGMiranda**********************************************************
                            
                            Printer.Print String(40, "-")
                            sLinea = String((40 - Len(Trim("NIT: " + sRUC))) / 2, " ") & "NIT: " + sRUC
                            Printer.Print sLinea
                            Printer.Print "Comprobante  Nº " & Mid(RsImpresion!tDocumento, 7)
                            Printer.Print "Autorización Nº " & tAutorizacion
                            Printer.Print String(40, "-")
                             
                             'impresiondiacontable
                            If lImpresionDiaContable Then
                                If lReimpresion = True Then
                                    Printer.Print "Fecha    : " & Format(Calcular("select fdiacontable as codigo from mdocumento where tdocumento ='" & RsImpresion!tDocumento & "'", Cn), "dd/MM/yyyy") & " " & Calcular("exec DiacontableHora '" & fImpresionDiaContable & "'", Cn)
                                    Else
                                    Printer.Print "Fecha    : " & fImpresionDiaContable & " " & Calcular("exec DiacontableHora '" & fImpresionDiaContable & "'", Cn)
                                End If
                                Else
                                 Printer.Print "Fecha    : " & RsImpresion!fRegistro
                            End If
                            
                            
                            'Printer.Print "Fecha    : " & RsImpresion!fRegistro
                            If Not IsNull(RsImpresion!Cliente) Or Len(Trim(RsImpresion!Cliente)) > 0 Then
                                ImprimeXLinea "Señores  : " & RsImpresion!Cliente, 40, 9
                                Printer.Print "NIT/CI   : " & RsImpresion!Ruc
                                Printer.Print "Dirección: " & Mid(RsImpresion!direccion, 1, 30)
                            End If
                            Printer.Print String(40, "-")
                            Printer.Print
                            Printer.Print "Pedido   : " & RsImpresion!tCodigoPedido
                            Printer.Print "Tipo     : " & RsImpresion!tipopedido
                            Printer.Print "Caja     : " & RsImpresion!tCaja & " - " & RsImpresion!tUsuario
                            Printer.Print "Mesero   : " & RsImpresion!Mozo
                            Printer.Print "Nro.Serie: " & Calcular("select isnull(tSerieImpresora,'') codigo from MDOCUMENTO where tDocumento ='" & RsImpresion!tDocumento & "'", Cn)
                            Printer.Print "Descuento: " & Mid(Trim(RsImpresion!DESCUENTO), 1, 30)
                            Printer.Print
                            Printer.Print "MESA     : " & RsImpresion!Mesa
                            If lObservacionCabDoc Then
                                Printer.Print "Observac.: " & RsImpresion!tObservacion
                            End If
                            Printer.Print
                            Printer.Print String(40, "-")
                            Printer.Print "Descripcion                     SubTotal"
                            Printer.Print String(40, "-")
                                
                            'Cuerpo
                            Printer.Print
                            txt = sConsumo
                            tOt = Len(Trim(txt))
                            pri = True
                            Do While tOt <> 0
                               lin = Mid(txt & " ", 1, 28)
                               For i = 28 To 1 Step -1
                                   If Mid(lin, i, 1) = " " Then
                                      pos = i
                                      Exit For
                                   End If
                               Next i
                                If pos = 0 Then
                                    pos = 28
                                End If
                               If pri Then
                                  sLinea = Mid(Mid(txt, 1, pos - 1) & String(27, " "), 1, 27) & " " & Right(String(12, " ") & Format(RsImpresion!nVenta + RsImpresion!nDescuento, "#,###,##0.00"), 12)
                                  pri = False
                               Else
                                  sLinea = Mid(txt, 1, pos - 1)
                               End If
                               txt = Mid(txt, pos + 1, tOt)
                               tOt = Len(txt)
                               Printer.Print sLinea
                            Loop
                                    
                            Printer.Print
                            Printer.Print String(40, "-")
                            RsImpresion.MoveLast
                            
                            If RsImpresion!nRecargo > 0 Then
                               Printer.Print
                               Printer.Print Right(String(27, " ") & "Recargo " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nRecargo, "##,###,##0.00"), 13)
                            End If
                            
                            If RsImpresion!nDescuento > 0 Then
                               Printer.Print
                               Printer.Print Right(String(27, " ") & "Descuento " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nDescuento, "##,###,##0.00"), 13)
                            End If
                               
                            nSumaNeto = RsImpresion!nNeto
                            
                            If IsNull(RsImpresion!lImpuesto1) Or Not RsImpresion!lImpuesto1 Then
                               nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto1
                            End If
                            
                            If IsNull(RsImpresion!lImpuesto2) Or Not RsImpresion!lImpuesto2 Then
                               nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto2
                            End If
                            
                            If IsNull(RsImpresion!lImpuesto3) Or Not RsImpresion!lImpuesto3 Then
                               nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto3
                            End If
                            'CESAR Bolivia
                            If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
                               Printer.Print Right(String(27, " ") & "Valor Venta " & sMonN & " : ", 27) & Right(String(13, " ") & Format(nSumaNeto, "##,###,##0.00"), 13)
                            End If
                            
                            If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                               Printer.Print Right(String(27, " ") & sImpuesto1 & " " & Format(nPorcentaje1, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,##0.00"), 13)
                            End If
                               
                            If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                               Printer.Print Right(String(27, " ") & sImpuesto2 & " " & Format(nPorcentaje2, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto2, "##,###,##0.00"), 13)
                            End If
                            
                            If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                               Printer.Print Right(String(27, " ") & sImpuesto3 & " " & Format(nPorcentaje3, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto3, "##,###,##0.00"), 13)
                            End If
                                                
                            Printer.Print Right(String(27, " ") & "Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 13)
                            '====================== nov 2010
                            If lDocumEquivaPrecuenta Then
                                 Printer.Print " "
                                Printer.Print Right(String(27, " ") & "Total " & sMonE & " :", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 13)
                            End If
                            '====================== nov 2010
                               
                            Printer.Print
                            If Calcular(" SELECT case when  lImpresionRetencion=1 then 1 else 0 end  as codigo FROM vTipodocumento WHERE Codigo=(SELECT TTIPODOCUMENTO FROM MDOCUMENTO WHERE tDocumento='" & RsImpresion!tDocumento & "')", Cn) = 1 Then
                            'ImprimeXCentro tTextoAgenteRetencion, 70
                            ImprimeXLinea tTextoAgenteRetencion, 40, 5
                            End If
                                                               
                               
                            Printer.Print
                            txt = "Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
                            ImprimeXLinea txt, 40, 5
                            Printer.Print
                            
                            Printer.Print String(40, "-")
                            Printer.Print "Código de Control      : " & tcodigoControl
                            Printer.Print "Fecha Límite de Emisión: " & Format(fLimite, "dd/MM/yyyy")
                            Printer.Print String(40, "-")
                            If Calcular("select ISNULL(lImprimeQR,0) as codigo from TTIPODOCUMENTO where tCodigoTipoDocumento='" & tTipoDoc & "'", Cn) = 1 Then
                                If pais = "001" Then
                                
                                Set rsQr = Lib.OpenRecordset("usp_Inforest_ObtieneCodigoQR_Bol " + RsImpresion!tDocumento, Cn)
                            
                                  FastQRCode rsQr.Fields(0), App.Path & "\BaseTempQr.bmp"
                            
                                    Set imgDocumento = CreateObject("Scripting.FileSystemObject")
                                    If imgDocumento.FileExists(App.Path & "\BaseTempQr.bmp") Then
                                        Printer.PaintPicture LoadPicture(App.Path & "\BaseTempQr.bmp"), 1400, Printer.CurrentY, 1323, 1323
                                         For p = 1 To 8
                                            Printer.Print
                                         Next p
                                    End If
                               End If
                            End If
                    
                            ImprimeXLinea textoComprobanteBolivia, 40, 5
                            Printer.Print String(40, "-")
                            ImprimeXCentro sPie, 40
                            
                            Printer.Print '.'
                            If lImprimeImagPieDocumento Then
                                    If pie <> 0 Then
                                        Printer.PaintPicture pie, 500, Printer.CurrentY, 2860, 1600
                                    End If
                            End If
                            Printer.EndDoc

        Case Else  'Peru, Ecuador
                           If lImprimeImagCabDocumento Then
                                    If Cabecera <> 0 Then
                                    Printer.PaintPicture Cabecera, 500, Printer.CurrentY, 2860, 1600
                                    For p = 1 To 10
                                    Printer.Print
                                    Next p
                                    End If
                            End If
                            'Cabecera
                                RsImpresion.MoveFirst


                             'Log
                             If lLogCajaRapida = True Then
                              Cn.Execute "UPDATE TLOG_IMPRESION SET TPOSICION5='PASO 1 ' + '" & RsImpresion!tDocumento & "' WHERE TDOCUMENTO='" & sDocumento & "'"
                            End If
                            

                                ImprimeXCentro sRazonSocial, 40
                                ImprimeXCentro sRazonComercial, 40
                                sLinea = String((40 - Len(Trim("R.U.C.: " + sRUC))) / 2, " ") & "R.U.C.: " + sRUC
                                Printer.Print sLinea
                                ImprimeXCentro sDireccion, 40
                                If Trim(sDireccion2) <> "" Then
                                    ImprimeXCentro sDireccion2, 40
                                End If
                                sLinea = String((40 - Len(Trim("Telefono: " + sTelefono))) / 2, " ") & "Telefono: " + sTelefono

                                
                                Printer.Print sLinea
                                Printer.Print
                                Printer.Print Mid(RsImpresion!tDocumento, 1, 1) & "-" & Mid(RsImpresion!tDocumento, 2, 5) & "-" & Mid(RsImpresion!tDocumento, 7)
                                Printer.Print
                                Printer.Print "Pedido   : " & RsImpresion!tCodigoPedido
                                
                             'impresiondiacontable
                            If lImpresionDiaContable Then
                                If lReimpresion = True Then
                                    Printer.Print "Fecha    : " & Format(Calcular("select fdiacontable as codigo from mdocumento where tdocumento ='" & RsImpresion!tDocumento & "'", Cn), "dd/MM/yyyy") & " " & Calcular("exec DiacontableHora '" & fImpresionDiaContable & "'", Cn)
                                Else
                                    Printer.Print "Fecha    : " & fImpresionDiaContable & " " & Calcular("exec DiacontableHora '" & fImpresionDiaContable & "'", Cn)
                                End If
                                
                             Else
                                 Printer.Print "Fecha    : " & RsImpresion!fRegistro
                            End If
                                                       
                                Printer.Print "Tipo     : " & RsImpresion!tipopedido
                                Printer.Print "Caja     : " & RsImpresion!tCaja & " - " & RsImpresion!tUsuario
                                If RsImpresion!Mozo <> "" Then
                                Printer.Print "Mesero   : " & RsImpresion!Mozo
                                End If
                                Printer.Print "Nro.Serie: " & Calcular("select isnull(tSerieImpresora,'') codigo from MDOCUMENTO where tDocumento ='" & RsImpresion!tDocumento & "'", Cn)
                                If Mid(Trim(RsImpresion!DESCUENTO), 1, 30) <> "" Then
                                Printer.Print "Descuento: " & Mid(Trim(RsImpresion!DESCUENTO), 1, 30)
                                Printer.Print
                                End If
                                If RsImpresion!Mesa <> "" Then
                                Printer.Print "MESA     : " & RsImpresion!Mesa
                                End If
                                If lObservacionCabDoc Then
                                    If RsImpresion!tObservacion <> "" Then
                                        Printer.Print "Observac.: " & RsImpresion!tObservacion
                                        Printer.Print
                                    End If
                                End If
                                Printer.Print String(40, "-")
                                Printer.Print "Descripcion                     SubTotal"
                                Printer.Print String(40, "-")
                                    
                                'Cuerpo
                                Printer.Print
                                txt = sConsumo
                                tOt = Len(Trim(txt))
                                pri = True
                                
                                
                                Do While Not RsImpresion.EOF
                                    If Item <> RsImpresion!tCodigoPedido + RsImpresion!tItem Then
                                        Item = RsImpresion!tCodigoPedido + RsImpresion!tItem
                                        xTotalS = xTotalS + (RsImpresion!nCantidad * RsImpresion!nPrecioOficial)
                                    End If
                                    RsImpresion.MoveNext
                                Loop
                       
                                Do While tOt <> 0
                                   lin = Mid(txt & " ", 1, 28)
                                   For i = 28 To 1 Step -1
                                       If Mid(lin, i, 1) = " " Then
                                          pos = i
                                          Exit For
                                       End If
                                   Next i
                                   If pos = 0 Then
                                    pos = 28
                                   End If
                                   If pri Then
                                    If ImpDolarDelivery Then
                                      sLinea = Mid(Mid(txt, 1, pos - 1) & String(27, " "), 1, 27) & " " & Right(String(12, " ") & Format(xTotalS / nTC, "#,###,##0.00"), 12)
                                    Else
                                        sLinea = Mid(Mid(txt, 1, pos - 1) & String(27, " "), 1, 27) & " " & Right(String(12, " ") & Format(xTotalS, "#,###,##0.00"), 12)
                                    End If
                                      pri = False
                                   Else
                                      sLinea = Mid(txt, 1, pos - 1)
                                   End If
                                   txt = Mid(txt, pos + 1, tOt)
                                   tOt = Len(txt)
                                   xTotalS = xTotalS + (RsImpresion!nCantidad * RsImpresion!nPrecioOficial)
                                   Printer.Print sLinea
                                Loop
                                        
                                Printer.Print
                                Printer.Print String(40, "-")
                                RsImpresion.MoveLast
                                
                                If ImpDolarDelivery Then
                                    Printer.Print Right(String(27, " ") & " Total " & sMonE & " : ", 27) & Right(String(13, " ") & Format(xTotalS / nTC, "##,###,##0.00"), 13)
                                Else
                                    Printer.Print Right(String(27, " ") & " Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xTotalS, "##,###,##0.00"), 13)
                                End If
                                
                                Printer.Print String(40, " ")
                                
                                If ImpDolarDelivery Then
                                    If RsImpresion!nRecargo > 0 Then
                                       Printer.Print
                                       Printer.Print Right(String(27, " ") & "Recargo " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nRecargo / nTC, "##,###,##0.00"), 13)
                                    End If
                                    
                                    If RsImpresion!nDescuento > 0 Then
                                       Printer.Print
                                       Printer.Print Right(String(27, " ") & "Descuento " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nDescuento / nTC, "##,###,##0.00"), 13)
                                    End If
                                Else
                                    If RsImpresion!nRecargo > 0 Then
                                       Printer.Print
                                       Printer.Print Right(String(27, " ") & "Recargo " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nRecargo, "##,###,##0.00"), 13)
                                    End If
                                    
                                    If RsImpresion!nDescuento > 0 Then
                                       Printer.Print
                                       Printer.Print Right(String(27, " ") & "Descuento " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nDescuento, "##,###,##0.00"), 13)
                                    End If

                                End If
                                nSumaNeto = RsImpresion!nNeto
                                
                                If IsNull(RsImpresion!lImpuesto1) Or Not RsImpresion!lImpuesto1 Then
                                   nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto1
                                End If
                                
                                If IsNull(RsImpresion!lImpuesto2) Or Not RsImpresion!lImpuesto2 Then
                                   nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto2
                                End If
                                
                                If IsNull(RsImpresion!lImpuesto3) Or Not RsImpresion!lImpuesto3 Then
                                   nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto3
                                End If
                                'CESAR Por Consumo SI - TICKET
                                If ImpDolarDelivery Then
                                    If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
                                       Printer.Print Right(String(27, " ") & "Sub Total " & sMonE & " : ", 27) & Right(String(13, " ") & Format(nSumaNeto / nTC, "##,###,##0.00"), 13)
                                    End If
                                    
                                    If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                                       Printer.Print Right(String(27, " ") & sImpuesto1 & " " & Format(nPorcentaje1, "##0.00") & "% " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto1 / nTC, "##,###,##0.00"), 13)
                                    End If
                                       
                                    If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                                       Printer.Print Right(String(27, " ") & sImpuesto2 & " " & Format(nPorcentaje2, "##0.00") & "% " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto2 / nTC, "##,###,##0.00"), 13)
                                    End If
                                    
                                    If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                                       Printer.Print Right(String(27, " ") & sImpuesto3 & " " & Format(nPorcentaje3, "##0.00") & "% " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto3 / nTC, "##,###,##0.00"), 13)
                                    End If
                                                        
                                    Printer.Print Right(String(27, " ") & "Total " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 13)
                                    
                                Else
                                    If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
                                       Printer.Print Right(String(27, " ") & "Sub Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(nSumaNeto, "##,###,##0.00"), 13)
                                    End If
                                    
                                    If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                                       Printer.Print Right(String(27, " ") & sImpuesto1 & " " & Format(nPorcentaje1, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,##0.00"), 13)
                                    End If
                                       
                                    If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                                       Printer.Print Right(String(27, " ") & sImpuesto2 & " " & Format(nPorcentaje2, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto2, "##,###,##0.00"), 13)
                                    End If
                                    
                                    If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                                       Printer.Print Right(String(27, " ") & sImpuesto3 & " " & Format(nPorcentaje3, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto3, "##,###,##0.00"), 13)
                                    End If
                                                        
                                    Printer.Print Right(String(27, " ") & "Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 13)

                                End If
                                '====================== nov 2010
                                If lDocumEquivaPrecuenta And ImpDolarDelivery = False Then
                                     Printer.Print " "
                                    Printer.Print Right(String(27, " ") & "Total " & sMonE & " :", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 13)
                                End If
                                '====================== nov 2010
                                Printer.Print
                                If Calcular(" SELECT case when  lImpresionRetencion=1 then 1 else 0 end  as codigo FROM vTipodocumento WHERE Codigo=(SELECT TTIPODOCUMENTO FROM MDOCUMENTO WHERE tDocumento='" & RsImpresion!tDocumento & "')", Cn) = 1 Then
                                'ImprimeXCentro tTextoAgenteRetencion, 70
                                ImprimeXLinea tTextoAgenteRetencion, 40, 5
                                End If
                            
                                Printer.Print
                                If ImpDolarDelivery Then
                                    txt = "Son: " & NumeroCadena(str(RsImpresion!nVenta / nTC)) & " " & sMonedaE
                                Else
                                    txt = "Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
                                End If
                                ImprimeXLinea txt, 40, 5
                                Printer.Print
                                
                                If Not IsNull(RsImpresion!Cliente) Or Len(Trim(RsImpresion!Cliente)) > 0 Then
                                   Printer.Print "Cliente: " & Mid(RsImpresion!Cliente, 1, 30)
                                   
                                End If
                                xTipoIdentidad = ""
                                xTipoIdentidad = Calcular("select upper(tResumido) as Codigo from vTipoIdentidad inner join TCLIENTE on vTipoIdentidad.Codigo=tcliente.tTipoIdentidad where tcliente.tCodigoCliente= (select isnull(tCodigoCliente,'') as codigo From MDOCUMENTO where tDocumento='" & RsImpresion!tDocumento & "')", Cn)
                                If xTipoIdentidad = "0" Then
                                xTipoIdentidad = "Iden."
                                End If
                                If IsNull(RsImpresion!Ruc) Or RsImpresion!Ruc = "" Then
                                Else
                                Printer.Print xTipoIdentidad & "    : " & RsImpresion!Ruc
                                Printer.Print
                                End If
                                Printer.Print String(40, "-")
                                ImprimeXCentro sPie, 40
                                
                                            
                                If lPagoAntesImpresion Then
                                    Dim RsPagoDocumento As ADODB.Recordset
                                    
                                    lcuentaCobrar = True
                                    'Set RsPagoDocumento = Lib.OpenRecordset("select Distinct v.Descripcion + ' ' + M.tResumido as pago , Sum(D.nMonto) as monto from DPAGODOCUMENTO D inner join vTipoPago v on d.tTipoPago = v.Codigo inner join vMoneda M on M.Codigo = D.tMoneda Where D.tDocumento = '" & RsImpresion!tDocumento & "' group by v.Descripcion,  M.tResumido", Cn)
                                    Set RsPagoDocumento = Lib.OpenRecordset("exec usp_Inforest_Impresion '" & RsImpresion!tDocumento & "', 9 ", Cn)
                                    Printer.Print " "

                                    If pais = "000" Then 'PERU
                                        Printer.Print String(40, "-")
                                        Printer.Print "Forma de Pago:"
                                        If RsPagoDocumento.RecordCount > 0 Then
                                            For i = 0 To RsPagoDocumento.RecordCount - 1
                                                lcuentaCobrar = False
                                                    Printer.Print RsPagoDocumento!pago & " " & Format(RsPagoDocumento!Monto, "##,###,##0.00")
                                                RsPagoDocumento.MoveNext
                                            Next i
                                            
                                            Printer.Print "Vuelto       :" & sMonN & Format(RsImpresion!Vuelto, "##,###,##0.00")
                                        End If
                                        If lcuentaCobrar Then
                                            Printer.Print "Forma de Pago:Enviado a Cuenta por Cobrar"
                                        End If
                                        Printer.Print String(40, "-")
                                        
                                    Else 'ECUADOR
                                        For i = 0 To RsPagoDocumento.RecordCount - 1
                                            lcuentaCobrar = False
                                            Printer.Print "Forma de Pago:" & RsPagoDocumento!pago & Format(RsPagoDocumento!Monto, "##,###,##0.00")
                                            RsPagoDocumento.MoveNext
                                        Next i
                                        If lcuentaCobrar Then
                                            Printer.Print "Forma de Pago:Enviado a Cuenta por Cobrar"
                                        End If
                                    End If

                                    Printer.Print " "
                                End If
                                
                                
'                                'On Error Resume Next
'                                Set imgDocumento = CreateObject("Scripting.FileSystemObject")
'                                If imgDocumento.FileExists(App.Path & "\bmps\ImgDocumento.jpg") Then
'                                    Printer.Print
'                                    Printer.PaintPicture LoadPicture(App.Path & "\bmps\ImgDocumento.jpg"), 400, Printer.CurrentY, 2800, 1000
'
'                                End If
                                 
                                 
                                'LOG
                                If lLogCajaRapida = True Then
                                    Cn.Execute "UPDATE TLOG_IMPRESION SET TPOSICION6='PASO 2 ' + '" & RsImpresion!tDocumento & "' WHERE TDOCUMENTO='" & sDocumento & "'"
                                End If
                              '  Printer.Print
                                If lImprimeImagPieDocumento Then
                                        If pie <> 0 Then
                                        Printer.PaintPicture pie, 500, Printer.CurrentY, 2860, 1600
                                        End If
                                End If
                                Printer.EndDoc
    End Select
End Sub



Public Sub ImprimeBoletaConsumoElectronico(ByVal RsImpresion As Recordset, sConsumo As String, Optional CodigoHash As Image, Optional tTipoDoc As String, Optional Cabecera As Image, Optional pie As Image, Optional ByVal cadenaCodigoHash As String, Optional ByVal ImpDolarDelivery As Boolean)
    On Error Resume Next
    Dim Item As String
    Dim sLinea As String
    
    Dim xImpresionFE As String
    
    Dim txt As String
    Dim lin As String
    Dim i As Integer
    Dim tOt As Integer
    Dim pos As Integer
    Dim pri As Boolean
    Dim nSumaNeto As Double
    
    Dim nDescuentoNeto As Double
    
    'imprime tipo de cambio
    IsqlTC = "select lVerTCImp from TPARAMETRO"
    Set RsParametroTC = Lib.OpenRecordset(IsqlTC, Cn)
    '------------------------------------------
    
    
    lImprimeImagCabDocumento = Calcular("select lImprimeImageCab as codigo from ttipodocumentoimpresora where ttipoemision='" & tTipoDoc & "' and  tcaja='" & sCaja & "'", Cn)
    lImprimeImagPieDocumento = Calcular("select lImprimeImagePie as codigo from ttipodocumentoimpresora where ttipoemision='" & tTipoDoc & "' and  tcaja='" & sCaja & "'", Cn)
'    ximprimeDetallado = Calcular("select lImprimeresumen as codigo from ttipodocumentoimpresora where ttipoemision='" & tTipoDoc & "' and  tcaja='" & sCaja & "'", Cn)
    ' no tiene xproducto revisar para enviar descripcion detallado.
    Dim xUnidadNegocio As String
    xUnidadNegocio = Calcular("SELECT tDetallado As Codigo FROM TTABLA WHERE TTABLA = 'UNIDADNEGOCIO' AND TCODIGO = (SELECT tUnidadNegocio FROM TCAJA WHERE TCAJA='" & RsImpresion!tCaja & "')", Cn)
      

    Select Case pais
        Case "001" 'BOLIVIA
                    'OBTIENE DATOS A IMPRIMIR
                    Dim tAutorizacion As String '  del documento
                    Dim tcodigoControl As String ' del documento
                    Dim RsDatos As Recordset
                    Dim fLimite As Date ' de la caja
                    Dim tSfc As String ' de la caja
                    
                    Dim tSucursal As String
                    
                    Dim cadenaxx As String
                    tSfc = ""
                    fLimite = Now
                    
                    tAutorizacion = Calcular("select tautorizacion as codigo from mdocumento where tdocumento ='" & RsImpresion!tDocumento & "'", Cn)
                    tcodigoControl = Calcular("select tcodigoControl as codigo from mdocumento where tdocumento ='" & RsImpresion!tDocumento & "'", Cn)
                    cadenaxx = "SELECT tsfc,ffin FROM TORIGENCODIGOCONTROL WHERE TCAJA='" & RsImpresion!tCaja & "' AND TAUTORIZACION='" & Trim(tAutorizacion) & "' AND ((FINICIO <= '" & Format(RsImpresion!fRegistro, "YYYYmmdd HH:mm") & "') AND (ffin>='" & Format(RsImpresion!fRegistro, "YYYYmmdd HH:mm") & "'))"
                    Set RsDatos = Lib.OpenRecordset(cadenaxx, Cn)
                    If Not (RsDatos.EOF Or RsDatos.BOF) Then
                           ' rsDatos.MoveFirst
                            tSfc = RsDatos!tSfc
                            fLimite = Format(RsDatos!fFin, "dd/MM/yyyy")
                    End If
    
                            If lImprimeImagCabDocumento Then
                                    If Cabecera <> 0 Then
                                    Printer.PaintPicture Cabecera, 500, Printer.CurrentY, 2860, 1600
                                    For p = 1 To 10
                                    Printer.Print
                                    Next p
                                    End If
                            End If
                            RsImpresion.MoveFirst
                            ImprimeXCentro sRazonSocial, 40
                            ImprimeXCentro sRazonComercial, 40
                            'CGMiranda******************************************************
                            tSucursal = Calcular("select vs.tResumido as codigo from vsucursal vs inner join TCAJA tc on vs.Codigo = tc.tSucursal where tc.tCaja='" & sCaja & "'", Cn)
                            ImprimeXCentro "Sucursal Nº " & IIf(tSucursal = 0, "", tSucursal), 40
                            ImprimeXCentro sDireccion, 40
                            ImprimeXCentro "Telefono: " & sTelefono, 40
                            ImprimeXCentro "SFC: " & tSfc & "   La Paz Bolivia", 40
                            If estadoReimpresion = True Then
                                ImprimeXCentro "COMPROBANTE - COPIA", 40
                                estadoReimpresion = False
                            Else
                                ImprimeXCentro "COMPROBANTE", 40
                            End If
                            'Fin CGMiranda**********************************************************
                            
                            Printer.Print String(40, "-")
                            sLinea = String((40 - Len(Trim("NIT: " + sRUC))) / 2, " ") & "NIT: " + sRUC
                            Printer.Print sLinea
                            Printer.Print "Comprobante  Nº " & Mid(RsImpresion!tDocumento, 7)
                            Printer.Print "Autorización Nº " & tAutorizacion
                            Printer.Print String(40, "-")
                             
                             'impresiondiacontable
                            If lImpresionDiaContable Then
                                If lReimpresion = True Then
                                    Printer.Print "Fecha    : " & Format(Calcular("select fdiacontable as codigo from mdocumento where tdocumento ='" & RsImpresion!tDocumento & "'", Cn), "dd/MM/yyyy") & " " & Calcular("exec DiacontableHora '" & fImpresionDiaContable & "'", Cn)
                                    Else
                                    Printer.Print "Fecha    : " & fImpresionDiaContable & " " & Calcular("exec DiacontableHora '" & fImpresionDiaContable & "'", Cn)
                                End If
                                Else
                                 Printer.Print "Fecha    : " & RsImpresion!fRegistro
                            End If
                            
                            
                            'Printer.Print "Fecha    : " & RsImpresion!fRegistro
                            If Not IsNull(RsImpresion!Cliente) Or Len(Trim(RsImpresion!Cliente)) > 0 Then
                                ImprimeXLinea "Señores  : " & RsImpresion!Cliente, 40, 9
                                Printer.Print "NIT/CI   : " & RsImpresion!Ruc
                                Printer.Print "Dirección: " & Mid(RsImpresion!direccion, 1, 30)
                            End If
                            Printer.Print String(40, "-")
                            Printer.Print
                            Printer.Print "Pedido   : " & RsImpresion!tCodigoPedido
                            Printer.Print "Tipo     : " & RsImpresion!tipopedido
                            Printer.Print "Caja     : " & RsImpresion!tCaja & " - " & RsImpresion!tUsuario
                            Printer.Print "Mesero   : " & RsImpresion!Mozo
                            Printer.Print "Nro.Serie: " & Calcular("select isnull(tSerieImpresora,'') codigo from MDOCUMENTO where tDocumento ='" & RsImpresion!tDocumento & "'", Cn)
                            Printer.Print "Descuento: " & Mid(Trim(RsImpresion!DESCUENTO), 1, 30)
                            Printer.Print
                            Printer.Print "MESA     : " & RsImpresion!Mesa
                            
                            If lObservacionCabDoc Then
                                Printer.Print "Observac.: " & RsImpresion!tObservacion
                            End If
                            
                            Printer.Print
                            Printer.Print String(40, "-")
                            Printer.Print "Descripcion                     SubTotal"
                            Printer.Print String(40, "-")
                                
                            'Cuerpo
                            Printer.Print
                            txt = sConsumo
                            tOt = Len(Trim(txt))
                            pri = True
                            Do While tOt <> 0
                               lin = Mid(txt & " ", 1, 28)
                               For i = 28 To 1 Step -1
                                   If Mid(lin, i, 1) = " " Then
                                      pos = i
                                      Exit For
                                   End If
                               Next i
                                If pos = 0 Then
                                    pos = 28
                                End If
                               If pri Then
                                  sLinea = Mid(Mid(txt, 1, pos - 1) & String(27, " "), 1, 27) & " " & Right(String(12, " ") & Format(RsImpresion!nVenta + RsImpresion!nDescuento, "#,###,##0.00"), 12)
                                  pri = False
                               Else
                                  sLinea = Mid(txt, 1, pos - 1)
                               End If
                               txt = Mid(txt, pos + 1, tOt)
                               tOt = Len(txt)
                               Printer.Print sLinea
                            Loop
                                    
                            Printer.Print
                            Printer.Print String(40, "-")
                            RsImpresion.MoveLast
                            
                            If RsImpresion!nRecargo > 0 Then
                               Printer.Print
                               Printer.Print Right(String(27, " ") & "Recargo " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nRecargo, "##,###,##0.00"), 13)
                            End If
                            
                            If RsImpresion!nDescuento > 0 Then
                               Printer.Print
                               Printer.Print Right(String(27, " ") & "Descuento " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nDescuento, "##,###,##0.00"), 13)
                            End If
                               
                            nSumaNeto = RsImpresion!nNeto
                            
                            If IsNull(RsImpresion!lImpuesto1) Or Not RsImpresion!lImpuesto1 Then
                               nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto1
                            End If
                            
                            If IsNull(RsImpresion!lImpuesto2) Or Not RsImpresion!lImpuesto2 Then
                               nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto2
                            End If
                            
                            If IsNull(RsImpresion!lImpuesto3) Or Not RsImpresion!lImpuesto3 Then
                               nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto3
                            End If
                            'CESAR Bolivia
                            If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
                               Printer.Print Right(String(27, " ") & "Valor Venta " & sMonN & " : ", 27) & Right(String(13, " ") & Format(nSumaNeto, "##,###,##0.00"), 13)
                            End If
                            
                            If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                               Printer.Print Right(String(27, " ") & sImpuesto1 & " " & Format(nPorcentaje1, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,##0.00"), 13)
                            End If
                               
                            If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                               Printer.Print Right(String(27, " ") & sImpuesto2 & " " & Format(nPorcentaje2, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto2, "##,###,##0.00"), 13)
                            End If
                            
                            If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                               Printer.Print Right(String(27, " ") & sImpuesto3 & " " & Format(nPorcentaje3, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto3, "##,###,##0.00"), 13)
                            End If
                                                
                            Printer.Print Right(String(27, " ") & "Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 13)
                            '====================== nov 2010
                            If lDocumEquivaPrecuenta Then
                                 Printer.Print " "
                                Printer.Print Right(String(27, " ") & "Total " & sMonE & " :", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 13)
                            End If
                            '====================== nov 2010
                               
                            Printer.Print
                            If Calcular(" SELECT case when  lImpresionRetencion=1 then 1 else 0 end  as codigo FROM vTipodocumento WHERE Codigo=(SELECT TTIPODOCUMENTO FROM MDOCUMENTO WHERE tDocumento='" & RsImpresion!tDocumento & "')", Cn) = 1 Then
                            'ImprimeXCentro tTextoAgenteRetencion, 70
                            ImprimeXLinea tTextoAgenteRetencion, 40, 5
                            End If
                                                               
                               
                            Printer.Print
                            txt = "Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
                            ImprimeXLinea txt, 40, 5
                            Printer.Print
                            
                            Printer.Print String(40, "-")
                            Printer.Print "Código de Control      : " & tcodigoControl
                            Printer.Print "Fecha Límite de Emisión: " & Format(fLimite, "dd/MM/yyyy")
                            Printer.Print String(40, "-")
                            If Calcular("select ISNULL(lImprimeQR,0) as codigo from TTIPODOCUMENTO where tCodigoTipoDocumento='" & tTipoDoc & "'", Cn) = 1 Then
                                If pais = "001" Then
                                
                                Set rsQr = Lib.OpenRecordset("usp_Inforest_ObtieneCodigoQR_Bol " + RsImpresion!tDocumento, Cn)
                            
                                  FastQRCode rsQr.Fields(0), App.Path & "\BaseTempQr.bmp"
                            
                                    Set imgDocumento = CreateObject("Scripting.FileSystemObject")
                                    If imgDocumento.FileExists(App.Path & "\BaseTempQr.bmp") Then
                                        Printer.PaintPicture LoadPicture(App.Path & "\BaseTempQr.bmp"), 1400, Printer.CurrentY, 1323, 1323
                                         For p = 1 To 8
                                            Printer.Print
                                         Next p
                                    End If
                               End If
                            End If
                    
                            ImprimeXLinea textoComprobanteBolivia, 40, 5
                            Printer.Print String(40, "-")
                            ImprimeXCentro sPie, 40
                            
                            Printer.Print '.'
                            If lImprimeImagPieDocumento Then
                                    If pie <> 0 Then
                                        Printer.PaintPicture pie, 500, Printer.CurrentY, 2860, 1600
                                    End If
                            End If
                            Printer.EndDoc
                            
                            
                            
                            

        Case Else  'PERU - ECUADOR
        
                           If lImprimeImagCabDocumento Then
                                    If Cabecera <> 0 Then
                                    Printer.PaintPicture Cabecera, 500, Printer.CurrentY, 2860, 1600
                                    For p = 1 To 10
                                    Printer.Print
                                    Next p
                                    End If
                            End If
                            
                               'Cabecera
                                RsImpresion.MoveFirst

                                ImprimeXCentro sRazonSocial, 40
                                ImprimeXCentro sRazonComercial, 40
                                sLinea = String((40 - Len(Trim("R.U.C.: " + sRUC))) / 2, " ") & "R.U.C.: " + sRUC
                                Printer.Print sLinea
                                ImprimeXCentro sDireccion, 40
                                If Trim(sDireccion2) <> "" Then
                                    ImprimeXCentro sDireccion2, 40
                                End If
                                sLinea = String((40 - Len(Trim("Telefono: " + sTelefono))) / 2, " ") & "Telefono: " + sTelefono
                                Printer.Print sLinea
                                
                                Printer.Print " "
                                ImprimeXCentro "BOLETA DE VENTA ELECTRONICA", 40
                                Printer.Print " "
                                
                                'Printer.Print Mid(RsImpresion!tDocumento, 1, 1) & "-" & Mid(RsImpresion!tDocumento, 2, 5) & "-" & Mid(RsImpresion!tDocumento, 7)
                                ImprimeXCentro Mid(RsImpresion!tDocumento, 1, 1) & Mid(RsImpresion!tDocumento, 4, 3) & "-" & Mid(RsImpresion!tDocumento, 8, 8), 40
                                Printer.Print " "
                                Printer.Print "Pedido        : " & RsImpresion!tCodigoPedido
                                Printer.Print "Fecha Emision : " & RsImpresion!fRegistro
                                Printer.Print "Tipo          : " & RsImpresion!tipopedido
                                Printer.Print "Local         : " & xUnidadNegocio
                                Printer.Print "Caja          : " & RsImpresion!tCaja & " - " & RsImpresion!tUsuario
                                Printer.Print "Mesero        : " & IIf(IsNull(RsImpresion!Mozo), "", RsImpresion!Mozo)
                                If ImpDolarDelivery Then
                                    Printer.Print "Tipo Moneda   : " & sMonedaE
                                Else
                                    Printer.Print "Tipo Moneda   : " & sMonedaN
                                End If
                                
                                
                                'tipo de cambio
                                If RsParametroTC!lVerTCImp = True Then
                                Printer.Print "T/Cambio  : " & Format(nTC, "###,##0.00")
                                End If
                                '-----------------------------------------------------------
                                
                                'Printer.Print "Nro.Serie     : " & Calcular("select isnull(tSerieImpresora,'') codigo from MDOCUMENTO where tDocumento ='" & RsImpresion!tDocumento & "'", Cn)
                                Printer.Print "Mesa          : " & RsImpresion!Mesa
                                If lObservacionCabDoc Then
                                    ImprimeXLinea "Observacion   : " & RsImpresion!tObservacion, 40, 17
                                End If
                                Printer.Print " "
                                Printer.Print String(40, "-")
                                Printer.Print "Descripcion                         Total"
                                'Printer.Print "Cantid. Producto                SubTotal"
                                Printer.Print String(40, "-")
                                    
                                'Cuerpo
                                Printer.Print
                                txt = sConsumo
                                tOt = Len(Trim(txt))
                                pri = True
                                Do While tOt <> 0
                                   lin = Mid(txt & " ", 1, 28)
                                   For i = 28 To 1 Step -1
                                       If Mid(lin, i, 1) = " " Then
                                          pos = i
                                          Exit For
                                       End If
                                   Next i
                                   If pos = 0 Then
                                        pos = 28
                                   End If
                                   
                                   If pri Then
                                        If ImpDolarDelivery Then
                                            sLinea = Mid(Mid(txt, 1, pos - 1) & String(27, " "), 1, 27) & " " & Right(String(12, " ") & Format(RsImpresion!nVenta / nTC, "#,###,##0.00"), 12)
                                        Else
                                            sLinea = Mid(Mid(txt, 1, pos - 1) & String(27, " "), 1, 27) & " " & Right(String(12, " ") & Format(RsImpresion!nVenta, "#,###,##0.00"), 12)
                                        End If
                                      pri = False
                                   Else
                                      sLinea = Mid(txt, 1, pos - 1)
                                   End If
                                   txt = Mid(txt, pos + 1, tOt)
                                   tOt = Len(txt)
                                   Printer.Print sLinea
                                Loop
                                        
                                Printer.Print
                                Printer.Print String(40, "-")
                                RsImpresion.MoveLast
                                
                                Printer.Print " "
                                
                                Dim xGravada As Double
                                Dim xInafecta As Double
                                
                                xGravada = Calcular("SELECT SUM(D.nPrecioNeto*nCantidad) As Codigo FROM dDocumento D WHERE D.tDocumento = '" & RsImpresion!tDocumento & "' AND ((D.nPrecioImpuesto1>0 AND D.nPrecioImpuesto2=0) OR (D.nPrecioImpuesto1>0 AND D.nPrecioImpuesto2>0))", Cn)
                                xInafecta = Calcular("SELECT ISNULL(SUM(D.nPrecioNeto*nCantidad),0) As Codigo FROM dDocumento D WHERE ((D.nPrecioImpuesto1<=0 AND D.nPrecioImpuesto2>0)OR(D.nPrecioImpuesto1<=0 AND D.nPrecioImpuesto2<=0)) AND D.tDocumento = '" & RsImpresion!tDocumento & "'", Cn)
                                
                                ' FE SPRING
                                If lFESpring Then
                                    If ImpDolarDelivery Then
                                        If RsImpresion!nRecargo > 0 Then
                                           Printer.Print
                                           Printer.Print Right(String(27, " ") & "Recargo " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nRecargo / nTC, "##,###,##0.00"), 13)
                                        End If
                                        
                                        If RsImpresion!nDescuento > 0 Then
                                           Printer.Print
                                           nDescuentoNeto = Calcular("select IsNull(nDescuentoNeto,0) as Codigo from mDocumento where tdocumento = '" & RsImpresion!tDocumento & "'", Cn)
                                           Printer.Print Right(String(27, " ") & "Descuento " & sMonE & " : ", 27) & Right(String(13, " ") & Format(nDescuentoNeto / nTC, "##,###,##0.00"), 13)
                                        End If
                                        If Not (IsNull(RsImpresion!lOpGravInaf) Or RsImpresion!lOpGravInaf = 0) Then
                                            If lPagoAntesImpresion And lPagocortesiaAI Then
                                                Printer.Print Right(String(27, " ") & "Op. Gratuita " & sMonE & " : ", 27) & Right(String(13, " ") & Format(0 / nTC, "##,###,##0.00"), 13)
                                            Else
                                                Printer.Print Right(String(27, " ") & "Op. Gravadas " & sMonE & " : ", 27) & Right(String(13, " ") & Format(xGravada / nTC, "##,###,##0.00"), 13)
                                                Printer.Print Right(String(27, " ") & "Op. Inafecta " & sMonE & " : ", 27) & Right(String(13, " ") & Format(xInafecta / nTC, "##,###,##0.00"), 13)
                                            End If
                                        End If
                                    Else
                                        If RsImpresion!nRecargo > 0 Then
                                           Printer.Print
                                           Printer.Print Right(String(27, " ") & "Recargo " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nRecargo, "##,###,##0.00"), 13)
                                        End If
                                        
                                        If RsImpresion!nDescuento > 0 Then
                                           Printer.Print
                                           nDescuentoNeto = Calcular("select IsNull(nDescuentoNeto,0) as Codigo from mDocumento where tdocumento = '" & RsImpresion!tDocumento & "'", Cn)
                                           Printer.Print Right(String(27, " ") & "Descuento " & sMonN & " : ", 27) & Right(String(13, " ") & Format(nDescuentoNeto, "##,###,##0.00"), 13)
                                        End If
                                        If Not (IsNull(RsImpresion!lOpGravInaf) Or RsImpresion!lOpGravInaf = 0) Then
                                            If lPagoAntesImpresion And lPagocortesiaAI Then
                                                Printer.Print Right(String(27, " ") & "Op. Gratuita " & sMonN & " : ", 27) & Right(String(13, " ") & Format(0, "##,###,##0.00"), 13)
                                            Else
                                                Printer.Print Right(String(27, " ") & "Op. Gravadas " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xGravada, "##,###,##0.00"), 13)
                                                Printer.Print Right(String(27, " ") & "Op. Inafecta " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xInafecta, "##,###,##0.00"), 13)
                                            End If
                                        End If
                                    End If
                                Else
                                    If ImpDolarDelivery Then
                                        If Not (IsNull(RsImpresion!lOpGravInaf) Or RsImpresion!lOpGravInaf = 0) Then
                                            Printer.Print Right(String(27, " ") & "Op. Gravadas " & sMonE & " : ", 27) & Right(String(13, " ") & Format(xGravada / nTC, "##,###,##0.00"), 13)
                                            Printer.Print Right(String(27, " ") & "Op. Inafecta " & sMonE & " : ", 27) & Right(String(13, " ") & Format(xInafecta / nTC, "##,###,##0.00"), 13)
                                        End If
                                        
                                        If RsImpresion!nRecargo > 0 Then
                                           Printer.Print
                                           Printer.Print Right(String(27, " ") & "Recargo " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nRecargo / nTC, "##,###,##0.00"), 13)
                                        End If
                                        
                                        If RsImpresion!nDescuento > 0 Then
                                           Printer.Print
                                           Printer.Print Right(String(27, " ") & "Descuento " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nDescuento / nTC, "##,###,##0.00"), 13)
                                        End If
                                    Else
                                        If Not (IsNull(RsImpresion!lOpGravInaf) Or RsImpresion!lOpGravInaf = 0) Then
                                            Printer.Print Right(String(27, " ") & "Op. Gravadas " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xGravada, "##,###,##0.00"), 13)
                                            Printer.Print Right(String(27, " ") & "Op. Inafecta " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xInafecta, "##,###,##0.00"), 13)
                                        End If
                                        
                                        If RsImpresion!nRecargo > 0 Then
                                           Printer.Print
                                           Printer.Print Right(String(27, " ") & "Recargo " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nRecargo, "##,###,##0.00"), 13)
                                        End If
                                        
                                        If RsImpresion!nDescuento > 0 Then
                                           Printer.Print
                                           Printer.Print Right(String(27, " ") & "Descuento " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nDescuento, "##,###,##0.00"), 13)
                                        End If
                                    
                                    End If
                                End If
                                
                                nSumaNeto = RsImpresion!nNeto
                                
                                If IsNull(RsImpresion!lImpuesto1) Or Not RsImpresion!lImpuesto1 Then
                                   nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto1
                                End If
                                
                                If IsNull(RsImpresion!lImpuesto2) Or Not RsImpresion!lImpuesto2 Then
                                   nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto2
                                End If
                                
                                If IsNull(RsImpresion!lImpuesto3) Or Not RsImpresion!lImpuesto3 Then
                                   nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto3
                                End If
                                'CESAR Por Consumo SI - TICKET
'                                If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
'                                   Printer.Print Right(String(27, " ") & "Sub Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(nSumaNeto, "##,###,##0.00"), 13)
'                                End If
                                If ImpDolarDelivery Then
                                    If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                                       Printer.Print Right(String(27, " ") & sImpuesto1 & " " & Format(nPorcentaje1, "##0.00") & "% " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto1 / nTC, "##,###,##0.00"), 13)
                                    End If
                                       
                                    If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                                       Printer.Print Right(String(27, " ") & sImpuesto2 & " " & Format(nPorcentaje2, "##0.00") & "% " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto2 / nTC, "##,###,##0.00"), 13)
                                    End If
                                    
                                    If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                                       Printer.Print Right(String(27, " ") & sImpuesto3 & " " & Format(nPorcentaje3, "##0.00") & "% " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto3 / nTC, "##,###,##0.00"), 13)
                                    End If
                                                        
                                    Printer.Print Right(String(27, " ") & "Importe Total " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 13)
                                Else
                                    If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                                       Printer.Print Right(String(27, " ") & sImpuesto1 & " " & Format(nPorcentaje1, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,##0.00"), 13)
                                    End If
                                       
                                    If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                                       Printer.Print Right(String(27, " ") & sImpuesto2 & " " & Format(nPorcentaje2, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto2, "##,###,##0.00"), 13)
                                    End If
                                    
                                    If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                                       Printer.Print Right(String(27, " ") & sImpuesto3 & " " & Format(nPorcentaje3, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto3, "##,###,##0.00"), 13)
                                    End If
                                                        
                                    Printer.Print Right(String(27, " ") & "Importe Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 13)

                                    '====================== nov 2010
                                    If lDocumEquivaPrecuenta Then
                                         Printer.Print " "
                                        Printer.Print Right(String(27, " ") & "Total " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 13)
                                    End If
                                    '====================== nov 2010
                                End If
                                
                                Printer.Print " "
                                If Calcular(" SELECT case when  lImpresionRetencion=1 then 1 else 0 end  as codigo FROM vTipodocumento WHERE Codigo=(SELECT TTIPODOCUMENTO FROM MDOCUMENTO WHERE tDocumento='" & RsImpresion!tDocumento & "')", Cn) = 1 Then
                                ImprimeXLinea tTextoAgenteRetencion, 40, 5
                                End If
                                
                                Printer.Print " "
                                If ImpDolarDelivery Then
                                    txt = "Son: " & NumeroCadena(str(RsImpresion!nVenta / nTC)) & " " & sMonedaE
                                Else
                                    txt = "Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
                                End If
                                ImprimeXLinea txt, 40, 5
                                Printer.Print " "
                                
                                If Not IsNull(RsImpresion!Cliente) Or Len(Trim(RsImpresion!Cliente)) > 0 Then
                                   Printer.Print "Cliente: " & Mid(RsImpresion!Cliente, 1, 30)
                                
                                End If
                                
                                xTipoIdentidad = ""
                                xTipoIdentidad = Calcular("select upper(tResumido) as Codigo from vTipoIdentidad inner join TCLIENTE on vTipoIdentidad.Codigo=tcliente.tTipoIdentidad where tcliente.tCodigoCliente= (select isnull(tCodigoCliente,'') as codigo From MDOCUMENTO where tDocumento='" & RsImpresion!tDocumento & "')", Cn)
                                If xTipoIdentidad = "0" Then
                                        xTipoIdentidad = "Iden."
                                End If
                                Printer.Print xTipoIdentidad & "    : " & RsImpresion!Ruc
                                Printer.Print
                                Printer.Print String(40, "-")
                                ImprimeXCentro sPie, 40
                                
                                
                                Printer.Print " "
                                
                                'FACTURACION_E_PERU
                                If lQRFE Then
                                    Printer.PaintPicture CodigoHash, 1400, Printer.CurrentY, 1323, 1323
                                    Dim d As Integer
                                    For d = 1 To 8
                                        Printer.Print
                                     Next d
                                Else
            
                                     If lImpresionCodigoBarras Then
                                        Printer.PaintPicture CodigoHash, 250, Printer.CurrentY, 3400, 1200
                                        Printer.CurrentY = Printer.CurrentY + 1200
                                     Else
                                        ImprimeXCentro cadenaCodigoHash, 40
                                     End If
                                 End If

                     
                                Printer.Print " "
                                xImpresionFE = Calcular(" SELECT tImpresionFE as codigo FROM vTipodocumento WHERE Codigo=(SELECT TTIPODOCUMENTO FROM MDOCUMENTO WHERE tDocumento='" & RsImpresion!tDocumento & "')", Cn)
                                ImprimeXCentro xImpresionFE, 40
                                Printer.Print " "
                                '------------------
                                 
                                If lImprimeImagPieDocumento Then
                                        If pie <> 0 Then
                                        Printer.Print " "
                                        Printer.PaintPicture pie, 500, Printer.CurrentY, 2860, 1600
                                        End If
                                End If
                     
                                Printer.EndDoc
    End Select
End Sub


Public Sub ImprimeFacturaN(ByVal RsImpresion As Recordset, ByVal Empresa As String, Optional ByVal tTipoDoc As String)
    On Error Resume Next
    Dim Item As String
    Dim sLinea As String
    Dim sNum As String
    Dim i As Integer
    
    Dim nDescFacJA As Integer
    
    'Cabecera
    Printer.PaperSize = vbPRPSUser
    Printer.Orientation = vbPRORPortrait
    RsImpresion.MoveFirst
    ximprimeDetallado = Calcular("select lImprimeresumen as codigo from ttipodocumentoimpresora where ttipoemision='" & tTipoDoc & "' and  tcaja='" & sCaja & "'", Cn)




    Select Case Empresa
           Case Is = "001" 'Bohemia
                 For i = 1 To nCabecera
                     Printer.Print
                 Next i
                 Printer.Print "             Fecha Emision : " & Format(RsImpresion!fRegistro, "dd MMMM yyyy")
                 Printer.Print "             " & RsImpresion!tDocumento
                 Printer.Print
                 Printer.Print "               " & Mid(RsImpresion!Cliente & String(60, " "), 1, 60)
                 Printer.Print "               " & Mid(RsImpresion!direccion & String(46, " "), 1, 46) & "RUC : " & RsImpresion!Ruc
                 For i = 1 To nDetalle
                     Printer.Print
                 Next i
                 
                 'Cuerpo
                 Item = ""
                 i = 0
                 j = 0
                 
                'Cuerpo
                Item = ""
                Do While Not RsImpresion.EOF
                    If ximprimeDetallado = False Then
                        xproducto = RsImpresion!Producto
                    Else
                        xproducto = RsImpresion!ProductoDetallado
                    End If
                
                   If Item <> RsImpresion!tCodigoPedido + RsImpresion!tItem Then
                      i = i + 1
                      'Printer.Print
                      sNum = Mid("000", 1, 3 - Len(Trim(str(i)))) & Trim(str(i))
                      sLinea = sNum & "  " & Mid(xproducto & String(42, " "), 1, 42) & Right(String(7, " ") & Format(RsImpresion!nCantidad, "###0.00"), 7) & " " & Right(String(9, " ") & Format(RsImpresion!nprecioVenta, "##,##0.00"), 9) & " " & Right(String(12, " ") & Format(RsImpresion!nCantidad * RsImpresion!nprecioVenta, "#,###,##0.00"), 12)
                       Printer.Print sLinea
                   End If
                   Item = RsImpresion!tCodigoPedido + RsImpresion!tItem
                   RsImpresion.MoveNext
                Loop
                 
                 For j = i To nFItem
                     Printer.Print " "
                 Next j
                 
                 Printer.Print
                 RsImpresion.MoveLast
                 If sResumen Then
                    Printer.Print "        Pedido  : " & sPedido
                    Printer.Print "        Mesero  : " & RsImpresion!Mozo
                    Printer.Print "        Caja    : " & RsImpresion!tCaja & " - " & RsImpresion!tUsuario
                    Printer.FontBold = True
                    Printer.Print "        MESA    : " & IIf((RsImpresion!tMesa = "000" Or Len(Trim(RsImpresion!tMesa)) = 0 Or IsNull(RsImpresion!tMesa)), RsImpresion!tObservacion, RsImpresion!Mesa) & " Mesero : " & RsImpresion!Mozo
                    Printer.FontBold = False
                 Else
                    Printer.Print " "
                    Printer.Print " "
                    Printer.Print " "
                    Printer.Print " "
                 End If
                 
                 Printer.Print "        Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
                 If RsImpresion!nRecargo > 0 Then
                    Printer.Print Right(String(64, " ") & "Recargo : ", 64) & Right(String(13, " ") & Format(RsImpresion!nRecargo, "##,###,##0.00"), 13)
                 Else
                    Printer.Print
                 End If
                     
                 If RsImpresion!nDescuento > 0 Then
                    Printer.Print Right(String(64, " ") & "Descuento : ", 64) & Right(String(13, " ") & Format(RsImpresion!nDescuento, "##,###,##0.00"), 13)
                 Else
                    Printer.Print
                 End If
                 'Humberto 15/10/2008, se agrego la condición para saber si se debe o no imprimir el impuesto
                 'CESAR
                 If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
                    Printer.Print Right(String(64, " ") & "Valor Venta :", 64) & Right(String(13, " ") & Format(RsImpresion!nNeto, "##,###,##0.00"), 13)
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                    If RsImpresion!nprecioImpuesto1 > 0 Then
                        Printer.Print Right(String(64, " ") & sImpuesto1 & " " & Format(nPorcentaje1, "##0.00") & "% :", 64) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,##0.00"), 13)
                    End If
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                    If RsImpresion!nprecioImpuesto2 > 0 Then
                        Printer.Print Right(String(64, " ") & sImpuesto2 & " " & Format(nPorcentaje2, "##0.00") & "% :", 64) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto2, "##,###,##0.00"), 13)
                    End If
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                    If RsImpresion!nprecioImpuesto3 > 0 Then
                        Printer.Print Right(String(64, " ") & sImpuesto3 & " " & Format(nPorcentaje3, "##0.00") & "% :", 64) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto3, "##,###,##0.00"), 13)
                    End If
                 End If
                 'Humberto 15/10/2008, FIN
                 Printer.Print Right(String(64, " ") & "Total " & sMonN & " :", 64) & Right(String(13, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 13)
                   '====================== nov 2010
                If lDocumEquivaPrecuenta Then
                     Printer.Print " "
                    Printer.Print Right(String(64, " ") & "Total " & sMonE & " :", 64) & Right(String(13, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 13)
                End If
                '====================== nov 2010
           Case Is = "002"       ' Brujas
                 For i = 1 To nCabecera
                     Printer.Print
                 Next i
                    
                 Printer.Print String(58, " ") & "   Pedido : " & sPedido
                 Printer.Print "            " & Mid(RsImpresion!tDocumento & String(45, " "), 1, 45) & "    Caja   : " & RsImpresion!tCaja & " - " & RsImpresion!tUsuario
                 Printer.Print "            " & Mid(RsImpresion!Cliente & String(60, " "), 1, 60)
                 Printer.Print "            " & Mid(RsImpresion!direccion & String(60, " "), 1, 60)
                 Printer.Print "            " & Mid(RsImpresion!Ruc & String(49, " "), 1, 49) & Format(RsImpresion!fRegistro, "dd MMMM yyyy")
                 Printer.Print String(51, " ") & "          Mesa   : " & IIf(RsImpresion!tMesa = "000" Or Len(Trim((RsImpresion!tMesa))) = 0, RsImpresion!tObservacion, RsImpresion!Mesa)
                                                 
                 For i = 1 To nDetalle
                     Printer.Print
                 Next i
                 
                 'Cuerpo
                 Item = ""
                 i = 0
                 j = 0
                 
                'Cuerpo
                Item = ""
                Do While Not RsImpresion.EOF
                    If ximprimeDetallado = False Then
                        xproducto = RsImpresion!Producto
                    Else
                        xproducto = RsImpresion!ProductoDetallado
                    End If
                    
                   If Item <> RsImpresion!tCodigoPedido + RsImpresion!tItem Then
                      i = i + 1
                      'Printer.Print
                       sNum = Mid("000", 1, 3 - Len(Trim(str(i)))) & Trim(str(i))
                       sLinea = "   " & sNum & "  " & Right(String(7, " ") & Format(RsImpresion!nCantidad, "###0.00"), 7) & "  " & Mid(xproducto & String(55, " "), 1, 55) & " " & Right(String(9, " ") & Format(RsImpresion!nprecioVenta, "##,##0.00"), 9) & " " & Right(String(12, " ") & Format(RsImpresion!nCantidad * RsImpresion!nprecioVenta, "#,###,##0.00"), 12)
                       Printer.Print sLinea
                   End If
                   Item = RsImpresion!tCodigoPedido + RsImpresion!tItem
                   RsImpresion.MoveNext
                Loop
                                  
                 For j = i To nFItem
                     Printer.Print " "
                 Next j
                 
                 Printer.Print
                 RsImpresion.MoveLast
                 Printer.Print "                  Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
                 If RsImpresion!nRecargo > 0 Then
                    Printer.Print Right(String(82, " ") & "Recargo : ", 64) & Right(String(13, " ") & Format(RsImpresion!nRecargo, "##,###,##0.00"), 13)
                 Else
                    Printer.Print
                 End If
                     
                 If RsImpresion!nDescuento > 0 Then
                    Printer.Print Right(String(82, " ") & "Descuento : ", 64) & Right(String(13, " ") & Format(RsImpresion!nDescuento, "##,###,##0.00"), 13)
                 Else
                    Printer.Print
                 End If
                 
                 
                 Printer.Print ""
                 'Humberto 15/10/2008, se agrego la condición para saber si se debe o no imprimir el impuesto
                 If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
                    Printer.Print String(82, " ") & Right(String(13, " ") & Format(RsImpresion!nNeto, "##,###,##0.00"), 13)
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                    If RsImpresion!nprecioImpuesto1 > 0 Then
                        Printer.Print String(82, " ") & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,##0.00"), 13)
                    Else
                        Printer.Print ""
                    End If
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                    If RsImpresion!nprecioImpuesto2 > 0 Then
                        Printer.Print String(82, " ") & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto2, "##,###,##0.00"), 13)
                    Else
                        Printer.Print ""
                    End If
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                    If RsImpresion!nprecioImpuesto3 > 0 Then
                        Printer.Print String(82, " ") & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto3, "##,###,##0.00"), 13)
                    Else
                        Printer.Print ""
                    End If
                 End If
                 'Humberto 15/10/2008, FIN
                 Printer.Print String(82, " ") & Right(String(13, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 13)
                   '====================== nov 2010
                If lDocumEquivaPrecuenta Then
                     Printer.Print " "
                    Printer.Print Right(String(82, " ") & "Total " & sMonE & " :", 82) & Right(String(13, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 13)
                End If
                '====================== nov 2010
           Case Is = "003"       ' Rodrigo
                 For i = 1 To nCabecera
                     Printer.Print
                 Next i
                 
                 Printer.Print "      Fecha de Emisión : " & Format(RsImpresion!fRegistro, "dd MMMM yyyy")
                 Printer.Print "      Documento        : " & RsImpresion!tDocumento
                 Printer.Print "      Cliente          : " & RsImpresion!Cliente
                 Printer.Print "      Dirección        : " & RsImpresion!direccion
                 Printer.Print "      RUC              : " & RsImpresion!Ruc
                 
                 Printer.Print ""
                 
                 Printer.Print "      Pedido           : " & sPedido
                 Printer.Print "      Mesero           : " & RsImpresion!Mozo
                 Printer.Print "      Caja             : " & RsImpresion!tCaja & " - " & RsImpresion!tUsuario
                 Printer.FontBold = True
                 Printer.Print "      MESA             : " & IIf((RsImpresion!tMesa = "000" Or Len(Trim(RsImpresion!tMesa)) = 0 Or IsNull(RsImpresion!tMesa)), RsImpresion!tObservacion, RsImpresion!Mesa)
                 Printer.FontBold = False
                                                 
                 For i = 1 To nDetalle
                     Printer.Print
                 Next i
                 
                 'Cuerpo
                 Item = ""
                 i = 0
                 j = 0
                 
                'Cuerpo
                Item = ""
                Do While Not RsImpresion.EOF
                    If ximprimeDetallado = False Then
                        xproducto = RsImpresion!Producto
                    Else
                        xproducto = RsImpresion!ProductoDetallado
                    End If
                    
                   If Item <> RsImpresion!tCodigoPedido + RsImpresion!tItem Then
                      i = i + 1
                       sNum = Mid("000", 1, 3 - Len(Trim(str(i)))) & Trim(str(i))
                       sLinea = "   " & sNum & "  " & Right(String(7, " ") & Format(RsImpresion!nCantidad, "###0.00"), 7) & "  " & Mid(xproducto & String(55, " "), 1, 55) & " " & Right(String(9, " ") & Format(RsImpresion!nprecioVenta, "##,##0.00"), 9) & " " & Right(String(12, " ") & Format(RsImpresion!nCantidad * RsImpresion!nprecioVenta, "#,###,##0.00"), 12)
                       Printer.Print sLinea
                   End If
                   Item = RsImpresion!tCodigoPedido + RsImpresion!tItem
                   RsImpresion.MoveNext
                Loop
                                  
                 For j = i To nFItem
                     Printer.Print " "
                 Next j
                 
                 Printer.Print
                 RsImpresion.MoveLast
                 Printer.Print "                  Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
                 If RsImpresion!nRecargo > 0 Then
                    Printer.Print Right(String(82, " ") & "Recargo : ", 64) & Right(String(13, " ") & Format(RsImpresion!nRecargo, "##,###,##0.00"), 13)
                 Else
                    Printer.Print
                 End If
                     
                 If RsImpresion!nDescuento > 0 Then
                    Printer.Print Right(String(82, " ") & "Descuento : ", 64) & Right(String(13, " ") & Format(RsImpresion!nDescuento, "##,###,##0.00"), 13)
                 Else
                    Printer.Print
                 End If
                 
                 Printer.Print ""
                 'Humberto 15/10/2008, se agrego la condición para saber si se debe o no imprimir el impuesto
                 If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
                    Printer.Print Right(String(82, " ") & "Valor Venta :", 82) & Right(String(13, " ") & Format(RsImpresion!nNeto, "##,###,##0.00"), 13)
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                    If RsImpresion!nprecioImpuesto1 > 0 Then
                        Printer.Print Right(String(82, " ") & sImpuesto1 & " " & Format(nPorcentaje1, "##0.00") & "% :", 82) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,##0.00"), 13)
                    End If
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                    If RsImpresion!nprecioImpuesto2 > 0 Then
                        Printer.Print Right(String(82, " ") & sImpuesto2 & " " & Format(nPorcentaje2, "##0.00") & "% :", 82) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto2, "##,###,##0.00"), 13)
                    End If
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                    If RsImpresion!nprecioImpuesto3 > 0 Then
                        Printer.Print Right(String(82, " ") & sImpuesto3 & " " & Format(nPorcentaje3, "##0.00") & "% :", 82) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto3, "##,###,##0.00"), 13)
                    End If
                 End If
                 'Humberto 15/10/2008, fin
                 Printer.Print Right(String(82, " ") & "Total :", 82) & Right(String(13, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 13)
                               '====================== nov 2010
                If lDocumEquivaPrecuenta Then
                     Printer.Print " "
                    Printer.Print Right(String(82, " ") & "Total " & sMonE & " :", 82) & Right(String(13, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 13)
                End If
                '====================== nov 2010
           Case Is = "005" 'Ancel
           
                 For i = 1 To nCabecera
                     Printer.Print
                 Next i
                 
                 Printer.Print "           " & RsImpresion!tDocumento
                 Printer.Print
                 Printer.Print
                 Printer.Print "     " & Mid(Format(RsImpresion!fRegistro, "dd    MMMM ") & String(20, " "), 1, 20) & "      " & Mid(Format(RsImpresion!fRegistro, "yy"), 2, 1)
                 Printer.Print
                 Printer.Print "         " & Mid(RsImpresion!Cliente & String(66, " "), 1, 66) & RsImpresion!Ruc
                 Printer.Print
                 Printer.Print "         " & Mid(RsImpresion!direccion & String(50, " "), 1, 50)
                 
                 Printer.Print
                 Printer.Print
                 Printer.Print
                 Printer.Print "                        " & RsImpresion!tObservacion
                 For i = 1 To nDetalle
                     Printer.Print
                 Next i
                 
                 'Cuerpo
                 Item = ""
                 i = 0
                 j = 0
                 
                 Item = ""
                 Do While Not RsImpresion.EOF
                     If ximprimeDetallado = False Then
                        xproducto = RsImpresion!Producto
                    Else
                        xproducto = RsImpresion!ProductoDetallado
                    End If
                    
                    If Item <> RsImpresion!tCodigoPedido + RsImpresion!tItem Then
                       i = i + 1
                       'Printer.Print
                       sLinea = " " & Mid(xproducto & String(12, "  "), 1, 12) & "  " & Mid(xproducto & String(40, " "), 1, 40) & Right(String(7, " ") & Format(RsImpresion!nCantidad, "###0.00"), 7) & " " & Right(String(9, "  ") & Format(RsImpresion!nprecioVenta, "##,##0.00"), 9) & "   " & Right(String(16, " ") & Format(RsImpresion!nCantidad * RsImpresion!nprecioVenta, "#,###,###,##0.00"), 16)
                       Printer.Print sLinea
                    End If
                    Item = RsImpresion!tCodigoPedido + RsImpresion!tItem
                    RsImpresion.MoveNext
                 Loop
                                   
                 For j = i To nFItem
                     Printer.Print " "
                 Next j
                 
                 RsImpresion.MoveLast
                 If RsImpresion!nRecargo > 0 Then
                    Printer.Print Right(String(78, " ") & "Recargo : ", 78) & Right(String(17, " ") & Format(RsImpresion!nRecargo, "##,###,###,##0.00"), 17)
                 Else
                    Printer.Print
                 End If
                     
                 If RsImpresion!nDescuento > 0 Then
                    Printer.Print Right(String(74, " ") & "Descuento : ", 74) & Right(String(17, " ") & Format(RsImpresion!nDescuento, "##,###,###,##0.00"), 17)
                 Else
                    Printer.Print
                 End If
                 'Humberto 15/10/2008, se agrego la condición para saber si se debe o no imprimir el impuesto
                 If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
                    Printer.Print Right(String(74, " ") & "Valor Venta :", 74) & Right(String(17, " ") & Format(RsImpresion!nNeto, "##,##,###,##0.00"), 17)
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                    If RsImpresion!nprecioImpuesto1 > 0 Then
                        Printer.Print Right(String(74, " ") & sImpuesto1 & " " & Format(nPorcentaje1, "##0.00") & "% :", 74) & Right(String(17, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,###,##0.00"), 17)
                    End If
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                    If RsImpresion!nprecioImpuesto2 > 0 Then
                        Printer.Print Right(String(74, " ") & sImpuesto2 & " " & Format(nPorcentaje2, "##0.00") & "% :", 74) & Right(String(17, " ") & Format(RsImpresion!nprecioImpuesto2, "##,##,###,##0.00"), 17)
                    End If
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                    If RsImpresion!nprecioImpuesto3 > 0 Then
                        Printer.Print Right(String(74, " ") & sImpuesto3 & " " & Format(nPorcentaje3, "##0.00") & "% :", 74) & Right(String(17, " ") & Format(RsImpresion!nprecioImpuesto3, "##,##,###,##0.00"), 17)
                    End If
                 End If
                 'Humberto 15/10/2008, fin
                 Printer.Print Right(String(74, " ") & "Total " & sMonN & " : ", 74) & Right(String(17, " ") & Format(RsImpresion!nVenta, "##,##,###,##0.00"), 17)
                   '====================== nov 2010
                If lDocumEquivaPrecuenta Then
                     Printer.Print " "
                    Printer.Print Right(String(74, " ") & "Total " & sMonE & " :", 74) & Right(String(17, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 17)
                End If
                '====================== nov 2010
                 Printer.Print " "
                 Printer.Print UCase("       " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN)
                      
           Case Is = "006" ' ATLANTIC
                 For i = 1 To nCabecera
                     Printer.Print
                 Next i
                 
                 Printer.Print "   Documento        : " & RsImpresion!tDocumento
                 Printer.Print "   Fecha de Emisión : " & Format(RsImpresion!fRegistro, "dd MMMM yyyy") & "                  RUC     : " & RsImpresion!Ruc
                 Printer.Print "   Cliente          : " & RsImpresion!Cliente
                 Printer.Print "   Dirección        : " & RsImpresion!direccion
                 Printer.Print "   Pedido           : " & sPedido
                 Printer.Print Mid("   Caja             : " & RsImpresion!tCaja & " - " & RsImpresion!tUsuario & String(53, " "), 1, 53) & "Mozo    : " & RsImpresion!Mozo
                 Printer.Print "   MESA             : " & IIf((RsImpresion!tMesa = "000" Or Len(Trim(RsImpresion!tMesa)) = 0 Or IsNull(RsImpresion!tMesa)), RsImpresion!tObservacion, RsImpresion!Mesa)
                 
                 For i = 1 To nDetalle
                     Printer.Print
                 Next i
                 
                 'Cuerpo
                 Item = ""
                 i = 0
                 j = 0
                                  
                 Item = ""
                 Do While Not RsImpresion.EOF
                     If ximprimeDetallado = False Then
                        xproducto = RsImpresion!Producto
                    Else
                        xproducto = RsImpresion!ProductoDetallado
                    End If
                    
                    If Item <> RsImpresion!tCodigoPedido + RsImpresion!tItem Then
                       i = i + 1
                       'Printer.Print
                       sLinea = Right(String(11, " ") & Format(RsImpresion!nCantidad, "###0.00"), 7) & "  " & Mid(xproducto & String(58, " "), 1, 58) & " " & Right(String(9, " ") & Format(RsImpresion!nprecioVenta, "##,##0.00"), 9) & "     " & Right(String(12, " ") & Format(RsImpresion!nCantidad * RsImpresion!nprecioVenta, "#,###,##0.00"), 12)
                       Printer.Print sLinea
                    End If
                    Item = RsImpresion!tCodigoPedido + RsImpresion!tItem
                    RsImpresion.MoveNext
                 Loop
                                  
                 For j = i To nFItem
                     Printer.Print " "
                 Next j
                 
                 RsImpresion.MoveLast
                 If RsImpresion!nRecargo > 0 Then
                    Printer.Print Right(String(77, " ") & "Recargo : ", 77) & Right(String(17, " ") & Format(RsImpresion!nRecargo, "##,###,###,##0.00"), 17)
                 Else
                    Printer.Print
                 End If
                     
                 If RsImpresion!nDescuento > 0 Then
                    Printer.Print Right(String(77, " ") & "Descuento : ", 77) & Right(String(17, " ") & Format(RsImpresion!nDescuento, "##,###,###,##0.00"), 17)
                 Else
                    Printer.Print
                 End If
                 'Humberto 15/10/2008, se agrego la condición para saber si se debe o no imprimir el impuesto
                 If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
                    Printer.Print Right(String(77, " ") & "Valor Venta :", 77) & Right(String(17, " ") & Format(RsImpresion!nNeto, "##,##,###,##0.00"), 17)
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                    If RsImpresion!nprecioImpuesto1 > 0 Then
                        Printer.Print Right(String(77, " ") & sImpuesto1 & " " & Format(nPorcentaje1, "##0.00") & "% :", 77) & Right(String(17, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,###,##0.00"), 17)
                    End If
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                    If RsImpresion!nprecioImpuesto2 > 0 Then
                       Printer.Print Right(String(77, " ") & sImpuesto2 & " " & Format(nPorcentaje2, "##0.00") & "% :", 77) & Right(String(17, " ") & Format(RsImpresion!nprecioImpuesto2, "##,##,###,##0.00"), 17)
                    End If
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                    If RsImpresion!nprecioImpuesto3 > 0 Then
                       Printer.Print Right(String(77, " ") & sImpuesto3 & " " & Format(nPorcentaje3, "##0.00") & "% :", 77) & Right(String(17, " ") & Format(RsImpresion!nprecioImpuesto3, "##,##,###,##0.00"), 17)
                    End If
                 End If
                 'Humberto 15/10/2008, fin
                 Printer.Print Right(String(77, " ") & "Total " & sMonN & " : ", 77) & Right(String(17, " ") & Format(RsImpresion!nVenta, "##,##,###,##0.00"), 17)
                   '====================== nov 2010
                If lDocumEquivaPrecuenta Then
                     Printer.Print " "
                    Printer.Print Right(String(77, " ") & "Total " & sMonE & " :", 77) & Right(String(17, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 17)
                End If
                '====================== nov 2010
                If Calcular(" SELECT case when  lImpresionRetencion=1 then 1 else 0 end  as codigo FROM vTipodocumento WHERE Codigo=(SELECT TTIPODOCUMENTO FROM MDOCUMENTO WHERE tDocumento='" & RsImpresion!tDocumento & "')", Cn) = 1 Then
                    Printer.Print tTextoAgenteRetencion
                End If
                 Printer.Print UCase("SON: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN)
                                                                                              
           Case Is = "007" ' DUZKA
                 For i = 1 To nCabecera
                     Printer.Print
                 Next i
            
                 Printer.Print "         " & Mid(RsImpresion!Cliente, 1, 50)
                 Printer.Print "         " & Mid(RsImpresion!direccion, 1, 50)
                 Printer.Print "         " & RsImpresion!Ruc & "                      " & RsImpresion!tDocumento
                 Printer.Print
                 Printer.Print "                                                                   " & Day(RsImpresion!fRegistro) & "    " & Format(RsImpresion!fRegistro, "MMM") & "    " & Year(RsImpresion!fRegistro)
                 
                 For i = 1 To nDetalle
                     Printer.Print
                 Next i
                 
                 'Cuerpo
                 Item = ""
                 i = 0
                 j = 0
        
                 Do While Not RsImpresion.EOF
                     If ximprimeDetallado = False Then
                        xproducto = RsImpresion!Producto
                    Else
                        xproducto = RsImpresion!ProductoDetallado
                    End If
                    
                    'If Item <> RsImpresion!tCodigoPedido + RsImpresion!tItem Then
                       i = i + 1
                       sNum = Mid("000", 1, 3 - Len(Trim(str(i)))) & Trim(str(i))
                       sLinea = Right(String(7, " ") & Format(RsImpresion!nCantidad, "###0.00"), 7) & " " & Mid(xproducto & String(60, " "), 1, 60) & " " & Right(String(9, " ") & Format(RsImpresion!nprecioVenta / RsImpresion!nCantidad, "##,##0.00"), 9) & " " & Right(String(12, " ") & Format(RsImpresion!nprecioVenta, "#,###,##0.00"), 12)
                       Printer.Print sLinea
                    'End If
                    'Item = RsImpresion!tCodigoPedido + RsImpresion!tItem
                    RsImpresion.MoveNext
                 Loop
                                  
                 For j = i To nFItem
                     Printer.Print " "
                 Next j
            
                 Printer.Print
                 RsImpresion.MoveLast
                 
                 Printer.Print "        Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
                 If RsImpresion!nRecargo > 0 Then
                    Printer.Print Right(String(64, " ") & "Recargo : ", 64) & Right(String(13, " ") & Format(RsImpresion!nRecargo, "##,###,##0.00"), 13)
                 Else
                    Printer.Print
                 End If
                     
                 If RsImpresion!nDescuento > 0 Then
                    Printer.Print Right(String(64, " ") & "Descuento : ", 64) & Right(String(13, " ") & Format(RsImpresion!nDescuento, "##,###,##0.00"), 13)
                 Else
                    Printer.Print
                 End If
                 'Humberto 15/10/2008, se agrego la condición para saber si se debe o no imprimir el impuesto
                 If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
                     Printer.Print Right(String(78, " "), 78) & Right(String(13, " ") & Format(RsImpresion!nNeto, "##,###,##0.00"), 13)
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                    If RsImpresion!nprecioImpuesto1 > 0 Then
                        Printer.Print Right(String(78, " "), 78) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,##0.00"), 13)
                    End If
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                    If RsImpresion!nprecioImpuesto2 > 0 Then
                       Printer.Print Right(String(78, " "), 78) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto2, "##,###,##0.00"), 13)
                    End If
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                    If RsImpresion!nprecioImpuesto3 > 0 Then
                        Printer.Print Right(String(78, " "), 78) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto3, "##,###,##0.00"), 13)
                    End If
                 End If
                 'Humberto 15/10/2008, FIN
                 Printer.Print Right(String(78, " "), 78) & Right(String(13, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 13)
                   '====================== nov 2010
                If lDocumEquivaPrecuenta Then
                     Printer.Print " "
                    Printer.Print Right(String(78, " ") & "Total " & sMonE & " :", 78) & Right(String(13, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 13)
                End If
                '====================== nov 2010
           Case Is = "008" 'Herve
                 For i = 1 To nCabecera
                     Printer.Print
                 Next i
                 Printer.Print "         " & RsImpresion!tDocumento
                 Printer.Print " "
                 Printer.Print "           " & Day(RsImpresion!fRegistro) & "     " & Format(RsImpresion!fRegistro, "MMMM") & "              " & Year(RsImpresion!fRegistro)
                 
                 Printer.Print
                 Printer.Print "         " & Mid(RsImpresion!Cliente & String(60, " "), 1, 60) & "   " & RsImpresion!Ruc
                 Printer.Print "         " & Mid(RsImpresion!direccion & String(46, " "), 1, 46)
                 For i = 1 To nDetalle
                     Printer.Print
                 Next i
                 
                 'Cuerpo
                 Item = ""
                 i = 0
                 j = 0
                 
                'Cuerpo
                Item = ""
                Do While Not RsImpresion.EOF
                    If ximprimeDetallado = False Then
                        xproducto = RsImpresion!Producto
                    Else
                        xproducto = RsImpresion!ProductoDetallado
                    End If
                    
                   If Item <> RsImpresion!tCodigoPedido + RsImpresion!tItem Then
                      i = i + 1
                      'Printer.Print
                      sNum = Mid("000", 1, 3 - Len(Trim(str(i)))) & Trim(str(i))
                      sLinea = "   " & Right(String(7, " ") & Format(RsImpresion!nCantidad, "###0.00"), 7) & "  " & Mid(xproducto & String(50, " "), 1, 50) & " " & Right(String(9, " ") & Format(RsImpresion!nprecioVenta, "##,##0.00"), 9) & " " & Right(String(12, " ") & Format(RsImpresion!nCantidad * RsImpresion!nprecioVenta, "#,###,##0.00"), 12)
                       Printer.Print sLinea
                   End If
                   Item = RsImpresion!tCodigoPedido + RsImpresion!tItem
                   RsImpresion.MoveNext
                Loop
                 
                 For j = i To nFItem
                     Printer.Print " "
                 Next j
                 
                 Printer.Print
                 RsImpresion.MoveLast
                 If sResumen Then
                    Printer.Print "        Pedido  : " & sPedido
                    Printer.Print "        Mesero    : " & RsImpresion!Mozo
                    Printer.Print "        Caja    : " & RsImpresion!tCaja & " - " & RsImpresion!tUsuario
                    Printer.FontBold = True
                    Printer.Print "        MESA    : " & IIf((RsImpresion!tMesa = "000" Or Len(Trim(RsImpresion!tMesa)) = 0 Or IsNull(RsImpresion!tMesa)), RsImpresion!tObservacion, RsImpresion!Mesa) & " Mesero : " & RsImpresion!Mozo
                    Printer.FontBold = False
                 Else
                    Printer.Print " "
                    Printer.Print " "
                    Printer.Print " "
                    Printer.Print " "
                 End If
                 
                 Printer.Print "       " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
                 If RsImpresion!nRecargo > 0 Then
                    Printer.Print Right(String(64, " ") & "Recargo : ", 64) & Right(String(13, " ") & Format(RsImpresion!nRecargo, "##,###,##0.00"), 13)
                    Printer.Print " "
                 Else
                    Printer.Print
                 End If
                     
                 If RsImpresion!nDescuento > 0 Then
                    Printer.Print Right(String(64, " ") & "Descuento : ", 64) & Right(String(13, " ") & Format(RsImpresion!nDescuento, "##,###,##0.00"), 13)
                 Else
                    Printer.Print
                 End If
                 'Humberto 15/10/2008, se agrego la condición para saber si se debe o no imprimir el impuesto
                 If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
                    Printer.Print String(74, " ") & Right(String(13, " ") & Format(RsImpresion!nNeto, "##,###,##0.00"), 13)
                    Printer.Print " "
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                    If RsImpresion!nprecioImpuesto2 > 0 Then
                        Printer.Print Right(String(74, " ") & Format(nPorcentaje2, "##0.00"), 74) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto2, "##,###,##0.00"), 13)
                        Printer.Print " "
                    Else
                        Printer.Print " "
                        Printer.Print " "
                    End If
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                    If RsImpresion!nprecioImpuesto1 > 0 Then
                        Printer.Print Right(String(74, " ") & Format(nPorcentaje1, "##0.00"), 74) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,##0.00"), 13)
                        Printer.Print " "
                    Else
                        Printer.Print " "
                        Printer.Print " "
                    End If
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                    If RsImpresion!nprecioImpuesto3 > 0 Then
                        Printer.Print Right(String(74, " ") & Format(nPorcentaje3, "##0.00"), 74) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto3, "##,###,##0.00"), 13)
                        Printer.Print " "
                    Else
                        Printer.Print " "
                        Printer.Print " "
                    End If
                Else
                 End If
                 'Humberto 15/10/2008, FIN
                 Printer.Print String(74, " ") & Right(String(13, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 13)
                   '====================== nov 2010
                If lDocumEquivaPrecuenta Then
                     Printer.Print " "
                    Printer.Print Right(String(74, " ") & "Total " & sMonE & " :", 74) & Right(String(13, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 13)
                End If
                '====================== nov 2010
         Case Is = "009" 'La Gloria
                Dim RsPropiedad As ADODB.Recordset
                Dim RsPropiedadCombo As ADODB.Recordset
                
                Isql = "SELECT dbo.TPRODUCTOPROPIEDAD.tItem, dbo.TOPERADOR.tDetallado AS Operador, dbo.TPROPIEDAD.tDetallado AS Descripcion " & _
                       "FROM dbo.TPRODUCTOPROPIEDAD INNER JOIN dbo.TPROPIEDAD ON dbo.TPRODUCTOPROPIEDAD.tCodigoPropiedad = dbo.TPROPIEDAD.tCodigoPropiedad AND dbo.TPRODUCTOPROPIEDAD.tProducto = dbo.TPROPIEDAD.tProducto INNER JOIN dbo.TOPERADOR ON dbo.TPROPIEDAD.tOperador = dbo.TOPERADOR.tOperador " & _
                       "where tCodigoPedido='" & sPedido & "' and TOPERADOR.lImprime=1"
                Set RsPropiedad = Lib.OpenRecordset(Isql, Cn)
                
                Isql = "SELECT dbo.TCOMBOPROPIEDAD.tItem, dbo.TCOMBOPROPIEDAD.tItemCombo, dbo.TOPERADOR.tDetallado AS Operador, dbo.TPROPIEDAD.tDetallado AS Descripcion " & _
                       "FROM dbo.TCOMBOPROPIEDAD INNER JOIN dbo.TPROPIEDAD ON dbo.TCOMBOPROPIEDAD.tCodigoPropiedad = dbo.TPROPIEDAD.tCodigoPropiedad INNER JOIN dbo.TOPERADOR ON dbo.TPROPIEDAD.tOperador = dbo.TOPERADOR.tOperador " & _
                       "where tCodigoPedido='" & sPedido & "'  and TOPERADOR.lImprime=1"
                Set RsPropiedadCombo = Lib.OpenRecordset(Isql, Cn)
         
                 For i = 1 To nCabecera
                     Printer.Print
                 Next i
                 Printer.Print "  " & Mid(Format(RsImpresion!fRegistro, "dd    MMMM ") & String(20, " "), 1, 20) & "   " & Format(RsImpresion!fRegistro, "yyyy")
                 Printer.Print "      " & Mid(RsImpresion!Cliente & String(65, " "), 1, 65) & "  Doc.: " & RsImpresion!tDocumento
                 Printer.Print "      " & Mid(RsImpresion!Ruc & String(65, " "), 1, 65) & "  Mesero: " & RsImpresion!Mozo
                 Printer.Print "      " & Mid(RsImpresion!direccion & String(65, " "), 1, 65); "  Caja: " & RsImpresion!tCaja & " - " & RsImpresion!tUsuario
                 
                 For i = 1 To nDetalle
                     Printer.Print
                 Next i
                 
                 'Cuerpo
                 Item = ""
                 i = 0
                 j = 0
                 
                 'Item = ""
                Do While Not RsImpresion.EOF
                    If ximprimeDetallado = False Then
                        xproducto = RsImpresion!Producto
                    Else
                        xproducto = RsImpresion!ProductoDetallado
                    End If
                    
                   If Item <> RsImpresion!tCodigoPedido + RsImpresion!tItem Then
                      i = i + 1
                      sNum = Mid("000", 1, 3 - Len(Trim(str(i)))) & Trim(str(i))
                      'Imprime Detalle
                      
                      sLinea = Right(String(5, "   ") & Format(RsImpresion!tCodigoProducto, "00000"), 5) & Right(String(14, " ") & Format(RsImpresion!nCantidad, "###0.00"), 14) & "  " & Mid(xproducto & String(42, " "), 1, 42) & "    " & Right(String(9, " ") & Format(RsImpresion!nprecioVenta, "##,##0.00"), 9) & "   " & Right(String(12, " ") & Format(RsImpresion!nprecioVenta * RsImpresion!nCantidad, "#,###,##0.00"), 12)
                      Printer.Print sLinea
                    End If
                    
                    'Impresion de Propiedades
                    RsPropiedad.Filter = "tItem='" & RsImpresion!tItem & "'"
                    If Not RsPropiedad.EOF Then
                       RsPropiedad.MoveFirst
                       Do While Not RsPropiedad.EOF
                          i = i + 1
                          Printer.Print "                     " & RsPropiedad!Operador & " " & RsPropiedad!Descripcion
                          RsPropiedad.MoveNext
                       Loop
                    End If
                             
                    'Impresion de la Observacion
                    If lPropiedadDocumento And Len(Trim(RsImpresion!tObservacionPedido)) > 0 Then
                       i = i + 1
                       ImprimeXLinea "                     * " & Trim(RsImpresion!tObservacionPedido), 42, 2
                       
                    End If
                    
                    Item = RsImpresion!tCodigoPedido + RsImpresion!tItem
                    RsImpresion.MoveNext
                 Loop
                                  
                 For j = i To nFItem
                     Printer.Print " "
                 Next j
                 RsImpresion.MoveLast
                 Printer.Print "Son " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
                 RsImpresion.MoveLast
                 If RsImpresion!nRecargo > 0 Then
                    Printer.Print Right(String(68, " ") & "Recargo : ", 68) & Right(String(17, " ") & Format(RsImpresion!nRecargo, "##,###,###,##0.00"), 17)
                 Else
                    Printer.Print
                 End If
                     
                 If RsImpresion!nDescuento > 0 Then
                    Printer.Print Right(String(68, " ") & "Descuento : ", 68) & Right(String(17, " ") & Format(RsImpresion!nDescuento, "##,###,###,##0.00"), 17)
                 Else
                    Printer.Print
                 End If
                                  
                 'Humberto 15/10/2008, se agrego la condición para saber si se debe o no imprimir el impuesto
                 'NETO
                 If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
                     Printer.Print Right(String(91, " ") & Format(RsImpresion!nNeto, "##,##,###,##0.00"), 91)
                     'Printer.Print " "
                     Printer.Print "                     " & Day(RsImpresion!fRegistro) & "      " & Format(RsImpresion!fRegistro, "MMM") & "                 " & Year(RsImpresion!fRegistro)
                 End If
                 
                 If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                    If RsImpresion!nprecioImpuesto1 > 0 Then
                        Printer.Print Right(String(79, " ") & Format(nPorcentaje1, "##0.00") & "% ", 79) & Right(String(17, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,###,##0.00"), 12)
                        Printer.Print
                    End If
                 End If
                 
                 If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                    If RsImpresion!nprecioImpuesto2 > 0 Then
                        Printer.Print Right(String(79, " ") & Format(nPorcentaje2, "##0.00") & "% ", 79) & Right(String(17, " ") & Format(RsImpresion!nprecioImpuesto2, "##,##,###,##0.00"), 12)
                        Printer.Print
                    End If
                 End If
                 
                 If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                    If RsImpresion!nprecioImpuesto3 > 0 Then
                        Printer.Print Right(String(79, " ") & Format(nPorcentaje3, "##0.00") & "% ", 79) & Right(String(17, " ") & Format(RsImpresion!nprecioImpuesto3, "##,##,###,##0.00"), 12)
                        Printer.Print
                    End If
                 End If
                 
                 'Humberto 15/10/2008, fin
                 Printer.Print Right(String(91, " ") & Format(RsImpresion!nVenta, "##,##,###,##0.00"), 91)
                   '====================== nov 2010
                If lDocumEquivaPrecuenta Then
                     Printer.Print " "
                    Printer.Print Right(String(91, " ") & "Total " & sMonE & " :", 91) & Right(String(13, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 13)
                End If
                '====================== nov 2010
            
            'LG
            Case Is = "010" ' Mangos
                 For i = 1 To nCabecera
                     Printer.Print
                 Next i
                
                 Printer.Print "Cliente:   " & Left(Mid(RsImpresion!Cliente, 1, 60) & String(60, " "), 60) & IIf(RsImpresion!Ruc <> "", "RUC: " & RsImpresion!Ruc, "")
                 Printer.Print "Dirección: " & Left(Mid(RsImpresion!direccion, 1, 60) & String(60, " "), 60)
                 Printer.Print "Fecha:     " & Format(RsImpresion!fRegistro, " dd  MMMM  yyyy ") & String(3, " ") & Left("Usuario: " & RsImpresion!tUsuario & String(50, " "), 50)
                               
                 For i = 1 To nDetalle
                     Printer.Print
                 Next i
                 
                 'Cuerpo
                 Item = ""
                 i = 0
                 j = 0
                 
                 'Cuerpo
                 Item = ""
                 sLinea = "   " & Right(String(6, " ") & "CANT.", 6) & "     " & UCase(Mid("PRODUCTO" & String(48, " "), 1, 48)) & " " & Right(String(10, " ") & "PRECIO UNI", 10) & " " & Right(String(14, " ") & Format("SUBTOTAL"), 14)
                 Printer.Print sLinea
                 
                 Do While Not RsImpresion.EOF
                     If ximprimeDetallado = False Then
                        xproducto = RsImpresion!Producto
                    Else
                        xproducto = RsImpresion!ProductoDetallado
                    End If
                    
                    If Item <> RsImpresion!tCodigoPedido + RsImpresion!tItem Then
                       'Genera la cadena las Propiedades

                       i = i + 1
                       Producto = xproducto
                       
                       sLinea = "   " & Right(String(6, " ") & Format(RsImpresion!nCantidad, "###0.00"), 6) & "     " & UCase(Mid(Producto & String(48, " "), 1, 48)) & " " & Right(String(10, " ") & Format(RsImpresion!nprecioVenta, "##,##0.00"), 10) & " " & Right(String(14, " ") & Format(RsImpresion!nCantidad * RsImpresion!nprecioVenta, "#,###,##0.00"), 14)
                       Printer.Print sLinea
                    End If
                    
                    Item = RsImpresion!tCodigoPedido + RsImpresion!tItem
                    RsImpresion.MoveNext
                 Loop
                 
                
                 
                    For j = i To nFItem
                        Printer.Print " "
                    Next j
                 
                 
                 Printer.Print
                 RsImpresion.MoveLast
                 Printer.Print "              Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
 
                 Printer.Print ""
                 Printer.Print ""

                 If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
                    sImportes = Right(String(22, " ") & "NETO " & sMonN & Format(RsImpresion!nNeto, "##,###,##0.00"), 22) & _
                                Right(String(18, " ") & UCase(sImpuesto1) & " " & sMonN & Format(RsImpresion!nprecioImpuesto1, "##,###,##0.00"), 19) & _
                                Right(String(18, " ") & UCase(sImpuesto2) & " " & sMonN & Format(RsImpresion!nprecioImpuesto2, "##,###,##0.00"), 19) & _
                                Right(String(20, " ") & "TOTAL " & sMonN & Format(RsImpresion!nVenta, "##,###,##0.00"), 21)
                    Printer.Print String(6, " ") & sImportes
                 End If
                                 
 'CGMIRANDA*******************************************************************************************
            Case Is = "011" ' LIBER
                 For i = 1 To nCabecera
                     Printer.Print
                 Next i
                 
                 Printer.Print "   Documento        : " & RsImpresion!tDocumento
                 Printer.Print "   Fecha de Emisión : " & Format(RsImpresion!fRegistro, "dd MMMM yyyy") & "                  RUC     : " & RsImpresion!Ruc
                 Printer.Print "   Cliente          : " & RsImpresion!Cliente
                 Printer.Print "   Dirección        : " & RsImpresion!direccion
                 Printer.Print "   Pedido           : " & sPedido
                 Printer.Print Mid("   Caja             : " & RsImpresion!tCaja & " - " & RsImpresion!tUsuario & String(53, " "), 1, 53) & "Mozo    : " & RsImpresion!Mozo
                 Printer.Print "   MESA             : " & IIf((RsImpresion!tMesa = "000" Or Len(Trim(RsImpresion!tMesa)) = 0 Or IsNull(RsImpresion!tMesa)), RsImpresion!tObservacion, RsImpresion!Mesa)
                 
                 For i = 1 To nDetalle
                     Printer.Print
                 Next i
                 
                 'Cuerpo
                 Item = ""
                 i = 0
                 j = 0
                                  
                 Item = ""
                 Do While Not RsImpresion.EOF
                     If ximprimeDetallado = False Then
                        xproducto = RsImpresion!Producto
                    Else
                        xproducto = RsImpresion!ProductoDetallado
                    End If
                    
                    If Item <> RsImpresion!tCodigoPedido + RsImpresion!tItem Then
                       i = i + 1
                       'Printer.Print
                       sLinea = Right(String(11, " ") & Format(RsImpresion!nCantidad, "###0.00"), 7) & "  " & Mid(xproducto & String(58, " "), 1, 58) & " " & Right(String(9, " ") & Format(RsImpresion!nprecioVenta, "##,####0.0000"), 9) & "     " & Right(String(12, " ") & Format(RsImpresion!nCantidad * RsImpresion!nprecioVenta, "#,###,##0.00"), 12)
                       Printer.Print sLinea
                    End If
                    Item = RsImpresion!tCodigoPedido + RsImpresion!tItem
                    RsImpresion.MoveNext
                 Loop
                                  
                 For j = i To nFItem
                     Printer.Print " "
                 Next j
                 
                 RsImpresion.MoveLast
                 If RsImpresion!nRecargo > 0 Then
                    Printer.Print Right(String(77, " ") & "Recargo : ", 77) & Right(String(17, " ") & Format(RsImpresion!nRecargo, "##,###,###,##0.00"), 17)
                 Else
                    Printer.Print
                 End If
                     
                 If RsImpresion!nDescuento > 0 Then
                    Printer.Print Right(String(77, " ") & "Descuento : ", 77) & Right(String(17, " ") & Format(RsImpresion!nDescuento, "##,###,###,##0.00"), 17)
                 Else
                    Printer.Print
                 End If
                 'Humberto 15/10/2008, se agrego la condición para saber si se debe o no imprimir el impuesto
                 If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
                    Printer.Print Right(String(77, " ") & "Valor Venta :", 77) & Right(String(17, " ") & Format(RsImpresion!nNeto, "##,##,###,##0.00"), 17)
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                    If RsImpresion!nprecioImpuesto1 > 0 Then
                        Printer.Print Right(String(77, " ") & sImpuesto1 & " " & Format(nPorcentaje1, "##0.00") & "% :", 77) & Right(String(17, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,###,##0.00"), 17)
                    End If
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                    If RsImpresion!nprecioImpuesto2 > 0 Then
                       Printer.Print Right(String(77, " ") & sImpuesto2 & " " & Format(nPorcentaje2, "##0.00") & "% :", 77) & Right(String(17, " ") & Format(RsImpresion!nprecioImpuesto2, "##,##,###,##0.00"), 17)
                    End If
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                    If RsImpresion!nprecioImpuesto3 > 0 Then
                       Printer.Print Right(String(77, " ") & sImpuesto3 & " " & Format(nPorcentaje3, "##0.00") & "% :", 77) & Right(String(17, " ") & Format(RsImpresion!nprecioImpuesto3, "##,##,###,##0.00"), 17)
                    End If
                 End If
                 'Humberto 15/10/2008, fin
                 Printer.Print Right(String(77, " ") & "Total " & sMonN & " : ", 77) & Right(String(17, " ") & Format(RsImpresion!nVenta, "##,##,###,##0.00"), 17)
                   '====================== nov 2010
                If lDocumEquivaPrecuenta Then
                     Printer.Print " "
                    Printer.Print Right(String(77, " ") & "Total " & sMonE & " :", 77) & Right(String(17, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 17)
                End If
                '====================== nov 2010
                 Printer.Print UCase("SON: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN)
                 
          'FIN CGMIRANDA**************************************************************************************
                
   '--------------IMPRIME FACTURA N--------------

'CESAR
            Case Is = "012" 'winebar

                ImprimeFacturaNEmpresa12 RsImpresion, Empresa, tTipoDoc


            'CESAR NINAHUANCA
            Case Is = "013" 'COSTANERA 700
                ImprimeFacturaNEmpresa13 RsImpresion, Empresa, tTipoDoc
                
            'CESAR NINAHUANCA
            Case Is = "014" 'QUEIROLO
                ImprimeFacturaNEmpresa14 RsImpresion, Empresa, tTipoDoc
            
            'CESAR NINAHUANCA
            Case Is = "015" 'PIKALO
                ImprimeFacturaNEmpresa15 RsImpresion, Empresa, tTipoDoc
            
            'CESAR NINAHUANCA
            Case Is = "016" 'COLONIAL
                ImprimeFacturaNEmpresa16 RsImpresion, Empresa, tTipoDoc
             
            'CESAR NINAHUANCA
            Case Is = "017" 'EL HORNERO
                ImprimeFacturaNEmpresa17 RsImpresion, Empresa, tTipoDoc
                                                            
            Case Is = "018" 'AS DE ORO
                ImprimeFacturaNEmpresa18 RsImpresion, Empresa, tTipoDoc
                
            Case Is = "100" 'tablon
                ImprimeFacturaNEmpresa100 RsImpresion, Empresa, tTipoDoc
             
             
            'Luis Chumpitaz
            Case Is = "020" ' Jose Antonio

                 For i = 1 To nCabecera
                     Printer.Print
                 Next i
                 'Printer.Print "        " & Left(Mid(RsImpresion!Cliente, 1, 34) & String(34, " "), 34) & RsImpresion!Ruc
                 Printer.Print "  " & Left(Mid(RsImpresion!Cliente, 1, 40) & String(40, " "), 40) & RsImpresion!Ruc
                 Printer.Print " "
                 Printer.Print Mid(RsImpresion!direccion, 1, 52)
                 Printer.Print " "
                 Printer.Print Left(RsImpresion!tUsuario & String(10, " "), 10) & String(2, " ") & Mid(WeekdayName(Weekday(Format(RsImpresion!fRegistro, "dd/MM/yyyy"))), 1, 3) & String(1, " ") & Format(RsImpresion!fRegistro, "dd/MM/yyyy") & String(2, " ") & Right(sTurno, 5) & String(2, " ") & Left(RsImpresion!Mozo & String(6, " "), 6) & String(1, " ") & Left(RsImpresion!Mesa & String(10, " "), 10) & String(7, " "); RsImpresion!tDocumento
                                                 
                 For i = 1 To nDetalle
                     Printer.Print
                 Next i
                 
                 'Cuerpo
                 Item = ""
                 i = 0
                 j = 0
                 
                 'Cuerpo
                 Item = ""
                 nPorcDscto = RsImpresion!PorcDscto
                 sMotivoDscto = RsImpresion!DESCUENTO
                 nMontoDscto = Calcular("select sum(ndescuento*ncantidad) as codigo from ddocumento where tdocumento='" & RsImpresion!tDocumento & "'", Cn)
                 nDescFacJA = RsImpresion!nDescuento
                 
                 Do While Not RsImpresion.EOF
                     If ximprimeDetallado = False Then
                        xproducto = RsImpresion!Producto
                    Else
                        xproducto = RsImpresion!ProductoDetallado
                    End If
                    
                    If Item <> RsImpresion!tCodigoPedido + RsImpresion!tItem Then
                        'Genera la cadena las Propiedades

                    
                       i = i + 1
                       If Len(RsImpresion!Propiedad) > 0 Then
                        Producto = xproducto & ", " & Mid(RsImpresion!Propiedad, 1, Len(RsImpresion!Propiedad) - 1)
                       Else
                        Producto = xproducto
                       End If

                       sNum = "   "
                       sLinea = "   " & sNum & " " & Right(String(6, " ") & Format(RsImpresion!nCantidad, "###0.00"), 6) & " " & UCase(Mid(Producto & String(48, " "), 1, 48)) & " " & Right(String(10, " ") & Format(RsImpresion!nprecioVenta, "##,##0.00"), 10) & " " & Right(String(14, " ") & Format(RsImpresion!nCantidad * RsImpresion!nprecioVenta, "#,###,##0.00"), 14)
                       Printer.Print sLinea
                    End If
                    
                    Item = RsImpresion!tCodigoPedido + RsImpresion!tItem
                    RsImpresion.MoveNext
                 Loop
                 
                 'Imprime el Descuento
'                 If nPorcDscto > 0 Then
'                    For j = i To nFItem - 1
'                        Printer.Print " "
'                    Next j
'
'                    sLinea = "Descuento " & sMotivoDscto & ". Monto S/." & Format(nMontoDscto, "##,###,##0.00")
'                    Printer.Print "              " & sLinea
'                 Else
'                    For j = i To nFItem
'                        Printer.Print " "
'                    Next j
'                 End If
                 
                 '-------DESCUENTOS
                 If nDescFacJA > 0 Then
                    For j = i To nFItem - 1
                        Printer.Print " "
                    Next j
                    sLinea = "Descuento " & sMotivoDscto & ". Monto S/." & Format(nMontoDscto, "##,###,##0.00")
                    Printer.Print "              " & sLinea
                 Else
                    For j = i To nFItem
                        Printer.Print " "
                    Next j
                 End If
                 Printer.Print
                 RsImpresion.MoveLast
                 Printer.Print "              Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
 
                 Printer.Print ""
                 Printer.Print ""

                 If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
                    sImportes = Right(String(10, " ") & Format(RsImpresion!nNeto, "##,###,##0.00"), 10) & _
                                Right(String(10, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,##0.00"), 10) & _
                                Right(String(10, " ") & Format(RsImpresion!nprecioImpuesto2, "##,###,##0.00"), 10) & _
                                Right(String(15, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 15)
                    Printer.FontBold = True
                    Printer.Print String(20, " ") & Format(RsImpresion!fRegistro, " dd     MM       yyyy ") & sImportes
                    Printer.FontBold = False
                 End If
                 
   
        End Select
        Printer.EndDoc
End Sub


Public Sub ImprimeFacturaNEmpresa14(RsImpresion As Recordset, Empresa As String, Optional tTipoDoc As String)
                 ximprimeDetallado = Calcular("select lImprimeresumen as codigo from ttipodocumentoimpresora where ttipoemision='" & tTipoDoc & "' and  tcaja='" & sCaja & "'", Cn)

                 For i = 1 To nCabecera
                     Printer.Print
                 Next i
                 
                    Printer.Print ""
                    Printer.Print ""
                    Printer.Print "                              LIMA - PERU"
                    Printer.Print ""
                    Printer.Print ""
                    Printer.Print String(5, " ") & Format(RsImpresion!fRegistro, "dd /" & " " & "MM /" & " " & "yyyy")
                    Printer.Print String(5, " ") & Left(Mid(RsImpresion!Cliente, 1, 46) & String(46, " "), 50) & String(24, " ") & Left(Mid(RsImpresion!Mesa, 1, 30) & String(30, " "), 36)
                    Printer.Print String(5, " ") & Left(Mid(RsImpresion!Ruc, 1, 20) & String(20, " "), 26) & String(24, " ") & Left(Mid(RsImpresion!direccion, 1, 60) & String(60, " "), 66)
                    Printer.Print ""
                    
                 For i = 1 To nDetalle
                     Printer.Print
                 Next i
                 'Cuerpo
                 Item = "":                  i = 0:                   j = 0
                 'Cuerpo
                 Item = ""
                 Printer.Print sLinea
                 
                 Do While Not RsImpresion.EOF
                    If ximprimeDetallado = False Then
                        xproducto = RsImpresion!Producto
                    Else
                        xproducto = RsImpresion!ProductoDetallado
                    End If
                    
                    If Item <> RsImpresion!tCodigoPedido + RsImpresion!tItem Then
                       i = i + 1
                       Producto = xproducto
                       
                       sLinea = Right(String(0, " ") & Format(RsImpresion!nCantidad, "##0.00"), 6) & String(6, " ") & UCase(Mid(Producto & String(48, " "), 1, 48)) & String(38, " ") & Right(String(11, " ") & Format(RsImpresion!nprecioVenta, "##,##0.00"), 11) & "    " & Right(String(14, " ") & Format(RsImpresion!nCantidad * RsImpresion!nprecioVenta, "#,###,##0.00"), 14)
                       Printer.Print sLinea
                    End If
                    
                    Item = RsImpresion!tCodigoPedido + RsImpresion!tItem
                    RsImpresion.MoveNext
                 Loop

                    For j = i To nFItem
                        Printer.Print " "
                    Next j
                            
                 Printer.Print
                 RsImpresion.MoveLast
                 
                    sImportes = Right(String(12, " ") & Format(RsImpresion!nNeto, "##,###,##0.00"), 12)
                    sImportes1 = Right(String(12, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,##0.00"), 12)
                    sImportes2 = Right(String(12, " ") & Format(RsImpresion!nprecioImpuesto2, "##,###,##0.00"), 12)
                    sImportes3 = Right(String(12, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 12)
                    
                    
                    Printer.Print String(92, " ") & Right(String(10, " ") & "SUB-TOTAL", 10) & "      " & sMonN & "  " & sImportes
                    Printer.Print String(92, " ") & Right(String(10, " ") & UCase(sImpuesto1), 10) & " " & Format(nPorcentaje1, "##0") & " % " & sMonN & "  " & sImportes1
                    Printer.Print String(92, " ") & Right(String(10, " ") & UCase(sImpuesto2), 10) & " " & Format(nPorcentaje2, "##0") & " % " & sMonN & "  " & sImportes2
                    Printer.Print String(92, " ") & Right(String(10, " ") & "TOTAL", 10) & "      " & sMonN & "  " & sImportes3
                    
                    Printer.Print "        Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN

End Sub


Public Sub ImprimeFacturaNEmpresa13(RsImpresion As Recordset, Empresa As String, Optional tTipoDoc As String)
                    ximprimeDetallado = Calcular("select lImprimeresumen as codigo from ttipodocumentoimpresora where ttipoemision='" & tTipoDoc & "' and  tcaja='" & sCaja & "'", Cn)

                 For i = 1 To nCabecera
                     Printer.Print
                 Next i
                    'Printer.Print " "
                    'Printer.Print " "
                    'Printer.Print " "
                    Printer.Print String(12, " ") & Left(Mid(RsImpresion!Cliente, 1, 60) & String(60, " "), 66)
                    Printer.Print String(12, " ") & Left(Mid(RsImpresion!direccion, 1, 60) & String(60, " "), 66)
                    Printer.Print String(12, " ") & Left(Mid(RsImpresion!Ruc, 1, 60) & String(60, " "), 66)
                    Printer.Print String(12, " ") & Left(Mid(RsImpresion!Mesa, 1, 30) & String(30, " "), 36) & " " & "Mz: " & RsImpresion!Mozo
                    Printer.Print " "
                    
                 For i = 1 To nDetalle
                     Printer.Print
                 Next i
                 'Cuerpo
                 Item = "":                  i = 0:                   j = 0
                 'Cuerpo
                 Item = ""
                 Printer.Print sLinea
                 
                 Do While Not RsImpresion.EOF
                     If ximprimeDetallado = False Then
                        xproducto = RsImpresion!Producto
                    Else
                        xproducto = RsImpresion!ProductoDetallado
                    End If
                    
                    If Item <> RsImpresion!tCodigoPedido + RsImpresion!tItem Then
                       i = i + 1
                       Producto = xproducto
                       
                       sLinea = Right(String(6, " ") & Format(RsImpresion!nCantidad, "##0.00"), 6) & "    " & UCase(Mid(Producto & String(48, " "), 1, 48)) & "            " & Right(String(11, " ") & Format(RsImpresion!nprecioVenta, "##,##0.00"), 11) & " " & Right(String(14, " ") & Format(RsImpresion!nCantidad * RsImpresion!nprecioVenta, "#,###,##0.00"), 14)
                       Printer.Print sLinea
                    End If
                    
                    Item = RsImpresion!tCodigoPedido + RsImpresion!tItem
                    RsImpresion.MoveNext
                 Loop

                    For j = i To nFItem
                        Printer.Print " "
                    Next j
                            
                 Printer.Print
                 RsImpresion.MoveLast
                 Printer.Print "        Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
                 Printer.Print " "
                 Printer.Print " "
                 
                    sImportes = Right(String(20, " ") & Format(RsImpresion!nNeto, "##,###,##0.00"), 20)
                    sImportes1 = Right(String(12, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,##0.00"), 12)
                    sImportes2 = Right(String(12, " ") & Format(RsImpresion!nprecioImpuesto2, "##,###,##0.00"), 12)
                    sImportes3 = Right(String(20, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 20)
                    Printer.Print String(76, " ") & sImportes
                    'Printer.Print String(80, " ") & Format(nPorcentaje1, "##0") & "% " & sImportes1
                    'Printer.Print String(6, " ") & Format(RsImpresion!fRegistro, " dd" & "    " & " MMMM" & "        " & " yyyy ") & String(45, " ") & Format(nPorcentaje2, "##0") & "% " & sImportes2
                    Printer.Print String(84, " ") & sImportes1
                    Printer.Print String(6, " ") & Format(RsImpresion!fRegistro, " dd" & "    " & " MMMM" & "        " & " yyyy ") & String(48, " ") & sImpuesto2 & " " & sImportes2
                    Printer.Print String(76, " ") & sImportes3
 

End Sub


Public Sub ImprimeFacturaConsumoN(ByVal RsImpresion As Recordset, ByVal sConsumo As String, ByVal Empresa As String)
    On Error Resume Next
    Dim Item As String
    Dim sLinea As String
    Dim i As Integer
    Dim j As Integer
    Dim txt As String
    Dim lin As String
    Dim tOt As Integer
    Dim pos As Integer
    Dim pri As Boolean
        
    'Cabecera
    Printer.PaperSize = vbPRPSUser
    Printer.Orientation = vbPRORPortrait
    RsImpresion.MoveFirst
    
    Select Case Empresa
           Case Is = "001" ' Bohemia
                 For i = 1 To nCabecera
                     Printer.Print
                 Next i
           
                 Printer.Print "             Fecha Emision : " & Format(RsImpresion!fRegistro, "dd MMMM yyyy")
                 Printer.Print "             " & RsImpresion!tDocumento
                 Printer.Print
                 Printer.Print "               " & Mid(RsImpresion!Cliente & String(60, " "), 1, 60)
                 Printer.Print "               " & Mid(RsImpresion!direccion & String(48, " "), 1, 48) & "RUC : " & RsImpresion!Ruc
                 For i = 1 To nDetalle
                     Printer.Print
                 Next i

                 'Cuerpo
                 txt = sConsumo
                 tOt = Len(Trim(txt))
                 pri = True
                 j = 0
                 Do While tOt <> 0
                    j = j + 1
                    lin = Mid(txt & " ", 1, 50)
                    For i = 50 To 1 Step -1
                        If Mid(lin, i, 1) = " " Then
                           pos = i
                           Exit For
                        End If
                    Next i
                    If pri Then
                       sLinea = "         " & Mid(Mid(txt, 1, pos - 1) & String(56, " "), 1, 56) & " " & Right(String(12, " ") & Format(RsImpresion!nVenta, "#,###,##0.00"), 12)
                       pri = False
                    Else
                       sLinea = "         " & Mid(txt, 1, pos - 1)
                    End If
                    txt = Mid(txt, pos + 1, tOt)
                    tOt = Len(txt)
                    Printer.Print sLinea
                 Loop
                    
                 For i = j To nFItem - 1
                     Printer.Print " "
                 Next i
                 
                 RsImpresion.MoveLast
                 Printer.Print
                 If sResumen Then
                    Printer.Print "        Pedido  : " & sPedido
                    Printer.Print "        Mesero    : " & RsImpresion!Mozo
                    Printer.Print "        Caja    : " & RsImpresion!tCaja & " - " & RsImpresion!tUsuario
                    Printer.FontBold = True
                    Printer.Print "        MESA    : " & IIf((RsImpresion!tMesa = "000" Or Len(Trim(RsImpresion!tMesa)) = 0 Or IsNull(RsImpresion!tMesa)), RsImpresion!tObservacion, RsImpresion!Mesa) & " Mesero : " & RsImpresion!Mozo
                    Printer.FontBold = False
                 Else
                    Printer.Print ""
                    Printer.Print ""
                    Printer.Print ""
                    Printer.Print ""
                 End If
                     
                 Printer.Print "        Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
                 
                 If RsImpresion!nRecargo > 0 Then
                    Printer.Print Right(String(61, " ") & "Recargo : ", 61) & "    " & Right(String(13, " ") & Format(RsImpresion!nRecargo, "##,###,##0.00"), 13)
                 Else
                    Printer.Print
                 End If
                     
                 If RsImpresion!nDescuento > 0 Then
                    Printer.Print Right(String(61, " ") & "Descuento : ", 61) & "    " & Right(String(13, " ") & Format(RsImpresion!nDescuento, "##,###,##0.00"), 13)
                 Else
                    Printer.Print
                 End If
                 'Humberto 15/10/2008, se agrego la condición para saber si se debe o no imprimir el impuesto
                 'CESAR
                 If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
                     Printer.Print Right(String(64, " ") & "Valor Venta :", 64) & Right(String(13, " ") & Format(RsImpresion!nNeto, "##,###,##0.00"), 13)
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                    If RsImpresion!nprecioImpuesto1 > 0 Then
                        Printer.Print Right(String(64, " ") & sImpuesto1 & " " & Format(nPorcentaje1, "##0.00") & "% :", 64) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,##0.00"), 13)
                    End If
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                    If RsImpresion!nprecioImpuesto2 > 0 Then
                        Printer.Print Right(String(64, " ") & sImpuesto2 & " " & Format(nPorcentaje2, "##0.00") & "% :", 64) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto2, "##,###,##0.00"), 13)
                    End If
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                    If RsImpresion!nprecioImpuesto3 > 0 Then
                        Printer.Print Right(String(64, " ") & sImpuesto3 & " " & Format(nPorcentaje3, "##0.00") & "% :", 64) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto3, "##,###,##0.00"), 13)
                    End If
                 End If
                 'Humberto 15/10/2008, fin
                 Printer.Print Right(String(64, " ") & "Total :", 64) & Right(String(13, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 13)
                 '====================== nov 2010
                If lDocumEquivaPrecuenta Then
                     Printer.Print " "
                    Printer.Print Right(String(64, " ") & "Total " & sMonE & " :", 64) & Right(String(13, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 13)
                End If
                '====================== nov 2010
           Case Is = "002" 'Brujas
                 For i = 1 To nCabecera
                     Printer.Print
                 Next i
                    
                 Printer.Print String(58, " ") & "   Pedido : " & sPedido
                 Printer.Print "            " & Mid(RsImpresion!tDocumento & String(45, " "), 1, 45) & "    Caja   : " & RsImpresion!tCaja & " - " & RsImpresion!tUsuario
                 Printer.Print "            " & Mid(RsImpresion!Cliente & String(60, " "), 1, 60)
                 Printer.Print "            " & Mid(RsImpresion!direccion & String(60, " "), 1, 60)
                 Printer.Print "            " & Mid(RsImpresion!Ruc & String(49, " "), 1, 49) & Format(RsImpresion!fRegistro, "dd MMMM yyyy")
                 Printer.Print String(51, " ") & "          Mesa   : " & IIf(RsImpresion!tMesa = "000" Or Len(Trim((RsImpresion!tMesa))) = 0, RsImpresion!tObservacion, RsImpresion!Mesa)
                 
                 For i = 1 To nDetalle
                     Printer.Print
                 Next i
                    
                 'Cuerpo
                 Printer.Print
                 txt = sConsumo
                 tOt = Len(Trim(txt))
                 pri = True
                 j = 0
                 Do While tOt <> 0
                    j = j + 1
                    lin = Mid(txt & " ", 1, 50)
                    For i = 50 To 1 Step -1
                        If Mid(lin, i, 1) = " " Then
                           pos = i
                           Exit For
                        End If
                    Next i
                    If pri Then
                       sLinea = "                   " & Mid(Mid(txt, 1, pos - 1) & String(56, " "), 1, 56) & "        " & Right(String(12, " ") & Format(RsImpresion!nVenta, "#,###,##0.00"), 12)
                       pri = False
                    Else
                       sLinea = "                   " & Mid(txt, 1, pos - 1)
                    End If
                    txt = Mid(txt, pos + 1, tOt)
                    tOt = Len(txt)
                    Printer.Print sLinea
                 Loop
                    
                 For i = j To nFItem - 1
                     Printer.Print " "
                 Next i
                 
                 RsImpresion.MoveLast
                 Printer.Print
                 RsImpresion.MoveLast
                 Printer.Print "                  Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
                 If RsImpresion!nRecargo > 0 Then
                    Printer.Print Right(String(82, " ") & "Recargo : ", 64) & Right(String(13, " ") & Format(RsImpresion!nRecargo, "##,###,##0.00"), 13)
                 Else
                    Printer.Print
                 End If
                     
                 If RsImpresion!nDescuento > 0 Then
                    Printer.Print Right(String(82, " ") & "Descuento : ", 64) & Right(String(13, " ") & Format(RsImpresion!nDescuento, "##,###,##0.00"), 13)
                 Else
                    Printer.Print
                 End If
                 
                 Printer.Print ""
                 'Humberto 15/10/2008, se agrego la condición para saber si se debe o no imprimir el impuesto
                 If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
                     Printer.Print String(82, " ") & Right(String(13, " ") & Format(RsImpresion!nNeto, "##,###,##0.00"), 13)
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                    If RsImpresion!nprecioImpuesto1 > 0 Then
                        Printer.Print String(82, " ") & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,##0.00"), 13)
                    Else
                        Printer.Print ""
                    End If
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                    If RsImpresion!nprecioImpuesto2 > 0 Then
                        Printer.Print String(82, " ") & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto2, "##,###,##0.00"), 13)
                    Else
                        Printer.Print ""
                    End If
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                    If RsImpresion!nprecioImpuesto3 > 0 Then
                        Printer.Print String(82, " ") & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto3, "##,###,##0.00"), 13)
                    Else
                        Printer.Print ""
                    End If
                 End If
                 'Humberto 15/10/2008, FIN
                 Printer.Print String(82, " ") & Right(String(13, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 13)
                   '====================== nov 2010
                    If lDocumEquivaPrecuenta Then
                         Printer.Print " "
                        Printer.Print Right(String(82, " ") & "Total " & sMonE & " :", 82) & Right(String(13, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 13)
                    End If
                    '====================== nov 2010
           Case Is = "003"       ' Rodrigo
                 For i = 1 To nCabecera
                     Printer.Print
                 Next i
                 
                 Printer.Print "      Fecha de Emisión : " & Format(RsImpresion!fRegistro, "dd MMMM yyyy")
                 Printer.Print "      Documento        : " & RsImpresion!tDocumento
                 Printer.Print "      Cliente          : " & RsImpresion!Cliente
                 Printer.Print "      Dirección        : " & RsImpresion!direccion
                 Printer.Print "      RUC              : " & RsImpresion!Ruc
                 
                 Printer.Print ""
                 
                 Printer.Print "      Pedido           : " & sPedido
                 Printer.Print "      Mesero             : " & RsImpresion!Mozo
                 Printer.Print "      Caja             : " & RsImpresion!tCaja & " - " & RsImpresion!tUsuario
                 Printer.FontBold = True
                 Printer.Print "      MESA             : " & IIf((RsImpresion!tMesa = "000" Or Len(Trim(RsImpresion!tMesa)) = 0 Or IsNull(RsImpresion!tMesa)), RsImpresion!tObservacion, RsImpresion!Mesa)
                 Printer.FontBold = False
                                                 
                 For i = 1 To nDetalle
                     Printer.Print
                 Next i
           
                 'Cuerpo
                 Printer.Print
                 txt = sConsumo
                 tOt = Len(Trim(txt))
                 pri = True
                 j = 0
                 Do While tOt <> 0
                    j = j + 1
                    lin = Mid(txt & " ", 1, 50)
                    For i = 50 To 1 Step -1
                        If Mid(lin, i, 1) = " " Then
                           pos = i
                           Exit For
                        End If
                    Next i
                    If pri Then
                       sLinea = "                   " & Mid(Mid(txt, 1, pos - 1) & String(56, " "), 1, 56) & "        " & Right(String(12, " ") & Format(RsImpresion!nVenta, "#,###,##0.00"), 12)
                       pri = False
                    Else
                       sLinea = "                   " & Mid(txt, 1, pos - 1)
                    End If
                    txt = Mid(txt, pos + 1, tOt)
                    tOt = Len(txt)
                    Printer.Print sLinea
                 Loop
                    
                 For i = j To nFItem - 1
                     Printer.Print " "
                 Next i
                 
                 RsImpresion.MoveLast
                 Printer.Print
                 RsImpresion.MoveLast
                 Printer.Print "                  Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
                 If RsImpresion!nRecargo > 0 Then
                    Printer.Print Right(String(82, " ") & "Recargo : ", 64) & Right(String(13, " ") & Format(RsImpresion!nRecargo, "##,###,##0.00"), 13)
                 Else
                    Printer.Print
                 End If
                     
                 If RsImpresion!nDescuento > 0 Then
                    Printer.Print Right(String(82, " ") & "Descuento : ", 64) & Right(String(13, " ") & Format(RsImpresion!nDescuento, "##,###,##0.00"), 13)
                 Else
                    Printer.Print
                 End If
                 
                 Printer.Print ""
                 'Humberto 15/10/2008, se agrego la condición para saber si se debe o no imprimir el impuesto
                 'CESAR
                 If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
                    Printer.Print Right(String(82, " ") & "Valor Venta :", 82) & Right(String(13, " ") & Format(RsImpresion!nNeto, "##,###,##0.00"), 13)
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                    If RsImpresion!nprecioImpuesto1 > 0 Then
                        Printer.Print Right(String(82, " ") & sImpuesto1 & " " & Format(nPorcentaje1, "##0.00") & "% :", 82) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,##0.00"), 13)
                    End If
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                    If RsImpresion!nprecioImpuesto2 > 0 Then
                        Printer.Print Right(String(82, " ") & sImpuesto2 & " " & Format(nPorcentaje2, "##0.00") & "% :", 82) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto2, "##,###,##0.00"), 13)
                    End If
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                    If RsImpresion!nprecioImpuesto3 > 0 Then
                        Printer.Print Right(String(82, " ") & sImpuesto3 & " " & Format(nPorcentaje3, "##0.00") & "% :", 82) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto3, "##,###,##0.00"), 13)
                    End If
                 End If
                 'Humberto 15/10/2008, FIN
                 Printer.Print Right(String(82, " ") & "Total :", 82) & Right(String(13, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 13)
                 '====================== nov 2010
                If lDocumEquivaPrecuenta Then
                     Printer.Print " "
                    Printer.Print Right(String(82, " ") & "Total " & sMonE & " :", 82) & Right(String(13, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 13)
                End If
                '====================== nov 2010
           Case Is = "005"       ' Ancel
                 For i = 1 To nCabecera
                     Printer.Print
                 Next i
                 
                 Printer.Print "         " & RsImpresion!tDocumento
                 Printer.Print
                 Printer.Print
                 Printer.Print "    " & Mid(Format(RsImpresion!fRegistro, "dd    MMMM ") & String(15, " "), 1, 15) & "          " & Format(RsImpresion!fRegistro, "yy")
                 Printer.Print
                 Printer.Print "         " & Mid(RsImpresion!Cliente & String(65, " "), 1, 65) & RsImpresion!Ruc
                 Printer.Print
                 Printer.Print "         " & Mid(RsImpresion!direccion & String(26, " "), 1, 26)
                 For i = 1 To nDetalle
                     Printer.Print
                 Next i
                 
                 'Cuerpo
                 Printer.Print
                 txt = sConsumo
                 tOt = Len(Trim(txt))
                 pri = True
                 j = 0
                 Do While tOt <> 0
                    j = j + 1
                    lin = Mid(txt & " ", 1, 45)
                    For i = 45 To 1 Step -1
                        If Mid(lin, i, 1) = " " Then
                           pos = i
                           Exit For
                        End If
                    Next i
                    If pri Then
                       sLinea = "              " & Mid(Mid(txt, 1, pos - 1) & String(45, " "), 1, 45) & "                " & Right(String(12, " ") & Format(RsImpresion!nVenta, "#,###,##0.00"), 12)
                       pri = False
                    Else
                       sLinea = "              " & Mid(txt, 1, pos - 1)
                    End If
                    txt = Mid(txt, pos + 1, tOt)
                    tOt = Len(txt)
                    Printer.Print sLinea
                 Loop
                    
                 For i = j To nFItem - 1
                     Printer.Print " "
                 Next i
                 
                 RsImpresion.MoveLast
                 If RsImpresion!nRecargo > 0 Then
                    Printer.Print Right(String(74, " ") & "Recargo : ", 74) & Right(String(13, " ") & Format(RsImpresion!nRecargo, "##,###,##0.00"), 13)
                 Else
                    Printer.Print
                 End If
                     
                 If RsImpresion!nDescuento > 0 Then
                    Printer.Print Right(String(74, " ") & "Descuento : ", 74) & Right(String(13, " ") & Format(RsImpresion!nDescuento, "##,###,##0.00"), 13)
                 Else
                    Printer.Print
                 End If
                 
                 'Humberto 15/10/2008, se agrego la condición para saber si se debe o no imprimir el impuesto
                 'CESAR
                 If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
                    Printer.Print Right(String(74, " ") & "Valor Venta :", 74) & Right(String(13, " ") & Format(RsImpresion!nNeto, "##,###,##0.00"), 13)
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                    If RsImpresion!nprecioImpuesto1 > 0 Then
                        Printer.Print Right(String(74, " ") & sImpuesto1 & " " & Format(nPorcentaje1, "##0.00") & "% :", 74) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,##0.00"), 13)
                     End If
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                    If RsImpresion!nprecioImpuesto2 > 0 Then
                        Printer.Print Right(String(74, " ") & sImpuesto2 & " " & Format(nPorcentaje2, "##0.00") & "% :", 74) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto2, "##,###,##0.00"), 13)
                    End If
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                    If RsImpresion!nprecioImpuesto3 > 0 Then
                        Printer.Print Right(String(74, " ") & sImpuesto3 & " " & Format(nPorcentaje3, "##0.00") & "% :", 74) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto3, "##,###,##0.00"), 13)
                    End If
                 End If
                 'Humberto 15/10/2008, FIN
                 Printer.Print Right(String(74, " ") & "Total :", 74) & Right(String(13, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 13)
                   '====================== nov 2010
                If lDocumEquivaPrecuenta Then
                     Printer.Print " "
                    Printer.Print Right(String(74, " ") & "Total " & sMonE & " :", 74) & Right(String(13, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 13)
                End If
                '====================== nov 2010
                 Printer.Print "      " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
    
           Case Is = "006"       ' Atlantic
                 For i = 1 To nCabecera
                     Printer.Print
                 Next i
                 
                 Printer.Print "   Documento        : " & RsImpresion!tDocumento
                 Printer.Print "   Fecha de Emisión : " & Format(RsImpresion!fRegistro, "dd MMMM yyyy") & "                  RUC     : " & RsImpresion!Ruc
                 Printer.Print "   Cliente          : " & RsImpresion!Cliente
                 Printer.Print "   Dirección        : " & RsImpresion!direccion
                 Printer.Print "   Pedido           : " & sPedido
                 Printer.Print Mid("   Caja             : " & RsImpresion!tCaja & " - " & RsImpresion!tUsuario & String(53, " "), 1, 53) & "Mozo    : " & RsImpresion!Mozo
                 Printer.Print "   MESA             : " & IIf((RsImpresion!tMesa = "000" Or Len(Trim(RsImpresion!tMesa)) = 0 Or IsNull(RsImpresion!tMesa)), RsImpresion!tObservacion, RsImpresion!Mesa)
                 For i = 1 To nDetalle
                     Printer.Print
                 Next i
                 
                 'Cuerpo
                 Printer.Print
                 txt = sConsumo
                 tOt = Len(Trim(txt))
                 pri = True
                 j = 0
                 Do While tOt <> 0
                    j = j + 1
                    lin = Mid(txt & " ", 1, 45)
                    For i = 45 To 1 Step -1
                        If Mid(lin, i, 1) = " " Then
                           pos = i
                           Exit For
                        End If
                    Next i
                    If pri Then
                       sLinea = "              " & Mid(Mid(txt, 1, pos - 1) & String(45, " "), 1, 45) & "                " & Right(String(12, " ") & Format(RsImpresion!nVenta, "#,###,##0.00"), 12)
                       pri = False
                    Else
                       sLinea = "              " & Mid(txt, 1, pos - 1)
                    End If
                    txt = Mid(txt, pos + 1, tOt)
                    tOt = Len(txt)
                    Printer.Print sLinea
                 Loop
                    
                 For i = j To nFItem - 1
                     Printer.Print " "
                 Next i
                 
                 RsImpresion.MoveLast
                 If RsImpresion!nRecargo > 0 Then
                    Printer.Print Right(String(77, " ") & "Recargo : ", 77) & Right(String(17, " ") & Format(RsImpresion!nRecargo, "##,###,###,##0.00"), 17)
                 Else
                    Printer.Print
                 End If
                     
                 If RsImpresion!nDescuento > 0 Then
                    Printer.Print Right(String(77, " ") & "Descuento : ", 77) & Right(String(17, " ") & Format(RsImpresion!nDescuento, "##,###,###,##0.00"), 17)
                 Else
                    Printer.Print
                 End If
                 
                 'Humberto 15/10/2008, se agrego la condición para saber si se debe o no imprimir el impuesto
                 If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
                    Printer.Print Right(String(77, " ") & "Valor Venta :", 77) & Right(String(17, " ") & Format(RsImpresion!nNeto, "##,##,###,##0.00"), 17)
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                    If RsImpresion!nprecioImpuesto1 > 0 Then
                       Printer.Print Right(String(77, " ") & sImpuesto1 & " " & Format(nPorcentaje1, "##0.00") & "% :", 77) & Right(String(17, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,###,##0.00"), 17)
                    End If
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                    If RsImpresion!nprecioImpuesto2 > 0 Then
                        Printer.Print Right(String(77, " ") & sImpuesto2 & " " & Format(nPorcentaje2, "##0.00") & "% :", 77) & Right(String(17, " ") & Format(RsImpresion!nprecioImpuesto2, "##,##,###,##0.00"), 17)
                    End If
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                    If RsImpresion!nprecioImpuesto3 > 0 Then
                        Printer.Print Right(String(77, " ") & sImpuesto3 & " " & Format(nPorcentaje3, "##0.00") & "% :", 77) & Right(String(17, " ") & Format(RsImpresion!nprecioImpuesto3, "##,##,###,##0.00"), 17)
                    End If
                 End If
                 'Humberto 15/10/2008, FIN
                 Printer.Print Right(String(77, " ") & "Total " & sMonN & " : ", 77) & Right(String(17, " ") & Format(RsImpresion!nVenta, "##,##,###,##0.00"), 17)
                   '====================== nov 2010
                If lDocumEquivaPrecuenta Then
                     Printer.Print " "
                    Printer.Print Right(String(77, " ") & "Total " & sMonE & " :", 77) & Right(String(17, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 17)
                End If
                
                If Calcular(" SELECT case when  lImpresionRetencion=1 then 1 else 0 end  as codigo FROM vTipodocumento WHERE Codigo=(SELECT TTIPODOCUMENTO FROM MDOCUMENTO WHERE tDocumento='" & RsImpresion!tDocumento & "')", Cn) = 1 Then
                    Printer.Print tTextoAgenteRetencion
                End If
                '====================== nov 2010
                 Printer.Print UCase("SON: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN)
    
           Case Is = "007" ' DUZKA
                 For i = 1 To nCabecera
                     Printer.Print
                 Next i
            
                 Printer.Print "         " & Mid(RsImpresion!Cliente, 1, 50)
                 Printer.Print "         " & Mid(RsImpresion!direccion, 1, 50)
                 Printer.Print "         " & RsImpresion!Ruc & "                      " & RsImpresion!tDocumento
                 Printer.Print
                 Printer.Print "                                                                   " & Day(RsImpresion!fRegistro) & "    " & Format(RsImpresion!fRegistro, "MMM") & "    " & Year(RsImpresion!fRegistro)
                 
                 For i = 1 To nDetalle
                     Printer.Print
                 Next i
                 
                 'Cuerpo
                 Printer.Print
                 txt = sConsumo
                 tOt = Len(Trim(txt))
                 pri = True
                 j = 0
                 Do While tOt <> 0
                    j = j + 1
                    lin = Mid(txt & " ", 1, 45)
                    For i = 45 To 1 Step -1
                        If Mid(lin, i, 1) = " " Then
                           pos = i
                           Exit For
                        End If
                    Next i
                    If pri Then
                       sLinea = "              " & Mid(Mid(txt, 1, pos - 1) & String(45, " "), 1, 45) & "                    " & Right(String(12, " ") & Format(RsImpresion!nVenta, "#,###,##0.00"), 12)
                       pri = False
                    Else
                       sLinea = "              " & Mid(txt, 1, pos - 1)
                    End If
                    txt = Mid(txt, pos + 1, tOt)
                    tOt = Len(txt)
                    Printer.Print sLinea
                 Loop
                    
                 For i = j To nFItem - 1
                     Printer.Print " "
                 Next i
            
                 Printer.Print
                 RsImpresion.MoveLast
                 
                 Printer.Print "        Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
                 If RsImpresion!nRecargo > 0 Then
                    Printer.Print Right(String(64, " ") & "Recargo : ", 64) & Right(String(13, " ") & Format(RsImpresion!nRecargo, "##,###,##0.00"), 13)
                 Else
                    Printer.Print
                 End If
                     
                 If RsImpresion!nDescuento > 0 Then
                    Printer.Print Right(String(64, " ") & "Descuento : ", 64) & Right(String(13, " ") & Format(RsImpresion!nDescuento, "##,###,##0.00"), 13)
                 Else
                    Printer.Print
                 End If
    
                 'Humberto 15/10/2008, se agrego la condición para saber si se debe o no imprimir el impuesto
                 If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
                     Printer.Print Right(String(78, " "), 78) & Right(String(13, " ") & Format(RsImpresion!nNeto, "##,###,##0.00"), 13)
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                    If RsImpresion!nprecioImpuesto1 > 0 Then
                        Printer.Print Right(String(78, " "), 78) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,##0.00"), 13)
                    End If
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                    If RsImpresion!nprecioImpuesto2 > 0 Then
                        Printer.Print Right(String(78, " "), 78) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto2, "##,###,##0.00"), 13)
                    End If
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                    If RsImpresion!nprecioImpuesto3 > 0 Then
                        Printer.Print Right(String(78, " "), 78) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto3, "##,###,##0.00"), 13)
                    End If
                 End If
                 'Humberto 15/10/2008, fin
                 Printer.Print Right(String(78, " "), 78) & Right(String(13, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 13)
                   '====================== nov 2010
                If lDocumEquivaPrecuenta Then
                     Printer.Print " "
                    Printer.Print Right(String(78, " ") & "Total " & sMonE & " :", 78) & Right(String(13, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 13)
                End If
                '====================== nov 2010
            Case Is = "008" 'Herve
                 For i = 1 To nCabecera
                     Printer.Print
                 Next i
                 Printer.Print "         " & RsImpresion!tDocumento
                 Printer.Print " "
                 Printer.Print "           " & Day(RsImpresion!fRegistro) & "     " & Format(RsImpresion!fRegistro, "MMMM") & "              " & Year(RsImpresion!fRegistro)
                 
                 Printer.Print
                 Printer.Print "         " & Mid(RsImpresion!Cliente & String(60, " "), 1, 60) & "   " & RsImpresion!Ruc
                 Printer.Print "         " & Mid(RsImpresion!direccion & String(46, " "), 1, 46)
                 For i = 1 To nDetalle
                     Printer.Print
                 Next i
                 
                 'Cuerpo
                 Item = ""
                 i = 0
                 j = 0
                 
                'Cuerpo
                Printer.Print
                 txt = sConsumo
                 tOt = Len(Trim(txt))
                 pri = True
                 j = 0
                 Do While tOt <> 0
                    j = j + 1
                    lin = Mid(txt & " ", 1, 45)
                    For i = 45 To 1 Step -1
                        If Mid(lin, i, 1) = " " Then
                           pos = i
                           Exit For
                        End If
                    Next i
                    If pri Then
                       sLinea = "              " & Mid(Mid(txt, 1, pos - 1) & String(45, " "), 1, 45) & "                    " & Right(String(12, " ") & Format(RsImpresion!nVenta, "#,###,##0.00"), 6)
                       pri = False
                    Else
                       sLinea = "              " & Mid(txt, 1, pos - 1)
                    End If
                    txt = Mid(txt, pos + 1, tOt)
                    tOt = Len(txt)
                    Printer.Print sLinea
                 Loop
                
                 For j = i To nFItem
                     Printer.Print " "
                 Next j
                 
                 Printer.Print
                 RsImpresion.MoveLast
                 If sResumen Then
                    Printer.Print "        Pedido  : " & sPedido
                    Printer.Print "        Mesero    : " & RsImpresion!Mozo
                    Printer.Print "        Caja    : " & RsImpresion!tCaja & " - " & RsImpresion!tUsuario
                    Printer.FontBold = True
                    Printer.Print "        MESA    : " & IIf((RsImpresion!tMesa = "000" Or Len(Trim(RsImpresion!tMesa)) = 0 Or IsNull(RsImpresion!tMesa)), RsImpresion!tObservacion, RsImpresion!Mesa) & " Mesero : " & RsImpresion!Mozo
                    Printer.FontBold = False
                 Else
                    Printer.Print " "
                    Printer.Print " "
                    Printer.Print " "
                    Printer.Print " "
                 End If
                 
                 Printer.Print "       " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
                 If RsImpresion!nRecargo > 0 Then
                    Printer.Print Right(String(64, " ") & "Recargo : ", 64) & Right(String(13, " ") & Format(RsImpresion!nRecargo, "##,###,##0.00"), 13)
                    Printer.Print " "
                 Else
                    Printer.Print
                 End If
                     
                 If RsImpresion!nDescuento > 0 Then
                    Printer.Print Right(String(64, " ") & "Descuento : ", 64) & Right(String(13, " ") & Format(RsImpresion!nDescuento, "##,###,##0.00"), 13)
                 Else
                    Printer.Print
                 End If
                 'Humberto 15/10/2008, se agrego la condición para saber si se debe o no imprimir el impuesto
                 If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
                    Printer.Print String(74, " ") & Right(String(13, " ") & Format(RsImpresion!nNeto, "##,###,##0.00"), 13)
                    Printer.Print " "
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                    If RsImpresion!nprecioImpuesto2 > 0 Then
                        Printer.Print Right(String(74, " ") & Format(nPorcentaje2, "##0.00"), 74) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto2, "##,###,##0.00"), 13)
                        Printer.Print " "
                    Else
                        Printer.Print " "
                        Printer.Print " "
                    End If
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                    If RsImpresion!nprecioImpuesto1 > 0 Then
                        Printer.Print Right(String(74, " ") & Format(nPorcentaje1, "##0.00"), 74) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,##0.00"), 13)
                        Printer.Print " "
                    Else
                        Printer.Print " "
                        Printer.Print " "
                    End If
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                    If RsImpresion!nprecioImpuesto3 > 0 Then
                        Printer.Print Right(String(74, " ") & Format(nPorcentaje3, "##0.00"), 74) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto3, "##,###,##0.00"), 13)
                        Printer.Print " "
                    Else
                        Printer.Print " "
                        Printer.Print " "
                    End If
                Else
                 End If
                 'Humberto 15/10/2008, FIN
                 Printer.Print String(74, " ") & Right(String(13, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 13)
                               '====================== nov 2010
                If lDocumEquivaPrecuenta Then
                     Printer.Print " "
                    Printer.Print Right(String(74, " ") & "Total " & sMonE & " :", 74) & Right(String(13, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 13)
                End If
                '====================== nov 2010
         Case Is = "009" 'La Gloria
                 For i = 1 To nCabecera
                     Printer.Print
                 Next i
                 Printer.Print "  " & Mid(Format(RsImpresion!fRegistro, "dd    MMMM ") & String(20, " "), 1, 20) & "   " & Format(RsImpresion!fRegistro, "yyyy")
                 Printer.Print "      " & Mid(RsImpresion!Cliente & String(65, " "), 1, 65) & "  Doc.: " & RsImpresion!tDocumento
                 Printer.Print "      " & Mid(RsImpresion!Ruc & String(65, " "), 1, 65) & "  Mesero: " & RsImpresion!Mozo
                 Printer.Print "      " & Mid(RsImpresion!direccion & String(65, " "), 1, 65); "  Caja: " & RsImpresion!tCaja & " - " & RsImpresion!tUsuario
                 
                 For i = 1 To nDetalle
                     Printer.Print
                 Next i
                 
                 'Cuerpo
                 Printer.Print
                 txt = sConsumo
                 tOt = Len(Trim(txt))
                 pri = True
                 j = 0
                 Do While tOt <> 0
                    j = j + 1
                    lin = Mid(txt & " ", 1, 45)
                    For i = 45 To 1 Step -1
                        If Mid(lin, i, 1) = " " Then
                           pos = i
                           Exit For
                        End If
                    Next i
                    If pri Then
                       sLinea = "              " & Mid(Mid(txt, 1, pos - 1) & String(45, " "), 1, 45) & "                    " & Right(String(12, " ") & Format(RsImpresion!nVenta, "#,###,##0.00"), 12)
                       pri = False
                    Else
                       sLinea = "              " & Mid(txt, 1, pos - 1)
                    End If
                    txt = Mid(txt, pos + 1, tOt)
                    tOt = Len(txt)
                    Printer.Print sLinea
                 Loop
                    
                 For i = j To nFItem - 1
                     Printer.Print " "
                 Next i
            
                 Printer.Print
                 RsImpresion.MoveLast
                 
                                                                    
                 Printer.Print "Son " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
                 RsImpresion.MoveLast
                 If RsImpresion!nRecargo > 0 Then
                    Printer.Print Right(String(68, " ") & "Recargo : ", 68) & Right(String(17, " ") & Format(RsImpresion!nRecargo, "##,###,###,##0.00"), 17)
                 Else
                    Printer.Print
                 End If
                     
                 If RsImpresion!nDescuento > 0 Then
                    Printer.Print Right(String(68, " ") & "Descuento : ", 68) & Right(String(17, " ") & Format(RsImpresion!nDescuento, "##,###,###,##0.00"), 17)
                 Else
                    Printer.Print
                 End If
                                  
                 'Humberto 15/10/2008, se agrego la condición para saber si se debe o no imprimir el impuesto
                 'NETO
                 If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
                     Printer.Print Right(String(91, " ") & Format(RsImpresion!nNeto, "##,##,###,##0.00"), 91)
                     'Printer.Print " "
                     Printer.Print "                     " & Day(RsImpresion!fRegistro) & "      " & Format(RsImpresion!fRegistro, "MMM") & "                 " & Year(RsImpresion!fRegistro)
                 End If
                 
                 If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                    If RsImpresion!nprecioImpuesto1 > 0 Then
                        Printer.Print Right(String(79, " ") & Format(nPorcentaje1, "##0.00") & "% ", 79) & Right(String(17, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,###,##0.00"), 12)
                        Printer.Print
                    End If
                 End If
                 
                 If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                    If RsImpresion!nprecioImpuesto2 > 0 Then
                        Printer.Print Right(String(79, " ") & Format(nPorcentaje2, "##0.00") & "% ", 79) & Right(String(17, " ") & Format(RsImpresion!nprecioImpuesto2, "##,##,###,##0.00"), 12)
                        Printer.Print
                    End If
                 End If
                 
                 If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                    If RsImpresion!nprecioImpuesto3 > 0 Then
                        Printer.Print Right(String(79, " ") & Format(nPorcentaje3, "##0.00") & "% ", 79) & Right(String(17, " ") & Format(RsImpresion!nprecioImpuesto3, "##,##,###,##0.00"), 12)
                        Printer.Print
                    End If
                 End If
                 
                 'Humberto 15/10/2008, fin
                 Printer.Print Right(String(91, " ") & Format(RsImpresion!nVenta, "##,##,###,##0.00"), 91)
                '====================== nov 2010
                  If lDocumEquivaPrecuenta Then
                      Printer.Print " "
                      Printer.Print Right(String(91, " ") & "Total " & sMonE & " :", 91) & Right(String(13, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 13)
                  End If
                  '====================== nov 2010
           
           'LG
            Case Is = "010" ' Mangos
                 For i = 1 To nCabecera
                     Printer.Print
                 Next i
                 
                 If (RsImpresion!Cliente <> nulo) Then
                    Printer.Print "Cliente:   " & Left(Mid(RsImpresion!Cliente, 1, 60) & String(60, " "), 60) & IIf(RsImpresion!Ruc <> "", "RUC: " & RsImpresion!Ruc, "")
                    Printer.Print "Dirección: " & Left(Mid(RsImpresion!direccion, 1, 60) & String(60, " "), 60)

                 Else
                    Printer.Print ""
                    Printer.Print ""
                 End If
                 
                 Printer.Print "Fecha:     " & Format(RsImpresion!fRegistro, " dd  MMMM  yyyy ") & String(3, " ") & Left("Usuario: " & RsImpresion!tUsuario & String(50, " "), 50)
                                                
                 For i = 1 To nDetalle
                     Printer.Print
                 Next i
                 
                 'Cuerpo
                 'Printer.Print
                 txt = sConsumo
                 tOt = Len(Trim(txt))
                 pri = True
                 j = 0
                 Do While tOt <> 0
                    j = j + 1
                    lin = Mid(txt & " ", 1, 50)
                    For i = 50 To 1 Step -1
                        If Mid(lin, i, 1) = " " Then
                           pos = i
                           Exit For
                        End If
                    Next i
                    If pri Then
                       sLinea = "                " & Mid(Mid(txt, 1, pos - 1) & String(50, " "), 1, 50) & "         " & Right(String(14, " ") & Format(RsImpresion!nVenta, "#,###,##0.00"), 14)
                       pri = False
                    Else
                       sLinea = "              " & Mid(txt, 1, pos - 1)
                    End If
                    txt = Mid(txt, pos + 1, tOt)
                    tOt = Len(txt)
                    Printer.Print sLinea
                 Loop
                 
                 Printer.Print " "
                 For i = j To nFItem - 1
                     Printer.Print " "
                 Next i
                 
                 Printer.Print
                 RsImpresion.MoveLast
                 Printer.Print "              Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
                 
                 Printer.Print ""
                 Printer.Print ""

                 If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
                    sImportes = Right(String(22, " ") & "NETO " & sMonN & Format(RsImpresion!nNeto, "##,###,##0.00"), 22) & _
                                Right(String(18, " ") & UCase(sImpuesto1) & " " & sMonN & Format(RsImpresion!nprecioImpuesto1, "##,###,##0.00"), 19) & _
                                Right(String(18, " ") & UCase(sImpuesto2) & " " & sMonN & Format(RsImpresion!nprecioImpuesto2, "##,###,##0.00"), 19) & _
                                Right(String(20, " ") & "TOTAL " & sMonN & Format(RsImpresion!nVenta, "##,###,##0.00"), 21)
                    Printer.Print String(6, " ") & sImportes
                 End If
                 
 'CGMIRANDA------------------------------------------------------------------------------------
            Case Is = "011"       ' Liber
                 For i = 1 To nCabecera
                     Printer.Print
                 Next i
                 
                 Printer.Print "   Documento        : " & RsImpresion!tDocumento
                 Printer.Print "   Fecha de Emisión : " & Format(RsImpresion!fRegistro, "dd MMMM yyyy") & "                  RUC     : " & RsImpresion!Ruc
                 Printer.Print "   Cliente          : " & RsImpresion!Cliente
                 Printer.Print "   Dirección        : " & RsImpresion!direccion
                 Printer.Print "   Pedido           : " & sPedido
                 Printer.Print Mid("   Caja             : " & RsImpresion!tCaja & " - " & RsImpresion!tUsuario & String(53, " "), 1, 53) & "Mozo    : " & RsImpresion!Mozo
                 Printer.Print "   MESA             : " & IIf((RsImpresion!tMesa = "000" Or Len(Trim(RsImpresion!tMesa)) = 0 Or IsNull(RsImpresion!tMesa)), RsImpresion!tObservacion, RsImpresion!Mesa)
                 For i = 1 To nDetalle
                     Printer.Print
                 Next i
                 
                 'Cuerpo
                 Printer.Print
                 txt = sConsumo
                 tOt = Len(Trim(txt))
                 pri = True
                 j = 0
                 Do While tOt <> 0
                    j = j + 1
                    lin = Mid(txt & " ", 1, 45)
                    For i = 45 To 1 Step -1
                        If Mid(lin, i, 1) = " " Then
                           pos = i
                           Exit For
                        End If
                    Next i
                    If pri Then
                       sLinea = "              " & Mid(Mid(txt, 1, pos - 1) & String(45, " "), 1, 45) & "                " & Right(String(12, " ") & Format(RsImpresion!nVenta, "#,###,##0.00"), 12)
                       pri = False
                    Else
                       sLinea = "              " & Mid(txt, 1, pos - 1)
                    End If
                    txt = Mid(txt, pos + 1, tOt)
                    tOt = Len(txt)
                    Printer.Print sLinea
                 Loop
                    
                 For i = j To nFItem - 1
                     Printer.Print " "
                 Next i
                 
                 RsImpresion.MoveLast
                 If RsImpresion!nRecargo > 0 Then
                    Printer.Print Right(String(77, " ") & "Recargo : ", 77) & Right(String(17, " ") & Format(RsImpresion!nRecargo, "##,###,###,##0.00"), 17)
                 Else
                    Printer.Print
                 End If
                     
                 If RsImpresion!nDescuento > 0 Then
                    Printer.Print Right(String(77, " ") & "Descuento : ", 77) & Right(String(17, " ") & Format(RsImpresion!nDescuento, "##,###,###,##0.00"), 17)
                 Else
                    Printer.Print
                 End If
                 
                 'Humberto 15/10/2008, se agrego la condición para saber si se debe o no imprimir el impuesto
                 If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
                    Printer.Print Right(String(77, " ") & "Valor Venta :", 77) & Right(String(17, " ") & Format(RsImpresion!nNeto, "##,##,###,##0.00"), 17)
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                    If RsImpresion!nprecioImpuesto1 > 0 Then
                       Printer.Print Right(String(77, " ") & sImpuesto1 & " " & Format(nPorcentaje1, "##0.00") & "% :", 77) & Right(String(17, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,###,##0.00"), 17)
                    End If
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                    If RsImpresion!nprecioImpuesto2 > 0 Then
                        Printer.Print Right(String(77, " ") & sImpuesto2 & " " & Format(nPorcentaje2, "##0.00") & "% :", 77) & Right(String(17, " ") & Format(RsImpresion!nprecioImpuesto2, "##,##,###,##0.00"), 17)
                    End If
                 End If
                 If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                    If RsImpresion!nprecioImpuesto3 > 0 Then
                        Printer.Print Right(String(77, " ") & sImpuesto3 & " " & Format(nPorcentaje3, "##0.00") & "% :", 77) & Right(String(17, " ") & Format(RsImpresion!nprecioImpuesto3, "##,##,###,##0.00"), 17)
                    End If
                 End If
                 'Humberto 15/10/2008, FIN
                 Printer.Print Right(String(77, " ") & "Total " & sMonN & " : ", 77) & Right(String(17, " ") & Format(RsImpresion!nVenta, "##,##,###,##0.00"), 17)
                   '====================== nov 2010
                If lDocumEquivaPrecuenta Then
                     Printer.Print " "
                    Printer.Print Right(String(77, " ") & "Total " & sMonE & " :", 77) & Right(String(17, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 17)
                End If
                '====================== nov 2010
                 Printer.Print UCase("SON: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN)

            
            'FIN CGMIRANDA------------------------------------------------------------------------------------------------------
                  
                  
                  '--------IMPRIME FACTURA CONSUMO N---------




                'CESAR----------
                Case Is = "012" 'winebar

            
                 For i = 1 To nCabecera
                     Printer.Print
                 Next i
                
                 Printer.Print String(8, " ") & Left(Mid(RsImpresion!Cliente, 1, 60) & String(60, " "), 66) & Format(RsImpresion!fRegistro, " dd  MMMM  yyyy ") & String(3, " ")
                 Printer.Print String(8, " ") & Left(Mid(RsImpresion!direccion, 1, 60) & String(60, " "), 66)
                 Printer.Print String(8, " ") & Left(Mid(RsImpresion!Ruc, 1, 60) & String(60, " "), 66) & Left(Mid(RsImpresion!tDocumento, 1, 60) & String(60, " "), 86)
                             
                 For i = 1 To nDetalle
                     Printer.Print
                 Next i
                 
                 'Cuerpo
                 'Printer.Print
                 txt = sConsumo
                 tOt = Len(Trim(txt))
                 pri = True
                 j = 0
                 Do While tOt <> 0
                    j = j + 1
                    lin = Mid(txt & " ", 1, 50)
                    For i = 50 To 1 Step -1
                        If Mid(lin, i, 1) = " " Then
                           pos = i
                           Exit For
                        End If
                    Next i
                    If pri Then
                    
                       'Cuerpo
                       Printer.Print " "
                       sLinea = "                " & Mid(Mid(txt, 1, pos - 1) & String(50, " "), 1, 50) & "         " & Right(String(14, " ") & Format(RsImpresion!nVenta, "#,###,##0.00"), 14)
                       pri = False
                    Else
                       Printer.Print " "
                       sLinea = "              " & Mid(txt, 1, pos - 1)
                    End If
                    txt = Mid(txt, pos + 1, tOt)
                    tOt = Len(txt)
                    Printer.Print sLinea

                 Loop
                 
                 Printer.Print " "
                 For i = j To nFItem - 1
                     Printer.Print " "
                 Next i
                 
                 Printer.Print
                 RsImpresion.MoveLast
                 Printer.Print "              Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
 
                 Printer.Print ""
                 Printer.Print ""

                 If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
                     sImportes = Right(String(20, " ") & sMonN & Format(RsImpresion!nNeto, "##,###,##0.00"), 20)
                    sImportes1 = Right(String(20, " ") & "   " & sMonN & Format(RsImpresion!nprecioImpuesto2, "##,###,##0.00"), 20)
                    sImportes2 = Right(String(20, " ") & "       " & sMonN & Format(RsImpresion!nprecioImpuesto1, "##,###,##0.00"), 20)
                    sImportes3 = Right(String(20, " ") & sMonN & Format(RsImpresion!nVenta, "##,###,##0.00"), 20)
                    Printer.Print String(70, " ") & sImportes
                    Printer.Print String(70, " ") & sImportes1
                    Printer.Print String(70, " ") & sImportes2
                    Printer.Print String(70, " ") & sImportes3
                 End If


             'CESAR NINAHUANCA
              Case Is = "013" 'COSTANERA 700
                 For i = 1 To nCabecera
                     Printer.Print
                 Next i
                    Printer.Print " "
                    Printer.Print " "
                    Printer.Print " "
                    Printer.Print String(12, " ") & Left(Mid(RsImpresion!Cliente, 1, 60) & String(60, " "), 66)
                    Printer.Print String(12, " ") & Left(Mid(RsImpresion!direccion, 1, 60) & String(60, " "), 66)
                    Printer.Print String(12, " ") & Left(Mid(RsImpresion!Ruc, 1, 60) & String(60, " "), 66)
                    Printer.Print String(12, " ") & Left(Mid(RsImpresion!Mesa, 1, 30) & String(30, " "), 36) & " " & "Mz: " & RsImpresion!Mozo
                    Printer.Print " "
                 For i = 1 To nDetalle
                     Printer.Print
                 Next i
                        
                 'Cuerpo
                 'Printer.Print
                 txt = sConsumo
                 tOt = Len(Trim(txt))
                 pri = True
                 j = 0
                 Do While tOt <> 0
                    j = j + 1
                    lin = Mid(txt & " ", 1, 50)
                    For i = 50 To 1 Step -1
                        If Mid(lin, i, 1) = " " Then
                           pos = i
                           Exit For
                        End If
                    Next i
                    If pri Then
                       sLinea = "                " & Mid(Mid(txt, 1, pos - 1) & String(50, " "), 1, 50) & "                " & Right(String(14, " ") & Format(RsImpresion!nVenta, "#,###,##0.00"), 14)
                       pri = False
                    Else
                       sLinea = "              " & Mid(txt, 1, pos - 1)
                    End If
                    txt = Mid(txt, pos + 1, tOt)
                    tOt = Len(txt)
                    Printer.Print sLinea
                 Loop
                    
                 Printer.Print " "
                 For i = j To nFItem - 1
                     Printer.Print " "
                 Next i
                 
                 Printer.Print
                 RsImpresion.MoveLast
                 Printer.Print "        Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
                 Printer.Print " "
                 Printer.Print " "
                 
                    sImportes = Right(String(20, " ") & Format(RsImpresion!nNeto, "##,###,##0.00"), 20)
                    sImportes1 = Right(String(12, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,##0.00"), 12)
                    sImportes2 = Right(String(12, " ") & Format(RsImpresion!nprecioImpuesto2, "##,###,##0.00"), 12)
                    sImportes3 = Right(String(20, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 20)
                    Printer.Print String(76, " ") & sImportes
                    'Printer.Print String(80, " ") & Format(nPorcentaje1, "##0") & "% " & sImportes1
                    'Printer.Print String(6, " ") & Format(RsImpresion!fRegistro, " dd" & "    " & " MMMM" & "        " & " yyyy ") & String(45, " ") & Format(nPorcentaje2, "##0") & "% " & sImportes2
                    Printer.Print String(84, " ") & sImportes1
                    Printer.Print String(6, " ") & Format(RsImpresion!fRegistro, " dd" & "    " & " MMMM" & "        " & " yyyy ") & String(48, " ") & sImpuesto2 & " " & sImportes2
                    Printer.Print String(76, " ") & sImportes3
                  
                  
              'CESAR NINAHUANCA
              Case Is = "014" 'QUEIROLO
                 For i = 1 To nCabecera
                     Printer.Print
                 Next i
                    Printer.Print ""
                    Printer.Print String(5, " ") & Format(RsImpresion!fRegistro, "dd /" & " " & "MM /" & " " & "yyyy")
                    Printer.Print String(5, " ") & Left(Mid(RsImpresion!Cliente, 1, 46) & String(46, " "), 50) & String(24, " ") & Left(Mid(RsImpresion!Mesa, 1, 30) & String(30, " "), 36)
                    Printer.Print String(5, " ") & Left(Mid(RsImpresion!Ruc, 1, 20) & String(20, " "), 26) & String(24, " ") & Left(Mid(RsImpresion!direccion, 1, 60) & String(60, " "), 66)
                    Printer.Print ""
                    Printer.Print ""
                    
                 For i = 1 To nDetalle
                     Printer.Print
                 Next i
                        
                 'Cuerpo
                 'Printer.Print
                 txt = sConsumo
                 tOt = Len(Trim(txt))
                 pri = True
                 j = 0
                 Do While tOt <> 0
                    j = j + 1
                    lin = Mid(txt & " ", 1, 50)
                    For i = 50 To 1 Step -1
                        If Mid(lin, i, 1) = " " Then
                           pos = i
                           Exit For
                        End If
                    Next i
                    If pri Then
                       sLinea = "                " & Mid(Mid(txt, 1, pos - 1) & String(50, " "), 1, 50) & String(44, " ") & Right(String(14, " ") & Format(RsImpresion!nVenta, "#,###,##0.00"), 14)
                       pri = False
                    Else
                       sLinea = "              " & Mid(txt, 1, pos - 1)
                    End If
                    txt = Mid(txt, pos + 1, tOt)
                    tOt = Len(txt)
                    Printer.Print sLinea
                 Loop
                    
                 Printer.Print " "
                 For i = j To nFItem - 1
                     Printer.Print " "
                 Next i
                 
                 Printer.Print
                 RsImpresion.MoveLast
                    sImportes = Right(String(15, " ") & Format(RsImpresion!nNeto, "##,###,##0.00"), 15)
                    sImportes1 = Right(String(12, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,##0.00"), 12)
                    sImportes2 = Right(String(12, " ") & Format(RsImpresion!nprecioImpuesto2, "##,###,##0.00"), 12)
                    sImportes3 = Right(String(15, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 15)
                    
                    Printer.Print String(95, " ") & "SUB-TOTAL     " & sImportes
                    Printer.Print String(95, " ") & UCase(sImpuesto1) & "       " & Format(nPorcentaje1, "##0") & " %   " & sImportes1
                    Printer.Print String(95, " ") & UCase(sImpuesto2) & " " & Format(nPorcentaje2, "##0") & " %       " & sImportes2
                    Printer.Print String(95, " ") & "TOTAL         " & sImportes3
                    Printer.Print "        Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
                  
                  
            'CESAR NINAHUANCA
            Case Is = "015" 'PIKALO
            ImprimeFacturaConsumoEmpresa15 RsImpresion, sConsumo, Empresa

            'CESAR NINAHUANCA
            Case Is = "016" 'COLONIAL
            ImprimeFacturaConsumoEmpresa16 RsImpresion, sConsumo, Empresa
           
            Case Is = "017" 'SAINT
            ImprimeFacturaConsumoEmpresa17 RsImpresion, sConsumo, Empresa
                       
            Case Is = "018" 'AS DE ORO
            ImprimeFacturaConsumoEmpresa18 RsImpresion, sConsumo, Empresa
                       
                       
            'Luis Chumpitaz
            Case Is = "020" ' Jose Antonio
                  For i = 1 To nCabecera
                     Printer.Print
                 Next i
                 'Printer.Print "        " & Left(Mid(RsImpresion!Cliente, 1, 34) & String(34, " "), 34) & RsImpresion!Ruc
                 Printer.Print "  " & Left(Mid(RsImpresion!Cliente, 1, 40) & String(40, " "), 40) & RsImpresion!Ruc
                 Printer.Print " "
                 Printer.Print Mid(RsImpresion!direccion, 1, 100)
                 Printer.Print " "
                 Printer.Print Left(RsImpresion!tUsuario & String(10, " "), 10) & String(2, " ") & Mid(WeekdayName(Weekday(Format(RsImpresion!fRegistro, "dd/MM/yyyy"))), 1, 3) & String(1, " ") & Format(RsImpresion!fRegistro, "dd/MM/yyyy") & String(2, " ") & Right(sTurno, 5) & String(2, " ") & Left(RsImpresion!Mozo & String(6, " "), 6) & String(1, " ") & Left(RsImpresion!Mesa & String(10, " "), 10) & String(7, " "); RsImpresion!tDocumento
                 'Printer.Print "            " & Mid(RsImpresion!tDocumento & String(45, " "), 1, 45) & "    Caja   : " & RsImpresion!tCaja & " - " & RsImpresion!tUsuario
                                                 
                 For i = 1 To nDetalle
                     Printer.Print
                 Next i
                 
                 'Cuerpo
                 'Printer.Print
                 txt = sConsumo
                 tOt = Len(Trim(txt))
                 pri = True
                 j = 0
                 Do While tOt <> 0
                    j = j + 1
                    lin = Mid(txt & " ", 1, 50)
                    For i = 50 To 1 Step -1
                        If Mid(lin, i, 1) = " " Then
                           pos = i
                           Exit For
                        End If
                    Next i
                    If pri Then
                       sLinea = "              " & Mid(Mid(txt, 1, pos - 1) & String(50, " "), 1, 50) & "         " & Right(String(14, " ") & Format(RsImpresion!nVenta, "#,###,##0.00"), 14)
                       pri = False
                    Else
                       sLinea = "              " & Mid(txt, 1, pos - 1)
                    End If
                    txt = Mid(txt, pos + 1, tOt)
                    tOt = Len(txt)
                    Printer.Print sLinea
                 Loop
                 
                 Printer.Print " "
                 For i = j To nFItem - 1
                     Printer.Print " "
                 Next i
                 
                 Printer.Print
                 RsImpresion.MoveLast
                 Printer.Print "              Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
                 
                 Printer.Print ""
                 Printer.Print ""

                 If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
                    sImportes = Right(String(10, " ") & Format(RsImpresion!nNeto, "##,###,##0.00"), 10) & _
                                Right(String(10, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,##0.00"), 10) & _
                                Right(String(10, " ") & Format(RsImpresion!nprecioImpuesto2, "##,###,##0.00"), 10) & _
                                Right(String(15, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 15)
                    Printer.FontBold = True
                    Printer.Print String(20, " ") & Format(RsImpresion!fRegistro, " dd     MM       yyyy ") & sImportes
                    Printer.FontBold = False
                 End If
                    
        End Select
    Printer.EndDoc
End Sub


Public Sub Enfoque(ByRef texto As TextBox)
    texto.SelStart = 0
    texto.SelLength = Len(texto)
End Sub

Public Sub PictureNumero(Tecla As Integer)
    If Tecla = 13 Then Exit Sub
    If Tecla = 46 Then Exit Sub
    If Tecla = vbKeyBack Then Exit Sub
    If Chr(Tecla) < "0" Or Chr(Tecla) > "9" Then Tecla = 0: Beep
End Sub

Public Sub LimpiaRs()
   Set RsImpresion = Nothing
   Set RsImpDocumentoE = Nothing
   Screen.MousePointer = vbDefault
End Sub

Public Function NumeroCadena(strnum As String) As String
Dim Valor As String
Dim unidad(0 To 9) As String
Dim decena(0 To 9) As String
Dim centena(0 To 9) As String
Dim especial(1 To 5) As String
Dim compuesto(1 To 9) As String
Dim son As String
Dim Monto As String
Dim Fraccion As String

son = ""
unidad(0) = "cero"
unidad(1) = "uno"
unidad(2) = "dos"
unidad(3) = "tres"
unidad(4) = "cuatro"
unidad(5) = "cinco"
unidad(6) = "seis"
unidad(7) = "siete"
unidad(8) = "ocho"
unidad(9) = "nueve"

decena(1) = "diez"
decena(2) = "veinte"
decena(3) = "treinta"
decena(4) = "cuarenta"
decena(5) = "cincuenta"
decena(6) = "sesenta"
decena(7) = "setenta"
decena(8) = "ochenta"
decena(9) = "noventa"

centena(1) = "cien"
centena(2) = "doscientos"
centena(3) = "trescientos"
centena(4) = "cuatrocientos"
centena(5) = "quinientos"
centena(6) = "seiscientos"
centena(7) = "setecientos"
centena(8) = "ochocientos"
centena(9) = "novecientos"

especial(1) = "once"
especial(2) = "doce"
especial(3) = "trece"
especial(4) = "catorce"
especial(5) = "quince"

compuesto(1) = "dieci"
compuesto(2) = "veinte y "
compuesto(3) = "treinta y "
compuesto(4) = "cuarenta y "
compuesto(5) = "cincuenta y "
compuesto(6) = "sesenta y "
compuesto(7) = "setenta y "
compuesto(8) = "ochenta y "
compuesto(9) = "noventa y "

Dim Sw As Boolean
Dim qwe As Boolean
Dim qwa As Boolean


Sw = True
qwe = True
qwa = True

Do While qwa

Do While qwe
   If Sw Then
      Monto = LTrim(Format(strnum, "####0.00"))
      If InStr(Monto, ".") > 0 Then
         Fraccion = Mid(Monto, InStr(Monto, ".") + 1)
         Monto = Mid(Monto, 1, InStr(Monto, ".") - 1)
      Else
         Fraccion = "00"
      End If
   Else
      Sw = True
   End If

   'LM = Len(Monto)
   Select Case Len(Monto)
      Case Is = 0
           Exit Function
           
      Case Is = 1 And Monto <> ""
           son = son + unidad(Val(Monto))
           
      Case Is = 2
           If Right(Monto, 1) = "0" Then
              son = son + decena(Val(Left(Monto, 1)))
           Else
              If Left(Monto, 1) = "1" And InStr("12345", Right(Monto, 1)) > 0 Then
                 son = son + especial(Val(Right(Monto, 1)))
              Else
                 son = son + compuesto(Val(Left(Monto, 1))) + unidad(Val(Right(Monto, 1)))
              End If
           End If
           
      Case Is = 3
           If Right(Monto, 2) = "00" Then
              son = son + centena(Val(Left(Monto, 1)))
           Else
              If Left(Monto, 2) = "10" And InStr("123456789", Right(Monto, 1)) > 0 Then
                 son = son + "CIENTO" + unidad(Val(Right(Monto, 2)))
              Else
                 If Left(Monto, 1) = "1" And InStr("102030405060708090", Right(Monto, 2)) > 0 Then
                    son = son + "CIENTO " + decena(Val(Mid(Monto, 2, 1)))
                 Else
                    If Left(Monto, 2) = "11" And InStr("12345", Right(Monto, 1)) > 0 Then
                       son = son + "CIENTO " + especial(Val(Right(Monto, 1)))
                    Else
                       If Left(Monto, 1) = "1" Then
                          son = son + "CIENTO " + compuesto(Val(Mid(Monto, 2, 1))) + unidad(Val(Right(Monto, 1)))
                       Else
                          If Right(Monto, 1) = "0" And Mid(Monto, 2, 1) <> "0" Then
                             son = son + centena(Val(Left(Monto, 1))) + " " + decena(Val(Mid(Monto, 2, 1)))
                          Else
                             If Mid(Monto, 2, 1) = "1" And InStr("12345", Right(Monto, 1)) > 0 Then
                                son = son + centena(Val(Left(Monto, 1))) + " " + especial(Val(Right(Monto, 1)))
                             Else
                                If Val(Right(Monto, 2)) > 10 Then
                                   son = son + centena(Val(Left(Monto, 1))) + " " + compuesto(Val(Mid(Monto, 2, 1))) + unidad(Val(Right(Monto, 1)))
                                Else
                                   son = son + centena(Val(Left(Monto, 1))) + " " + unidad(Val(Right(Monto, 1)))
                                End If
                             End If
                          End If
                       End If
                    End If
                 End If
              End If
           End If
      Case Is = 4
           If Left(Monto, 1) = "1" And Right(Monto, 3) = "000" Then
              son = son + "UN MIL"
           Else
              If Left(Monto, 1) = "1" Then
                 son = son + "MIL "
              Else
                 son = son + unidad(Val(Left(Monto, 1))) + " MIL "
              End If
           End If
           Monto = LTrim(Mid(Monto, 2))
           If Left(Monto, 1) = "0" Then
              Monto = LTrim(Mid(Monto, 2))
              If Left(Monto, 1) = "0" Then
                 Monto = LTrim(Mid(Monto, 2))
              End If
              Sw = False
              'Loop
              Exit Do
           End If
           Sw = True
           If Left(Monto, 2) = "10" And InStr("123456789", Right(Monto, 1)) > 0 Then
              son = son + "CIENTO" + unidad(Val(Right(Monto, 2)))
           Else
              If Left(Monto, 1) = "1" And InStr("102030405060708090", Right(Monto, 2)) > 0 Then
                 son = son + "CIENTO " + decena(Val(Mid(Monto, 2, 1)))
              Else
                 If Left(Monto, 2) = "11" And InStr("12345", Right(Monto, 1)) > 0 Then
                    son = son + "CIENTO " + especial(Val(Right(Monto, 1)))
                 Else
                    If Left(Monto, 1) = "1" And Right(Monto, 2) <> "00" Then
                       son = son + "CIENTO " + compuesto(Val(Mid(Monto, 2, 1))) + unidad(Val(Right(Monto, 1)))
                    Else
                       If Right(Monto, 1) = "0" And Mid(Monto, 2, 1) <> "0" Then
                          son = son + centena(Val(Left(Monto, 1))) + " " + decena(Val(Mid(Monto, 2, 1)))
                       Else
                          If Mid(Monto, 2, 1) = "1" And InStr("12345", Right(Monto, 1)) > 0 Then
                             son = son + centena(Val(Left(Monto, 1))) + " " + especial(Val(Right(Monto, 1)))
                          Else
                             If Val(Right(Monto, 2)) > 10 Then
                                son = son + centena(Val(Left(Monto, 1))) + " " + compuesto(Val(Mid(Monto, 2, 1))) + unidad(Val(Right(Monto, 1)))
                             Else
                                If Right(Monto, 2) = "00" Then
                                   son = son + centena(Val(Left(Monto, 1)))
                                Else
                                   son = son + centena(Val(Left(Monto, 1))) + " " + unidad(Val(Right(Monto, 1)))
                                End If
                             End If
                          End If
                       End If
                    End If
                 End If
              End If
           End If
      Case Is = 5
           If Left(Monto, 1) = "1" And Mid(Monto, 2, 1) < "6" And Mid(Monto, 2, 1) <> "0" Then
              son = son + especial(Val(Mid(Monto, 2, 1))) + " MIL "
           Else
              If Left(Monto, 2) >= "10" And Mid(Monto, 2, 1) > "5" Then
                 son = son + compuesto(Val(Left(Monto, 1))) + unidad(Val(Mid(Monto, 2, 1))) + " MIL "
              Else
                 If Left(Monto, 1) >= "1" And Mid(Monto, 2, 1) = "0" Then
                    son = son + decena(Val(Left(Monto, 1))) + " MIL "
                 Else
                    If Mid(Monto, 2, 1) = "1" Then
                       son = son + compuesto(Val(Left(Monto, 1))) + "UN MIL "
                    Else
                       son = son + compuesto(Val(Left(Monto, 1))) + unidad(Val(Mid(Monto, 2, 1))) + " MIL "
                    End If
                 End If
              End If
           End If
           Monto = LTrim(Mid(Monto, 3))
           If Left(Monto, 1) = "0" Then
              Monto = LTrim(Mid(Monto, 2))
              If Left(Monto, 1) = "0" Then
                 Monto = LTrim(Mid(Monto, 2))
              End If
              Sw = False
              'Loop
              Exit Do
           End If
           Sw = True
           If Left(Monto, 2) = "10" And InStr("123456789", Right(Monto, 1)) > 0 Then
              son = son + "CIENTO" + unidad(Val(Right(Monto, 2)))
           Else
              If Left(Monto, 1) = "1" And InStr("102030405060708090", Right(Monto, 2)) > 0 Then
                 son = son + "CIENTO " + decena(Val(Mid(Monto, 2, 1)))
              Else
                 If Left(Monto, 2) = "11" And InStr("12345", Right(Monto, 1)) > 0 Then
                    son = son + "CIENTO " + especial(Val(Right(Monto, 1)))
                 Else
                    If Left(Monto, 1) = "1" And Right(Monto, 2) <> "00" Then
                       son = son + "CIENTO " + compuesto(Val(Mid(Monto, 2, 1))) + unidad(Val(Right(Monto, 1)))
                    Else
                       If Right(Monto, 1) = "0" And Mid(Monto, 2, 1) <> "0" Then
                          son = son + centena(Val(Left(Monto, 1))) + " " + decena(Val(Mid(Monto, 2, 1)))
                       Else
                          If Mid(Monto, 2, 1) = "1" And InStr("12345", Right(Monto, 1)) > 0 Then
                             son = son + centena(Val(Left(Monto, 1))) + " " + especial(Val(Right(Monto, 1)))
                          Else
                             If Val(Right(Monto, 2)) > 10 Then
                                son = son + centena(Val(Left(Monto, 1))) + " " + compuesto(Val(Mid(Monto, 2, 1))) + unidad(Val(Right(Monto, 1)))
                             Else
                                If Right(Monto, 2) = "00" Then
                                   son = son + centena(Val(Left(Monto, 1)))
                                Else
                                   son = son + centena(Val(Left(Monto, 1))) + " " + unidad(Val(Right(Monto, 1)))
                                End If
                             End If
                          End If
                       End If
                    End If
                 End If
              End If
           End If
      Case Is = 6
   End Select
   If Fraccion = "00" Then
      son = son + " Y 00/100 "
   Else
      son = son + " Y " + Fraccion + "/100 "
   End If
   qwe = False
   qwa = False
Loop

Loop
  NumeroCadena = UCase(son)
End Function

Public Sub ImprimeCtaCte(RsImpresion As Recordset)
    On Error Resume Next
    Dim Item As String
    Dim sLinea As String
    Dim zSubTotal As Double
    Dim zImpuesto1 As Double
    Dim zImpuesto2 As Double
    Dim zImpuesto3 As Double
    Dim zTotal As Double

    'Configura la impresora la impresion Font
    If Not Imprimir(sPreCuenta) Then
       Exit Sub
    End If
    
    Printer.FontName = sFont
    Printer.FontBold = False
    
    'Cabecera
    ImprimeXCentro sRazonSocial, 40
    ImprimeXCentro sRazonComercial, 40
    sLinea = String((40 - Len(Trim("R.U.C.: " + sRUC))) / 2, " ") & "R.U.C.: " + sRUC
    Printer.Print sLinea
    ImprimeXCentro sDireccion, 40
    sLinea = String((40 - Len(Trim("Telefono: " + sTelefono))) / 2, " ") & "Telefono: " + sTelefono
    Printer.Print sLinea
    Printer.Print
    
    Printer.Print "Pedido : " & RsImpresion!codigo
    Printer.Print "Fecha  : " & FechaServidor()
    Printer.Print "Caja   : " & RsImpresion!tCaja & " - " & RsImpresion!tUsuario
    Printer.Print "Mesero : " & RsImpresion!Mozo
    Printer.Print "Usuario: " & RsImpresion!tUsuario
    Printer.Print
    Printer.FontBold = True
    Printer.Print "MESA   : " & IIf(RsImpresion!tMesa = "000" Or Len(Trim((RsImpresion!tMesa))) = 0, RsImpresion!tObservacion, RsImpresion!Mesa)
    Printer.FontBold = False
    Printer.Print
    Printer.Print String(40, "-")
    Printer.Print "Cantid. Producto                SubTotal"
    Printer.Print String(40, "-")
        
    RsImpresion.MoveFirst
    zSubTotal = 0
    zImpuesto1 = 0
    zImpuesto2 = 0
    zImpuesto3 = 0
    zTotal = 0
    
    Item = ""
    'Cuerpo
    Do While Not RsImpresion.EOF
       sLinea = Right(String(7, " ") & Format(RsImpresion!nCantidad, "###0.00"), 7) & " " & Mid(RsImpresion!Producto & String(19, " "), 1, 19) & " " & Right(String(12, " ") & Format(RsImpresion!nVenta, "#,###,##0.00"), 12)
       Printer.Print sLinea
       zTotal = zTotal + RsImpresion!nVenta
       zImpuesto1 = zImpuesto1 + RsImpresion!nImpuesto1
       zImpuesto2 = zImpuesto2 + RsImpresion!nImpuesto2
       zImpuesto3 = zImpuesto3 + RsImpresion!nImpuesto3
       RsImpresion.MoveNext
    Loop
    zSubTotal = Round(zTotal - zImpuesto1 - zImpuesto2 - zImpuesto3, 2)
    zTotal = Round(zTotal, 2)
    
    Printer.Print String(40, "-")
    Printer.Print
    Printer.Print Right(String(27, " ") & "Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(zTotal, "##,###,##0.00"), 13)
    
    Printer.Print
    txt = "Son: " & NumeroCadena(str(zTotal)) & " " & sMonedaN
    tOt = Len(txt)
    j = 0
    Do While tOt <> 0
       j = j + 1
       lin = Mid(txt & " ", 1, 40)
       For i = 40 To 1 Step -1
           If Mid(lin, i, 1) = " " Then
              pos = i
              Exit For
           End If
       Next i
       
       sLinea = Mid(txt, 1, pos - 1)
       txt = Mid(txt, pos + 1, tOt)
       tOt = Len(txt)
       Printer.Print sLinea
    Loop

    Printer.Print
    Printer.Print String(40, "-")
    Printer.Print
    RsImpresion.MoveLast
    Printer.Print " Cliente : " & RsImpresion!Cliente
    Printer.Print " Saldo   : S/. " & Format(RsImpresion!nSaldo, "##,###,##0.00")
    Printer.Print " Linea   : S/. " & Format(RsImpresion!nLinea, "##,###,##0.00")
    Printer.Print
    Printer.Print
    Printer.Print
    Printer.Print "         __________________________"
    Printer.Print "                    Firma          "
    Printer.Print
    Printer.EndDoc
End Sub


Public Function Supervisor(Opcion As String) As Boolean
    Dim RsPW As Recordset
    Set RsPW = Lib.OpenRecordset("select * from vGrupoUsuario where lActivo = 1 and lOpcion" & Opcion & "=1", Cn)
    If RsPW.RecordCount = 0 Then
       Set RsPW = Nothing
       Supervisor = False
       Exit Function
    End If


 
    'HUELLA
    pTipo = "C"
    
    If lHuella = True Then
        wenterHuellaSup = False
        lVieneHuella = False
        frmVerificacionHuellaSup.Opcion Opcion
        frmVerificacionHuellaSup.Show vbModal
    Else
        frmPassword.TipoSeguridad Opcion
        frmPassword.Show vbModal
    End If

   
   If wenterHuellaSup = True Then
        Supervisor = True
        Exit Function
   End If
   '-------------------------
   
   
    If Not wEnter Or LTrim(sDescrip) = "" Then
       Set RsPW = Nothing
       Supervisor = False
       Exit Function
     End If

    RsPW.MoveFirst
    Do While Not RsPW.EOF
    
        sDescrip = Replace(sDescrip, "'", "", 1, , vbTextCompare)
        If Len(sDescrip) = 1 Then
         sDescrip = Replace(sDescrip, "%", "", 1, , vbTextCompare)
        End If
        
       If sDescrip = Desencapsula(RsPW!tpassword) Or Encapsula(sDescrip) = IIf(IsNull(RsPW!tBandaMagnetica), "", "´" & RsPW!tBandaMagnetica) Then
          If sDescrip = Desencapsula(RsPW!tpassword) Then
             sVar1 = RsPW!tResumido
          Else
             sVar1 = "*" & RsPW!tResumido
          End If
          Supervisor = True
          Set RsPW = Nothing
          Exit Function
       End If
       RsPW.MoveNext
    Loop
    Supervisor = False
    Set RsPW = Nothing
End Function

Public Sub ImprimeFacturaT(ByVal RsImpresion As Recordset, Optional tTipoDoc As String, Optional Cabecera As Image, Optional pie As Image, Optional ByVal ImpDolarDelivery As Boolean)
    On Error Resume Next
    Dim Item As String
    Dim xObservacion As String
    Dim sLinea As String
    Dim txt As String
    Dim xRsPropiedad As ADODB.Recordset
    Dim xRsPropiedadCombo As ADODB.Recordset
    Dim nSumaNeto As Double
    Dim xTotalS As Double
    
    Dim RsPagoDocumento As ADODB.Recordset
    Dim lcuentaCobrar As Boolean
                        
    '---CESAR IMP
    Dim imp1 As Double
    Dim imp2 As Double
    Dim impxT As Double
    Dim impx1 As Double
    Dim impx2 As Double
    Dim impG As Double
    Dim xDescuento As Double
    Dim xRecargo As Double
    Dim xSubTotal As Double
    Dim xDiferencia As Double
    Dim xAumento As Double
    
    imp1 = Calcular("select ISNULL(Impuesto1,0) as Codigo from TPARAMETRO", Cn)
    imp2 = Calcular("select ISNULL(Impuesto2,0) as Codigo from TPARAMETRO", Cn)
    impxT = 1 + (imp1 / 100) + (imp2 / 100)
    impx1 = 1 + (imp1 / 100)
    impx2 = 1 + (imp2 / 100)
    impG = 1
    '------------------
    lImprimeImagCabDocumento = Calcular("select lImprimeImageCab as codigo from ttipodocumentoimpresora where ttipoemision='" & tTipoDoc & "' and  tcaja='" & sCaja & "'", Cn)
    lImprimeImagPieDocumento = Calcular("select lImprimeImagePie as codigo from ttipodocumentoimpresora where ttipoemision='" & tTipoDoc & "' and  tcaja='" & sCaja & "'", Cn)
    ximprimeDetallado = Calcular("select lImprimeresumen as codigo from ttipodocumentoimpresora where ttipoemision='" & tTipoDoc & "' and  tcaja='" & sCaja & "'", Cn)
    
    Dim CANT, Valor As Integer
    Dim ProductoTem As String
    
    xTotalS = 0
    
  
    Isql = "SELECT tCodigoPedido, dbo.TPRODUCTOPROPIEDAD.tItem, dbo.TOPERADOR.tDetallado AS Operador, dbo.TPROPIEDAD.tDetallado AS Descripcion,dbo.TPRODUCTOPROPIEDAD.nCantidad " & _
           "FROM dbo.TPRODUCTOPROPIEDAD INNER JOIN dbo.TPROPIEDAD ON dbo.TPRODUCTOPROPIEDAD.tCodigoPropiedad = dbo.TPROPIEDAD.tCodigoPropiedad AND dbo.TPRODUCTOPROPIEDAD.tProducto = dbo.TPROPIEDAD.tProducto INNER JOIN dbo.TOPERADOR ON dbo.TPROPIEDAD.tOperador = dbo.TOPERADOR.tOperador " & _
           "where tCodigoPedido='" & RsImpresion!tCodigoPedido & "' and TOPERADOR.lImprime=1 Order by dbo.TOPERADOR.nBoton"
    Set xRsPropiedad = Lib.OpenRecordset(Isql, Cn)
    Isql = "SELECT dbo.TCOMBOPROPIEDAD.tItem, dbo.TCOMBOPROPIEDAD.tItemCombo, dbo.TOPERADOR.tDetallado AS Operador, dbo.TPROPIEDAD.tDetallado AS Descripcion, dbo.TCOMBOPROPIEDAD.tCodigoPedido,dbo.TCOMBOPROPIEDAD.nCantidad " & _
           "FROM dbo.TOPERADOR INNER JOIN dbo.TPROPIEDAD ON dbo.TOPERADOR.tOperador = dbo.TPROPIEDAD.tOperador RIGHT OUTER JOIN dbo.TCOMBOPROPIEDAD ON dbo.TPROPIEDAD.tProducto = dbo.TCOMBOPROPIEDAD.tProducto AND dbo.TPROPIEDAD.tCodigoPropiedad = dbo.TCOMBOPROPIEDAD.tCodigoPropiedad " & _
           "where tCodigoPedido='" & RsImpresion!tCodigoPedido & "'  and TOPERADOR.lImprime=1 Order by dbo.TOPERADOR.nBoton"
    Set xRsPropiedadCombo = Lib.OpenRecordset(Isql, Cn)
    
    If lLogCajaRapida = True Then
    'Log
    Cn.Execute "UPDATE TLOG_IMPRESION SET TPOSICION5='PASO 1 ' + '" & RsImpresion!tDocumento & "' WHERE TDOCUMENTO='" & sDocumento & "'"
    End If
    
    Select Case pais
    Case "001" 'Bolivia
                    'OBTIENE DATOS A IMPRIMIR
                    Dim tAutorizacion As String '  del documento
                    Dim tcodigoControl As String ' del documento
                    Dim tGlosaDosificacion As String
                    Dim RsDatos As Recordset
                    Dim fLimite As Date ' de la caja
                    Dim tSfc As String ' de la caja
                    
                    'CGMiranda******************************
                    Dim tSucursal As String
                    'fin CGMiranda************************
                    Dim cadenaxx As String
                    tSfc = ""
                    fLimite = Now
                    tAutorizacion = Calcular("select tautorizacion as codigo from mdocumento where tdocumento ='" & RsImpresion!tDocumento & "'", Cn)
                    tcodigoControl = Calcular("select tcodigoControl as codigo from mdocumento where tdocumento ='" & RsImpresion!tDocumento & "'", Cn)
                    cadenaxx = "SELECT tsfc,ffin, isnull(tGlosaDosificacion,'') tglosadosificacion FROM TORIGENCODIGOCONTROL WHERE TCAJA='" & RsImpresion!tCaja & "' AND TAUTORIZACION='" & Trim(tAutorizacion) & "' AND ((FINICIO <= '" & Format(RsImpresion!fRegistro, "YYYYmmdd HH:mm") & "') AND (ffin>='" & Format(RsImpresion!fRegistro, "YYYYmmdd HH:mm") & "'))"
                    Set RsDatos = Lib.OpenRecordset(cadenaxx, Cn)
                    If Not (RsDatos.EOF Or RsDatos.BOF) Then
                           ' rsDatos.MoveFirst
                            tSfc = RsDatos!tSfc
                            fLimite = Format(RsDatos!fFin, "dd/MM/yyyy")
                            tGlosaDosificacion = RsDatos!tGlosaDosificacion
                    End If
                    
                            If lImprimeImagCabDocumento Then
                                    If Cabecera <> 0 Then
                                    Printer.PaintPicture Cabecera, 500, Printer.CurrentY, 2860, 1600
                                    For p = 1 To 10
                                    Printer.Print
                                    Next p
                                    End If
                            End If
                    'Cabecera
                    RsImpresion.MoveFirst
                    ImprimeXCentro sRazonSocial, 40
                    ImprimeXCentro sRazonComercial, 40
                    'CGMiranda******************************************************
                    tSucursal = Calcular("select vs.tResumido as codigo from vsucursal vs inner join TCAJA tc on vs.Codigo = tc.tSucursal where tc.tCaja='" & sCaja & "'", Cn)
                    ImprimeXCentro "Sucursal Nº " & IIf(tSucursal = 0, "", tSucursal), 40
                    ImprimeXCentro sDireccion, 40
                    ImprimeXCentro "Telefono: " & sTelefono, 40
                    ImprimeXCentro "SFC: " & tSfc & "   La Paz Bolivia", 40
                    If estadoReimpresion = True Then
                        ImprimeXCentro "FACTURA-COPIA", 40
                        estadoReimpresion = False
                    Else
                        ImprimeXCentro "FACTURA", 40
                    End If
                    'Fin CGMiranda**********************************************************
                    Printer.Print
                    Printer.Print String(40, "-")
                    sLinea = String((40 - Len(Trim("NIT: " + sRUC))) / 2, " ") & "NIT: " + sRUC
                    Printer.Print sLinea
                    'cambios pedido por salvador bustillos
                        'Printer.Print "Factura Nº " & Mid(RsImpresion!tDocumento, 7)
                        'Printer.Print "Autorizacion Nº " & tAutorizacion
                        ImprimeXCentro "Factura Nº " & Mid(RsImpresion!tDocumento, 7), 40 'cambio
                        ImprimeXCentro "Autorizacion Nº " & tAutorizacion, 40 ' cambio
                        Printer.Print String(40, "-")
                        lTamanio = Printer.FontSize
                        Printer.FontSize = lTamanio - 1
                        ImprimeXCentro "Hotelería, Restaurantes y Alquileres", 40 'cambio
                        Printer.FontSize = lTamanio
                             'impresiondiacontable
                            If lImpresionDiaContable Then
                                If lReimpresion = True Then
                                    Printer.Print "Fecha    : " & Format(Calcular("select fdiacontable as codigo from mdocumento where tdocumento ='" & RsImpresion!tDocumento & "'", Cn), "dd/MM/yyyy") & " " & Calcular("exec DiacontableHora '" & fImpresionDiaContable & "'", Cn)
                                    Else
                                    Printer.Print "Fecha    : " & fImpresionDiaContable & " " & Calcular("exec DiacontableHora '" & fImpresionDiaContable & "'", Cn)
                                End If
                                Else
                                 Printer.Print "Fecha    : " & RsImpresion!fRegistro
                            End If
                                                                           
                    
                    'Printer.Print "Fecha    : " & RsImpresion!fRegistro
                    ImprimeXLinea "Señores  : " & RsImpresion!Cliente, 40, 9
                    Printer.Print "NIT/CI   : " & RsImpresion!Ruc
                    Printer.Print "Dirección: " & Mid(RsImpresion!direccion, 1, 30)
                    Printer.Print String(40, "-")
                    
                    Printer.Print
                    Printer.Print "Pedido   : " & RsImpresion!tCodigoPedido
                    Printer.Print "Tipo     : " & RsImpresion!tipopedido
                    Printer.Print "Caja     : " & RsImpresion!tCaja & " - " & RsImpresion!tUsuario
                    Printer.Print "Mesero   : " & RsImpresion!Mozo
                    Printer.Print "Nro.Serie: " & Calcular("select isnull(tSerieImpresora,'') codigo from MDOCUMENTO where tDocumento ='" & RsImpresion!tDocumento & "'", Cn)
                    Printer.Print "Descuento: " & Mid(Trim(RsImpresion!DESCUENTO), 1, 30)
                    Printer.Print
                    Printer.Print "MESA     : " & RsImpresion!Mesa
                    If lObservacionCabDoc Then
                        Printer.Print "Observac.: " & RsImpresion!tObservacion
                    End If
                    Printer.Print
                    Printer.Print String(40, "-")
                    Printer.Print "Cantid Producto         P.Unit. SubTotal"
                    Printer.Print String(40, "-")
                                      
                    'Cuerpo
                    Item = ""
                    'Cuerpo
                    Do While Not RsImpresion.EOF
                    If ximprimeDetallado = False Then
                        xproducto = RsImpresion!Producto
                    Else
                        xproducto = RsImpresion!ProductoDetallado
                    End If
                       If Item <> RsImpresion!tCodigoPedido + RsImpresion!tItem Then
                          'Impresion de Propiedades
                          If lPropiedadDocumento Then
                             xRsPropiedad.Filter = "tCodigoPedido='" & Mid(Item, 1, 10) & "' and tItem='" & Mid(Item, 11, 3) & "'"
                             If Not xRsPropiedad.EOF Then
                                xRsPropiedad.MoveFirst
                                Do While Not xRsPropiedad.EOF
                                   Printer.Print "        * " & xRsPropiedad!Operador & " " & xRsPropiedad!Descripcion
                                   xRsPropiedad.MoveNext
                                Loop
                             End If
                                         
                             'Impresion de la Observacion
                             If lObservacionDocumento And Len(Trim(xObservacion)) > 0 Then
                                ImprimeXLinea "        - " & Trim(xObservacion), 33, 2
                             End If
                          End If
                          
                          If IsNull(RsImpresion!tOferta) Or RsImpresion!tOferta = "" Then
                          
                             '---------------- Top de 18 carcteres por y salto de linea en el modulo

                                CANT = Len(Trim(xproducto))
                                ProductoTem = xproducto
regreso2:
                                If Valor = 0 Then
                                    sLinea = Right(String(6, " ") & Format(RsImpresion!nCantidad, "##0.00"), 6) & " " & Mid(xproducto & String(16, " "), 1, 16) & " " & Right(String(7, " ") & Format(RsImpresion!nprecioVenta, "###0.00"), 7) & " " & Right(String(8, " ") & Format(RsImpresion!nCantidad * RsImpresion!nprecioVenta, "####0.00"), 8)
                                    Valor = 1
                                    CANT = Len(Mid(ProductoTem, 17))
                                    ProductoTem = Mid(ProductoTem, 17)
                                    Printer.Print sLinea
                                Else
                                    sLinea = Right(String(6, " ") & "      ", 6) & " " & Mid(ProductoTem & String(16, " "), 1, 16) & " " & Right(String(7, " ") & "       ", 7) & " " & Right(String(8, " ") & "        ", 8)
                                    CANT = Len(Mid(ProductoTem, 17))
                                    ProductoTem = Mid(ProductoTem, 17)
                                    Printer.Print sLinea
                                End If
                                
                                If CANT > 0 And ximprimeDetallado = True Then
                                GoTo regreso2
                                End If
                          
                          '-----------------------------------------------------------
                          
                             'sLinea = Right(String(6, " ") & Format(RsImpresion!nCantidad, "##0.00"), 6) & " " & Mid(xproducto & String(16, " "), 1, 16) & " " & Right(String(7, " ") & Format(RsImpresion!nprecioVenta, "###0.00"), 7) & " " & Right(String(8, " ") & Format(RsImpresion!nCantidad * RsImpresion!nprecioVenta, "####0.00"), 8)
                             
                          Else
                          
                          
                            CANT = Len(Trim(xproducto))
                             ProductoTem = xproducto
regreso3:
                                If Valor = 0 Then
                                    sLinea = Right(String(6, " ") & Format(RsImpresion!nCantidad, "##0.00"), 6) & " " & Mid(xproducto & String(16, " "), 1, 16)
                                    Valor = 1
                                    CANT = Len(Mid(ProductoTem, 17))
                                    ProductoTem = Mid(ProductoTem, 17)
                                    Printer.Print sLinea
                                Else
                                    sLinea = Right(String(6, " ") & "      ", 6) & " " & Mid(ProductoTem & String(16, " "), 1, 16)

                                    CANT = Len(Mid(ProductoTem, 17))
                                    ProductoTem = Mid(ProductoTem, 17)
                                    Printer.Print sLinea
                                End If
                                
                                If CANT > 0 And ximprimeDetallado = True Then
                                GoTo regreso3
                                End If
                          
   
'                            sLinea = Right(String(6, " ") & Format(RsImpresion!nCantidad, "##0.00"), 6) & " " & Mid(xproducto & String(16, " "), 1, 16)
'                            Printer.Print sLinea
                             sLinea = String(6, " ") & " " & Mid(RsImpresion!tOferta & String(16, " "), 1, 16) & " " & Right(String(7, " ") & Format(RsImpresion!nprecioVenta, "###0.00"), 7) & " " & Right(String(8, " ") & Format(RsImpresion!nCantidad * RsImpresion!nprecioVenta, "####0.00"), 8)
                             Printer.Print sLinea
                          End If
                          
                          Valor = 0
                          'Printer.Print sLinea
                       End If
                       
                       'Combos
                       If lComboDocumento And IIf(IsNull(RsImpresion!Combo), 0, Len(Trim(RsImpresion!Combo))) > 0 Then
                          sLinea = Mid("       " & Right(String(5, " ") & Format(RsImpresion!nCombo, "#0.00"), 5) & " " & RsImpresion!Combo, 1, 40)
                          Printer.Print sLinea
                          
                          'Combos Propiedades
                          If lPropiedadDocumento And Len(Trim(IIf(IsNull(RsImpresion!Combo), "", RsImpresion!Combo))) > 0 Then
                          
                             xRsPropiedadCombo.Filter = "tCodigoPedido='" & RsImpresion!tCodigoPedido & "' and tItem='" & RsImpresion!tItem & "' and tItemCombo='" & RsImpresion!tItemCombo & "'"
                             If Not xRsPropiedadCombo.EOF Then
                                xRsPropiedadCombo.MoveFirst
                                Do While Not xRsPropiedadCombo.EOF
                                    ImprimeXLinea "        * " & xRsPropiedadCombo!Operador & " " & xRsPropiedadCombo!Descripcion, 31, 10
                                   'Printer.Print "        * " & xRsPropiedadCombo!Operador & " " & xRsPropiedadCombo!Descripcion
                                   xRsPropiedadCombo.MoveNext
                                Loop
                             End If
                          
                             'Impresion de la Observacion
                              If lObservacionDocumento And Len(Trim(RsImpresion!tObservacionCombo)) > 0 Then
                                 ImprimeXLinea "        - " & Trim(RsImpresion!tObservacionCombo), 33, 2
                              End If
                          End If
                       End If
                       xObservacion = IIf(IsNull(RsImpresion!tObservacionPedido), "", RsImpresion!tObservacionPedido)
                       Item = RsImpresion!tCodigoPedido + RsImpresion!tItem
                       RsImpresion.MoveNext
                    Loop
                    
                    If lPropiedadDocumento Then
                       xRsPropiedad.Filter = "tCodigoPedido='" & Mid(Item, 1, 10) & "' and tItem='" & Mid(Item, 11, 3) & "'"
                       If Not xRsPropiedad.EOF Then
                          xRsPropiedad.MoveFirst
                          Do While Not xRsPropiedad.EOF
                             Printer.Print "        * " & xRsPropiedad!Operador & " " & xRsPropiedad!Descripcion
                             xRsPropiedad.MoveNext
                          Loop
                       End If
                                   
                       'Impresion de la Observacion
                       If lObservacionDocumento And Len(Trim(xObservacion)) > 0 Then
                          ImprimeXLinea "        - " & Trim(xObservacion), 33, 2
                       End If
                    End If
                    
                    'Printer.Print
                    Printer.Print String(40, "-")
                    RsImpresion.MoveLast
                    
                    If RsImpresion!nRecargo > 0 Then
                       Printer.Print
                       Printer.Print Right(String(27, " ") & "Recargo " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nRecargo, "##,###,##0.00"), 13)
                    End If
                    
                    If RsImpresion!nDescuento > 0 Then
                       Printer.Print
                       Printer.Print Right(String(27, " ") & "Descuento " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nDescuento, "##,###,##0.00"), 13)
                    End If
                            
                  
                    nSumaNeto = RsImpresion!nNeto
                    
                    If IsNull(RsImpresion!lImpuesto1) Or Not RsImpresion!lImpuesto1 Then
                       nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto1
                    End If
                    
                    If IsNull(RsImpresion!lImpuesto2) Or Not RsImpresion!lImpuesto2 Then
                       nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto2
                    End If
                    
                    If IsNull(RsImpresion!lImpuesto3) Or Not RsImpresion!lImpuesto3 Then
                       nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto3
                    End If
                    'CESAR
                    If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
                       Printer.Print Right(String(27, " ") & "Valor Venta " & sMonN & " : ", 27) & Right(String(13, " ") & Format(nSumaNeto, "##,###,##0.00"), 13)
                    End If
                                  
                    If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                       Printer.Print Right(String(27, " ") & sImpuesto1 & " " & Format(nPorcentaje1, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,##0.00"), 13)
                    End If
                       
                    If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                       Printer.Print Right(String(27, " ") & sImpuesto2 & " " & Format(nPorcentaje2, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto2, "##,###,##0.00"), 13)
                    End If
                    
                    If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                       Printer.Print Right(String(27, " ") & sImpuesto3 & " " & Format(nPorcentaje3, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto3, "##,###,##0.00"), 13)
                    End If
                    
                    'Printer.Print CarlosD
                    Printer.Print Right(String(27, " ") & "Total " & sMonN & " :", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 13)
                    'Printer.Print
                    'CarlosD 2/12/2006
                    If lEquivalencia = True Or lDocumEquivaPrecuenta = True Then
                    Printer.Print Right(String(27, " ") & "Total " & sMonE & " :", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 13)
                    Printer.Print
                    End If
                    
                    Printer.Print
                    If Calcular(" SELECT case when  lImpresionRetencion=1 then 1 else 0 end  as codigo FROM vTipodocumento WHERE Codigo=(SELECT TTIPODOCUMENTO FROM MDOCUMENTO WHERE tDocumento='" & RsImpresion!tDocumento & "')", Cn) = 1 Then
                        'ImprimeXCentro tTextoAgenteRetencion, 70
                        ImprimeXLinea tTextoAgenteRetencion, 40, 5
                    End If

                    'End CarlosD
                    txt = "Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
                    ImprimeXLinea txt, 40, 5
                    
                    Printer.Print String(40, "-")
                    Printer.Print "Código de Control      : " & tcodigoControl
                    Printer.Print "Fecha Límite de Emisión: " & Format(fLimite, "dd/MM/yyyy")

                    Printer.Print String(40, "-")
'                     ImprimeXLinea textoComprobanteBolivia, 40, 5
'                    Printer.Print String(40, "-")
                    
                    
'
                    'IMPRIMEQR
                    If Calcular("select ISNULL(lImprimeQR,0) as codigo from TTIPODOCUMENTO where tCodigoTipoDocumento='" & tTipoDoc & "'", Cn) = 1 Then
                        If pais = "001" Then
                        Set rsQr = Lib.OpenRecordset("usp_Inforest_ObtieneCodigoQR_Bol " + RsImpresion!tDocumento, Cn)
                        FastQRCode rsQr.Fields(0), App.Path & "\BaseTempQr.bmp"
'                     QRCodeLibVer
                        Set imgDocumento = CreateObject("Scripting.FileSystemObject")
                        If imgDocumento.FileExists(App.Path & "\BaseTempQr.bmp") Then
                                Printer.PaintPicture LoadPicture(App.Path & "\BaseTempQr.bmp"), 1400, Printer.CurrentY, 1323, 1323
                                 For p = 1 To 8
                                    Printer.Print
                                 Next p
                         End If
                       End If
                    End If

                    Set xRsPropiedad = Nothing
                    Set xRsPropiedadCombo = Nothing
                    Set rsQr = Nothing
                
                    Printer.Print '.'
                    lTamanio = Printer.FontSize
                    Printer.FontSize = lTamanio - 2
                    comilla = Chr(34)
                    ImprimeXLinea comilla & "ESTA FACTURA CONTRIBUYE AL DESARROLLO DEL PAIS. EL USO ILICITO DE ESTA SERA SANCIONADO DE ACUERDO A LEY" & comilla, 57, 2
                    Printer.Print '.'
                    If tGlosaDosificacion <> "" Then
                            ImprimeXLinea tGlosaDosificacion, 40, 2
                    End If
                    Printer.FontSize = lTamanio
                    Printer.Print String(40, "-")
                    ImprimeXCentro sPie, 40
                    Printer.Print
                    If lImprimeImagPieDocumento Then
                                    If pie <> 0 Then
                                        Printer.PaintPicture pie, 500, Printer.CurrentY, 2860, 1600
                                    End If
                    End If
                    Printer.EndDoc
                    
                    
        Case "002" 'Ecuador
                    'Cabecera
                    RsImpresion.MoveFirst
                    Dim RsEcua As Recordset
                    Dim sIGV As Double
                    Dim cIGV As Double
                    sIGV = 0
                    cIGV = 0
                    
                    
                    If lImprimeImagCabDocumento Then
                                    If Cabecera <> 0 Then
                                    Printer.PaintPicture Cabecera, 500, Printer.CurrentY, 2860, 1600
                                    For p = 1 To 10
                                    Printer.Print
                                    Next p
                                    End If
                    End If
                    If estadoReimpresion = True Then
                        ImprimeXCentro "REIMPRESION", 40
                        estadoReimpresion = False
                    End If
                    
                    ImprimeXCentro sRazonSocial, 40
                    ImprimeXCentro sDireccion, 40
                    If Trim(sDireccion2) <> "" Then
                        ImprimeXCentro sDireccion2, 40
                    End If
                    ImprimeXCentro "Telefono: " & sTelefono, 40
                    sLinea = String((40 - Len(Trim("R.U.C.: " + sRUC))) / 2, " ") & "R.U.C.: " + sRUC
                    Printer.Print sLinea
                    
                    If tContribuyenteEspecial <> "" Then
                       ImprimeXCentro "CONTRIBUYENTE ESPECIAL", 40
                       ImprimeXCentro "RESOLUCION Nro." & tContribuyenteEspecial & " del " & fContribuyenteEspecial, 40
                    End If
                    
                    Printer.Print
                    Set RsEcua = Lib.OpenRecordset("select Descripcion, tNumeroAutorizacion, fInicio, fCaducidad from vTipoDocumentoImpresora where tCaja='" & RsImpresion!tCaja & "' and Prefijo='" & Mid(RsImpresion!tDocumento, 1, 1) & "'", Cn)
                    If RsEcua.RecordCount > 0 Then
                       RsEcua.MoveFirst
                    End If
                    
                    Printer.Print RsEcua!Descripcion & "-" & Mid(RsImpresion!tDocumento, 2, 3) & "-" & Mid(RsImpresion!tDocumento, 5, 3) & "-" & Mid(RsImpresion!tDocumento, 8, 9)
                    Printer.Print "Aut. SRI : " & RsEcua!tNumeroAutorizacion
                    Printer.Print "F. Inicio: " & Format(RsEcua!fInicio, "dd/MM/yyyy")
                    Printer.Print "F.Validez: " & Format(RsEcua!fCaducidad, "dd/MM/yyyy")
                    Printer.Print
                    Printer.Print String(15, "-") & " CLIENTE " & String(16, "-")
                    Printer.Print "Cedul/RUC: " & RsImpresion!Ruc
                    ImprimeXLinea "Cliente  : " & RsImpresion!Cliente, 40, 11
                    ImprimeXLinea "Direccion: " & RsImpresion!direccion, 40, 11
                    Printer.Print String(40, "-")
                    
                    Printer.Print
                    Printer.Print "Pedido   : " & RsImpresion!tCodigoPedido
                    
                    'impresiondiacontable
                    If lImpresionDiaContable Then
                        If lReimpresion = True Then
                            Printer.Print "Fecha    : " & Format(Calcular("select fdiacontable as codigo from mdocumento where tdocumento ='" & RsImpresion!tDocumento & "'", Cn), "dd/MM/yyyy") & " " & Calcular("exec DiacontableHora '" & fImpresionDiaContable & "'", Cn)
                            Else
                            Printer.Print "Fecha    : " & fImpresionDiaContable & " " & Calcular("exec DiacontableHora '" & fImpresionDiaContable & "'", Cn)
                        End If
                        Else
                         Printer.Print "Fecha    : " & RsImpresion!fRegistro
                    End If
                                                                          
                    Printer.Print "Caja     : " & RsImpresion!tCaja & " - " & RsImpresion!tUsuario
                    Printer.Print "Mesero   : " & RsImpresion!Mozo
                    Printer.Print "Descuento: " & Mid(Trim(RsImpresion!DESCUENTO), 1, 30)
                    Printer.Print
                    Printer.Print String(40, "-")
                    Printer.Print "Cant. Articulo            P.Unit P.Total"
                    Printer.Print String(40, "-")
                                      
                    'Cuerpo
                    Item = ""
                    'Cuerpo
                    Do While Not RsImpresion.EOF
                    If ximprimeDetallado = False Then
                        xproducto = RsImpresion!Producto
                    Else
                        xproducto = RsImpresion!ProductoDetallado
                    End If
                    
                       If Item <> RsImpresion!tCodigoPedido + RsImpresion!tItem Then
                       
                            If RsImpresion!nImpuesto1 > 0 Then
                               cIGV = cIGV + (RsImpresion!nPrecioNeto * RsImpresion!nCantidad)
                            Else
                               sIGV = sIGV + (RsImpresion!nPrecioNeto * RsImpresion!nCantidad)
                            End If
                       
                            'Impresion de Propiedades
                            If lPropiedadDocumento Then
                                xRsPropiedad.Filter = "tCodigoPedido='" & Mid(Item, 1, 10) & "' and tItem='" & Mid(Item, 11, 3) & "'"
                            If Not xRsPropiedad.EOF Then
                               xRsPropiedad.MoveFirst
                               Do While Not xRsPropiedad.EOF
                                  'ImprimeXLinea "        * " & IIf(xRsPropiedad!nCantidad = 1, "", "(" & xRsPropiedad!nCantidad & ")") & xRsPropiedad!Operador & " " & xRsPropiedad!Descripcion, 31, 10
                                  ImprimeXLinea "        * " & xRsPropiedad!Operador & " " & xRsPropiedad!Descripcion, 31, 10
                                  'Printer.Print "        * " & xRsPropiedad!Operador & " " & xRsPropiedad!Descripcion
                                  xRsPropiedad.MoveNext
                               Loop
                            End If
                                        
                            'Impresion de la Observacion
                            If lObservacionDocumento And Len(Trim(xObservacion)) > 0 Then
                               ImprimeXLinea "        - " & Trim(xObservacion), 33, 2
                            End If
                            End If
                          
                            'CESAR IMP
                            If RsImpresion!nImpuesto1 > 0 And RsImpresion!nImpuesto2 > 0 Then
                                  impG = impxT
                            ElseIf RsImpresion!nImpuesto1 > 0 And RsImpresion!nImpuesto2 = 0 Then
                                  impG = impx1
                            ElseIf RsImpresion!nImpuesto1 = 0 And RsImpresion!nImpuesto2 > 0 Then
                                  impG = impx2
                            Else
                                  impG = 1
                            End If
                            
                            
                            If IsNull(RsImpresion!tOferta) Or RsImpresion!tOferta = "" Then
                                                  
                             
                                CANT = Len(Trim(xproducto))
                                ProductoTem = xproducto
regreso4:
                                If Valor = 0 Then
                                   sLinea = Right(String(5, " ") & Format(RsImpresion!nCantidad, "#0.00"), 5) & " " & Mid(xproducto & String(19, " "), 1, 19) & " " & Right(String(6, " ") & Format(RsImpresion!nPrecioOficial / impG, "##0.00"), 6) & " " & Right(String(7, " ") & Format((RsImpresion!nPrecioOficial * RsImpresion!nCantidad) / impG, "###0.00"), 7)
                                    Valor = 1
                                    CANT = Len(Mid(ProductoTem, 20))
                                    ProductoTem = Mid(ProductoTem, 20)
                                    Printer.Print sLinea
                                Else
                                    sLinea = Right(String(5, " ") & "     ", 5) & " " & Mid(ProductoTem & String(19, " "), 1, 19) & " " & Right(String(6, " ") & Format(RsImpresion!nPrecioOficial / impG, "##0.00"), 6) & " " & Right(String(7, " ") & "       ", 7)
                                    CANT = Len(Mid(ProductoTem, 20))
                                    ProductoTem = Mid(ProductoTem, 20)
                                    Printer.Print sLinea
                                End If
                                
                                If CANT > 0 And ximprimeDetallado = True Then
                                GoTo regreso4
                                End If

                             
                              'sLinea = Right(String(5, " ") & Format(RsImpresion!nCantidad, "#0.00"), 5) & " " & Mid(xproducto & String(19, " "), 1, 19) & " " & Right(String(6, " ") & Format(RsImpresion!nPrecioOficial / impG, "##0.00"), 6) & " " & Right(String(7, " ") & Format((RsImpresion!nPrecioOficial * RsImpresion!nCantidad) / impG, "###0.00"), 7)
                            Else
                            
                            
                            CANT = Len(Trim(xproducto))
                             ProductoTem = xproducto
regreso5:
                                If Valor = 0 Then
                                    sLinea = Right(String(5, " ") & Format(RsImpresion!nCantidad, "#0.00"), 5) & " " & Mid(xproducto & String(21, " "), 1, 21)
                                    Valor = 1
                                    CANT = Len(Mid(ProductoTem, 22))
                                    ProductoTem = Mid(ProductoTem, 22)
                                    Printer.Print sLinea
                                Else
                                    sLinea = Right(String(5, " ") & "     ", 5) & " " & Mid(ProductoTem & String(21, " "), 1, 21)

                                    CANT = Len(Mid(ProductoTem, 22))
                                    ProductoTem = Mid(ProductoTem, 22)
                                    Printer.Print sLinea
                                End If
                                
                                If CANT > 0 And ximprimeDetallado = True Then
                                GoTo regreso5
                                End If

                            
                             sLinea = String(8, " ") & " " & Mid(RsImpresion!tOferta & String(20, " "), 1, 20) & " " & Right(String(10, " ") & Format((RsImpresion!nPrecioOficial * RsImpresion!nCantidad) / impG, "###,##0.00"), 10)
                              Printer.Print sLinea
                            End If
                            Valor = 0
                            '---CESAR IMP
                            xDiferencia = ((RsImpresion!nPrecioOficial * RsImpresion!nCantidad) / impG) - (RsImpresion!Venta - (RsImpresion!nImpuesto1 * RsImpresion!nCantidad) - (RsImpresion!nImpuesto2 * RsImpresion!nCantidad))
                            xDescuento = xDescuento + xDiferencia
                            xAumento = (RsImpresion!Venta - (RsImpresion!nImpuesto1 * RsImpresion!nCantidad) - (RsImpresion!nImpuesto2 * RsImpresion!nCantidad)) - ((RsImpresion!nPrecioOficial * RsImpresion!nCantidad) / impG)
                            xRecargo = xRecargo + xAumento
                            xSubTotal = xSubTotal + ((RsImpresion!nPrecioOficial * RsImpresion!nCantidad) / impG)
                            '------------
                          
                          'Printer.Print sLinea
                       End If
                       
                    
                       'Combos
                       If lComboDocumento And IIf(IsNull(RsImpresion!Combo), 0, Len(Trim(RsImpresion!Combo))) > 0 Then
                          sLinea = Mid("       " & Right(String(5, " ") & Format(RsImpresion!nCombo, "#0.00"), 5) & " " & RsImpresion!Combo, 1, 40)
                          Printer.Print sLinea
                          
                          'Combos Propiedades
                          If lPropiedadDocumento And Len(Trim(IIf(IsNull(RsImpresion!Combo), "", RsImpresion!Combo))) > 0 Then
                          
                             xRsPropiedadCombo.Filter = "tCodigoPedido='" & RsImpresion!tCodigoPedido & "' and tItem='" & RsImpresion!tItem & "' and tItemCombo='" & RsImpresion!tItemCombo & "'"
                             If Not xRsPropiedadCombo.EOF Then
                                xRsPropiedadCombo.MoveFirst
                                Do While Not xRsPropiedadCombo.EOF
                                   ImprimeXLinea "             * " & xRsPropiedadCombo!Operador & " " & xRsPropiedadCombo!Descripcion, 40, 13
                                   xRsPropiedadCombo.MoveNext
                                Loop
                             End If
                          
                             'Impresion de la Observacion
                              If lObservacionDocumento And Len(Trim(RsImpresion!tObservacionCombo)) > 0 Then
                                 ImprimeXLinea "        - " & Trim(RsImpresion!tObservacionCombo), 33, 2
                              End If
                          End If
                       End If
                       xObservacion = IIf(IsNull(RsImpresion!tObservacionPedido), "", RsImpresion!tObservacionPedido)
                       Item = RsImpresion!tCodigoPedido + RsImpresion!tItem
                       RsImpresion.MoveNext
                    Loop
                    
                    If lPropiedadDocumento Then
                       xRsPropiedad.Filter = "tCodigoPedido='" & Mid(Item, 1, 10) & "' and tItem='" & Mid(Item, 11, 3) & "'"
                       If Not xRsPropiedad.EOF Then
                          xRsPropiedad.MoveFirst
                          Do While Not xRsPropiedad.EOF
                             ImprimeXLinea "        * " & IIf(xRsPropiedad!nCantidad = 1, "", "(" & xRsPropiedad!nCantidad & ")") & xRsPropiedad!Operador & " " & xRsPropiedad!Descripcion, 31, 10
                             xRsPropiedad.MoveNext
                          Loop
                       End If
                                   
                       'Impresion de la Observacion
                       If lObservacionDocumento And Len(Trim(xObservacion)) > 0 Then
                          ImprimeXLinea "        - " & Trim(xObservacion), 33, 2
                       End If
                    End If
                    
                    'Printer.Print
                    Printer.Print String(40, "-")
                    RsImpresion.MoveLast
                                        
                    'Printer.Print Right(String(27, " ") & "Venta : ", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta + RsImpresion!nDescuento - RsImpresion!nRecargo, "##,###,##0.00"), 13)
                    'Printer.Print Right(String(27, " ") & "Sub Total : ", 27) & Right(String(13, " ") & Format(RsImpresion!nNeto, "##,###,##0.00"), 13)
                    If lPagoAntesImpresion Then
                            lcuentaCobrar = True
                            If lcuentaCobrar And lPagocortesiaAI = False Then
                                Printer.Print Right(String(27, " ") & "Sub Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xSubTotal, "##,###,##0.00"), 13)
                                Printer.Print String(40, " ")
                            Else
                                Printer.Print Right(String(27, " ") & "Sub Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(0, "##,###,##0.00"), 13)
                                Printer.Print String(40, " ")
                            End If
                    Else
                        Printer.Print Right(String(27, " ") & "Sub Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xSubTotal, "##,###,##0.00"), 13)
                        Printer.Print String(40, " ")
                    End If
                    
                    If RsImpresion!nRecargo > 0 Then
                       Printer.Print
                       'Printer.Print Right(String(27, " ") & "Recargo : ", 27) & Right(String(13, " ") & Format(RsImpresion!nRecargo, "##,###,##0.00"), 13)
                        Printer.Print Right(String(27, " ") & "Recargo " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xRecargo, "##,###,##0.00"), 13)
                    End If
                    
                    If RsImpresion!nDescuento > 0 Then
                       Printer.Print
                       'Printer.Print Right(String(27, " ") & "Descuento : ", 27) & Right(String(13, " ") & Format(RsImpresion!nDescuento, "##,###,##0.00"), 13)
                       Printer.Print Right(String(27, " ") & "Descuento " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xDescuento, "##,###,##0.00"), 13)
                    End If
                            
                    Printer.Print Right(String(27, " ") & "Base " & sImpuesto1 & " " & nPorcentaje1 & "%: ", 27) & Right(String(13, " ") & Format(cIGV, "##,###,##0.00"), 13)
                    Printer.Print Right(String(27, " ") & "Base " & sImpuesto1 & " 0%: ", 27) & Right(String(13, " ") & Format(sIGV, "##,###,##0.00"), 13)
                    Printer.Print ""
                    
                    nSumaNeto = RsImpresion!nNeto
                    
                    If IsNull(RsImpresion!lImpuesto1) Or Not RsImpresion!lImpuesto1 Then
                       nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto1
                    End If
                    
                    If IsNull(RsImpresion!lImpuesto2) Or Not RsImpresion!lImpuesto2 Then
                       nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto2
                    End If
                    
                    If IsNull(RsImpresion!lImpuesto3) Or Not RsImpresion!lImpuesto3 Then
                       nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto3
                    End If
                    
                    'CESAR Por Consumo No - FACTURA
                    If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
                       Printer.Print Right(String(27, " ") & "Sub Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(nSumaNeto, "##,###,##0.00"), 13)
                    End If
                                  
                    If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                       Printer.Print Right(String(27, " ") & sImpuesto1 & " " & Format(nPorcentaje1, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,##0.00"), 13)
                    End If
                       
                    If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                       Printer.Print Right(String(27, " ") & sImpuesto2 & " " & Format(nPorcentaje2, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto2, "##,###,##0.00"), 13)
                    End If
                    
                    If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                       Printer.Print Right(String(27, " ") & sImpuesto3 & " " & Format(nPorcentaje3, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto3, "##,###,##0.00"), 13)
                    End If
                    
                    'Printer.Print CarlosD
                        If lPagoAntesImpresion Then
                            lcuentaCobrar = True
                            If lcuentaCobrar And lPagocortesiaAI = False Then
                                Printer.Print Right(String(27, " ") & "Importe Total " & sMonN & " :", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 13)
                            Else
                                Printer.Print Right(String(27, " ") & "Importe Total " & sMonN & " :", 27) & Right(String(13, " ") & Format(0, "##,###,##0.00"), 13)
                            End If
                        Else
                             Printer.Print Right(String(27, " ") & "Importe Total " & sMonN & " :", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 13)
                        End If
                    'Printer.Print Right(String(27, " ") & "Total " & sMonN & " :", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 13)
                    'Printer.Print
                    'CarlosD 2/12/2006
                    If lEquivalencia = True Or lDocumEquivaPrecuenta = True Then
                         If lPagoAntesImpresion Then
                         lcuentaCobrar = True
                                If lcuentaCobrar And lPagocortesiaAI = False Then
                                    Printer.Print Right(String(27, " ") & "Importe Total " & sMonE & " :", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 13)
                                    Printer.Print
                                Else
                                    Printer.Print Right(String(27, " ") & "Importe Total " & sMonE & " :", 27) & Right(String(13, " ") & Format(0, "##,###,##0.00"), 13)
                                    Printer.Print
                                End If
                        Else
                            Printer.Print Right(String(27, " ") & "Importe Total " & sMonE & " :", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 13)
                            Printer.Print
                        End If
                    
                       'Printer.Print Right(String(27, " ") & "Total " & sMonE & " :", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 13)
                       'Printer.Print
                    End If
                    'End CarlosD
                   Printer.Print
                    If Calcular(" SELECT case when  lImpresionRetencion=1 then 1 else 0 end  as codigo FROM vTipodocumento WHERE Codigo=(SELECT TTIPODOCUMENTO FROM MDOCUMENTO WHERE tDocumento='" & RsImpresion!tDocumento & "')", Cn) = 1 Then
                        'ImprimeXCentro tTextoAgenteRetencion, 70
                        ImprimeXLinea tTextoAgenteRetencion, 40, 5
                    End If
                    
                     If lPagoAntesImpresion Then
                        lcuentaCobrar = True
                                If lcuentaCobrar And lPagocortesiaAI = False Then
                                    Printer.Print
                                    txt = "Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
                                    ImprimeXLinea txt, 40, 5
                                Else
                                    Printer.Print
                                     txt = "Son: " & NumeroCadena(str(0)) & " " & sMonedaN
                                    ImprimeXLinea txt, 40, 5
                                End If
                        Else
                            Printer.Print
                            txt = "Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
                            ImprimeXLinea txt, 40, 5
                        End If
'                    Printer.Print
'                    txt = "Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
'                    ImprimeXLinea txt, 40, 5
                    
                    Printer.Print String(40, "-")
                    Printer.Print "Inforest v.4.94 "
                    Printer.Print
                    Printer.Print String(40, "-")
                    
                    'impresion cliente frecuente
                    Dim rstCliente As New Recordset
                    Dim cadenaImprime As String
                    
                    Set rstCliente = Lib.OpenRecordset("SELECT ISNULL(dbo.MPEDIDO.tCodigoInvitado, N'') AS cinvitado, ISNULL(dbo.MPEDIDO.tCodigoPariente, N'') AS cpariente, ISNULL(dbo.MPEDIDO.tClienteDelivery, N'')  AS cdelivery, dbo.vDelivery.tApellido + ' ' + dbo.vDelivery.tNombre AS Socio, ISNULL(dbo.TPARIENTE.tApellido, N'') + '  ' + ISNULL(dbo.TPARIENTE.tNombre, N'') AS Pariente, ISNULL(dbo.tdeliveryinvitado.tApellido, N'') + ' ' + ISNULL(dbo.Tdeliveryinvitado.tNombre, N'') AS Invitado FROM dbo.MPEDIDO LEFT OUTER JOIN dbo.TDELIVERYINVITADO ON dbo.MPEDIDO.tCodigoInvitado = dbo.TDELIVERYINVITADO.tCodigoInvitado LEFT OUTER JOIN                       dbo.TPARIENTE ON dbo.MPEDIDO.tCodigoPariente = dbo.TPARIENTE.tCodigoPariente AND                       dbo.MPEDIDO.tClienteDelivery = dbo.TPARIENTE.tCodigoDelivery LEFT OUTER JOIN dbo.vDelivery ON dbo.MPEDIDO.tClienteDelivery = dbo.vDelivery.Codigo WHERE  (dbo.MPEDIDO.tCodigoPedido = (SELECT MAX(tCodigoPedido) AS Expr1 From dbo.DDOCUMENTO " & _
                            " WHERE      (tDocumento = '" & RsImpresion!tDocumento & "')))", Cn)
                    
                    If Not (rstCliente.EOF Or rstCliente.BOF) Then
                        rstCliente.MoveFirst
                        
                        If rstCliente.Fields(2) <> "" Then ' socio
                                ImprimeXLinea "Socio  : " & rstCliente.Fields(3), 40, 11
                        End If
                        If rstCliente.Fields(1) <> "" Then ' pariente
                                ImprimeXLinea "Pariente  : " & rstCliente.Fields(4), 40, 11
                        End If
                        If rstCliente.Fields(0) <> "" Then ' invitado
                                ImprimeXLinea "Invitado  : " & rstCliente.Fields(5), 40, 11
                        End If
                    End If
                    
                    
                    
                    'Printer.Print
                    'Printer.Print
                    'Printer.Print
                    'impresion cliente frecuente
                    Printer.Print
                    ImprimeXCentro "------------------------------", 40
                    ImprimeXCentro LTrim(RsImpresion!Cliente), 40
                    ImprimeXCentro sPie, 40
                    
                    Printer.Print
                    Printer.Print "Original : Cliente"
                    Printer.Print "Copia    : Emisor"
                    
                    
                    
                    If lPagoAntesImpresion Then
                        lcuentaCobrar = True
                        'Set RsPagoDocumento = Lib.OpenRecordset("select Distinct v.tResumido + ' ' + M.tResumido as pago , Sum(D.nMonto) as monto from DPAGODOCUMENTO D inner join vTipoPago v on d.tTipoPago = v.Codigo inner join vMoneda M on M.Codigo = D.tMoneda Where D.tDocumento = '" & RsImpresion!tDocumento & "' group by v.tResumido,  M.tResumido", Cn)
                        Set RsPagoDocumento = Lib.OpenRecordset("exec usp_Inforest_Impresion '" & RsImpresion!tDocumento & "', 9 ", Cn)
                        Printer.Print " "
                    
                        If pais = "000" Then 'PERU
                            Printer.Print String(40, "-")
                            
                            If RsPagoDocumento.RecordCount > 0 Then
                                Printer.Print "Forma de Pago:"
                                For i = 0 To RsPagoDocumento.RecordCount - 1
                                    lcuentaCobrar = False
                                    Printer.Print RsPagoDocumento!pago & " " & Format(RsPagoDocumento!Monto, "##,###,##0.00")
                                    RsPagoDocumento.MoveNext
                                Next i
                                Printer.Print "Vuelto       :" & sMonN & " " & Format(RsImpresion!Vuelto, "##,###,##0.00")
                            Else
                                If lcuentaCobrar And lPagocortesiaAI = False Then
                                    Printer.Print "Forma de Pago:Enviado a Cuenta por Cobrar"
                                Else
                                    ImprimeXLinea "Forma de Pago: " & lGlosaTrans, 40, 15
                                End If
                            End If
                            Printer.Print String(40, "-")
                            
                        Else 'ECUADOR
                            If RsPagoDocumento.RecordCount > 0 Then
                                For i = 0 To RsPagoDocumento.RecordCount - 1
                                    lcuentaCobrar = False
                                    Printer.Print "Forma de Pago:" & RsPagoDocumento!pago & " " & Format(RsPagoDocumento!Monto, "##,###,##0.00")
                                    RsPagoDocumento.MoveNext
                                Next i
                            Else
                                If lcuentaCobrar And lPagocortesiaAI = False Then
                                    Printer.Print "Forma de Pago:Enviado a Cuenta por Cobrar"
                                Else
                                    ImprimeXLinea "Forma de Pago: " & lGlosaTrans, 40, 15
                                    'Printer.Print "Forma de Pago:Cortesia"
                                End If
                            End If
                        End If
                    
                        Printer.Print " "
                    End If
                    
                    
'                    'On Error Resume Next
'                    Set imgDocumento = CreateObject("Scripting.FileSystemObject")
'                    If imgDocumento.FileExists(App.Path & "\bmps\ImgDocumento.jpg") Then
'                        Printer.Print
'                        Printer.PaintPicture LoadPicture(App.Path & "\bmps\ImgDocumento.jpg"), 400, Printer.CurrentY, 2800, 1000
'                    End If
'
                    Set xRsPropiedad = Nothing
                    Set xRsPropiedadCombo = Nothing
                    Set RsEcua = Nothing
                    
                    Printer.Print
                    Printer.Print
    
                    If lImprimeImagPieDocumento Then
                                        If pie <> 0 Then
                                           Printer.PaintPicture pie, 500, Printer.CurrentY, 2860, 1600
                                        End If
                                End If
                    Printer.EndDoc
        
        
        Case Else 'Peru
                    'Cabecera
                    If lImprimeImagCabDocumento Then
                                    If Cabecera <> 0 Then
                                    Printer.PaintPicture Cabecera, 500, Printer.CurrentY, 2860, 1600
                                    For p = 1 To 10
                                    Printer.Print
                                    Next p
                                    End If
                    End If
                    
                    
                    RsImpresion.MoveFirst

                    ImprimeXCentro sRazonSocial, 40
                    ImprimeXCentro sRazonComercial, 40
                    sLinea = String((40 - Len(Trim("R.U.C.: " + sRUC))) / 2, " ") & "R.U.C.: " + sRUC
                    Printer.Print sLinea
                    ImprimeXCentro sDireccion, 40
                    If Trim(sDireccion2) <> "" Then
                        ImprimeXCentro sDireccion2, 40
                    End If
                    sLinea = String((40 - Len(Trim("Telefono: " + sTelefono))) / 2, " ") & "Telefono: " + sTelefono
                    Printer.Print sLinea
     
                    Printer.Print
                    Printer.Print Mid(RsImpresion!tDocumento, 1, 1) & "-" & Mid(RsImpresion!tDocumento, 2, 5) & "-" & Mid(RsImpresion!tDocumento, 7)
                    Printer.Print
                    Printer.Print "Pedido   : " & RsImpresion!tCodigoPedido
                    
                             'impresiondiacontable
                            If lImpresionDiaContable Then
                                If lReimpresion = True Then
                                    Printer.Print "Fecha    : " & Format(Calcular("select fdiacontable as codigo from mdocumento where tdocumento ='" & RsImpresion!tDocumento & "'", Cn), "dd/MM/yyyy") & " " & Calcular("exec DiacontableHora '" & fImpresionDiaContable & "'", Cn)
                                    
                                    Else
                                    Printer.Print "Fecha    : " & fImpresionDiaContable & " " & Calcular("exec DiacontableHora '" & fImpresionDiaContable & "'", Cn)
                                End If
                                Else
                                 Printer.Print "Fecha    : " & RsImpresion!fRegistro
                            End If
                            
                                              
                    'Printer.Print "Fecha    : " & RsImpresion!fRegistro
                    Printer.Print "Tipo     : " & RsImpresion!tipopedido
                    Printer.Print "Caja     : " & RsImpresion!tCaja & " - " & RsImpresion!tUsuario
                    If RsImpresion!Mozo <> "" Then
                    Printer.Print "Mesero   : " & RsImpresion!Mozo
                    End If
                    Printer.Print "Nro.Serie: " & Calcular("select isnull(tSerieImpresora,'') codigo from MDOCUMENTO where tDocumento ='" & RsImpresion!tDocumento & "'", Cn)
                    If Mid(Trim(RsImpresion!DESCUENTO), 1, 30) <> "" Then
                    Printer.Print "Descuento: " & Mid(Trim(RsImpresion!DESCUENTO), 1, 30)
                    Printer.Print
                    End If
                    If RsImpresion!Mesa <> "" Then
                    Printer.Print "MESA     : " & RsImpresion!Mesa
                    End If
                    If lObservacionCabDoc Then
                        If RsImpresion!tObservacion <> "" Then
                            Printer.Print "Observac.: " & RsImpresion!tObservacion
                            Printer.Print
                        End If
                    End If
                    Printer.Print String(40, "-")
                    Printer.Print "Cantid. Producto                SubTotal"
                    Printer.Print String(40, "-")
                                      
                    'Cuerpo
                    Item = ""
                    'Cuerpo
                    Do While Not RsImpresion.EOF
                    If ximprimeDetallado = False Then
                        xproducto = RsImpresion!Producto
                    Else
                        xproducto = RsImpresion!ProductoDetallado
                    End If
                    
                       If Item <> RsImpresion!tCodigoPedido + RsImpresion!tItem Then
                          'Impresion de Propiedades
                          If lPropiedadDocumento Then
                             xRsPropiedad.Filter = "tCodigoPedido='" & Mid(Item, 1, 10) & "' and tItem='" & Mid(Item, 11, 3) & "'"
                             If Not xRsPropiedad.EOF Then
                                xRsPropiedad.MoveFirst
                                Do While Not xRsPropiedad.EOF
                                    'Printer.Print "        * " & xRsPropiedad!Operador & " " & xRsPropiedad!Descripcion
                                    'ImprimeXLinea "        * " & xRsPropiedad!Operador & " " & xRsPropiedad!Descripcion, 40, 8
                                    ImprimeXLinea "        * " & IIf(xRsPropiedad!nCantidad = 1, "", "(" & xRsPropiedad!nCantidad & ")") & xRsPropiedad!Operador & " " & xRsPropiedad!Descripcion, 31, 10
                                   xRsPropiedad.MoveNext
                                Loop
                             End If
                                         
                             'Impresion de la Observacion
                             If lObservacionDocumento And Len(Trim(xObservacion)) > 0 Then
                                ImprimeXLinea "        - " & Trim(xObservacion), 33, 10
                             End If
                          End If
                          If IsNull(RsImpresion!tOferta) Or RsImpresion!tOferta = "" Then ' & String(1, " ")
                          '---------------- Top de 18 carcteres por y salto de linea en el modulo
'                          Dim cant, Valor As Integer
'                          Dim ProductoTem As String
                                CANT = Len(Trim(xproducto))
                                ProductoTem = xproducto
regreso:
                                If Valor = 0 Then
                                    If ImpDolarDelivery Then
                                        sLinea = Right(String(8, " ") & Format(RsImpresion!nCantidad, "####0.00"), 8) & " " & Mid(Trim(xproducto) & String(21, " "), 1, 21) & " " & Right(String(9, " ") & Format((RsImpresion!nCantidad * RsImpresion!nPrecioOficial) / nTC, "##,##0.00"), 9)
                                    Else
                                        sLinea = Right(String(8, " ") & Format(RsImpresion!nCantidad, "####0.00"), 8) & " " & Mid(Trim(xproducto) & String(21, " "), 1, 21) & " " & Right(String(9, " ") & Format(RsImpresion!nCantidad * RsImpresion!nPrecioOficial, "##,##0.00"), 9)
                                    End If
                                    'sLinea = Right(String(7, " ") & Format(RsImpresion!nCantidad, "#####0.00"), 8) & " " & Trim(xproducto) & " " & Right(String(12, " ") & Format(RsImpresion!nCantidad * RsImpresion!nPrecioOficial, "#,###,##0.00"), 12)
                                    Valor = 1
                                    CANT = Len(Mid(ProductoTem, 22))
                                    ProductoTem = Mid(ProductoTem, 22)
                                    Printer.Print sLinea
                                Else
                                    sLinea = Right(String(8, " ") & "        ", 8) & " " & Mid(Trim(ProductoTem) & String(21, " "), 1, 21) & " " & Right(String(9, " ") & "            ", 9)
                                    CANT = Len(Mid(ProductoTem, 22))
                                    ProductoTem = Mid(ProductoTem, 22)
                                    Printer.Print sLinea
                                End If
                                
                                If CANT > 0 And ximprimeDetallado = True Then
                                GoTo regreso
                                End If
                            '------------------------------------------------------------------------------
                          Else
                          
                          '----------------------------------cambio erick -------------------------
'                            Dim cant, Valor As Integer
'                          Dim ProductoTem As String
                                CANT = Len(Trim(xproducto))
                                ProductoTem = xproducto
regreso1:
                                If Valor = 0 Then
                                    sLinea = Right(String(8, " ") & Format(RsImpresion!nCantidad, "####0.00"), 8) & " " & Mid(Trim(xproducto) & String(25, " "), 1, 25)
                                    Printer.Print sLinea
                                
                                    Valor = 1
                                    CANT = Len(Mid(ProductoTem, 26))
                                    ProductoTem = Mid(ProductoTem, 26)
                                    
                                Else
                                    sLinea = Right(String(8, " ") & "        ", 8) & " " & Mid(Trim(ProductoTem) & String(25, " "), 1, 25)
                                    CANT = Len(Mid(ProductoTem, 26))
                                    ProductoTem = Mid(ProductoTem, 26)
                                    Printer.Print sLinea
                                End If
                                
                                If CANT > 0 And ximprimeDetallado = True Then
                                GoTo regreso1
                                End If
                                
                                If ImpDolarDelivery Then
                                    sLinea = String(8, " ") & " " & Mid(RsImpresion!tOferta & String(20, " "), 1, 20) & " " & Right(String(10, " ") & Format((RsImpresion!nCantidad * RsImpresion!nPrecioOficial) / nTC, "###,##0.00"), 10)
                                Else
                                    sLinea = String(8, " ") & " " & Mid(RsImpresion!tOferta & String(20, " "), 1, 20) & " " & Right(String(10, " ") & Format(RsImpresion!nCantidad * RsImpresion!nPrecioOficial, "###,##0.00"), 10)
                                End If
                                Printer.Print sLinea

                          '-------------------------


                          End If
                          xTotalS = xTotalS + (RsImpresion!nCantidad * RsImpresion!nPrecioOficial)
                          'Printer.Print sLinea
                          Valor = 0
                       End If
                       
                       'Combos
                       If lComboDocumento And IIf(IsNull(RsImpresion!Combo), 0, Len(Trim(RsImpresion!Combo))) > 0 Then
                          sLinea = Mid("       " & Right(String(5, " ") & Format(RsImpresion!nCombo, "#0.00"), 5) & " " & RsImpresion!Combo, 1, 40)
                          Printer.Print sLinea
                          
                          'Combos Propiedades
                          If lPropiedadDocumento And Len(Trim(IIf(IsNull(RsImpresion!Combo), "", RsImpresion!Combo))) > 0 Then
                          
                             xRsPropiedadCombo.Filter = "tCodigoPedido='" & RsImpresion!tCodigoPedido & "' and tItem='" & RsImpresion!tItem & "' and tItemCombo='" & RsImpresion!tItemCombo & "'"
                             If Not xRsPropiedadCombo.EOF Then
                                xRsPropiedadCombo.MoveFirst
                                Do While Not xRsPropiedadCombo.EOF
                                   'Printer.Print "        * " & xRsPropiedadCombo!Operador & " " & xRsPropiedadCombo!Descripcion
                                    ImprimeXLinea "             * " & xRsPropiedadCombo!Operador & " " & xRsPropiedadCombo!Descripcion, 30, 15
                                   xRsPropiedadCombo.MoveNext
                                Loop
                             End If
                          
                             'Impresion de la Observacion
                              If lObservacionDocumento And Len(Trim(RsImpresion!tObservacionCombo)) > 0 Then
                                 ImprimeXLinea "        - " & Trim(RsImpresion!tObservacionCombo), 33, 10
                              End If
                          End If
                       End If
                       xObservacion = IIf(IsNull(RsImpresion!tObservacionPedido), "", RsImpresion!tObservacionPedido)
                       Item = RsImpresion!tCodigoPedido + RsImpresion!tItem
                       RsImpresion.MoveNext
                    Loop
                    
                    If lPropiedadDocumento Then
                       xRsPropiedad.Filter = "tCodigoPedido='" & Mid(Item, 1, 10) & "' and tItem='" & Mid(Item, 11, 3) & "'"
                       If Not xRsPropiedad.EOF Then
                          xRsPropiedad.MoveFirst
                          Do While Not xRsPropiedad.EOF
                             'Printer.Print "        * " & xRsPropiedad!Operador & " " & xRsPropiedad!Descripcion
                              ImprimeXLinea "        * " & IIf(xRsPropiedad!nCantidad = 1, "", "(" & xRsPropiedad!nCantidad & ")") & xRsPropiedad!Operador & " " & xRsPropiedad!Descripcion, 31, 10
                             xRsPropiedad.MoveNext
                          Loop
                       End If
                                   
                       'Impresion de la Observacion
                       If lObservacionDocumento And Len(Trim(xObservacion)) > 0 Then
                          ImprimeXLinea "        - " & Trim(xObservacion), 33, 2
                       End If
                    End If
                    
                    'Printer.Print
                    Printer.Print String(40, "-")
                    RsImpresion.MoveLast
                    
                    If ImpDolarDelivery Then
                        
                        If lPagoAntesImpresion Then
                                lcuentaCobrar = True
                                If lcuentaCobrar And lPagocortesiaAI = False Then
                                    Printer.Print Right(String(27, " ") & " Total a Pagar " & sMonE & " : ", 27) & Right(String(13, " ") & Format(xTotalS / nTC, "##,###,##0.00"), 13)
                                Else
                                    Printer.Print Right(String(27, " ") & " Total a Pagar " & sMonE & " : ", 27) & Right(String(13, " ") & Format(0, "##,###,##0.00"), 13)
                                End If
                            'Printer.Print Right(String(27, " ") & " Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta + RsImpresion!nDescuento - RsImpresion!nRecargo, "##,###,##0.00"), 13)
                        Else
                             Printer.Print Right(String(27, " ") & " Total a Pagar " & sMonE & " : ", 27) & Right(String(13, " ") & Format(xTotalS / nTC, "##,###,##0.00"), 13)
                            'Printer.Print Right(String(27, " ") & " Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta + RsImpresion!nDescuento - RsImpresion!nRecargo, "##,###,##0.00"), 13)
                        End If
                    Else
                        '0035-2013 CESAR
                        If lPagoAntesImpresion Then
                                lcuentaCobrar = True
                                If lcuentaCobrar And lPagocortesiaAI = False Then
                                    Printer.Print Right(String(27, " ") & " Total a Pagar " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xTotalS, "##,###,##0.00"), 13)
                                Else
                                    Printer.Print Right(String(27, " ") & " Total a Pagar " & sMonN & " : ", 27) & Right(String(13, " ") & Format(0, "##,###,##0.00"), 13)
                                End If
                            'Printer.Print Right(String(27, " ") & " Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta + RsImpresion!nDescuento - RsImpresion!nRecargo, "##,###,##0.00"), 13)
                        Else
                             Printer.Print Right(String(27, " ") & " Total a Pagar " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xTotalS, "##,###,##0.00"), 13)
                            'Printer.Print Right(String(27, " ") & " Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta + RsImpresion!nDescuento - RsImpresion!nRecargo, "##,###,##0.00"), 13)
                        End If
                    End If
                   Printer.Print String(40, " ")
                   
                    If ImpDolarDelivery Then
                        If RsImpresion!nRecargo > 0 Then
                           Printer.Print
                           Printer.Print Right(String(27, " ") & "Recargo " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nRecargo / nTC, "##,###,##0.00"), 13)
                        End If
                        
                        If RsImpresion!nDescuento > 0 Then
                           Printer.Print
                           Printer.Print Right(String(27, " ") & "Descuento " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nDescuento / nTC, "##,###,##0.00"), 13)
                        End If
                    Else
                        If RsImpresion!nRecargo > 0 Then
                           Printer.Print
                           Printer.Print Right(String(27, " ") & "Recargo " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nRecargo, "##,###,##0.00"), 13)
                        End If
                        
                        If RsImpresion!nDescuento > 0 Then
                           Printer.Print
                           Printer.Print Right(String(27, " ") & "Descuento " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nDescuento, "##,###,##0.00"), 13)
                        End If
                    End If
                    
                    'Dim nSumaNeto As Double
                    nSumaNeto = RsImpresion!nNeto
                    
                    If IsNull(RsImpresion!lImpuesto1) Or Not RsImpresion!lImpuesto1 Then
                       nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto1
                    End If
                    
                    If IsNull(RsImpresion!lImpuesto2) Or Not RsImpresion!lImpuesto2 Then
                       nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto2
                    End If
                    
                    If IsNull(RsImpresion!lImpuesto3) Or Not RsImpresion!lImpuesto3 Then
                       nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto3
                    End If
                    'CESAR Por Consumo No - FACTURA
                    If ImpDolarDelivery Then
                        If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
                           Printer.Print Right(String(27, " ") & "Sub Total " & sMonE & " : ", 27) & Right(String(13, " ") & Format(nSumaNeto / nTC, "##,###,##0.00"), 13)
                        End If
                                      
                        If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                           Printer.Print Right(String(27, " ") & sImpuesto1 & " " & Format(nPorcentaje1, "##0.00") & "% " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto1 / nTC, "##,###,##0.00"), 13)
                        End If
                           
                        If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                           Printer.Print Right(String(27, " ") & sImpuesto2 & " " & Format(nPorcentaje2, "##0.00") & "% " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto2 / nTC, "##,###,##0.00"), 13)
                        End If
                        
                        If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                           Printer.Print Right(String(27, " ") & sImpuesto3 & " " & Format(nPorcentaje3, "##0.00") & "% " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto3 / nTC, "##,###,##0.00"), 13)
                        End If
                    Else
                        If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
                           Printer.Print Right(String(27, " ") & "Sub Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(nSumaNeto, "##,###,##0.00"), 13)
                        End If
                                      
                        If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                           Printer.Print Right(String(27, " ") & sImpuesto1 & " " & Format(nPorcentaje1, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,##0.00"), 13)
                        End If
                           
                        If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                           Printer.Print Right(String(27, " ") & sImpuesto2 & " " & Format(nPorcentaje2, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto2, "##,###,##0.00"), 13)
                        End If
                        
                        If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                           Printer.Print Right(String(27, " ") & sImpuesto3 & " " & Format(nPorcentaje3, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto3, "##,###,##0.00"), 13)
                        End If
                    End If
                    
                    'Printer.Print CarlosD
                    If lPagoAntesImpresion Then
                        lcuentaCobrar = True
                        If lcuentaCobrar And lPagocortesiaAI = False Then
                            If ImpDolarDelivery Then
                              Printer.Print Right(String(27, " ") & "Importe Total " & sMonE & " :", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 13)
                            Else
                                Printer.Print Right(String(27, " ") & "Importe Total " & sMonN & " :", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 13)
                            End If
                        Else
                            If ImpDolarDelivery Then
                                Printer.Print Right(String(27, " ") & "Importe Total " & sMonE & " :", 27) & Right(String(13, " ") & Format(0, "##,###,##0.00"), 13)
                            Else
                                Printer.Print Right(String(27, " ") & "Importe Total " & sMonN & " :", 27) & Right(String(13, " ") & Format(0, "##,###,##0.00"), 13)
                            End If
                        End If
                    Else
                        If ImpDolarDelivery Then
                            Printer.Print Right(String(27, " ") & "Importe Total " & sMonE & " :", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 13)
                        Else
                            Printer.Print Right(String(27, " ") & "Importe Total " & sMonN & " :", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 13)
                        End If
                    End If
                    
                    'Printer.Print Right(String(27, " ") & "Total " & sMonN & " :", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 13)
                    'Printer.Print
                    'CarlosD 2/12/2006
                    If ImpDolarDelivery Then
                    Else
                        If lEquivalencia = True Or lDocumEquivaPrecuenta = True Then
                            If lPagoAntesImpresion Then
                                lcuentaCobrar = True
                                        If lcuentaCobrar And lPagocortesiaAI = False Then
                                            Printer.Print Right(String(27, " ") & "Importe Total " & sMonE & " :", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 13)
                                            Printer.Print
                                        Else
                                            Printer.Print Right(String(27, " ") & "Importe Total " & sMonE & " :", 27) & Right(String(13, " ") & Format(0, "##,###,##0.00"), 13)
                                            Printer.Print
                                        End If
    
                            Else
                                Printer.Print Right(String(27, " ") & "Importe Total " & sMonE & " :", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 13)
                                Printer.Print
                            End If
                        End If
                    End If
                    'End CarlosD
                    Printer.Print
                    If Calcular(" SELECT case when  lImpresionRetencion=1 then 1 else 0 end  as codigo FROM vTipodocumento WHERE Codigo=(SELECT TTIPODOCUMENTO FROM MDOCUMENTO WHERE tDocumento='" & RsImpresion!tDocumento & "')", Cn) = 1 Then
                        ImprimeXLinea tTextoAgenteRetencion, 40, 5
                    End If
                    If ImpDolarDelivery Then
                        If lPagoAntesImpresion Then
                            lcuentaCobrar = True
                                    If lcuentaCobrar And lPagocortesiaAI = False Then
                                        txt = "Son: " & NumeroCadena(str(RsImpresion!nVenta / nTC)) & " " & sMonedaE
                                        ImprimeXLinea txt, 40, 5
                                    Else
                                        txt = "Son: " & NumeroCadena(str(0)) & " " & sMonedaE
                                        ImprimeXLinea txt, 40, 5
                                    End If
                        Else
                            txt = "Son: " & NumeroCadena(str(RsImpresion!nVenta / nTC)) & " " & sMonedaE
                            ImprimeXLinea txt, 40, 5
                        End If
                    Else
                        If lPagoAntesImpresion Then
                            lcuentaCobrar = True
                                    If lcuentaCobrar And lPagocortesiaAI = False Then
                                        txt = "Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
                                        ImprimeXLinea txt, 40, 5
                                    Else
                                        txt = "Son: " & NumeroCadena(str(0)) & " " & sMonedaN
                                        ImprimeXLinea txt, 40, 5
                                    End If
                        Else
                            txt = "Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
                            ImprimeXLinea txt, 40, 5
                        End If

                    End If
'                    txt = "Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
'                    ImprimeXLinea txt, 40, 5
                        
                        
                    If lPagoAntesImpresion Then
                        lcuentaCobrar = True
                        'Set RsPagoDocumento = Lib.OpenRecordset("select Distinct v.tResumido + ' ' + M.tResumido as pago , Sum(D.nMonto) as monto from DPAGODOCUMENTO D inner join vTipoPago v on d.tTipoPago = v.Codigo inner join vMoneda M on M.Codigo = D.tMoneda Where D.tDocumento = '" & RsImpresion!tDocumento & "' group by v.tResumido,  M.tResumido", Cn)
                        Set RsPagoDocumento = Lib.OpenRecordset("exec usp_Inforest_Impresion '" & RsImpresion!tDocumento & "', 9 ", Cn)
                        Printer.Print " "

                        If pais = "000" Then 'PERU
                            Printer.Print String(40, "-")
                            
                            If RsPagoDocumento.RecordCount > 0 Then
                                Printer.Print "Forma de Pago:"
                                For i = 0 To RsPagoDocumento.RecordCount - 1
                                    lcuentaCobrar = False
                                        Printer.Print RsPagoDocumento!pago & " " & Format(RsPagoDocumento!Monto, "##,###,##0.00")
                                    RsPagoDocumento.MoveNext
                                Next i
                                Printer.Print "Vuelto       :" & sMonN & " " & Format(RsImpresion!Vuelto, "##,###,##0.00")
                            Else
                                If lcuentaCobrar And lPagocortesiaAI = False Then
                                    Printer.Print "Forma de Pago:Enviado a Cuenta por Cobrar"
                                Else
                                    'Printer.Print "Forma de Pago:Cortesia"
                                    ImprimeXLinea "Forma de Pago: " & lGlosaTrans, 40, 15
                                End If
                            End If
                            Printer.Print String(40, "-")
                            
                        Else 'ECUADOR
                            If RsPagoDocumento.RecordCount > 0 Then
                                For i = 0 To RsPagoDocumento.RecordCount - 1
                                    lcuentaCobrar = False
                                    Printer.Print "Forma de Pago:" & RsPagoDocumento!pago & " " & Format(RsPagoDocumento!Monto, "##,###,##0.00")
                                    RsPagoDocumento.MoveNext
                                Next i
                            Else
                                If lcuentaCobrar And lPagocortesiaAI = False Then
                                    Printer.Print "Forma de Pago:Enviado a Cuenta por Cobrar"
                                Else
                                    ImprimeXLinea "Forma de Pago: " & lGlosaTrans, 40, 15
                                    'Printer.Print "Forma de Pago:Cortesia"
                                End If
                            End If
                        End If

                        Printer.Print " "
                    End If
                    
                    Printer.Print String(40, "-")
                    If Calcular("select isnull(tcodigocliente,'') codigo from mdocumento where tdocumento='" & RsImpresion!tDocumento & "'", Cn) <> "" Then
                        ImprimeXLinea "Empresa: " & RsImpresion!Cliente, 40, 9
                        xTipoIdentidad = ""
                        xTipoIdentidad = Calcular("select upper(tResumido) as Codigo from vTipoIdentidad inner join TCLIENTE on vTipoIdentidad.Codigo=tcliente.tTipoIdentidad where tcliente.tCodigoCliente= (select isnull(tCodigoCliente,'') as codigo From MDOCUMENTO where tDocumento='" & RsImpresion!tDocumento & "')", Cn)
                        If xTipoIdentidad = "0" Then
                            xTipoIdentidad = "Iden."
                        End If
                        Printer.Print xTipoIdentidad & "    : " & RsImpresion!Ruc
                        ImprimeXLinea "Direcc.: " & RsImpresion!direccion, 40, 9
                        Printer.Print String(40, "-")
                    End If
                    ImprimeXCentro sPie, 40

                    Set xRsPropiedad = Nothing
                    Set xRsPropiedadCombo = Nothing
                    If lLogCajaRapida = True Then
                     'Log
                     Cn.Execute "UPDATE TLOG_IMPRESION SET TPOSICION6='PASO 2 ' + '" & RsImpresion!tDocumento & "' WHERE TDOCUMENTO='" & sDocumento & "'"
                    End If
                    If lImprimeImagPieDocumento Then
                                        If pie <> 0 Then
                                        Printer.PaintPicture pie, 500, Printer.CurrentY, 2860, 1600
                                        End If
                     End If
                    Printer.EndDoc
                     

        End Select
        
End Sub

Public Sub ImprimeFacturaElectronica(ByVal RsImpresion As Recordset, Optional CodigoHash As Image, Optional tTipoDoc As String, Optional Cabecera As Image, Optional pie As Image, Optional ByVal cadenaCodigoHash As String, Optional ByVal ImpDolarDelivery As Boolean)
    On Error Resume Next
    Dim Item As String
    Dim xObservacion As String
    Dim sLinea As String
    Dim sLinea2 As String
    Dim txt As String
    Dim xRsPropiedad As ADODB.Recordset
    Dim xRsPropiedadCombo As ADODB.Recordset
    Dim nSumaNeto As Double
    Dim xTotalS As Double
    
    Dim xImpresionFE As String
    
    Dim RsPagoDocumento As ADODB.Recordset
    Dim lcuentaCobrar As Boolean

    Dim nDescuentoNeto As String
    
    'imprime tipo de cambio
    IsqlTC = "select lVerTCImp from TPARAMETRO"
    Set RsParametroTC = Lib.OpenRecordset(IsqlTC, Cn)
    '------------------------------------------
                        
    '---CESAR IMP
    Dim imp1 As Double
    Dim imp2 As Double
    Dim impxT As Double
    Dim impx1 As Double
    Dim impx2 As Double
    Dim impG As Double
    Dim xDescuento As Double
    Dim xRecargo As Double
    Dim xSubTotal As Double
    Dim xDiferencia As Double
    Dim xAumento As Double
    
    imp1 = Calcular("select ISNULL(Impuesto1,0) as Codigo from TPARAMETRO", Cn)
    imp2 = Calcular("select ISNULL(Impuesto2,0) as Codigo from TPARAMETRO", Cn)
    impxT = 1 + (imp1 / 100) + (imp2 / 100)
    impx1 = 1 + (imp1 / 100)
    impx2 = 1 + (imp2 / 100)
    impG = 1
    '------------------
    lImprimeImagCabDocumento = Calcular("select lImprimeImageCab as codigo from ttipodocumentoimpresora where ttipoemision='" & tTipoDoc & "' and  tcaja='" & sCaja & "'", Cn)
    lImprimeImagPieDocumento = Calcular("select lImprimeImagePie as codigo from ttipodocumentoimpresora where ttipoemision='" & tTipoDoc & "' and  tcaja='" & sCaja & "'", Cn)
    
    ximprimeDetallado = Calcular("select lImprimeresumen as codigo from ttipodocumentoimpresora where ttipoemision='" & tTipoDoc & "' and  tcaja='" & sCaja & "'", Cn)
    Dim CANT, Valor As Integer
    Dim ProductoTem As String
    
    xTotalS = 0
    
    Dim xUnidadNegocio As String
    xUnidadNegocio = Calcular("SELECT tDetallado As Codigo FROM TTABLA WHERE TTABLA = 'UNIDADNEGOCIO' AND TCODIGO = (SELECT tUnidadNegocio FROM TCAJA WHERE TCAJA='" & RsImpresion!tCaja & "')", Cn)
      
  
    Isql = "SELECT tCodigoPedido, dbo.TPRODUCTOPROPIEDAD.tItem, dbo.TOPERADOR.tDetallado AS Operador, dbo.TPROPIEDAD.tDetallado AS Descripcion,dbo.TPRODUCTOPROPIEDAD.nCantidad " & _
           "FROM dbo.TPRODUCTOPROPIEDAD INNER JOIN dbo.TPROPIEDAD ON dbo.TPRODUCTOPROPIEDAD.tCodigoPropiedad = dbo.TPROPIEDAD.tCodigoPropiedad AND dbo.TPRODUCTOPROPIEDAD.tProducto = dbo.TPROPIEDAD.tProducto INNER JOIN dbo.TOPERADOR ON dbo.TPROPIEDAD.tOperador = dbo.TOPERADOR.tOperador " & _
           "where tCodigoPedido='" & RsImpresion!tCodigoPedido & "' and TOPERADOR.lImprime=1 Order by dbo.TOPERADOR.nBoton"
    Set xRsPropiedad = Lib.OpenRecordset(Isql, Cn)
    Isql = "SELECT dbo.TCOMBOPROPIEDAD.tItem, dbo.TCOMBOPROPIEDAD.tItemCombo, dbo.TOPERADOR.tDetallado AS Operador, dbo.TPROPIEDAD.tDetallado AS Descripcion, dbo.TCOMBOPROPIEDAD.tCodigoPedido,dbo.TCOMBOPROPIEDAD.nCantidad " & _
           "FROM dbo.TOPERADOR INNER JOIN dbo.TPROPIEDAD ON dbo.TOPERADOR.tOperador = dbo.TPROPIEDAD.tOperador RIGHT OUTER JOIN dbo.TCOMBOPROPIEDAD ON dbo.TPROPIEDAD.tProducto = dbo.TCOMBOPROPIEDAD.tProducto AND dbo.TPROPIEDAD.tCodigoPropiedad = dbo.TCOMBOPROPIEDAD.tCodigoPropiedad " & _
           "where tCodigoPedido='" & RsImpresion!tCodigoPedido & "'  and TOPERADOR.lImprime=1 Order by dbo.TOPERADOR.nBoton"
    Set xRsPropiedadCombo = Lib.OpenRecordset(Isql, Cn)
    
    Select Case pais
    Case "001" 'BOLIVIA
    
'                    'OBTIENE DATOS A IMPRIMIR
'                    Dim tAutorizacion As String '  del documento
'                    Dim tcodigoControl As String ' del documento
'                    Dim tGlosaDosificacion As String
'                    Dim RsDatos As Recordset
'                    Dim fLimite As Date ' de la caja
'                    Dim tSfc As String ' de la caja
'
'                    Dim tSucursal As String
'
'                    Dim cadenaxx As String
'                    tSfc = ""
'                    fLimite = Now
'                    tAutorizacion = Calcular("select tautorizacion as codigo from mdocumento where tdocumento ='" & RsImpresion!tDocumento & "'", Cn)
'                    tcodigoControl = Calcular("select tcodigoControl as codigo from mdocumento where tdocumento ='" & RsImpresion!tDocumento & "'", Cn)
'                    cadenaxx = "SELECT tsfc,ffin, isnull(tGlosaDosificacion,'') tglosadosificacion FROM TORIGENCODIGOCONTROL WHERE TCAJA='" & RsImpresion!tCaja & "' AND TAUTORIZACION='" & Trim(tAutorizacion) & "' AND ((FINICIO <= '" & Format(RsImpresion!fRegistro, "YYYYmmdd HH:mm") & "') AND (ffin>='" & Format(RsImpresion!fRegistro, "YYYYmmdd HH:mm") & "'))"
'                    Set RsDatos = Lib.OpenRecordset(cadenaxx, Cn)
'                    If Not (RsDatos.EOF Or RsDatos.BOF) Then
'                           ' rsDatos.MoveFirst
'                            tSfc = RsDatos!tSfc
'                            fLimite = Format(RsDatos!fFin, "dd/MM/yyyy")
'                            tGlosaDosificacion = RsDatos!tGlosaDosificacion
'                    End If
'
'                            If lImprimeImagCabDocumento Then
'                                    If Cabecera <> 0 Then
'                                    Printer.PaintPicture Cabecera, 500, Printer.CurrentY, 2860, 1600
'                                    For p = 1 To 10
'                                    Printer.Print
'                                    Next p
'                                    End If
'                            End If
'                    'Cabecera
'                    RsImpresion.MoveFirst
'                    ImprimeXCentro sRazonSocial, 40
'                    ImprimeXCentro sRazonComercial, 40
'                    'CGMiranda******************************************************
'                    tSucursal = Calcular("select vs.tResumido as codigo from vsucursal vs inner join TCAJA tc on vs.Codigo = tc.tSucursal where tc.tCaja='" & sCaja & "'", Cn)
'                    ImprimeXCentro "Sucursal Nº " & IIf(tSucursal = 0, "", tSucursal), 40
'                    ImprimeXCentro sDireccion, 40
'                    ImprimeXCentro "Telefono: " & sTelefono, 40
'                    ImprimeXCentro "SFC: " & tSfc & "   La Paz Bolivia", 40
'                    If estadoReimpresion = True Then
'                        ImprimeXCentro "FACTURA-COPIA", 40
'                        estadoReimpresion = False
'                    Else
'                        ImprimeXCentro "FACTURA", 40
'                    End If
'                    Printer.Print
'                    Printer.Print String(40, "-")
'                    sLinea = String((40 - Len(Trim("NIT: " + sRUC))) / 2, " ") & "NIT: " + sRUC
'                    Printer.Print sLinea
'
'                        ImprimeXCentro "Factura Nº " & Mid(RsImpresion!tDocumento, 7), 40 'cambio
'                        ImprimeXCentro "Autorizacion Nº " & tAutorizacion, 40 ' cambio
'                        Printer.Print String(40, "-")
'                        lTamanio = Printer.FontSize
'                        Printer.FontSize = lTamanio - 1
'                        ImprimeXCentro "Hotelería, Restaurantes y Alquileres", 40 'cambio
'                        Printer.FontSize = lTamanio
'
'                            If lImpresionDiaContable Then
'                                If lReimpresion = True Then
'                                    Printer.Print "Fecha    : " & Format(Calcular("select fdiacontable as codigo from mdocumento where tdocumento ='" & RsImpresion!tDocumento & "'", Cn), "dd/MM/yyyy") & " " & Calcular("exec DiacontableHora '" & fImpresionDiaContable & "'", Cn)
'                                    Else
'                                    Printer.Print "Fecha    : " & fImpresionDiaContable & " " & Calcular("exec DiacontableHora '" & fImpresionDiaContable & "'", Cn)
'                                End If
'                                Else
'                                 Printer.Print "Fecha    : " & RsImpresion!fRegistro
'                            End If
'
'                    ImprimeXLinea "Señores  : " & RsImpresion!Cliente, 40, 9
'                    Printer.Print "NIT/CI   : " & RsImpresion!Ruc
'                    Printer.Print "Dirección: " & Mid(RsImpresion!direccion, 1, 30)
'                    Printer.Print String(40, "-")
'
'                    Printer.Print
'                    Printer.Print "Pedido   : " & RsImpresion!tCodigoPedido
'                    Printer.Print "Tipo     : " & RsImpresion!tipopedido
'                    Printer.Print "Caja     : " & RsImpresion!tCaja & " - " & RsImpresion!tUsuario
'                    Printer.Print "Mesero   : " & RsImpresion!Mozo
'                    Printer.Print "Nro.Serie: " & Calcular("select isnull(tSerieImpresora,'') codigo from MDOCUMENTO where tDocumento ='" & RsImpresion!tDocumento & "'", Cn)
'                    Printer.Print "Descuento: " & Mid(Trim(RsImpresion!DESCUENTO), 1, 30)
'                    Printer.Print
'                    Printer.Print "MESA     : " & RsImpresion!Mesa
'                    If lObservacionCabDoc Then
'                        Printer.Print "Observac.: " & RsImpresion!tObservacion
'                    End If
'                    Printer.Print
'                    Printer.Print String(40, "-")
'                    Printer.Print "Cantid Producto         P.Unit. SubTotal"
'                    Printer.Print String(40, "-")
'
'                    'tipo de cambio
'                    If RsParametroTC!lVerTCImp = True Then
'                    Printer.Print "T/Cambio  : " & Format(nTC, "###,##0.00")
'                    End If
'                    '------------------------------------------------------------
'
'                    'Cuerpo
'                    Item = ""
'                    'Cuerpo
'                    Do While Not RsImpresion.EOF
'                    If ximprimeDetallado = False Then
'                        xproducto = RsImpresion!Producto
'                    Else
'                        xproducto = RsImpresion!ProductoDetallado
'                    End If
'                       If Item <> RsImpresion!tCodigoPedido + RsImpresion!tItem Then
'                          'Impresion de Propiedades
'                          If lPropiedadDocumento Then
'                             xRsPropiedad.Filter = "tCodigoPedido='" & Mid(Item, 1, 10) & "' and tItem='" & Mid(Item, 11, 3) & "'"
'                             If Not xRsPropiedad.EOF Then
'                                xRsPropiedad.MoveFirst
'                                Do While Not xRsPropiedad.EOF
'                                   Printer.Print "        * " & xRsPropiedad!Operador & " " & xRsPropiedad!Descripcion
'                                   xRsPropiedad.MoveNext
'                                Loop
'                             End If
'
'                             'Impresion de la Observacion
'                             If lObservacionDocumento And Len(Trim(xObservacion)) > 0 Then
'                                ImprimeXLinea "        - " & Trim(xObservacion), 33, 2
'                             End If
'                          End If
'
'                          If IsNull(RsImpresion!tOferta) Or RsImpresion!tOferta = "" Then
'                         ' factura ..
'
'                                             '---------------- Top de 18 carcteres por y salto de linea en el modulo
''                          Dim cant, Valor As Integer
''                          Dim ProductoTem As String
'                                CANT = Len(Trim(xproducto))
'                                ProductoTem = xproducto
'regreso:
'                                If Valor = 0 Then
'                                    sLinea = Right(String(6, " ") & Format(RsImpresion!nCantidad, "##0.00"), 6) & " " & Mid(xproducto & String(16, " "), 1, 16) & " " & Right(String(7, " ") & Format(RsImpresion!nprecioVenta, "###0.00"), 7) & " " & Right(String(8, " ") & Format(RsImpresion!nCantidad * RsImpresion!nprecioVenta, "####0.00"), 8)
'                                    Valor = 1
'                                    CANT = Len(Mid(ProductoTem, 17))
'                                    ProductoTem = Mid(ProductoTem, 17)
'                                    Printer.Print sLinea
'                                Else
'                                    sLinea = Right(String(8, " ") & "        ", 8) & " " & Mid(Trim(ProductoTem) & String(18, " "), 1, 18) & " " & Right(String(12, " ") & "            ", 12)
'                                    CANT = Len(Mid(ProductoTem, 17))
'                                    ProductoTem = Mid(ProductoTem, 17)
'                                    Printer.Print sLinea
'                                End If
'
'                                If CANT > 0 And ximprimeDetallado = True Then
'                                GoTo regreso
'                                End If
'                            '------------------------------------------------------------------------------
'
'                             'sLinea = Right(String(6, " ") & Format(RsImpresion!nCantidad, "##0.00"), 6) & " " & Mid(xproducto & String(16, " "), 1, 16) & " " & Right(String(7, " ") & Format(RsImpresion!nprecioVenta, "###0.00"), 7) & " " & Right(String(8, " ") & Format(RsImpresion!nCantidad * RsImpresion!nprecioVenta, "####0.00"), 8)
'                          Else
'                                CANT = Len(Trim(xproducto))
'                                ProductoTem = xproducto
'regreso1:
'                                If Valor = 0 Then
'                                    sLinea = Right(String(6, " ") & Format(RsImpresion!nCantidad, "##0.00"), 6) & " " & Mid(xproducto & String(16, " "), 1, 16)
'                                    Printer.Print sLinea
'
'                                    Valor = 1
'                                    CANT = Len(Mid(ProductoTem, 17))
'                                    ProductoTem = Mid(ProductoTem, 17)
'
'                                Else
'                                    sLinea = Right(String(6, " ") & "      ", 6) & " " & Mid(ProductoTem & String(16, " "), 1, 16)
'                                    CANT = Len(Mid(ProductoTem, 17))
'                                    ProductoTem = Mid(ProductoTem, 17)
'                                    Printer.Print sLinea
'                                End If
'
'                                If CANT > 0 And ximprimeDetallado = True Then
'                                GoTo regreso1
'                                End If
'
'                          '-------------------------
'
'                             'sLinea = Right(String(6, " ") & Format(RsImpresion!nCantidad, "##0.00"), 6) & " " & Mid(xproducto & String(16, " "), 1, 16)
'
'
'                                sLinea = String(6, " ") & " " & Mid(RsImpresion!tOferta & String(16, " "), 1, 16) & " " & Right(String(7, " ") & Format(RsImpresion!nprecioVenta, "###0.00"), 7) & " " & Right(String(8, " ") & Format(RsImpresion!nCantidad * RsImpresion!nprecioVenta, "####0.00"), 8)
'                                Printer.Print sLinea
'                          End If
'
'                          Valor = 0
'                          'Printer.Print sLinea
'                       End If
'
'                       'Combos
'                       If lComboDocumento And IIf(IsNull(RsImpresion!Combo), 0, Len(Trim(RsImpresion!Combo))) > 0 Then
'                          sLinea = Mid("       " & Right(String(5, " ") & Format(RsImpresion!nCombo, "#0.00"), 5) & " " & RsImpresion!Combo, 1, 40)
'                          Printer.Print sLinea
'
'                          'Combos Propiedades
'                          If lPropiedadDocumento And Len(Trim(IIf(IsNull(RsImpresion!Combo), "", RsImpresion!Combo))) > 0 Then
'
'                             xRsPropiedadCombo.Filter = "tCodigoPedido='" & RsImpresion!tCodigoPedido & "' and tItem='" & RsImpresion!tItem & "' and tItemCombo='" & RsImpresion!tItemCombo & "'"
'                             If Not xRsPropiedadCombo.EOF Then
'                                xRsPropiedadCombo.MoveFirst
'                                Do While Not xRsPropiedadCombo.EOF
'                                    ImprimeXLinea "        * " & xRsPropiedadCombo!Operador & " " & xRsPropiedadCombo!Descripcion, 31, 10
'                                   'Printer.Print "        * " & xRsPropiedadCombo!Operador & " " & xRsPropiedadCombo!Descripcion
'                                   xRsPropiedadCombo.MoveNext
'                                Loop
'                             End If
'
'                             'Impresion de la Observacion
'                              If lObservacionDocumento And Len(Trim(RsImpresion!tObservacionCombo)) > 0 Then
'                                 ImprimeXLinea "        - " & Trim(RsImpresion!tObservacionCombo), 33, 2
'                              End If
'                          End If
'                       End If
'                       xObservacion = IIf(IsNull(RsImpresion!tObservacionPedido), "", RsImpresion!tObservacionPedido)
'                       Item = RsImpresion!tCodigoPedido + RsImpresion!tItem
'                       RsImpresion.MoveNext
'                    Loop
'
'                    If lPropiedadDocumento Then
'                       xRsPropiedad.Filter = "tCodigoPedido='" & Mid(Item, 1, 10) & "' and tItem='" & Mid(Item, 11, 3) & "'"
'                       If Not xRsPropiedad.EOF Then
'                          xRsPropiedad.MoveFirst
'                          Do While Not xRsPropiedad.EOF
'                             Printer.Print "        * " & xRsPropiedad!Operador & " " & xRsPropiedad!Descripcion
'                             xRsPropiedad.MoveNext
'                          Loop
'                       End If
'
'                       'Impresion de la Observacion
'                       If lObservacionDocumento And Len(Trim(xObservacion)) > 0 Then
'                          ImprimeXLinea "        - " & Trim(xObservacion), 33, 2
'                       End If
'                    End If
'
'                    'Printer.Print
'                    Printer.Print String(40, "-")
'                    RsImpresion.MoveLast
'
'                    If RsImpresion!nRecargo > 0 Then
'                       Printer.Print
'                       Printer.Print Right(String(27, " ") & "Recargo " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nRecargo, "##,###,##0.00"), 13)
'                    End If
'
'                    If RsImpresion!nDescuento > 0 Then
'                       Printer.Print
'                       Printer.Print Right(String(27, " ") & "Descuento " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nDescuento, "##,###,##0.00"), 13)
'                    End If
'
'
'                    nSumaNeto = RsImpresion!nNeto
'
'                    If IsNull(RsImpresion!lImpuesto1) Or Not RsImpresion!lImpuesto1 Then
'                       nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto1
'                    End If
'
'                    If IsNull(RsImpresion!lImpuesto2) Or Not RsImpresion!lImpuesto2 Then
'                       nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto2
'                    End If
'
'                    If IsNull(RsImpresion!lImpuesto3) Or Not RsImpresion!lImpuesto3 Then
'                       nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto3
'                    End If
'                    'CESAR
'                    If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
'                       Printer.Print Right(String(27, " ") & "Valor Venta " & sMonN & " : ", 27) & Right(String(13, " ") & Format(nSumaNeto, "##,###,##0.00"), 13)
'                    End If
'
'                    If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
'                       Printer.Print Right(String(27, " ") & sImpuesto1 & " " & Format(nPorcentaje1, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,##0.00"), 13)
'                    End If
'
'                    If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
'                       Printer.Print Right(String(27, " ") & sImpuesto2 & " " & Format(nPorcentaje2, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto2, "##,###,##0.00"), 13)
'                    End If
'
'                    If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
'                       Printer.Print Right(String(27, " ") & sImpuesto3 & " " & Format(nPorcentaje3, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto3, "##,###,##0.00"), 13)
'                    End If
'
'                    'Printer.Print CarlosD
'                    Printer.Print Right(String(27, " ") & "Total " & sMonN & " :", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 13)
'                    'Printer.Print
'                    'CarlosD 2/12/2006
'                    If lEquivalencia = True Or lDocumEquivaPrecuenta = True Then
'                    Printer.Print Right(String(27, " ") & "Total " & sMonE & " :", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 13)
'                    Printer.Print
'                    End If
'                    'End CarlosD
'                    txt = "Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
'                    ImprimeXLinea txt, 40, 5
'
'                    Printer.Print String(40, "-")
'                    Printer.Print "Código de Control      : " & tcodigoControl
'                    Printer.Print "Fecha Límite de Emisión: " & Format(fLimite, "dd/MM/yyyy")
'
'                    Printer.Print String(40, "-")
'
'                    'IMPRIMEQR
'                    If Calcular("select ISNULL(lImprimeQR,0) as codigo from TTIPODOCUMENTO where tCodigoTipoDocumento='" & tTipoDoc & "'", Cn) = 1 Then
'                        If pais = "001" Then
'                        Set rsQr = Lib.OpenRecordset("usp_Inforest_ObtieneCodigoQR_Bol " + RsImpresion!tDocumento, Cn)
'                        FastQRCode rsQr.Fields(0), App.Path & "\BaseTempQr.bmp"
''                     QRCodeLibVer
'                        Set imgDocumento = CreateObject("Scripting.FileSystemObject")
'                        If imgDocumento.FileExists(App.Path & "\BaseTempQr.bmp") Then
'                                Printer.PaintPicture LoadPicture(App.Path & "\BaseTempQr.bmp"), 1400, Printer.CurrentY, 1323, 1323
'                                 For p = 1 To 8
'                                    Printer.Print
'                                 Next p
'                         End If
'                       End If
'                    End If
'
'                    Set xRsPropiedad = Nothing
'                    Set xRsPropiedadCombo = Nothing
'                    Set rsQr = Nothing
'
'                    Printer.Print '.'
'                    lTamanio = Printer.FontSize
'                    Printer.FontSize = lTamanio - 2
'                    comilla = Chr(34)
'                    ImprimeXLinea comilla & "ESTA FACTURA CONTRIBUYE AL DESARROLLO DEL PAIS. EL USO ILICITO DE ESTA SERA SANCIONADO DE ACUERDO A LEY" & comilla, 57, 2
'                    Printer.Print '.'
'                    If tGlosaDosificacion <> "" Then
'                            ImprimeXLinea tGlosaDosificacion, 40, 2
'                    End If
'                    Printer.FontSize = lTamanio
'                    Printer.Print String(40, "-")
'                    ImprimeXCentro sPie, 40
'                    Printer.Print
'                    If lImprimeImagPieDocumento Then
'                                    If pie <> 0 Then
'                                        Printer.PaintPicture pie, 500, Printer.CurrentY, 2860, 1600
'                                    End If
'                    End If
'                    Printer.EndDoc
'
        Case "002" 'ECUADOR
     
                    RsImpresion.MoveFirst
                    Dim RsEcua As Recordset
                    Dim sIGV As Double
                    Dim cIGV As Double
                    sIGV = 0
                    cIGV = 0
                    
                    
                    If lImprimeImagCabDocumento Then
                                    If Cabecera <> 0 Then
                                    Printer.PaintPicture Cabecera, 500, Printer.CurrentY, 2860, 1600
                                    For p = 1 To 10
                                    Printer.Print
                                    Next p
                                    End If
                    End If
                    
                    If estadoReimpresion = True Then
                        ImprimeXCentro "REIMPRESION", 40
                        estadoReimpresion = False
                    End If
                    
                    ImprimeXCentro sRazonSocial, 40
                    ImprimeXCentro sDireccion, 40
                    If Trim(sDireccion2) <> "" Then
                        ImprimeXCentro sDireccion2, 40
                    End If
                    ImprimeXCentro "Telefono: " & sTelefono, 40
                    sLinea = String((40 - Len(Trim("R.U.C.: " + sRUC))) / 2, " ") & "R.U.C.: " + sRUC
                    Printer.Print sLinea
                    
                    If tContribuyenteEspecial <> "" Then
                       ImprimeXCentro "CONTRIBUYENTE ESPECIAL", 40
                       ImprimeXCentro "RESOLUCION Nro." & tContribuyenteEspecial & " del " & fContribuyenteEspecial, 40
                    End If
                    
                    Printer.Print
                    Set RsEcua = Lib.OpenRecordset("select Descripcion, tNumeroAutorizacion, fInicio, fCaducidad from vTipoDocumentoImpresora where tCaja='" & RsImpresion!tCaja & "' and Prefijo='" & Mid(RsImpresion!tDocumento, 1, 1) & "'", Cn)
                    If RsEcua.RecordCount > 0 Then
                       RsEcua.MoveFirst
                    End If
                    
                    Printer.Print RsEcua!Descripcion & "-" & Mid(RsImpresion!tDocumento, 2, 3) & "-" & Mid(RsImpresion!tDocumento, 5, 3) & "-" & Mid(RsImpresion!tDocumento, 8, 9)
                    Printer.Print
                    Printer.Print String(15, "-") & " CLIENTE " & String(16, "-")
                    Printer.Print "Cedul/RUC: " & RsImpresion!Ruc
                    ImprimeXLinea "Cliente  : " & RsImpresion!Cliente, 40, 11
                    ImprimeXLinea "Direccion: " & RsImpresion!direccion, 40, 11
                    Printer.Print String(40, "-")
                    
                    Printer.Print
                    Printer.Print "Pedido   : " & RsImpresion!tCodigoPedido
                    
                    
                    'tipo de cambio
                    If RsParametroTC!lVerTCImp = True Then
                    Printer.Print "T/Cambio  : " & Format(nTC, "###,##0.00")
                    End If
                    '------------------------------------------------------------
                    
                    
                    If lImpresionDiaContable Then
                        If lReimpresion = True Then
                            Printer.Print "Fecha    : " & Format(Calcular("select fdiacontable as codigo from mdocumento where tdocumento ='" & RsImpresion!tDocumento & "'", Cn), "dd/MM/yyyy") & " " & Calcular("exec DiacontableHora '" & fImpresionDiaContable & "'", Cn)
                            
                            Else
                            Printer.Print "Fecha    : " & fImpresionDiaContable & " " & Calcular("exec DiacontableHora '" & fImpresionDiaContable & "'", Cn)
                        End If
                        Else
                         Printer.Print "Fecha    : " & RsImpresion!fRegistro
                    End If
                                                                          
                    Printer.Print "Caja     : " & RsImpresion!tCaja & " - " & RsImpresion!tUsuario
                    Printer.Print "Mesero   : " & RsImpresion!Mozo
                    Printer.Print "Descuento: " & Mid(Trim(RsImpresion!DESCUENTO), 1, 30)
                    If lObservacionCabDoc Then
                        Printer.Print "Observ.  : " & Trim(RsImpresion!tObservacion)
                    End If
                    Printer.Print
                    Printer.Print String(40, "-")
                    Printer.Print "Cant. Articulo            P.Unit P.Total"
                    Printer.Print String(40, "-")
                                      
                    'Cuerpo
                    Item = ""
                    'Cuerpo
                    Do While Not RsImpresion.EOF
                    If ximprimeDetallado = False Then
                        xproducto = RsImpresion!Producto
                    Else
                        xproducto = RsImpresion!ProductoDetallado
                    End If
                    
                       If RsImpresion!nImpuesto1 > 0 Then
                          cIGV = cIGV + (RsImpresion!nPrecioNeto * RsImpresion!nCantidad)
                       Else
                          sIGV = sIGV + (RsImpresion!nPrecioNeto * RsImpresion!nCantidad)
                       End If
                    
                       If Item <> RsImpresion!tCodigoPedido + RsImpresion!tItem Then
                          'Impresion de Propiedades
                          If lPropiedadDocumento Then
                             xRsPropiedad.Filter = "tCodigoPedido='" & Mid(Item, 1, 10) & "' and tItem='" & Mid(Item, 11, 3) & "'"
                             If Not xRsPropiedad.EOF Then
                                xRsPropiedad.MoveFirst
                                Do While Not xRsPropiedad.EOF
                                   Printer.Print "        * " & xRsPropiedad!Operador & " " & xRsPropiedad!Descripcion
                                   xRsPropiedad.MoveNext
                                Loop
                             End If
                                         
                             'Impresion de la Observacion
                             If lObservacionDocumento And Len(Trim(xObservacion)) > 0 Then
                                ImprimeXLinea "        - " & Trim(xObservacion), 33, 2
                             End If
                          End If
                          'CESAR IMP
                            If RsImpresion!nImpuesto1 > 0 And RsImpresion!nImpuesto2 > 0 Then
                                  impG = impxT
                            ElseIf RsImpresion!nImpuesto1 > 0 And RsImpresion!nImpuesto2 = 0 Then
                                  impG = impx1
                            ElseIf RsImpresion!nImpuesto1 = 0 And RsImpresion!nImpuesto2 > 0 Then
                                  impG = impx2
                            Else
                                  impG = 1
                            End If
                          

                          If IsNull(RsImpresion!tOferta) Or RsImpresion!tOferta = "" Then
                          
                                CANT = Len(Trim(xproducto))
                                ProductoTem = xproducto
regreso2:
                                If Valor = 0 Then
                                    sLinea = Right(String(5, " ") & Format(RsImpresion!nCantidad, "#0.00"), 5) & " " & Mid(xproducto & String(19, " "), 1, 19) & " " & Right(String(6, " ") & Format(RsImpresion!nPrecioOficial / impG, "##0.00"), 6) & " " & Right(String(7, " ") & Format((RsImpresion!nPrecioOficial * RsImpresion!nCantidad) / impG, "###0.00"), 7)
                                    Valor = 1
                                    CANT = Len(Mid(ProductoTem, 20))
                                    ProductoTem = Mid(ProductoTem, 20)
                                    Printer.Print sLinea
                                Else
                                    sLinea = Right(String(5, " ") & "     ", 5) & " " & Mid(ProductoTem & String(19, " "), 1, 19) & " " & Right(String(6, " ") & "      ", 6) & " " & Right(String(7, " ") & "       ", 7)
                                    CANT = Len(Mid(ProductoTem, 20))
                                    ProductoTem = Mid(ProductoTem, 20)
                                    Printer.Print sLinea
                                End If
                                
                                If CANT > 0 And ximprimeDetallado = True Then
                                GoTo regreso2
                                End If
                              
                          Else
                          
                                CANT = Len(Trim(xproducto))
                                ProductoTem = xproducto
regreso3:
                                If Valor = 0 Then
                                    sLinea = Right(String(5, " ") & Format(RsImpresion!nCantidad, "#0.00"), 5) & " " & Mid(xproducto & String(19, " "), 1, 19)
                                    Printer.Print sLinea
                                
                                    Valor = 1
                                    CANT = Len(Mid(ProductoTem, 20))
                                    ProductoTem = Mid(ProductoTem, 20)
                                    
                                Else
                                    sLinea = Right(String(5, " ") & "     ", 5) & " " & Mid(ProductoTem & String(19, " "), 1, 19)
                                    CANT = Len(Mid(ProductoTem, 20))
                                    ProductoTem = Mid(ProductoTem, 20)
                                    Printer.Print sLinea
                                End If
                                
                                If CANT > 0 And ximprimeDetallado = True Then
                                GoTo regreso3
                                End If

                              sLinea = String(7, " ") & " " & Mid(RsImpresion!tOferta & String(19, " "), 1, 19) & " " & Right(String(12, " ") & Format((RsImpresion!nPrecioOficial * RsImpresion!nCantidad) / impG, "#,###,##0.00"), 12)
                              Printer.Print sLinea
                          End If
                          
                          Valor = 0
                          'Printer.Print sLinea
                       End If
                       
                       
                        '---CESAR IMP
                        xDiferencia = ((RsImpresion!nPrecioOficial * RsImpresion!nCantidad) / impG) - (RsImpresion!Venta - (RsImpresion!nImpuesto1 * RsImpresion!nCantidad) - (RsImpresion!nImpuesto2 * RsImpresion!nCantidad))
                        xDescuento = xDescuento + xDiferencia
                        xAumento = (RsImpresion!Venta - (RsImpresion!nImpuesto1 * RsImpresion!nCantidad) - (RsImpresion!nImpuesto2 * RsImpresion!nCantidad)) - ((RsImpresion!nPrecioOficial * RsImpresion!nCantidad) / impG)
                        xRecargo = xRecargo + xAumento
                        xSubTotal = xSubTotal + ((RsImpresion!nPrecioOficial * RsImpresion!nCantidad) / impG)
                        '------------
                       
                       'Combos
                       If lComboDocumento And IIf(IsNull(RsImpresion!Combo), 0, Len(Trim(RsImpresion!Combo))) > 0 Then
                          sLinea = Mid("       " & Right(String(5, " ") & Format(RsImpresion!nCombo, "#0.00"), 5) & " " & RsImpresion!Combo, 1, 40)
                          Printer.Print sLinea
                          
                          'Combos Propiedades
                          If lPropiedadDocumento And Len(Trim(IIf(IsNull(RsImpresion!Combo), "", RsImpresion!Combo))) > 0 Then
                          
                             xRsPropiedadCombo.Filter = "tCodigoPedido='" & RsImpresion!tCodigoPedido & "' and tItem='" & RsImpresion!tItem & "' and tItemCombo='" & RsImpresion!tItemCombo & "'"
                             If Not xRsPropiedadCombo.EOF Then
                                xRsPropiedadCombo.MoveFirst
                                Do While Not xRsPropiedadCombo.EOF
                                   ImprimeXLinea "             * " & xRsPropiedadCombo!Operador & " " & xRsPropiedadCombo!Descripcion, 40, 13
                                   xRsPropiedadCombo.MoveNext
                                Loop
                             End If
                          
                             'Impresion de la Observacion
                              If lObservacionDocumento And Len(Trim(RsImpresion!tObservacionCombo)) > 0 Then
                                 ImprimeXLinea "        - " & Trim(RsImpresion!tObservacionCombo), 33, 2
                              End If
                          End If
                       End If
                       xObservacion = IIf(IsNull(RsImpresion!tObservacionPedido), "", RsImpresion!tObservacionPedido)
                       Item = RsImpresion!tCodigoPedido + RsImpresion!tItem
                       RsImpresion.MoveNext
                    Loop
                    
                    If lPropiedadDocumento Then
                       xRsPropiedad.Filter = "tCodigoPedido='" & Mid(Item, 1, 10) & "' and tItem='" & Mid(Item, 11, 3) & "'"
                       If Not xRsPropiedad.EOF Then
                          xRsPropiedad.MoveFirst
                          Do While Not xRsPropiedad.EOF
                             ImprimeXLinea "        * " & xRsPropiedad!Operador & " " & xRsPropiedad!Descripcion, 40, 8
                             xRsPropiedad.MoveNext
                          Loop
                       End If
                                   
                       'Impresion de la Observacion
                       If lObservacionDocumento And Len(Trim(xObservacion)) > 0 Then
                          ImprimeXLinea "        - " & Trim(xObservacion), 33, 2
                       End If
                    End If

                    Printer.Print String(40, "-")
                    RsImpresion.MoveLast
                    

                    
                    If lPagoAntesImpresion Then
                        lcuentaCobrar = True
                        If lcuentaCobrar And lPagocortesiaAI = False Then
                            Printer.Print Right(String(27, " ") & "Sub Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xSubTotal, "##,###,##0.00"), 13)
                            Printer.Print String(40, " ")
                        Else
                            Printer.Print Right(String(27, " ") & "Sub Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(0, "##,###,##0.00"), 13)
                            Printer.Print String(40, " ")
                        End If
                    Else
                        Printer.Print Right(String(27, " ") & "Sub Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xSubTotal, "##,###,##0.00"), 13)
                        Printer.Print String(40, " ")
                    End If
                    If RsImpresion!nRecargo > 0 Then
                       Printer.Print
                        Printer.Print Right(String(27, " ") & "Recargo " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xRecargo, "##,###,##0.00"), 13)
                    End If
                    
                    If RsImpresion!nDescuento > 0 Then
                       Printer.Print
                       If lClub = True Then
                            calculaDescuentoNeto sDocumento
                            Printer.Print Right(String(27, " ") & "Descuento " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xDescuento, "##,###,##0.00"), 13)
                       Else
                            Printer.Print Right(String(27, " ") & "Descuento " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xDescuento, "##,###,##0.00"), 13)
                       End If
                    Else
                       Cn.Execute "Update MDOCUMENTO Set nDescuentoNeto= 0  Where tDocumento ='" & RsImpresion!tDocumento & "'"
                       Cn.Execute "Update DDOCUMENTO Set nDescuentoNeto= 0  Where tDocumento ='" & RsImpresion!tDocumento & "'"
                    End If

                    Printer.Print Right(String(27, " ") & "Base " & sImpuesto1 & " " & nPorcentaje1 & "%: ", 27) & Right(String(13, " ") & Format(cIGV, "##,###,##0.00"), 13)
                    Printer.Print Right(String(27, " ") & "Base " & sImpuesto1 & " 0%: ", 27) & Right(String(13, " ") & Format(sIGV, "##,###,##0.00"), 13)
                    Printer.Print ""
                    
                    nSumaNeto = RsImpresion!nNeto
                    
                    If IsNull(RsImpresion!lImpuesto1) Or Not RsImpresion!lImpuesto1 Then
                       nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto1
                    End If
                    
                    If IsNull(RsImpresion!lImpuesto2) Or Not RsImpresion!lImpuesto2 Then
                       nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto2
                    End If
                    
                    If IsNull(RsImpresion!lImpuesto3) Or Not RsImpresion!lImpuesto3 Then
                       nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto3
                    End If
                    

                    'CESAR Por Consumo No - FACTURA
                    If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
                       Printer.Print Right(String(27, " ") & "Sub Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(nSumaNeto, "##,###,##0.00"), 13)
                    End If
                                  
                    If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                       Printer.Print Right(String(27, " ") & sImpuesto1 & " " & Format(nPorcentaje1, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,##0.00"), 13)
                    End If
                       
                    If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                       Printer.Print Right(String(27, " ") & sImpuesto2 & " " & Format(nPorcentaje2, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto2, "##,###,##0.00"), 13)
                    End If
                    
                    If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                       Printer.Print Right(String(27, " ") & sImpuesto3 & " " & Format(nPorcentaje3, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto3, "##,###,##0.00"), 13)
                    End If
                    
                    'Printer.Print CarlosD
                    If lPagoAntesImpresion Then
                        lcuentaCobrar = True
                        If lcuentaCobrar And lPagocortesiaAI = False Then
                             Printer.Print Right(String(27, " ") & "Importe Total " & sMonN & " :", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 13)
                        Else
                            Printer.Print Right(String(27, " ") & "Importe Total " & sMonN & " :", 27) & Right(String(13, " ") & Format(0, "##,###,##0.00"), 13)
                        End If
                    Else
                        Printer.Print Right(String(27, " ") & "Importe Total " & sMonN & " :", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 13)

                    End If

                    If lEquivalencia = True Or lDocumEquivaPrecuenta = True Then
                        If lPagoAntesImpresion Then
                            lcuentaCobrar = True
                            If lcuentaCobrar And lPagocortesiaAI = False Then
                                Printer.Print Right(String(27, " ") & "Importe Total " & sMonE & " :", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 13)
                                Printer.Print
                            Else
                                Printer.Print Right(String(27, " ") & "Importe Total " & sMonE & " :", 27) & Right(String(13, " ") & Format(0, "##,###,##0.00"), 13)
                                Printer.Print
                            End If
                        Else
                            Printer.Print Right(String(27, " ") & "Importe Total " & sMonE & " :", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 13)
                            Printer.Print
    
                        End If
                    End If

                    
                    If Calcular(" SELECT case when  lImpresionRetencion=1 then 1 else 0 end  as codigo FROM vTipodocumento WHERE Codigo=(SELECT TTIPODOCUMENTO FROM MDOCUMENTO WHERE tDocumento='" & RsImpresion!tDocumento & "')", Cn) = 1 Then
                        ImprimeXLinea tTextoAgenteRetencion, 40, 5
                    End If

                    If lPagoAntesImpresion Then
                        lcuentaCobrar = True
                        If lcuentaCobrar And lPagocortesiaAI = False Then
                            Printer.Print
                            txt = "Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
                            ImprimeXLinea txt, 40, 5

                        Else
                            Printer.Print
                            txt = "Son: " & NumeroCadena(str(0)) & " " & sMonedaN
                            ImprimeXLinea txt, 40, 5
                        End If
                    Else
                        Printer.Print
                        txt = "Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
                        ImprimeXLinea txt, 40, 5

                    End If
                    
                    Printer.Print String(40, "-")
                    Printer.Print "Inforest v.4.94 "
                    Printer.Print
                    Printer.Print String(40, "-")
                    
                    'impresion cliente frecuente
                    Dim rstCliente As New Recordset
                    Dim cadenaImprime As String
                    
                    Set rstCliente = Lib.OpenRecordset("SELECT ISNULL(dbo.MPEDIDO.tCodigoInvitado, N'') AS cinvitado, ISNULL(dbo.MPEDIDO.tCodigoPariente, N'') AS cpariente, ISNULL(dbo.MPEDIDO.tClienteDelivery, N'')  AS cdelivery, dbo.vDelivery.tApellido + ' ' + dbo.vDelivery.tNombre AS Socio, ISNULL(dbo.TPARIENTE.tApellido, N'') + '  ' + ISNULL(dbo.TPARIENTE.tNombre, N'') AS Pariente, ISNULL(dbo.tdeliveryinvitado.tApellido, N'') + ' ' + ISNULL(dbo.Tdeliveryinvitado.tNombre, N'') AS Invitado FROM dbo.MPEDIDO LEFT OUTER JOIN dbo.TDELIVERYINVITADO ON dbo.MPEDIDO.tCodigoInvitado = dbo.TDELIVERYINVITADO.tCodigoInvitado LEFT OUTER JOIN                       dbo.TPARIENTE ON dbo.MPEDIDO.tCodigoPariente = dbo.TPARIENTE.tCodigoPariente AND                       dbo.MPEDIDO.tClienteDelivery = dbo.TPARIENTE.tCodigoDelivery LEFT OUTER JOIN dbo.vDelivery ON dbo.MPEDIDO.tClienteDelivery = dbo.vDelivery.Codigo WHERE  (dbo.MPEDIDO.tCodigoPedido = (SELECT MAX(tCodigoPedido) AS Expr1 From dbo.DDOCUMENTO " & _
                            " WHERE      (tDocumento = '" & RsImpresion!tDocumento & "')))", Cn)
                    
                    If Not (rstCliente.EOF Or rstCliente.BOF) Then
                        rstCliente.MoveFirst
                        
                        If rstCliente.Fields(2) <> "" Then ' socio
                                ImprimeXLinea "Socio  : " & rstCliente.Fields(3), 40, 11
                        End If
                        If rstCliente.Fields(1) <> "" Then ' pariente
                                ImprimeXLinea "Pariente  : " & rstCliente.Fields(4), 40, 11
                        End If
                        If rstCliente.Fields(0) <> "" Then ' invitado
                                ImprimeXLinea "Invitado  : " & rstCliente.Fields(5), 40, 11
                        End If
                    End If

                    Printer.Print
                    Printer.Print
                    Printer.Print
                    ImprimeXCentro "------------------------------", 40
                    ImprimeXCentro LTrim(RsImpresion!Cliente), 40
                    Printer.Print
                    Printer.Print
                    ImprimeXCentro sPie, 40
                    
                    Printer.Print
                    Printer.Print "Original : Cliente"
                    Printer.Print "Copia    : Emisor"
                    Printer.Print " "
                    
                    ImprimeXCentro "DOCUMENTO SIN VALIDEZ TRIBUTARIA", 40
                    
                    
                    If tCodigoFE = "001" Then 'YATCH
                        If RsImpresion!Ruc = "9999999999999" And Len(RsImpresion!Ruc) = 13 Then
                            Printer.Print " "
                        Else
                            Printer.Print " "
                            Printer.Print " "
                            ImprimeXCentro tPieDocumento1, 40
                            Printer.Print " "
                            Printer.Print "Usuario    : " & RsImpresion!Ruc
                            getClaveAlatoria (RsImpresion!Ruc)
                            Printer.Print "Contraseña : " & ClaveFact & " "
                        End If
                        
                    ElseIf tCodigoFE = "002" Then 'TENIS CLUB
                        Printer.Print " "
                        getClaveAcceso (RsImpresion!tDocumento)
                        ImprimeXLinea "            " & "Clave de Acceso : ", 40, 10
                        ImprimeXLinea "        " & Mid(ClaveAcceso, 1, 25), 40, 10
                        ImprimeXLinea "        " & Mid(ClaveAcceso, 26, 24), 40, 10

                    Else
                        Printer.Print " "
                    End If
                    
                    
                    If lPagoAntesImpresion Then
                        lcuentaCobrar = True
                        'Set RsPagoDocumento = Lib.OpenRecordset("select Distinct v.tResumido + ' ' + M.tResumido as pago , Sum(D.nMonto) as monto from DPAGODOCUMENTO D inner join vTipoPago v on d.tTipoPago = v.Codigo inner join vMoneda M on M.Codigo = D.tMoneda Where D.tDocumento = '" & RsImpresion!tDocumento & "' group by v.tResumido,  M.tResumido", Cn)
                        Set RsPagoDocumento = Lib.OpenRecordset("exec usp_Inforest_Impresion '" & RsImpresion!tDocumento & "', 9 ", Cn)
                        Printer.Print " "
                            If RsPagoDocumento.RecordCount > 0 Then
                                For i = 0 To RsPagoDocumento.RecordCount - 1
                                    lcuentaCobrar = False
                                    Printer.Print "Forma de Pago:" & RsPagoDocumento!pago & " " & Format(RsPagoDocumento!Monto, "##,###,##0.00")
                                    RsPagoDocumento.MoveNext
                                Next i
                                Printer.Print "Vuelto       :" & sMonN & " " & Format(RsImpresion!Vuelto, "##,###,##0.00")
                            Else
                                If lcuentaCobrar And lPagocortesiaAI = False Then
                                    Printer.Print "Forma de Pago:Enviado a Cuenta por Cobrar"
                                Else
                                    'Printer.Print "Forma de Pago:Cortesia"
                                    ImprimeXLinea "Forma de Pago: " & lGlosaTrans, 40, 15
                                End If
                            End If
                        Printer.Print " "
                    End If
                    
                    'On Error Resume Next
                    Set imgDocumento = CreateObject("Scripting.FileSystemObject")
                    If imgDocumento.FileExists(App.Path & "\bmps\ImgDocumento.jpg") Then
                        Printer.Print
                        Printer.PaintPicture LoadPicture(App.Path & "\bmps\ImgDocumento.jpg"), 400, Printer.CurrentY, 2800, 1000
                    End If
                    
                    Set xRsPropiedad = Nothing
                    Set xRsPropiedadCombo = Nothing
                    Set RsEcua = Nothing
                    
                    Printer.Print
                    Printer.Print
                    Printer.Print
                    
                    If lImprimeImagPieDocumento Then
                        If pie <> 0 Then
                           Printer.PaintPicture pie, 500, Printer.CurrentY, 2860, 1600
                        End If
                    End If
                    Printer.EndDoc
         
         
         
        Case Else 'PERU
                    'Cabecera
                    If lImprimeImagCabDocumento Then
                                    If Cabecera <> 0 Then
                                    Printer.PaintPicture Cabecera, 500, Printer.CurrentY, 2860, 1600
                                    For p = 1 To 10
                                    Printer.Print
                                    Next p
                                    End If
                    End If

                    RsImpresion.MoveFirst
                    ImprimeXCentro sRazonSocial, 40
                    ImprimeXCentro sRazonComercial, 40
                    sLinea = String((40 - Len(Trim("R.U.C.: " + sRUC))) / 2, " ") & "R.U.C.: " + sRUC
                    Printer.Print sLinea
                    ImprimeXCentro sDireccion, 40
                    If Trim(sDireccion2) <> "" Then
                        ImprimeXCentro sDireccion2, 40
                    End If
                    sLinea = String((40 - Len(Trim("Telefono: " + sTelefono))) / 2, " ") & "Telefono: " + sTelefono
                    Printer.Print sLinea
                    
                    If sFax <> "" Then
                        sLinea = String((40 - Len(Trim("Fax: " + sFax))) / 2, " ") & "Fax: " + sFax
                        Printer.Print sLinea
                    End If
                    
                    If tCodigoFE <> "999" Then
                        Printer.Print " "
                        If Mid(RsImpresion!tDocumento, 1, 1) = "F" Then
                            ImprimeXCentro "FACTURA ELECTRONICA", 40
                        Else
                            ImprimeXCentro "BOLETA DE VENTA ELECTRONICA", 40
                        End If
                        Printer.Print " "
                    End If
                    
                    'Printer.Print Mid(RsImpresion!tDocumento, 1, 1) & "-" & Mid(RsImpresion!tDocumento, 2, 5) & "-" & Mid(RsImpresion!tDocumento, 7)
                    ImprimeXCentro Mid(RsImpresion!tDocumento, 1, 1) & Mid(RsImpresion!tDocumento, 4, 3) & "-" & Mid(RsImpresion!tDocumento, 8, 8), 40
                    Printer.Print " "
                    Printer.Print "Pedido        : " & RsImpresion!tCodigoPedido
                    Printer.Print "Fecha Emision : " & RsImpresion!fRegistro
                    Printer.Print "Tipo          : " & RsImpresion!tipopedido
                    Printer.Print "Local         : " & xUnidadNegocio
                    Printer.Print "Caja          : " & RsImpresion!tCaja & " - " & RsImpresion!tUsuario
                    Printer.Print "Mesero        : " & RsImpresion!Mozo
                    If ImpDolarDelivery Then
                        Printer.Print "Tipo Moneda   : " & sMonedaE
                    Else
                        Printer.Print "Tipo Moneda   : " & sMonedaN
                    End If
                    
                    'tipo de cambio
                    If RsParametroTC!lVerTCImp = True Then
                    Printer.Print "T/Cambio  : " & Format(nTC, "###,##0.00")
                    End If
                    '------------------------------------------------------------
                    
                    
                    'Printer.Print "Nro.Serie     : " & Calcular("select isnull(tSerieImpresora,'') codigo from MDOCUMENTO where tDocumento ='" & RsImpresion!tDocumento & "'", Cn)
                    Printer.Print "Mesa          : " & RsImpresion!Mesa
                    If lImprimeMotivoDescuentoFB And RsImpresion!MotivoDescuento <> "" Then
                        ImprimeXLinea "Descuento     : " & RsImpresion!MotivoDescuento, 40, 16
                    End If
                    If lObservacionCabDoc Then
                        ImprimeXLinea "Observacion   : " & RsImpresion!tObservacion, 40, 16
                    End If
                    Printer.Print " "
                    Printer.Print String(40, "-")
                    If Not IsNull(RsImpresion!lImpProdDesc) And (RsImpresion!lImpProdDesc) Then
                        Printer.Print "Codigo      Cant. UM   P.Unit      Total"
                        Printer.Print "Producto                          Dscto."
                    Else
                        Printer.Print "Producto         Cant. P.Unit      Total"
                    End If
                    'Printer.Print "Producto         Cant. P.Unit      Total"
                    'Printer.Print "Cantid. Producto                SubTotal"
                    Printer.Print String(40, "-")
                                      
                    'Cuerpo
                    Item = ""
                    'Cuerpo
                    Do While Not RsImpresion.EOF
                    If ximprimeDetallado = False Then
                        xproducto = RsImpresion!Producto
                    Else
                        xproducto = RsImpresion!ProductoDetallado
                    End If
                       If Item <> RsImpresion!tCodigoPedido + RsImpresion!tItem Then
                          'Impresion de Propiedades
                          If lPropiedadDocumento Then
                             xRsPropiedad.Filter = "tCodigoPedido='" & Mid(Item, 1, 10) & "' and tItem='" & Mid(Item, 11, 3) & "'"
                             If Not xRsPropiedad.EOF Then
                                xRsPropiedad.MoveFirst
                                Do While Not xRsPropiedad.EOF
                                    'ImprimeXLinea "        * " & xRsPropiedad!Operador & " " & xRsPropiedad!Descripcion, 40, 8
                                    ImprimeXLinea "        * " & IIf(xRsPropiedad!nCantidad = 1, "", "(" & xRsPropiedad!nCantidad & ")") & xRsPropiedad!Operador & " " & xRsPropiedad!Descripcion, 31, 10
                                   xRsPropiedad.MoveNext
                                Loop
                             End If
                                         
                             'Impresion de la Observacion
                             If lObservacionDocumento And Len(Trim(xObservacion)) > 0 Then
                                ImprimeXLinea "        - " & Trim(xObservacion), 33, 2
                             End If
                          End If
                          
                          If IsNull(RsImpresion!tOferta) Or RsImpresion!tOferta = "" Then
                            If Not (RsImpresion!lImpProdDesc) Then
                                CANT = Len(Trim(xproducto))
                                ProductoTem = xproducto
regreso4:
                                If Valor = 0 Then
                                    If ImpDolarDelivery Then
                                        sLinea = Mid(xproducto & String(16, " "), 1, 16) & " " & Right(String(6, " ") & Format(RsImpresion!nCantidad, "##0.00"), 6) & " " & Right(String(6, " ") & Format(RsImpresion!nPrecioOficial / nTC, "##0.00"), 6) & " " & Right(String(9, " ") & Format((RsImpresion!nCantidad * RsImpresion!nPrecioOficial) / nTC, "##,##0.00"), 9)
                                    Else
                                        sLinea = Mid(xproducto & String(16, " "), 1, 16) & " " & Right(String(6, " ") & Format(RsImpresion!nCantidad, "##0.00"), 6) & " " & Right(String(6, " ") & Format(RsImpresion!nPrecioOficial, "##0.00"), 6) & " " & Right(String(9, " ") & Format(RsImpresion!nCantidad * RsImpresion!nPrecioOficial, "##,##0.00"), 9)
                                    End If
                                    Valor = 1
                                    CANT = Len(Mid(ProductoTem, 17))
                                    ProductoTem = Mid(ProductoTem, 17)
                                    Printer.Print sLinea
                                Else
                                    sLinea = Mid(ProductoTem & String(16, " "), 1, 16) & " " & Right(String(6, " ") & "      ", 6) & " " & Right(String(6, " ") & "      ", 6) & " " & Right(String(9, " ") & "           ", 9)
                                    CANT = Len(Mid(ProductoTem, 17))
                                    ProductoTem = Mid(ProductoTem, 17)
                                    Printer.Print sLinea
                                End If
                                
                                If CANT > 0 And ximprimeDetallado = True Then
                                GoTo regreso4
                                End If
                            End If
                            If (RsImpresion!lImpProdDesc) Then ' Para impresion con formato 2
                                If ImpDolarDelivery Then
                                    sLinea = Mid(RsImpresion!tCodigoProducto & String(8, " "), 1, 8) & " " & Right(String(7, " ") & Format(RsImpresion!nCantidad, "##0.00"), 7) & " " & Right(String(3, " ") & "UN", 3) & " " & Right(String(9, " ") & Format(RsImpresion!nPrecioOficial / nTC, "##0.00"), 9) & " " & Right(String(9, " ") & Format((RsImpresion!nCantidad * RsImpresion!nPrecioOficial) / nTC, "##,##0.00"), 9)
                                    sLinea2 = Mid(xproducto & String(30, " "), 1, 30) & " " & Right(String(9, " ") & Format((RsImpresion!DescUnitario) / nTC, "##,##0.00"), 9)
                                Else
                                    sLinea = Mid(RsImpresion!tCodigoProducto & String(8, " "), 1, 8) & " " & Right(String(7, " ") & Format(RsImpresion!nCantidad, "##0.00"), 7) & " " & Right(String(3, " ") & "UN", 3) & " " & Right(String(9, " ") & Format(RsImpresion!nPrecioOficial, "##0.00"), 9) & " " & Right(String(9, " ") & Format(RsImpresion!nCantidad * RsImpresion!nPrecioOficial, "##,##0.00"), 9)
                                    sLinea2 = Mid(xproducto & String(30, " "), 1, 30) & " " & Right(String(9, " ") & Format(RsImpresion!DescUnitario, "##,##0.00"), 9)
                                End If
                                Printer.Print sLinea
                                Printer.Print sLinea2
                            End If
                            
                          Else
                          
                            If Not (RsImpresion!lImpProdDesc) Then
                                CANT = Len(Trim(xproducto))
                                ProductoTem = xproducto
regreso5:
                                If Valor = 0 Then
                                    sLinea = Right(String(8, " ") & Format(RsImpresion!nCantidad, "#,##0.00"), 8) & " " & Mid(xproducto & String(21, " "), 1, 21)
                                    Printer.Print sLinea
                                
                                    Valor = 1
                                    CANT = Len(Mid(ProductoTem, 22))
                                    ProductoTem = Mid(ProductoTem, 22)
                                    
                                Else
                                    sLinea = Right(String(8, " ") & "        ", 8) & " " & Mid(ProductoTem & String(21, " "), 1, 21)
                                    CANT = Len(Mid(ProductoTem, 22))
                                    ProductoTem = Mid(ProductoTem, 22)
                                    Printer.Print sLinea
                                End If
                                
                                If CANT > 0 And ximprimeDetallado = True Then
                                GoTo regreso5
                                End If
                                If ImpDolarDelivery Then
                                    sLinea = String(8, " ") & " " & Mid(RsImpresion!tOferta & String(20, " "), 1, 20) & " " & Right(String(10, " ") & Format((RsImpresion!nCantidad * RsImpresion!nPrecioOficial) / nTC, "###,##0.00"), 10)
                                Else
                                    sLinea = String(8, " ") & " " & Mid(RsImpresion!tOferta & String(20, " "), 1, 20) & " " & Right(String(10, " ") & Format(RsImpresion!nCantidad * RsImpresion!nPrecioOficial, "###,##0.00"), 10)
                                End If
                             Printer.Print sLinea
                            End If
                            If (RsImpresion!lImpProdDesc) Then ' Para impresion con formato 2
                                If ImpDolarDelivery Then
                                    sLinea = Mid(RsImpresion!tCodigoProducto & String(8, " "), 1, 8) & " " & Right(String(7, " ") & Format(RsImpresion!nCantidad, "##0.00"), 7) & " " & Right(String(3, " ") & "UN", 3) & " " & Right(String(9, " ") & Format(RsImpresion!nPrecioOficial / nTC, "##0.00"), 9) & " " & Right(String(9, " ") & Format((RsImpresion!nCantidad * RsImpresion!nPrecioOficial) / nTC, "##,##0.00"), 9)
                                    sLinea2 = Mid(xproducto & String(30, " "), 1, 30) & " " & Right(String(9, " ") & Format((RsImpresion!DescUnitario) / nTC, "##,##0.00"), 9)
                                Else
                                    sLinea = Mid(RsImpresion!tCodigoProducto & String(8, " "), 1, 8) & " " & Right(String(7, " ") & Format(RsImpresion!nCantidad, "##0.00"), 7) & " " & Right(String(3, " ") & "UN", 3) & " " & Right(String(9, " ") & Format(RsImpresion!nPrecioOficial, "##0.00"), 9) & " " & Right(String(9, " ") & Format(RsImpresion!nCantidad * RsImpresion!nPrecioOficial, "##,##0.00"), 9)
                                    sLinea2 = Mid(xproducto & String(30, " "), 1, 30) & " " & Right(String(9, " ") & Format(RsImpresion!DescUnitario, "##,##0.00"), 9)
                                End If
                                Printer.Print sLinea
                                Printer.Print sLinea2
                            End If
                          End If
                          Valor = 0
                          xTotalS = xTotalS + (RsImpresion!nCantidad * RsImpresion!nPrecioOficial)
                          'Printer.Print sLinea
                        
                    End If
                       
                       'Combos
                       If lComboDocumento And IIf(IsNull(RsImpresion!Combo), 0, Len(Trim(RsImpresion!Combo))) > 0 Then
                          sLinea = Mid("       " & Right(String(5, " ") & Format(RsImpresion!nCombo, "#0.00"), 5) & " " & RsImpresion!Combo, 1, 40)
                          Printer.Print sLinea
                          
                          'Combos Propiedades
                          If lPropiedadDocumento And Len(Trim(IIf(IsNull(RsImpresion!Combo), "", RsImpresion!Combo))) > 0 Then
                          
                             xRsPropiedadCombo.Filter = "tCodigoPedido='" & RsImpresion!tCodigoPedido & "' and tItem='" & RsImpresion!tItem & "' and tItemCombo='" & RsImpresion!tItemCombo & "'"
                             If Not xRsPropiedadCombo.EOF Then
                                xRsPropiedadCombo.MoveFirst
                                Do While Not xRsPropiedadCombo.EOF
                                   'Printer.Print "        * " & xRsPropiedadCombo!Operador & " " & xRsPropiedadCombo!Descripcion
                                    ImprimeXLinea "             * " & xRsPropiedadCombo!Operador & " " & xRsPropiedadCombo!Descripcion, 31, 13
                                   xRsPropiedadCombo.MoveNext
                                Loop
                             End If
                          
                             'Impresion de la Observacion
                              If lObservacionDocumento And Len(Trim(RsImpresion!tObservacionCombo)) > 0 Then
                                 ImprimeXLinea "        - " & Trim(RsImpresion!tObservacionCombo), 33, 10
                              End If
                          End If
                       End If
                       xObservacion = IIf(IsNull(RsImpresion!tObservacionPedido), "", RsImpresion!tObservacionPedido)
                       Item = RsImpresion!tCodigoPedido + RsImpresion!tItem
                       RsImpresion.MoveNext
                Loop
                    
                    If lPropiedadDocumento Then
                       xRsPropiedad.Filter = "tCodigoPedido='" & Mid(Item, 1, 10) & "' and tItem='" & Mid(Item, 11, 3) & "'"
                       If Not xRsPropiedad.EOF Then
                          xRsPropiedad.MoveFirst
                          Do While Not xRsPropiedad.EOF
                              'Printer.Print "        * " & xRsPropiedad!Operador & " " & xRsPropiedad!Descripcion
                              'ImprimeXLinea "        * " & xRsPropiedad!Operador & " " & xRsPropiedad!Descripcion, 40, 8
                              ImprimeXLinea "        * " & IIf(xRsPropiedad!nCantidad = 1, "", "(" & xRsPropiedad!nCantidad & ")") & xRsPropiedad!Operador & " " & xRsPropiedad!Descripcion, 31, 10
                             xRsPropiedad.MoveNext
                          Loop
                       End If
                                   
                       'Impresion de la Observacion
                       If lObservacionDocumento And Len(Trim(xObservacion)) > 0 Then
                          ImprimeXLinea "        - " & Trim(xObservacion), 33, 2
                       End If
                    End If

                    Printer.Print String(40, "-")
                    RsImpresion.MoveLast
                    Dim xGravada As Double
                    Dim xInafecta As Double
                    If ImpDolarDelivery Then
                    
                        If lPagoAntesImpresion Then
                            lcuentaCobrar = True
                            If lcuentaCobrar And lPagocortesiaAI = False Then
                                Printer.Print Right(String(27, " ") & " Total a Pagar " & sMonE & " : ", 27) & Right(String(13, " ") & Format(xTotalS / nTC, "##,###,##0.00"), 13)
                            Else
                                Printer.Print Right(String(27, " ") & " Total a Pagar " & sMonE & " : ", 27) & Right(String(13, " ") & Format(0, "##,###,##0.00"), 13)
                            End If
                        Else
                            Printer.Print Right(String(27, " ") & " Total a Pagar " & sMonE & " : ", 27) & Right(String(13, " ") & Format(xTotalS / nTC, "##,###,##0.00"), 13)
                        End If
                        'FE SPRING
                        If lFESpring Then
                            Printer.Print String(40, " ")
                            
                            If RsImpresion!nRecargo > 0 Then
                               Printer.Print
                               Printer.Print Right(String(27, " ") & "Recargo " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nRecargo / nTC, "##,###,##0.00"), 13)
                            End If
                                                
                            If RsImpresion!nDescuento > 0 Then
                               Printer.Print
                               nDescuentoNeto = Calcular("select IsNull(nDescuentoNeto,0) as Codigo from mDocumento where tdocumento = '" & RsImpresion!tDocumento & "'", Cn)
                               Printer.Print Right(String(27, " ") & "Descuento " & sMonE & " : ", 27) & Right(String(13, " ") & Format(nDescuentoNeto / nTC, "##,###,##0.00"), 13)
                            End If
                            
                            xGravada = Calcular("SELECT SUM(D.nPrecioNeto*nCantidad) As Codigo FROM dDocumento D WHERE D.tDocumento = '" & RsImpresion!tDocumento & "' AND ((D.nPrecioImpuesto1>0 AND D.nPrecioImpuesto2=0) OR (D.nPrecioImpuesto1>0 AND D.nPrecioImpuesto2>0))", Cn)
                            xInafecta = Calcular("SELECT ISNULL(SUM(D.nPrecioNeto*nCantidad),0) As Codigo FROM dDocumento D WHERE ((D.nPrecioImpuesto1<=0 AND D.nPrecioImpuesto2>0)OR(D.nPrecioImpuesto1<=0 AND D.nPrecioImpuesto2<=0)) AND D.tDocumento = '" & RsImpresion!tDocumento & "'", Cn)
                            
                            If Not (IsNull(RsImpresion!lOpGravInaf) Or RsImpresion!lOpGravInaf = 0) Then
                                If lPagoAntesImpresion And lPagocortesiaAI Then
                                    Printer.Print Right(String(27, " ") & "Op. Gratuita " & sMonE & " : ", 27) & Right(String(13, " ") & Format((xGravada + xInafecta) / nTC, "##,###,##0.00"), 13)
                                Else
                                    Printer.Print Right(String(27, " ") & "Op. Gravadas " & sMonE & " : ", 27) & Right(String(13, " ") & Format(xGravada / nTC, "##,###,##0.00"), 13)
                                    Printer.Print Right(String(27, " ") & "Op. Inafecta " & sMonE & " : ", 27) & Right(String(13, " ") & Format(xInafecta / nTC, "##,###,##0.00"), 13)
                                End If
                            End If
                            
                        Else
                            'Printer.Print Right(String(27, " ") & " Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta + RsImpresion!nDescuento - RsImpresion!nRecargo, "##,###,##0.00"), 13)
                            Printer.Print String(40, " ")
                            
                            xGravada = Calcular("SELECT SUM(D.nPrecioNeto*nCantidad) As Codigo FROM dDocumento D WHERE D.tDocumento = '" & RsImpresion!tDocumento & "' AND ((D.nPrecioImpuesto1>0 AND D.nPrecioImpuesto2=0) OR (D.nPrecioImpuesto1>0 AND D.nPrecioImpuesto2>0))", Cn)
                            xInafecta = Calcular("SELECT ISNULL(SUM(D.nPrecioNeto*nCantidad),0) As Codigo FROM dDocumento D WHERE ((D.nPrecioImpuesto1<=0 AND D.nPrecioImpuesto2>0)OR(D.nPrecioImpuesto1<=0 AND D.nPrecioImpuesto2<=0)) AND D.tDocumento = '" & RsImpresion!tDocumento & "'", Cn)
                            If Not (IsNull(RsImpresion!lOpGravInaf) Or RsImpresion!lOpGravInaf = 0) Then
                                Printer.Print Right(String(27, " ") & "Op. Gravadas " & sMonE & " : ", 27) & Right(String(13, " ") & Format(xGravada / nTC, "##,###,##0.00"), 13)
                                Printer.Print Right(String(27, " ") & "Op. Inafecta " & sMonE & " : ", 27) & Right(String(13, " ") & Format(xInafecta / nTC, "##,###,##0.00"), 13)
                            End If
                            
                            If RsImpresion!nRecargo > 0 Then
                               'Printer.Print
                               Printer.Print Right(String(27, " ") & "Recargo " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nRecargo / nTC, "##,###,##0.00"), 13)
                            End If
                                                
                            If RsImpresion!nDescuento > 0 Then
                               'Printer.Print
                               Printer.Print Right(String(27, " ") & "Total Descuento " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nDescuento / nTC, "##,###,##0.00"), 13)
                            Else
                               'Printer.Print
                               Printer.Print Right(String(27, " ") & "Total Descuento " & sMonE & " : ", 27) & Right(String(13, " ") & Format(0, "##,###,##0.00"), 13)
                            End If
                            
                        End If
                    Else
                        If lPagoAntesImpresion Then
                            lcuentaCobrar = True
                            If lcuentaCobrar And lPagocortesiaAI = False Then
                                Printer.Print Right(String(27, " ") & " Total a Pagar " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xTotalS, "##,###,##0.00"), 13)
                            Else
                                Printer.Print Right(String(27, " ") & " Total a Pagar " & sMonN & " : ", 27) & Right(String(13, " ") & Format(0, "##,###,##0.00"), 13)
                            End If
                        Else
                            Printer.Print Right(String(27, " ") & " Total a Pagar " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xTotalS, "##,###,##0.00"), 13)
                        End If
                        'Printer.Print Right(String(27, " ") & " Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta + RsImpresion!nDescuento - RsImpresion!nRecargo, "##,###,##0.00"), 13)
                        
                        
                        'FE SPRING
                        If lFESpring Then
                            Printer.Print String(40, " ")
                            
                            If RsImpresion!nRecargo > 0 Then
                               Printer.Print
                               Printer.Print Right(String(27, " ") & "Recargo " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nRecargo, "##,###,##0.00"), 13)
                            End If
                                                
                            If RsImpresion!nDescuento > 0 Then
                               Printer.Print
                               nDescuentoNeto = Calcular("select IsNull(nDescuentoNeto,0) as Codigo from mDocumento where tdocumento = '" & RsImpresion!tDocumento & "'", Cn)
                               Printer.Print Right(String(27, " ") & "Descuento " & sMonN & " : ", 27) & Right(String(13, " ") & Format(nDescuentoNeto, "##,###,##0.00"), 13)
                            End If
                            
                            xGravada = Calcular("SELECT SUM(D.nPrecioNeto*nCantidad) As Codigo FROM dDocumento D WHERE D.tDocumento = '" & RsImpresion!tDocumento & "' AND ((D.nPrecioImpuesto1>0 AND D.nPrecioImpuesto2=0) OR (D.nPrecioImpuesto1>0 AND D.nPrecioImpuesto2>0))", Cn)
                            xInafecta = Calcular("SELECT ISNULL(SUM(D.nPrecioNeto*nCantidad),0) As Codigo FROM dDocumento D WHERE ((D.nPrecioImpuesto1<=0 AND D.nPrecioImpuesto2>0)OR(D.nPrecioImpuesto1<=0 AND D.nPrecioImpuesto2<=0)) AND D.tDocumento = '" & RsImpresion!tDocumento & "'", Cn)
                            
                            If Not (IsNull(RsImpresion!lOpGravInaf) Or RsImpresion!lOpGravInaf = 0) Then
                                If lPagoAntesImpresion And lPagocortesiaAI Then
                                    Printer.Print Right(String(27, " ") & "Op. Gratuita " & sMonE & " : ", 27) & Right(String(13, " ") & Format(xGravada + xInafecta, "##,###,##0.00"), 13)
                                Else
                                    Printer.Print Right(String(27, " ") & "Op. Gravadas " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xGravada, "##,###,##0.00"), 13)
                                    Printer.Print Right(String(27, " ") & "Op. Inafecta " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xInafecta, "##,###,##0.00"), 13)
                                End If
                            End If
                        Else
                            Printer.Print String(40, " ")
    '
                            xGravada = Calcular("SELECT SUM(D.nPrecioNeto*nCantidad) As Codigo FROM dDocumento D WHERE D.tDocumento = '" & RsImpresion!tDocumento & "' AND ((D.nPrecioImpuesto1>0 AND D.nPrecioImpuesto2=0) OR (D.nPrecioImpuesto1>0 AND D.nPrecioImpuesto2>0))", Cn)
                            xInafecta = Calcular("SELECT ISNULL(SUM(D.nPrecioNeto*nCantidad),0) As Codigo FROM dDocumento D WHERE ((D.nPrecioImpuesto1<=0 AND D.nPrecioImpuesto2>0)OR(D.nPrecioImpuesto1<=0 AND D.nPrecioImpuesto2<=0)) AND D.tDocumento = '" & RsImpresion!tDocumento & "'", Cn)
                            
                            If Not (IsNull(RsImpresion!lOpGravInaf) Or RsImpresion!lOpGravInaf = 0) Then
                                Printer.Print Right(String(27, " ") & "Op. Gravadas " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xGravada, "##,###,##0.00"), 13)
                                Printer.Print Right(String(27, " ") & "Op. Inafecta " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xInafecta, "##,###,##0.00"), 13)
                            End If
                            
                            If RsImpresion!nRecargo > 0 Then
                               'Printer.Print
                               Printer.Print Right(String(27, " ") & "Recargo " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nRecargo, "##,###,##0.00"), 13)
                            End If
                                                
                            If RsImpresion!lAnticipo Then
                                Printer.Print Right(String(27, " ") & "Total Anticipo  " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nDescuento, "##,###,##0.00"), 13)
                            Else
                                If RsImpresion!nDescuento > 0 Then
                                   'Printer.Print
                                   Printer.Print Right(String(27, " ") & "Total Descuento " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nDescuento, "##,###,##0.00"), 13)
                                Else
                                   'Printer.Print
                                   Printer.Print Right(String(27, " ") & "Total Descuento " & sMonN & " : ", 27) & Right(String(13, " ") & Format(0, "##,###,##0.00"), 13)
                                End If
                            End If
                        End If
                    End If

                    nSumaNeto = RsImpresion!nNeto
                    
                    If IsNull(RsImpresion!lImpuesto1) Or Not RsImpresion!lImpuesto1 Then
                       nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto1
                    End If
                    
                    If IsNull(RsImpresion!lImpuesto2) Or Not RsImpresion!lImpuesto2 Then
                       nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto2
                    End If
                    
                    If IsNull(RsImpresion!lImpuesto3) Or Not RsImpresion!lImpuesto3 Then
                       nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto3
                    End If
                                                  
                    If ImpDolarDelivery Then
                        If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                           Printer.Print Right(String(27, " ") & sImpuesto1 & " " & Format(nPorcentaje1, "##0.00") & "% " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto1 / nTC, "##,###,##0.00"), 13)
                        End If
                           
                        If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                           Printer.Print Right(String(27, " ") & sImpuesto2 & " " & Format(nPorcentaje2, "##0.00") & "% " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto2 / nTC, "##,###,##0.00"), 13)
                        End If
                        
                        If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                           Printer.Print Right(String(27, " ") & sImpuesto3 & " " & Format(nPorcentaje3, "##0.00") & "% " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto3 / nTC, "##,###,##0.00"), 13)
                        End If
                        
                         If lPagoAntesImpresion Then
                            lcuentaCobrar = True
    
                            If lcuentaCobrar And lPagocortesiaAI = False Then
                              Printer.Print Right(String(27, " ") & "Importe Total " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 13)
                            Else
                              Printer.Print Right(String(27, " ") & "Importe Total " & sMonE & " : ", 27) & Right(String(13, " ") & Format(0, "##,###,##0.00"), 13)
                            End If
                        Else
                        
                          Printer.Print Right(String(27, " ") & "Importe Total " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 13)
                        End If
                    Else
                        If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                           Printer.Print Right(String(27, " ") & sImpuesto1 & " " & Format(nPorcentaje1, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,##0.00"), 13)
                        End If
                           
                        If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                           Printer.Print Right(String(27, " ") & sImpuesto2 & " " & Format(nPorcentaje2, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto2, "##,###,##0.00"), 13)
                        End If
                        
                        If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                           Printer.Print Right(String(27, " ") & sImpuesto3 & " " & Format(nPorcentaje3, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto3, "##,###,##0.00"), 13)
                        End If
                        
                         If lPagoAntesImpresion Then
                            lcuentaCobrar = True
    
                            If lcuentaCobrar And lPagocortesiaAI = False Then
                              Printer.Print Right(String(27, " ") & "Importe Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 13)
                            Else
                              Printer.Print Right(String(27, " ") & "Importe Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(0, "##,###,##0.00"), 13)
                            End If
                        Else
                        
                          Printer.Print Right(String(27, " ") & "Importe Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 13)
                        End If

                        If lEquivalencia = True Or lDocumEquivaPrecuenta = True Then
                            If lPagoAntesImpresion Then
                                lcuentaCobrar = True
        
                                If lcuentaCobrar And lPagocortesiaAI = False Then
                                    Printer.Print Right(String(27, " ") & "Importe Total " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 13)
                                    Printer.Print
                                Else
                                    Printer.Print Right(String(27, " ") & "Importe Total " & sMonE & " : ", 27) & Right(String(13, " ") & Format(0, "##,###,##0.00"), 13)
                                    Printer.Print
                                End If
                            Else
                                    
                                Printer.Print Right(String(27, " ") & "Importe Total " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 13)
                                Printer.Print
                            End If
                        End If
                    End If
                    'TEXTO AGENTE RETENCION
                    Printer.Print " "
                    If Calcular(" SELECT case when  lImpresionRetencion=1 then 1 else 0 end  as codigo FROM vTipodocumento WHERE Codigo=(SELECT TTIPODOCUMENTO FROM MDOCUMENTO WHERE tDocumento='" & RsImpresion!tDocumento & "')", Cn) = 1 Then
                        ImprimeXLinea tTextoAgenteRetencion, 40, 5
                    End If
                    Printer.Print " "
                    If ImpDolarDelivery Then
                        If lPagoAntesImpresion Then
                                lcuentaCobrar = True
    
                            If lcuentaCobrar And lPagocortesiaAI = False Then
                                txt = "Son: " & NumeroCadena(str(RsImpresion!nVenta / nTC)) & " " & sMonedaE
                                ImprimeXLinea txt, 40, 5
    
                            Else
                                txt = "Son: " & NumeroCadena(str(0)) & " " & sMonedaE
                                ImprimeXLinea txt, 40, 5
                            End If
                        Else
                            txt = "Son: " & NumeroCadena(str(RsImpresion!nVenta / nTC)) & " " & sMonedaE
                            ImprimeXLinea txt, 40, 5
                        End If
                      Else
                        If lPagoAntesImpresion Then
                                lcuentaCobrar = True
    
                            If lcuentaCobrar And lPagocortesiaAI = False Then
                                txt = "Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
                                ImprimeXLinea txt, 40, 5
    
                            Else
                                txt = "Son: " & NumeroCadena(str(0)) & " " & sMonedaN
                                ImprimeXLinea txt, 40, 5
                            End If
                        Else
                            txt = "Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
                            ImprimeXLinea txt, 40, 5
                        End If
                      End If
'                    txt = "Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
'                    ImprimeXLinea txt, 40, 5
'
                    If lPagoAntesImpresion Then
                        lcuentaCobrar = True
                        'Set RsPagoDocumento = Lib.OpenRecordset("select Distinct v.tResumido + ' ' + M.tResumido as pago , Sum(D.nMonto) as monto from DPAGODOCUMENTO D inner join vTipoPago v on d.tTipoPago = v.Codigo inner join vMoneda M on M.Codigo = D.tMoneda Where D.tDocumento = '" & RsImpresion!tDocumento & "' group by v.tResumido,  M.tResumido", Cn)
                        Set RsPagoDocumento = Lib.OpenRecordset("exec usp_Inforest_Impresion '" & RsImpresion!tDocumento & "', 9 ", Cn)
                        Printer.Print " "
                            If RsPagoDocumento.RecordCount > 0 Then
                                For i = 0 To RsPagoDocumento.RecordCount - 1
                                    lcuentaCobrar = False
                                        Printer.Print "Forma de Pago:" & RsPagoDocumento!pago & " " & Format(RsPagoDocumento!Monto, "##,###,##0.00")
                                    RsPagoDocumento.MoveNext
                                Next i
                                Printer.Print "Vuelto       :" & sMonN & " " & Format(RsImpresion!Vuelto, "##,###,##0.00")
                            Else
                                If lcuentaCobrar And lPagocortesiaAI = False Then
                                    Printer.Print "Forma de Pago:Enviado a Cuenta por Cobrar"
                                Else
                                    ImprimeXLinea "Forma de Pago: " & lGlosaTrans, 40, 15
                                End If
                            End If
                        Printer.Print " "
                    End If
                    Printer.Print String(40, "-")
                    If Calcular("select upper(tResumido) as Codigo from vTipoIdentidad inner join TCLIENTE on vTipoIdentidad.Codigo=tcliente.tTipoIdentidad where tcliente.tCodigoCliente= (select isnull(tCodigoCliente,'') as codigo From MDOCUMENTO where tDocumento='" & RsImpresion!tDocumento & "')", Cn) = "DNI" Then
                        ImprimeXLinea "Cliente: " & RsImpresion!Cliente, 40, 9
                        Printer.Print "DNI    : " & RsImpresion!Ruc
                        ImprimeXLinea "Direcc.: " & RsImpresion!direccion, 40, 9
                    Else
                        ImprimeXLinea "Empresa: " & RsImpresion!Cliente, 40, 9
                        Printer.Print "RUC    : " & RsImpresion!Ruc
                        ImprimeXLinea "Direcc.: " & RsImpresion!direccion, 40, 9
                    End If
                    If lFEBiz Then
                        Dim tUbigeo As String
                        Dim sUbigeo As String
                        tUbigeo = Calcular("select top 1 isnull(tUbigeo,'') as Codigo from tcliente where tIdentidad='" & RsImpresion!Ruc & "'", Cn)
                        sUbigeo = Calcular("select isnull(tdistrito+'-'+tprovincia+'-'+tDepartamento,'') as codigo from tubigeo where tcodigo='" & tUbigeo & "'", Cn)
                        ImprimeXLinea "Ubigeo : " & tUbigeo & " " & sUbigeo, 40, 9
                    End If
                    Printer.Print String(40, "-")
                    ImprimeXCentro sPie, 40
                                      
                    Set xRsPropiedad = Nothing
                    Set xRsPropiedadCombo = Nothing
                                      
                     Printer.Print " "
                     'FACTURACION_E_PERU
                     
                     If lQRFE Then
                        Printer.PaintPicture CodigoHash, 1400, Printer.CurrentY, 1323, 1323
                                Dim d As Integer
                                For d = 1 To 8
                                    Printer.Print
                                 Next d
                     Else
                        If lImpresionCodigoBarras Then
                           Printer.PaintPicture CodigoHash, 250, Printer.CurrentY, 3400, 1200
                           Printer.CurrentY = Printer.CurrentY + 1200
                        Else
                           ImprimeXCentro cadenaCodigoHash, 40
                        End If
                     End If

                     Printer.Print " "
                     xImpresionFE = Calcular(" SELECT tImpresionFE as codigo FROM vTipodocumento WHERE Codigo=(SELECT TTIPODOCUMENTO FROM MDOCUMENTO WHERE tDocumento='" & RsImpresion!tDocumento & "')", Cn)
                     ImprimeXCentro xImpresionFE, 40
                     Printer.Print " "
                     '------------------
                     
                     If lImprimeImagPieDocumento Then
                            If pie <> 0 Then
                            Printer.Print " "
                            Printer.PaintPicture pie, 500, Printer.CurrentY, 2860, 1600
                            End If
                    End If

                    Printer.EndDoc
                     
        End Select
        
End Sub


Public Function getClaveAcceso(ByVal Documento As String) As String
         Dim cadena As String
         
         Dim Fecha As String
         Dim Comprobante As String
         Dim Ruc As String
         Dim Ambiente As String
         Dim Serie As String
         Dim Numero As String
         Dim TipoEmision As String
         
         Dim xi As Integer
         Dim Valor As Integer
         Dim codigoVerifica As Integer
         
         Dim a, b, c, d As Integer
         Dim bx As Double
         
         Fecha = Calcular("Select CONVERT(NVARCHAR,fRegistro,103) As codigo From MDOCUMENTO Where tDocumento = '" & Documento & "'", Cn)
         Comprobante = "01"
         Ruc = sRUC
         
         If lAmbienteProduccion Then
            Ambiente = "2"
         Else
            Ambiente = "1"
         End If
         
         Serie = Mid(Documento, 2, 6)
         Numero = Mid(Documento, 8, 9)
         TipoEmision = "1"
         cadena = ""
         cadena = Mid(Fecha, 1, 2) + Mid(Fecha, 4, 2) + Mid(Fecha, 7, 4) + Comprobante + Ruc + Ambiente + Serie + Numero + "12345678" + TipoEmision
         Valor = 7
         codigoVerifica = 0
         
         For xi = 1 To 48
         
                 codigoVerifica = codigoVerifica + Mid(cadena, xi, 1) * Valor
                 Valor = Valor - 1
                 
                 If Valor = 1 Then
                    Valor = 7
                 End If
                 
         Next xi
         
         a = codigoVerifica
         bx = a / 11
         b = Int(bx)
         c = b * 11
         d = a - c
         codigoVerifica = 11 - d
         
         
         If codigoVerifica = 11 Then
            codigoVerifica = 0
         ElseIf codigoVerifica = 10 Then
            codigoVerifica = 1
         End If
        
         cadena = cadena + CStr(codigoVerifica)
        
         ClaveAcceso = cadena
End Function
Public Function getClaveAlatoria(ByVal llave As String) As String
         Dim longuitud As String
         Dim xi, xj, xs As Integer
         Dim cadena, caracter As String
         Dim Token As String
         Dim sChar As String
         Dim iCtr As Integer
         
         xi = 0
         xj = 0
         xs = 0
         iCtr = 1
         cadena = ""
         longuitud = Len(llave)
         
         Token = "ABCDEFGHIJKT123456RSVWXY7890Z"
         
         For xi = 1 To longuitud
                 xj = xi Mod 2
                 
                 If xj = 0 Then

                            sChar = Mid(llave, xi, 1)
                    
                            If Not sChar Like "[0-9]" Then
                               caracter = Mid(llave, xi - 1, xi)
                               cadena = cadena + caracter
                            Else
      
                                xs = Mid(llave, xi, 1)
                                cadena = Mid(Token, xs + 1, 1) + cadena
                            End If

                    
                 End If

         Next xi
        
         ClaveFact = cadena
End Function
Public Sub calculaDescuentoNeto(ByVal xsDocumento As String)
    '---CESAR IMP
    Dim imp1 As Double
    Dim imp2 As Double
    Dim impxT As Double
    Dim impx1 As Double
    Dim impx2 As Double
    Dim impG As Double
    Dim xDescuento As Double
    
    imp1 = Calcular("select ISNULL(Impuesto1,0) as Codigo from TPARAMETRO", Cn)
    imp2 = Calcular("select ISNULL(Impuesto2,0) as Codigo from TPARAMETRO", Cn)
    impxT = 1 + (imp1 / 100) + (imp2 / 100)
    impx1 = 1 + (imp1 / 100)
    impx2 = 1 + (imp2 / 100)
    impG = 1
    '------------------
    Dim RsImpresion As Recordset
    Set RsImpresion = Lib.OpenRecordset("select * from dbo.DDOCUMENTO where tdocumento='" & xsDocumento & "'", Cn)
    
    
    Do While Not RsImpresion.EOF
    
        If RsImpresion!nImpuesto1 > 0 And RsImpresion!nImpuesto2 > 0 Then
              impG = impxT
        ElseIf RsImpresion!nImpuesto1 > 0 And RsImpresion!nImpuesto2 = 0 Then
              impG = impx1
        ElseIf RsImpresion!nImpuesto1 = 0 And RsImpresion!nImpuesto2 > 0 Then
              impG = impx2
        Else
              impG = 1
        End If
        
        xDiferencia = ((RsImpresion!nPrecioOficial * RsImpresion!nCantidad) / impG) - (RsImpresion!nVenta - (RsImpresion!nprecioImpuesto1 * RsImpresion!nCantidad) - (RsImpresion!nprecioImpuesto2 * RsImpresion!nCantidad))
        xDescuento = xDescuento + xDiferencia
        
        If (RsImpresion!nPrecioOficial * RsImpresion!nCantidad) = RsImpresion!nVenta Then
            Cn.Execute "Update DDOCUMENTO Set nDescuentoNeto= " & 0 & "  Where tDocumento ='" & xsDocumento & "' And tItem ='" & RsImpresion!tItem & "'"
        Else
            Cn.Execute "Update DDOCUMENTO Set nDescuentoNeto= " & xDiferencia & "  Where tDocumento ='" & xsDocumento & "' And tItem ='" & RsImpresion!tItem & "'"
        End If

        RsImpresion.MoveNext
                            
    Loop
        Cn.Execute "Update MDOCUMENTO Set nDescuentoNeto= " & xDescuento & "  Where tDocumento ='" & xsDocumento & "'"
            
End Sub

Public Sub ImprimeFacturaConsumoT(ByVal RsImpresion As Recordset, sConsumo As String, Optional tTipoDoc As String, Optional Cabecera As Image, Optional pie As Image, Optional ByVal ImpDolarDelivery As Boolean)
    On Error Resume Next
    Dim Item As String
    Dim sLinea As String
    Dim txt As String
    Dim nSumaNeto As Double
        
    Dim xTotalS As Double
    
    lImprimeImagCabDocumento = Calcular("select lImprimeImageCab as codigo  from ttipodocumentoimpresora where ttipoemision='" & tTipoDoc & "' and  tcaja='" & sCaja & "'", Cn)
    lImprimeImagPieDocumento = Calcular("select lImprimeImagePie as codigo from ttipodocumentoimpresora where ttipoemision='" & tTipoDoc & "' and  tcaja='" & sCaja & "'", Cn)
'    ximprimeDetallado = Calcular("select lImprimeresumen as codigo from ttipodocumentoimpresora where ttipoemision='" & tTipoDoc & "' and  tcaja='" & sCaja & "'", Cn)
    ' no tiene xproducto revisar para enviar descripcion detallado
     'Log
     If lLogCajaRapida = True Then
            Cn.Execute "UPDATE TLOG_IMPRESION SET TPOSICION5='PASO 1 ' + '" & RsImpresion!tDocumento & "' WHERE TDOCUMENTO='" & sDocumento & "'"
     End If
    Select Case pais
       Case "001" 'Bolivia
                    'OBTIENE DATOS A IMPRIMIR
                    Dim tAutorizacion As String '  del documento
                    Dim tcodigoControl As String ' del documento
                    Dim tGlosaDosificacion As String
                    Dim RsDatos As Recordset
                    Dim fLimite As Date ' de la caja
                    Dim tSfc As String ' de la caja
                    
                    'CGMiranda******************************
                    Dim tSucursal As String
                    'fin CGMiranda************************
                    
                    Dim cadenaxx As String
                    tSfc = ""
                    fLimite = Now
                    tAutorizacion = Calcular("select tautorizacion as codigo from mdocumento where tdocumento ='" & RsImpresion!tDocumento & "'", Cn)
                    tcodigoControl = Calcular("select tcodigoControl as codigo from mdocumento where tdocumento ='" & RsImpresion!tDocumento & "'", Cn)
                    cadenaxx = "SELECT tsfc,ffin, isnull(tGlosaDosificacion,'') tglosadosificacion FROM TORIGENCODIGOCONTROL WHERE TCAJA='" & RsImpresion!tCaja & "' AND TAUTORIZACION='" & Trim(tAutorizacion) & "' AND ((FINICIO <= '" & Format(RsImpresion!fRegistro, "YYYYmmdd HH:mm") & "') AND (ffin>='" & Format(RsImpresion!fRegistro, "YYYYmmdd HH:mm") & "'))"
                    Set RsDatos = Lib.OpenRecordset(cadenaxx, Cn)
                    If Not (RsDatos.EOF Or RsDatos.BOF) Then
                           ' rsDatos.MoveFirst
                            tSfc = RsDatos!tSfc
                            fLimite = Format(RsDatos!fFin, "dd/MM/yyyy")
                            tGlosaDosificacion = RsDatos!tGlosaDosificacion

                    End If
                    'Cabecera
                    RsImpresion.MoveFirst
                
                    If lImprimeImagCabDocumento Then
                                    If Cabecera <> 0 Then
                                    Printer.PaintPicture Cabecera, 500, Printer.CurrentY, 2860, 1600
                                    For p = 1 To 10
                                    Printer.Print
                                    Next p
                                    End If
                    End If
                
                    ImprimeXCentro sRazonSocial, 40
                    ImprimeXCentro sRazonComercial, 40
                    'CGMiranda******************************************************
                    tSucursal = Calcular("select vs.tResumido as codigo from vsucursal vs inner join TCAJA tc on vs.Codigo = tc.tSucursal where tc.tCaja='" & sCaja & "'", Cn)
                    ImprimeXCentro "Sucursal Nº " & IIf(tSucursal = 0, "", tSucursal), 40
                    ImprimeXCentro sDireccion, 40
                    ImprimeXCentro "Telefono: " & sTelefono, 40
                    ImprimeXCentro "SFC: " & tSfc & "   La Paz Bolivia", 40
                    If estadoReimpresion = True Then
                        ImprimeXCentro "FACTURA-COPIA", 40
                        estadoReimpresion = False
                    Else
                        ImprimeXCentro "FACTURA", 40
                    End If
                    'Fin CGMiranda**********************************************************
                    Printer.Print
                    Printer.Print String(40, "-")
                    sLinea = String((40 - Len(Trim("NIT: " + sRUC))) / 2, " ") & "NIT: " + sRUC
                    Printer.Print sLinea
             'cambios pedido por salvador bustillos
                        'Printer.Print "Factura Nº " & Mid(RsImpresion!tDocumento, 7)
                        'Printer.Print "Autorizacion Nº " & tAutorizacion
                        ImprimeXCentro "Factura Nº " & Mid(RsImpresion!tDocumento, 7), 40 'cambio
                        ImprimeXCentro "Autorizacion Nº " & tAutorizacion, 40 ' cambio
                        Printer.Print String(40, "-")
                        lTamanio = Printer.FontSize
                        Printer.FontSize = lTamanio - 1
                        ImprimeXCentro "Hotelería, Restaurantes y Alquileres", 40 'cambio
                        Printer.FontSize = lTamanio
                             'impresiondiacontable
                             'impresiondiacontable
                            If lImpresionDiaContable Then
                                If lReimpresion = True Then
                                    Printer.Print "Fecha    : " & Format(Calcular("select fdiacontable as codigo from mdocumento where tdocumento ='" & RsImpresion!tDocumento & "'", Cn), "dd/MM/yyyy") & " " & Calcular("exec DiacontableHora '" & fImpresionDiaContable & "'", Cn)
                                    Else
                                    Printer.Print "Fecha    : " & fImpresionDiaContable & " " & Calcular("exec DiacontableHora '" & fImpresionDiaContable & "'", Cn)
                                End If
                                Else
                                 Printer.Print "Fecha    : " & RsImpresion!fRegistro
                            End If
                            
                                       
'                    Printer.Print "Fecha    : " & RsImpresion!fRegistro
                    ImprimeXLinea "Señores  : " & RsImpresion!Cliente, 40, 9
                    Printer.Print "NIT/CI   : " & RsImpresion!Ruc
                    Printer.Print "Dirección: " & Mid(RsImpresion!direccion, 1, 30)
                    Printer.Print String(40, "-")
                    
                    Printer.Print
                    Printer.Print "Pedido   : " & RsImpresion!tCodigoPedido
                    Printer.Print "Tipo     : " & RsImpresion!tipopedido
                    Printer.Print "Caja     : " & RsImpresion!tCaja & " - " & RsImpresion!tUsuario
                    Printer.Print "Mesero   : " & RsImpresion!Mozo
                    Printer.Print "Nro.Serie: " & Calcular("select isnull(tSerieImpresora,'') codigo from MDOCUMENTO where tDocumento ='" & RsImpresion!tDocumento & "'", Cn)
                    Printer.Print "Descuento: " & Mid(Trim(RsImpresion!DESCUENTO), 1, 30)
                    Printer.Print
                    Printer.Print "MESA     : " & RsImpresion!Mesa
                    If lObservacionCabDoc Then
                        Printer.Print "Observac.: " & RsImpresion!tObservacion
                    End If
                    Printer.Print
                    Printer.Print String(40, "-")
                    Printer.Print "Cantid. Producto                SubTotal"
                    Printer.Print String(40, "-")
                                      
                    'Cuerpo
                    Printer.Print
                    txt = sConsumo
                    tOt = Len(Trim(txt))
                    pri = True
                    j = 0
                    Do While tOt <> 0
                       j = j + 1
                       lin = Mid(txt & " ", 1, 27)
                       For i = 27 To 1 Step -1
                           If Mid(lin, i, 1) = " " Then
                              pos = i
                              Exit For
                           End If
                       Next i
                       If pri Then
                          sLinea = Mid(Mid(txt, 1, pos - 1) & String(27, " "), 1, 27) & " " & Right(String(12, " ") & Format(RsImpresion!nVenta + RsImpresion!nDescuento, "#,###,##0.00"), 12)
                          pri = False
                       Else
                          sLinea = Mid(txt, 1, pos - 1)
                       End If
                       txt = Mid(txt, pos + 1, tOt)
                       tOt = Len(txt)
                       Printer.Print sLinea
                    Loop
                    Printer.Print String(40, "-")
                    
                    If RsImpresion!nRecargo > 0 Then
                       Printer.Print
                       Printer.Print Right(String(27, " ") & "Recargo " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nRecargo, "##,###,##0.00"), 13)
                    End If
                    
                    If RsImpresion!nDescuento > 0 Then
                       Printer.Print
                       Printer.Print Right(String(27, " ") & "Descuento " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nDescuento, "##,###,##0.00"), 13)
                    End If
                    

                    nSumaNeto = RsImpresion!nNeto
                    
                    If IsNull(RsImpresion!lImpuesto1) Or Not RsImpresion!lImpuesto1 Then
                       nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto1
                    End If
                    
                    If IsNull(RsImpresion!lImpuesto2) Or Not RsImpresion!lImpuesto2 Then
                       nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto2
                    End If
                    
                    If IsNull(RsImpresion!lImpuesto3) Or Not RsImpresion!lImpuesto3 Then
                       nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto3
                    End If
                    'CESAR
                    If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
                       Printer.Print Right(String(27, " ") & "Valor Venta " & sMonN & " : ", 27) & Right(String(13, " ") & Format(nSumaNeto, "##,###,##0.00"), 13)
                    End If
                    
                    If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                       Printer.Print Right(String(27, " ") & sImpuesto1 & " " & Format(nPorcentaje1, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,##0.00"), 13)
                    End If
                       
                    If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                       Printer.Print Right(String(27, " ") & sImpuesto2 & " " & Format(nPorcentaje2, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto2, "##,###,##0.00"), 13)
                    End If
                    
                    If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                       Printer.Print Right(String(27, " ") & sImpuesto3 & " " & Format(nPorcentaje3, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto3, "##,###,##0.00"), 13)
                    End If
                                        
                    Printer.Print Right(String(27, " ") & "Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 13)
                      '====================== nov 2010
                    If lDocumEquivaPrecuenta Then
                         Printer.Print " "
                        Printer.Print Right(String(27, " ") & "Total " & sMonE & " :", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 13)
                    End If
                    '====================== nov 2010
                    Printer.Print
                    txt = "Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
                    ImprimeXLinea txt, 40, 5
                    Printer.Print String(40, "-")
                    Printer.Print "Código de Control      : " & tcodigoControl
                    Printer.Print "Fecha Límite de Emisión: " & Format(fLimite, "dd/MM/yyyy")
                     Printer.Print String(40, "-")
                     
                     
'                    ImprimeXLinea textoComprobanteBolivia, 40, 5
'                    Printer.Print String(40, "-")
'

                   
                    'IMPRIMEQR
                    If Calcular("select ISNULL(lImprimeQR,0) as codigo from TTIPODOCUMENTO where tCodigoTipoDocumento='" & tTipoDoc & "'", Cn) = 1 Then
                        If pais = "001" Then
                         
                        Set rsQr = Lib.OpenRecordset("usp_Inforest_ObtieneCodigoQR_Bol " + RsImpresion!tDocumento, Cn)
                    
                           FastQRCode rsQr.Fields(0), App.Path & "\BaseTempQr.bmp"
                    
                            Set imgDocumento = CreateObject("Scripting.FileSystemObject")
                            If imgDocumento.FileExists(App.Path & "\BaseTempQr.bmp") Then
                                Printer.PaintPicture LoadPicture(App.Path & "\BaseTempQr.bmp"), 1400, Printer.CurrentY, 1323, 1323
                                 For p = 1 To 8
                                    Printer.Print
                                 Next p
                            End If
                       End If
                    End If
                    
                    Printer.Print '.'
                    lTamanio = Printer.FontSize
                    Printer.FontSize = lTamanio - 2
                    comilla = Chr(34)
                    ImprimeXLinea comilla & "ESTA FACTURA CONTRIBUYE AL DESARROLLO DEL PAIS. EL USO ILICITO DE ESTA SERA SANCIONADO DE ACUERDO A LEY" & comilla, 57, 2
                    Printer.Print '.'
                    If tGlosaDosificacion <> "" Then
                            ImprimeXLinea tGlosaDosificacion, 40, 2
                    End If
                    Printer.FontSize = lTamanio
                    Printer.Print String(40, "-")
                    ImprimeXCentro sPie, 40
                    Printer.Print
                    
            
                    If lImprimeImagPieDocumento Then
                                    If pie <> 0 Then
                                        Printer.PaintPicture pie, 500, Printer.CurrentY, 2860, 1600
                                    End If
                    End If
                    
                     
                    
                    Printer.EndDoc
                    
                    
         Case Else 'Peru, Ecuador
                    
            
                    If lImprimeImagCabDocumento Then
                                    If Cabecera <> 0 Then
                                    Printer.PaintPicture Cabecera, 500, Printer.CurrentY, 2860, 1600
                                    For p = 1 To 10
                                    Printer.Print
                                    Next p
                                    End If
                    End If
                    
                     'Cabecera
                    RsImpresion.MoveFirst
                
                    If estadoReimpresion = True Then
                        ImprimeXCentro "REIMPRESION", 40
                        estadoReimpresion = False
                    End If
                    

                    ImprimeXCentro sRazonSocial, 40
                    ImprimeXCentro sRazonComercial, 40
                    sLinea = String((40 - Len(Trim("R.U.C.: " + sRUC))) / 2, " ") & "R.U.C.: " + sRUC
                    Printer.Print sLinea
                    ImprimeXCentro sDireccion, 40
                    If Trim(sDireccion2) <> "" Then
                        ImprimeXCentro sDireccion2, 40
                    End If
                    sLinea = String((40 - Len(Trim("Telefono: " + sTelefono))) / 2, " ") & "Telefono: " + sTelefono

                
                    Printer.Print sLinea
                    Printer.Print
                    Printer.Print Mid(RsImpresion!tDocumento, 1, 1) & "-" & Mid(RsImpresion!tDocumento, 2, 5) & "-" & Mid(RsImpresion!tDocumento, 7)
                    Printer.Print
                    Printer.Print "Pedido   : " & RsImpresion!tCodigoPedido
                    
                             'impresiondiacontable
                            If lImpresionDiaContable Then
                                If lReimpresion = True Then
                                    Printer.Print "Fecha    : " & Format(Calcular("select fdiacontable as codigo from mdocumento where tdocumento ='" & RsImpresion!tDocumento & "'", Cn), "dd/MM/yyyy") & " " & Calcular("exec DiacontableHora '" & fImpresionDiaContable & "'", Cn)
                                    Else
                                    Printer.Print "Fecha    : " & fImpresionDiaContable & " " & Calcular("exec DiacontableHora '" & fImpresionDiaContable & "'", Cn)
                                End If
                                Else
                                 Printer.Print "Fecha    : " & RsImpresion!fRegistro
                            End If
                            
                                                
                    'Printer.Print "Fecha    : " & RsImpresion!fRegistro
                    Printer.Print "Tipo     : " & RsImpresion!tipopedido
                    Printer.Print "Caja     : " & RsImpresion!tCaja & " - " & RsImpresion!tUsuario
                    Printer.Print "Mesero   : " & RsImpresion!Mozo
                    Printer.Print "Nro.Serie: " & Calcular("select isnull(tSerieImpresora,'') codigo from MDOCUMENTO where tDocumento ='" & RsImpresion!tDocumento & "'", Cn)
                    Printer.Print "Descuento: " & Mid(Trim(RsImpresion!DESCUENTO), 1, 30)
                    Printer.Print
                    Printer.Print "MESA     : " & RsImpresion!Mesa
                    If lObservacionCabDoc Then
                        Printer.Print "Observac.: " & RsImpresion!tObservacion
                    End If
                    Printer.Print
                    Printer.Print String(40, "-")
                    Printer.Print "Cantid. Producto                SubTotal"
                    Printer.Print String(40, "-")
                                      
                    'Cuerpo
                    Printer.Print
                    txt = sConsumo
                    tOt = Len(Trim(txt))
                    pri = True
                    j = 0
                    
                    Do While Not RsImpresion.EOF
                        If Item <> RsImpresion!tCodigoPedido + RsImpresion!tItem Then
                            Item = RsImpresion!tCodigoPedido + RsImpresion!tItem
                            xTotalS = xTotalS + (RsImpresion!nCantidad * RsImpresion!nPrecioOficial)
                            'RsImpresion.MoveNext
                        End If
                        RsImpresion.MoveNext
                    Loop
                    
                    Do While tOt <> 0
                       j = j + 1
                       lin = Mid(txt & " ", 1, 27)
                       For i = 27 To 1 Step -1
                           If Mid(lin, i, 1) = " " Then
                              pos = i
                              Exit For
                           End If
                       Next i
                       If pri Then
                        If ImpDolarDelivery Then
                            sLinea = Mid(Mid(txt, 1, pos - 1) & String(27, " "), 1, 27) & " " & Right(String(12, " ") & Format(xTotalS / nTC, "#,###,##0.00"), 12)
                        Else
                            sLinea = Mid(Mid(txt, 1, pos - 1) & String(27, " "), 1, 27) & " " & Right(String(12, " ") & Format(xTotalS, "#,###,##0.00"), 12)
                        End If
                        pri = False
                       Else
                          sLinea = Mid(txt, 1, pos - 1)
                       End If
                       txt = Mid(txt, pos + 1, tOt)
                       tOt = Len(txt)
                       Printer.Print sLinea
                    Loop
                    Printer.Print String(40, "-")
                    RsImpresion.MoveLast
                    
                    If ImpDolarDelivery Then
                        Printer.Print Right(String(27, " ") & " Total " & sMonE & " : ", 27) & Right(String(13, " ") & Format(xTotalS / nTC, "##,###,##0.00"), 13)
                    Else
                        Printer.Print Right(String(27, " ") & " Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xTotalS, "##,###,##0.00"), 13)
                    End If
                    
                    Printer.Print String(40, " ")
                    
                    If ImpDolarDelivery Then
                        If RsImpresion!nRecargo > 0 Then
                           Printer.Print
                           Printer.Print Right(String(27, " ") & "Recargo " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nRecargo / nTC, "##,###,##0.00"), 13)
                        End If
                        
                        If RsImpresion!nDescuento > 0 Then
                           Printer.Print
                           Printer.Print Right(String(27, " ") & "Descuento " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nDescuento / nTC, "##,###,##0.00"), 13)
                        End If
                    Else
                        If RsImpresion!nRecargo > 0 Then
                           Printer.Print
                           Printer.Print Right(String(27, " ") & "Recargo " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nRecargo, "##,###,##0.00"), 13)
                        End If
                        
                        If RsImpresion!nDescuento > 0 Then
                           Printer.Print
                           Printer.Print Right(String(27, " ") & "Descuento " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nDescuento, "##,###,##0.00"), 13)
                        End If

                    End If

                    nSumaNeto = RsImpresion!nNeto
                    
                    If IsNull(RsImpresion!lImpuesto1) Or Not RsImpresion!lImpuesto1 Then
                       nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto1
                    End If
                    
                    If IsNull(RsImpresion!lImpuesto2) Or Not RsImpresion!lImpuesto2 Then
                       nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto2
                    End If
                    
                    If IsNull(RsImpresion!lImpuesto3) Or Not RsImpresion!lImpuesto3 Then
                       nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto3
                    End If
                     'CESAR Por Consumo Si - FACTURAS
                     If ImpDolarDelivery Then
                        If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
                           Printer.Print Right(String(27, " ") & "Sub Total " & sMonE & " : ", 27) & Right(String(13, " ") & Format(nSumaNeto / nTC, "##,###,##0.00"), 13)
                        End If
                        
                        If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                           Printer.Print Right(String(27, " ") & sImpuesto1 & " " & Format(nPorcentaje1, "##0.00") & "% " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto1 / nTC, "##,###,##0.00"), 13)
                        End If
                           
                        If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                           Printer.Print Right(String(27, " ") & sImpuesto2 & " " & Format(nPorcentaje2, "##0.00") & "% " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto2 / nTC, "##,###,##0.00"), 13)
                        End If
                        
                        If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                           Printer.Print Right(String(27, " ") & sImpuesto3 & " " & Format(nPorcentaje3, "##0.00") & "% " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto3 / nTC, "##,###,##0.00"), 13)
                        End If
                                            
                        Printer.Print Right(String(27, " ") & "Total " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 13)
                    Else
                        If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
                           Printer.Print Right(String(27, " ") & "Sub Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(nSumaNeto, "##,###,##0.00"), 13)
                        End If
                        
                        If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                           Printer.Print Right(String(27, " ") & sImpuesto1 & " " & Format(nPorcentaje1, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,##0.00"), 13)
                        End If
                           
                        If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                           Printer.Print Right(String(27, " ") & sImpuesto2 & " " & Format(nPorcentaje2, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto2, "##,###,##0.00"), 13)
                        End If
                        
                        If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                           Printer.Print Right(String(27, " ") & sImpuesto3 & " " & Format(nPorcentaje3, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto3, "##,###,##0.00"), 13)
                        End If
                                            
                        Printer.Print Right(String(27, " ") & "Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 13)

                    End If
                      '====================== nov 2010
                    If lDocumEquivaPrecuenta And ImpDolarDelivery = False Then
                         Printer.Print " "
                        Printer.Print Right(String(27, " ") & "Total " & sMonE & " :", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 13)
                    End If
                    '====================== nov 2010
                    Printer.Print
                    If Calcular(" SELECT case when  lImpresionRetencion=1 then 1 else 0 end  as codigo FROM vTipodocumento WHERE Codigo=(SELECT TTIPODOCUMENTO FROM MDOCUMENTO WHERE tDocumento='" & RsImpresion!tDocumento & "')", Cn) = 1 Then
                        'ImprimeXCentro tTextoAgenteRetencion, 70
                        ImprimeXLinea tTextoAgenteRetencion, 40, 5
                    End If

                    
                    Printer.Print
                    If ImpDolarDelivery Then
                        txt = "Son: " & NumeroCadena(str(RsImpresion!nVenta / nTC)) & " " & sMonedaE
                    Else
                        txt = "Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
                    End If
                    ImprimeXLinea txt, 40, 5
                    Printer.Print String(40, "-")
                     If Calcular("select isnull(tcodigocliente,'') codigo from mdocumento where tdocumento='" & RsImpresion!tDocumento & "'", Cn) <> "" Then
                            ImprimeXLinea "Empresa: " & RsImpresion!Cliente, 40, 9
                            xTipoIdentidad = ""
                            xTipoIdentidad = Calcular("select upper(tResumido) as Codigo from vTipoIdentidad inner join TCLIENTE on vTipoIdentidad.Codigo=tcliente.tTipoIdentidad where tcliente.tCodigoCliente= (select isnull(tCodigoCliente,'') as codigo From MDOCUMENTO where tDocumento='" & RsImpresion!tDocumento & "')", Cn)
                               If xTipoIdentidad = "0" Then
                                    xTipoIdentidad = "Iden."
                               End If
                            Printer.Print xTipoIdentidad & "    : " & RsImpresion!Ruc
                            'Printer.Print "Direcc.: " & Mid(RsImpresion!direccion, 1, 30)
                            ImprimeXLinea "Direcc.: " & RsImpresion!direccion, 40, 9
                            Printer.Print String(40, "-")
                     End If
                    ImprimeXCentro sPie, 40

                    If lPagoAntesImpresion Then
                        Dim RsPagoDocumento As ADODB.Recordset
                        Dim lcuentaCobrar As Boolean
                        lcuentaCobrar = True
                        'Set RsPagoDocumento = Lib.OpenRecordset("select Distinct v.Descripcion + ' ' + M.tResumido as pago , Sum(D.nMonto) as monto from DPAGODOCUMENTO D inner join vTipoPago v on d.tTipoPago = v.Codigo inner join vMoneda M on M.Codigo = D.tMoneda Where D.tDocumento = '" & RsImpresion!tDocumento & "' group by v.Descripcion,  M.tResumido", Cn)
                        Set RsPagoDocumento = Lib.OpenRecordset("exec usp_Inforest_Impresion '" & RsImpresion!tDocumento & "', 9 ", Cn)
                        Printer.Print " "

                        If pais = "000" Then 'PERU
                            Printer.Print String(40, "-")
                            Printer.Print "Forma de Pago:"
                            If RsPagoDocumento.RecordCount > 0 Then
                                For i = 0 To RsPagoDocumento.RecordCount - 1
                                    lcuentaCobrar = False
                                        Printer.Print RsPagoDocumento!pago & Format(RsPagoDocumento!Monto, "##,###,##0.00")
                                    RsPagoDocumento.MoveNext
                                Next i
                                Printer.Print "Vuelto       :" & sMonN & Format(RsImpresion!Vuelto, "##,###,##0.00")
                            End If
                            If lcuentaCobrar Then
                                Printer.Print "Forma de Pago:Enviado a Cuenta por Cobrar"
                            End If
                            Printer.Print String(40, "-")
                            
                        Else 'ECUADOR
                            For i = 0 To RsPagoDocumento.RecordCount - 1
                                lcuentaCobrar = False
                                Printer.Print "Forma de Pago:" & RsPagoDocumento!pago & Format(RsPagoDocumento!Monto, "##,###,##0.00")
                                RsPagoDocumento.MoveNext
                            Next i
                            If lcuentaCobrar Then
                                Printer.Print "Forma de Pago:Enviado a Cuenta por Cobrar"
                            End If
                        End If

                        Printer.Print " "
                    End If
                    
'                    'On Error Resume Next
'                    Set imgDocumento = CreateObject("Scripting.FileSystemObject")
'                    If imgDocumento.FileExists(App.Path & "\bmps\ImgDocumento.jpg") Then
'                        Printer.Print
'                        Printer.PaintPicture LoadPicture(App.Path & "\bmps\ImgDocumento.jpg"), 400, Printer.CurrentY, 2800, 1000
'
'                    End If
                     If lLogCajaRapida = True Then
                     'Log
                     Cn.Execute "UPDATE TLOG_IMPRESION SET TPOSICION6='PASO 2 ' + '" & RsImpresion!tDocumento & "' WHERE TDOCUMENTO='" & sDocumento & "'"
                     End If
                    If lImprimeImagPieDocumento Then
                                    If pie <> 0 Then
                                        Printer.PaintPicture pie, 500, Printer.CurrentY, 2860, 1600
                                    End If
                    End If
                                        
                    Printer.EndDoc
              
    End Select
End Sub



Public Sub ImprimeFacturaConsumoElectronico(ByVal RsImpresion As Recordset, sConsumo As String, Optional CodigoHash As Image, Optional tTipoDoc As String, Optional Cabecera As Image, Optional pie As Image, Optional ByVal cadenaCodigoHash As String, Optional ByVal ImpDolarDelivery As Boolean)
    On Error Resume Next
    Dim Item As String
    Dim sLinea As String
    Dim txt As String
    Dim nSumaNeto As Double
    
    Dim xImpresionFE As String
        Dim nDescuentoNeto As String
        
        
    'imprime tipo de cambio
    IsqlTC = "select lVerTCImp from TPARAMETRO"
    Set RsParametroTC = Lib.OpenRecordset(IsqlTC, Cn)
    '------------------------------------------
        
        
    lImprimeImagCabDocumento = Calcular("select lImprimeImageCab as codigo  from ttipodocumentoimpresora where ttipoemision='" & tTipoDoc & "' and  tcaja='" & sCaja & "'", Cn)
    lImprimeImagPieDocumento = Calcular("select lImprimeImagePie as codigo from ttipodocumentoimpresora where ttipoemision='" & tTipoDoc & "' and  tcaja='" & sCaja & "'", Cn)
'    ximprimeDetallado = Calcular("select lImprimeresumen as codigo from ttipodocumentoimpresora where ttipoemision='" & tTipoDoc & "' and  tcaja='" & sCaja & "'", Cn)
    ' no tiene xproducto verificar para que envie descripcion detallado
    Dim xUnidadNegocio As String
    xUnidadNegocio = Calcular("SELECT tDetallado As Codigo FROM TTABLA WHERE TTABLA = 'UNIDADNEGOCIO' AND TCODIGO = (SELECT tUnidadNegocio FROM TCAJA WHERE TCAJA='" & RsImpresion!tCaja & "')", Cn)
      
    Select Case pais
       Case "001" 'Bolivia
                    'OBTIENE DATOS A IMPRIMIR
                    Dim tAutorizacion As String '  del documento
                    Dim tcodigoControl As String ' del documento
                    Dim tGlosaDosificacion As String
                    Dim RsDatos As Recordset
                    Dim fLimite As Date ' de la caja
                    Dim tSfc As String ' de la caja

                    Dim tSucursal As String

                    Dim cadenaxx As String
                    tSfc = ""
                    fLimite = Now
                    tAutorizacion = Calcular("select tautorizacion as codigo from mdocumento where tdocumento ='" & RsImpresion!tDocumento & "'", Cn)
                    tcodigoControl = Calcular("select tcodigoControl as codigo from mdocumento where tdocumento ='" & RsImpresion!tDocumento & "'", Cn)
                    cadenaxx = "SELECT tsfc,ffin, isnull(tGlosaDosificacion,'') tglosadosificacion FROM TORIGENCODIGOCONTROL WHERE TCAJA='" & RsImpresion!tCaja & "' AND TAUTORIZACION='" & Trim(tAutorizacion) & "' AND ((FINICIO <= '" & Format(RsImpresion!fRegistro, "YYYYmmdd HH:mm") & "') AND (ffin>='" & Format(RsImpresion!fRegistro, "YYYYmmdd HH:mm") & "'))"
                    Set RsDatos = Lib.OpenRecordset(cadenaxx, Cn)
                    If Not (RsDatos.EOF Or RsDatos.BOF) Then
                           ' rsDatos.MoveFirst
                            tSfc = RsDatos!tSfc
                            fLimite = Format(RsDatos!fFin, "dd/MM/yyyy")
                            tGlosaDosificacion = RsDatos!tGlosaDosificacion

                    End If
                    'Cabecera
                    RsImpresion.MoveFirst
                
                    If lImprimeImagCabDocumento Then
                                    If Cabecera <> 0 Then
                                    Printer.PaintPicture Cabecera, 500, Printer.CurrentY, 2860, 1600
                                    For p = 1 To 10
                                    Printer.Print
                                    Next p
                                    End If
                    End If
                
                    ImprimeXCentro sRazonSocial, 40
                    ImprimeXCentro sRazonComercial, 40
                    'CGMiranda******************************************************
                    tSucursal = Calcular("select vs.tResumido as codigo from vsucursal vs inner join TCAJA tc on vs.Codigo = tc.tSucursal where tc.tCaja='" & sCaja & "'", Cn)
                    ImprimeXCentro "Sucursal Nº " & IIf(tSucursal = 0, "", tSucursal), 40
                    ImprimeXCentro sDireccion, 40
                    ImprimeXCentro "Telefono: " & sTelefono, 40
                    ImprimeXCentro "SFC: " & tSfc & "   La Paz Bolivia", 40
                    If estadoReimpresion = True Then
                        ImprimeXCentro "FACTURA-COPIA", 40
                        estadoReimpresion = False
                    Else
                        ImprimeXCentro "FACTURA", 40
                    End If
                    'Fin CGMiranda**********************************************************
                    Printer.Print
                    Printer.Print String(40, "-")
                    sLinea = String((40 - Len(Trim("NIT: " + sRUC))) / 2, " ") & "NIT: " + sRUC
                    Printer.Print sLinea
                    
                        ImprimeXCentro "Factura Nº " & Mid(RsImpresion!tDocumento, 7), 40 'cambio
                        ImprimeXCentro "Autorizacion Nº " & tAutorizacion, 40 ' cambio
                        Printer.Print String(40, "-")
                        lTamanio = Printer.FontSize
                        Printer.FontSize = lTamanio - 1
                        ImprimeXCentro "Hotelería, Restaurantes y Alquileres", 40 'cambio
                        Printer.FontSize = lTamanio

                            If lImpresionDiaContable Then
                                If lReimpresion = True Then
                                    Printer.Print "Fecha    : " & Format(Calcular("select fdiacontable as codigo from mdocumento where tdocumento ='" & RsImpresion!tDocumento & "'", Cn), "dd/MM/yyyy") & " " & Calcular("exec DiacontableHora '" & fImpresionDiaContable & "'", Cn)
                                    Else
                                    Printer.Print "Fecha    : " & fImpresionDiaContable & " " & Calcular("exec DiacontableHora '" & fImpresionDiaContable & "'", Cn)
                                End If
                                Else
                                 Printer.Print "Fecha    : " & RsImpresion!fRegistro
                            End If
                            
                    ImprimeXLinea "Señores  : " & RsImpresion!Cliente, 40, 9
                    Printer.Print "NIT/CI   : " & RsImpresion!Ruc
                    Printer.Print "Dirección: " & Mid(RsImpresion!direccion, 1, 30)
                    Printer.Print String(40, "-")
                    
                    Printer.Print
                    Printer.Print "Pedido   : " & sPedido
                    Printer.Print "Tipo     : " & RsImpresion!tipopedido
                    Printer.Print "Caja     : " & RsImpresion!tCaja & " - " & RsImpresion!tUsuario
                    Printer.Print "Mesero   : " & RsImpresion!Mozo
                    'Printer.Print "Nro.Serie: " & Calcular("select isnull(tSerieImpresora,'') codigo from MDOCUMENTO where tDocumento ='" & RsImpresion!tDocumento & "'", Cn)
                    Printer.Print "Descuento: " & Mid(Trim(RsImpresion!DESCUENTO), 1, 30)
                    Printer.Print
                    Printer.Print "MESA     : " & RsImpresion!Mesa
                    If lObservacionCabDoc Then
                        Printer.Print "Observac.: " & RsImpresion!tObservacion
                    End If
                    Printer.Print
                    Printer.Print String(40, "-")
                    Printer.Print "Cantid. Producto                SubTotal"
                    Printer.Print String(40, "-")
                                      
                    'Cuerpo
                    Printer.Print
                    txt = sConsumo
                    tOt = Len(Trim(txt))
                    pri = True
                    j = 0
                    Do While tOt <> 0
                       j = j + 1
                       lin = Mid(txt & " ", 1, 27)
                       For i = 27 To 1 Step -1
                           If Mid(lin, i, 1) = " " Then
                              pos = i
                              Exit For
                           End If
                       Next i
                       If pri Then
                          sLinea = Mid(Mid(txt, 1, pos - 1) & String(27, " "), 1, 27) & " " & Right(String(12, " ") & Format(RsImpresion!nVenta + RsImpresion!nDescuento, "#,###,##0.00"), 12)
                          pri = False
                       Else
                          sLinea = Mid(txt, 1, pos - 1)
                       End If
                       txt = Mid(txt, pos + 1, tOt)
                       tOt = Len(txt)
                       Printer.Print sLinea
                    Loop
                    Printer.Print String(40, "-")
                    
                    If RsImpresion!nRecargo > 0 Then
                       Printer.Print
                       Printer.Print Right(String(27, " ") & "Recargo " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nRecargo, "##,###,##0.00"), 13)
                    End If
                    
                    If RsImpresion!nDescuento > 0 Then
                       Printer.Print
                       Printer.Print Right(String(27, " ") & "Descuento " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nDescuento, "##,###,##0.00"), 13)
                    End If
                    

                    nSumaNeto = RsImpresion!nNeto
                    
                    If IsNull(RsImpresion!lImpuesto1) Or Not RsImpresion!lImpuesto1 Then
                       nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto1
                    End If
                    
                    If IsNull(RsImpresion!lImpuesto2) Or Not RsImpresion!lImpuesto2 Then
                       nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto2
                    End If
                    
                    If IsNull(RsImpresion!lImpuesto3) Or Not RsImpresion!lImpuesto3 Then
                       nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto3
                    End If
                    'CESAR
                    If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
                       Printer.Print Right(String(27, " ") & "Valor Venta " & sMonN & " : ", 27) & Right(String(13, " ") & Format(nSumaNeto, "##,###,##0.00"), 13)
                    End If
                    
                    If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                       Printer.Print Right(String(27, " ") & sImpuesto1 & " " & Format(nPorcentaje1, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,##0.00"), 13)
                    End If
                       
                    If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                       Printer.Print Right(String(27, " ") & sImpuesto2 & " " & Format(nPorcentaje2, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto2, "##,###,##0.00"), 13)
                    End If
                    
                    If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                       Printer.Print Right(String(27, " ") & sImpuesto3 & " " & Format(nPorcentaje3, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto3, "##,###,##0.00"), 13)
                    End If
                                        
                    Printer.Print Right(String(27, " ") & "Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 13)
                      '====================== nov 2010
                    If lDocumEquivaPrecuenta Then
                         Printer.Print " "
                        Printer.Print Right(String(27, " ") & "Total " & sMonE & " :", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 13)
                    End If
                    '====================== nov 2010
                    Printer.Print
                    txt = "Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
                    ImprimeXLinea txt, 40, 5
                    Printer.Print String(40, "-")
                    Printer.Print "Código de Control      : " & tcodigoControl
                    Printer.Print "Fecha Límite de Emisión: " & Format(fLimite, "dd/MM/yyyy")
                     Printer.Print String(40, "-")

                    'IMPRIMEQR
                    If Calcular("select ISNULL(lImprimeQR,0) as codigo from TTIPODOCUMENTO where tCodigoTipoDocumento='" & tTipoDoc & "'", Cn) = 1 Then
                        If pais = "001" Then
                         
                        Set rsQr = Lib.OpenRecordset("usp_Inforest_ObtieneCodigoQR_Bol " + RsImpresion!tDocumento, Cn)
                    
                           FastQRCode rsQr.Fields(0), App.Path & "\BaseTempQr.bmp"
                    
                            Set imgDocumento = CreateObject("Scripting.FileSystemObject")
                            If imgDocumento.FileExists(App.Path & "\BaseTempQr.bmp") Then
                                Printer.PaintPicture LoadPicture(App.Path & "\BaseTempQr.bmp"), 1400, Printer.CurrentY, 1323, 1323
                                 For p = 1 To 8
                                    Printer.Print
                                 Next p
                            End If
                       End If
                    End If
                    
                    Printer.Print '.'
                    lTamanio = Printer.FontSize
                    Printer.FontSize = lTamanio - 2
                    comilla = Chr(34)
                    ImprimeXLinea comilla & "ESTA FACTURA CONTRIBUYE AL DESARROLLO DEL PAIS. EL USO ILICITO DE ESTA SERA SANCIONADO DE ACUERDO A LEY" & comilla, 57, 2
                    Printer.Print '.'
                    If tGlosaDosificacion <> "" Then
                            ImprimeXLinea tGlosaDosificacion, 40, 2
                    End If
                    Printer.FontSize = lTamanio
                    Printer.Print String(40, "-")
                    ImprimeXCentro sPie, 40
                    Printer.Print
            
                    If lImprimeImagPieDocumento Then
                                    If pie <> 0 Then
                                        Printer.PaintPicture pie, 500, Printer.CurrentY, 2860, 1600
                                    End If
                    End If
                    
                    Printer.EndDoc
                    
         Case Else 'PERU ECUADOR

                    If lImprimeImagCabDocumento Then
                                    If Cabecera <> 0 Then
                                    Printer.PaintPicture Cabecera, 500, Printer.CurrentY, 2860, 1600
                                    For p = 1 To 10
                                    Printer.Print
                                    Next p
                                    End If
                    End If
                    
                    RsImpresion.MoveFirst
                
                    If estadoReimpresion = True Then
                        ImprimeXCentro "REIMPRESION", 40
                        estadoReimpresion = False
                    End If
                
                    ImprimeXCentro sRazonSocial, 40
                    ImprimeXCentro sRazonComercial, 40
                    sLinea = String((40 - Len(Trim("R.U.C.: " + sRUC))) / 2, " ") & "R.U.C.: " + sRUC
                    Printer.Print sLinea
                    ImprimeXCentro sDireccion, 40
                    If Trim(sDireccion2) <> "" Then
                        ImprimeXCentro sDireccion2, 40
                    End If
                    sLinea = String((40 - Len(Trim("Telefono: " + sTelefono))) / 2, " ") & "Telefono: " + sTelefono
                    Printer.Print sLinea
                    
                    Printer.Print " "
                    ImprimeXCentro "FACTURA ELECTRONICA", 40
                    Printer.Print " "
            
                    'Printer.Print Mid(RsImpresion!tDocumento, 1, 1) & "-" & Mid(RsImpresion!tDocumento, 2, 5) & "-" & Mid(RsImpresion!tDocumento, 7)
                    ImprimeXCentro Mid(RsImpresion!tDocumento, 1, 1) & Mid(RsImpresion!tDocumento, 4, 3) & "-" & Mid(RsImpresion!tDocumento, 8, 8), 40
                    Printer.Print " "
                    Printer.Print "Pedido        : " & RsImpresion!tCodigoPedido
                    Printer.Print "Fecha Emision : " & RsImpresion!fRegistro
                    Printer.Print "Tipo          : " & RsImpresion!tipopedido
                    Printer.Print "Local         : " & xUnidadNegocio
                    Printer.Print "Caja          : " & RsImpresion!tCaja & " - " & RsImpresion!tUsuario
                    Printer.Print "Mesero        : " & RsImpresion!Mozo
                    If ImpDolarDelivery Then
                        Printer.Print "Tipo Moneda   : " & sMonedaE
                    Else
                        Printer.Print "Tipo Moneda   : " & sMonedaN
                    End If
                    
                    'tipo de cambio
                    If RsParametroTC!lVerTCImp = True Then
                    Printer.Print "T/Cambio  : " & Format(nTC, "###,##0.00")
                    End If
                    '-----------------------------------------------------------
                    
                    
                    Printer.Print "Nro.Serie     : " & Calcular("select isnull(tSerieImpresora,'') codigo from MDOCUMENTO where tDocumento ='" & RsImpresion!tDocumento & "'", Cn)
                    Printer.Print "Mesa          : " & RsImpresion!Mesa
                    If lImprimeMotivoDescuentoFB And RsImpresion!MotivoDescuento <> "" Then
                        ImprimeXLinea "Descuento     : " & RsImpresion!MotivoDescuento, 40, 16
                    End If
                    If lObservacionCabDoc Then
                        ImprimeXLinea "Observacion   : " & RsImpresion!tObservacion, 40, 16
                    End If
                    Printer.Print " "
                    Printer.Print String(40, "-")
                    Printer.Print "Descripcion                         Total"
                    'Printer.Print "Cantid. Producto                SubTotal"
                    Printer.Print String(40, "-")
                                      
                    'Cuerpo
                    Printer.Print
                    txt = sConsumo
                    tOt = Len(Trim(txt))
                    pri = True
                    j = 0
                    Do While tOt <> 0
                       j = j + 1
                       lin = Mid(txt & " ", 1, 27)
                       For i = 27 To 1 Step -1
                           If Mid(lin, i, 1) = " " Then
                              pos = i
                              Exit For
                           End If
                       Next i
                       If pri Then
                        If ImpDolarDelivery Then
                            sLinea = Mid(Mid(txt, 1, pos - 1) & String(27, " "), 1, 27) & " " & Right(String(12, " ") & Format(RsImpresion!nVenta / nTC, "#,###,##0.00"), 12)
                        Else
                            sLinea = Mid(Mid(txt, 1, pos - 1) & String(27, " "), 1, 27) & " " & Right(String(12, " ") & Format(RsImpresion!nVenta, "#,###,##0.00"), 12)
                        End If
                          pri = False
                       Else
                          sLinea = Mid(txt, 1, pos - 1)
                       End If
                       txt = Mid(txt, pos + 1, tOt)
                       tOt = Len(txt)
                       Printer.Print sLinea
                    Loop
                    Printer.Print String(40, "-")
                    
                    Printer.Print " "
                    
                    Dim xGravada As Double
                    Dim xInafecta As Double
                    
                    xGravada = Calcular("SELECT SUM(D.nPrecioNeto*nCantidad) As Codigo FROM dDocumento D WHERE D.tDocumento = '" & RsImpresion!tDocumento & "' AND ((D.nPrecioImpuesto1>0 AND D.nPrecioImpuesto2=0) OR (D.nPrecioImpuesto1>0 AND D.nPrecioImpuesto2>0))", Cn)
                    xInafecta = Calcular("SELECT ISNULL(SUM(D.nPrecioNeto*nCantidad),0) As Codigo FROM dDocumento D WHERE ((D.nPrecioImpuesto1<=0 AND D.nPrecioImpuesto2>0)OR(D.nPrecioImpuesto1<=0 AND D.nPrecioImpuesto2<=0)) AND D.tDocumento = '" & RsImpresion!tDocumento & "'", Cn)
                    
                    
                    'FE SPRING
                    If lFESpring Then
                        If ImpDolarDelivery Then
                            If RsImpresion!nRecargo > 0 Then
                               Printer.Print
                               Printer.Print Right(String(27, " ") & "Recargo " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nRecargo / nTC, "##,###,##0.00"), 13)
                            End If
                            
                            If RsImpresion!nDescuento > 0 Then
                               Printer.Print
                               nDescuentoNeto = Calcular("select IsNull(nDescuentoNeto,0) as Codigo from mDocumento where tdocumento = '" & RsImpresion!tDocumento & "'", Cn)
                               Printer.Print Right(String(27, " ") & "Descuento " & sMonE & " : ", 27) & Right(String(13, " ") & Format(nDescuentoNeto / nTC, "##,###,##0.00"), 13)
                            End If
                            If Not (IsNull(RsImpresion!lOpGravInaf) Or RsImpresion!lOpGravInaf = 0) Then
                                If lPagoAntesImpresion And lPagocortesiaAI Then
                                    Printer.Print Right(String(27, " ") & "Op. Gratuita " & sMonE & " : ", 27) & Right(String(13, " ") & Format(0 / nTC, "##,###,##0.00"), 13)
                                Else
                                    Printer.Print Right(String(27, " ") & "Op. Gravadas " & sMonE & " : ", 27) & Right(String(13, " ") & Format(xGravada / nTC, "##,###,##0.00"), 13)
                                    Printer.Print Right(String(27, " ") & "Op. Inafecta " & sMonE & " : ", 27) & Right(String(13, " ") & Format(xInafecta / nTC, "##,###,##0.00"), 13)
                                End If
                            End If
                        Else
                            If RsImpresion!nRecargo > 0 Then
                               Printer.Print
                               Printer.Print Right(String(27, " ") & "Recargo " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nRecargo, "##,###,##0.00"), 13)
                            End If
                            
                            If RsImpresion!nDescuento > 0 Then
                               Printer.Print
                               nDescuentoNeto = Calcular("select IsNull(nDescuentoNeto,0) as Codigo from mDocumento where tdocumento = '" & RsImpresion!tDocumento & "'", Cn)
                               Printer.Print Right(String(27, " ") & "Descuento " & sMonN & " : ", 27) & Right(String(13, " ") & Format(nDescuentoNeto, "##,###,##0.00"), 13)
                            End If
                            If Not (IsNull(RsImpresion!lOpGravInaf) Or RsImpresion!lOpGravInaf = 0) Then
                                If lPagoAntesImpresion And lPagocortesiaAI Then
                                    Printer.Print Right(String(27, " ") & "Op. Gratuita " & sMonN & " : ", 27) & Right(String(13, " ") & Format(0, "##,###,##0.00"), 13)
                                Else
                                    Printer.Print Right(String(27, " ") & "Op. Gravadas " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xGravada, "##,###,##0.00"), 13)
                                    Printer.Print Right(String(27, " ") & "Op. Inafecta " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xInafecta, "##,###,##0.00"), 13)
                                End If
                            End If
                        End If
                    Else
                        If ImpDolarDelivery Then
                            If Not (IsNull(RsImpresion!lOpGravInaf) Or RsImpresion!lOpGravInaf = 0) Then
                                Printer.Print Right(String(27, " ") & "Op. Gravadas " & sMonE & " : ", 27) & Right(String(13, " ") & Format(xGravada / nTC, "##,###,##0.00"), 13)
                                Printer.Print Right(String(27, " ") & "Op. Inafecta " & sMonE & " : ", 27) & Right(String(13, " ") & Format(xInafecta / nTC, "##,###,##0.00"), 13)
                            End If
                            
                            If RsImpresion!nRecargo > 0 Then
                               Printer.Print
                               Printer.Print Right(String(27, " ") & "Recargo " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nRecargo / nTC, "##,###,##0.00"), 13)
                            End If
                            
                            If RsImpresion!nDescuento > 0 Then
                               Printer.Print
                               Printer.Print Right(String(27, " ") & "Descuento " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nDescuento / nTC, "##,###,##0.00"), 13)
                            End If
                        Else
                            If Not (IsNull(RsImpresion!lOpGravInaf) Or RsImpresion!lOpGravInaf = 0) Then
                                Printer.Print Right(String(27, " ") & "Op. Gravadas " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xGravada, "##,###,##0.00"), 13)
                                Printer.Print Right(String(27, " ") & "Op. Inafecta " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xInafecta, "##,###,##0.00"), 13)
                            End If
                            
                            If RsImpresion!nRecargo > 0 Then
                               Printer.Print
                               Printer.Print Right(String(27, " ") & "Recargo " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nRecargo, "##,###,##0.00"), 13)
                            End If
                            
                            If RsImpresion!nDescuento > 0 Then
                               Printer.Print
                               Printer.Print Right(String(27, " ") & "Descuento " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nDescuento, "##,###,##0.00"), 13)
                            End If
    
                        End If
                    End If

                    nSumaNeto = RsImpresion!nNeto
                    
                    If IsNull(RsImpresion!lImpuesto1) Or Not RsImpresion!lImpuesto1 Then
                       nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto1
                    End If
                    
                    If IsNull(RsImpresion!lImpuesto2) Or Not RsImpresion!lImpuesto2 Then
                       nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto2
                    End If
                    
                    If IsNull(RsImpresion!lImpuesto3) Or Not RsImpresion!lImpuesto3 Then
                       nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto3
                    End If
                    
                     'CESAR Por Consumo Si - FACTURAS
'                    If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
'                       Printer.Print Right(String(27, " ") & "Sub Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(nSumaNeto, "##,###,##0.00"), 13)
'                    End If
                    If ImpDolarDelivery Then
                        If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                           Printer.Print Right(String(27, " ") & sImpuesto1 & " " & Format(nPorcentaje1, "##0.00") & "% " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto1 / nTC, "##,###,##0.00"), 13)
                        End If
                           
                        If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                           Printer.Print Right(String(27, " ") & sImpuesto2 & " " & Format(nPorcentaje2, "##0.00") & "% " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto2 / nTC, "##,###,##0.00"), 13)
                        End If
                        
                        If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                           Printer.Print Right(String(27, " ") & sImpuesto3 & " " & Format(nPorcentaje3, "##0.00") & "% " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto3 / nTC, "##,###,##0.00"), 13)
                        End If
                                            
                        Printer.Print Right(String(27, " ") & "Importe Total " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 13)
                    Else
                        If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                           Printer.Print Right(String(27, " ") & sImpuesto1 & " " & Format(nPorcentaje1, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,##0.00"), 13)
                        End If
                           
                        If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                           Printer.Print Right(String(27, " ") & sImpuesto2 & " " & Format(nPorcentaje2, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto2, "##,###,##0.00"), 13)
                        End If
                        
                        If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                           Printer.Print Right(String(27, " ") & sImpuesto3 & " " & Format(nPorcentaje3, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto3, "##,###,##0.00"), 13)
                        End If
                                            
                        Printer.Print Right(String(27, " ") & "Importe Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 13)

                          '====================== nov 2010
                        If lDocumEquivaPrecuenta Then
                             Printer.Print " "
                            Printer.Print Right(String(27, " ") & "Total " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 13)
                        End If
                        '====================== nov 2010
                    End If
                    Printer.Print " "
                    If Calcular(" SELECT case when  lImpresionRetencion=1 then 1 else 0 end  as codigo FROM vTipodocumento WHERE Codigo=(SELECT TTIPODOCUMENTO FROM MDOCUMENTO WHERE tDocumento='" & RsImpresion!tDocumento & "')", Cn) = 1 Then
                        ImprimeXLinea tTextoAgenteRetencion, 40, 5
                    End If

                    
                    Printer.Print " "
                    If ImpDolarDelivery Then
                        txt = "Son: " & NumeroCadena(str(RsImpresion!nVenta / nTC)) & " " & sMonedaE
                    Else
                        txt = "Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
                    End If
                    ImprimeXLinea txt, 40, 5
                    Printer.Print String(40, "-")
                    ImprimeXLinea "Empresa: " & RsImpresion!Cliente, 40, 9
                    xTipoIdentidad = ""
                    xTipoIdentidad = Calcular("select upper(tResumido) as Codigo from vTipoIdentidad inner join TCLIENTE on vTipoIdentidad.Codigo=tcliente.tTipoIdentidad where tcliente.tCodigoCliente= (select isnull(tCodigoCliente,'') as codigo From MDOCUMENTO where tDocumento='" & RsImpresion!tDocumento & "')", Cn)
                       If xTipoIdentidad = "0" Then
                        xTipoIdentidad = "Iden."
                    End If
                    Printer.Print xTipoIdentidad & "    : " & RsImpresion!Ruc
                    
                    ImprimeXLinea "Direcc.: " & RsImpresion!direccion, 40, 9
                    Printer.Print String(40, "-")
                    ImprimeXCentro sPie, 40
                    
                    
                     Printer.Print " "
                     
                     'FACTURACION_E_PERU
                        If lQRFE Then
                            Printer.PaintPicture CodigoHash, 1400, Printer.CurrentY, 1323, 1323
                            Dim d As Integer
                            For d = 1 To 8
                                Printer.Print
                             Next d
                        Else
    
                             If lImpresionCodigoBarras Then
                                Printer.PaintPicture CodigoHash, 250, Printer.CurrentY, 3400, 1200
                                Printer.CurrentY = Printer.CurrentY + 1200
                             Else
                                ImprimeXCentro cadenaCodigoHash, 40
                             End If
                         End If
                         
                     Printer.Print " "
                     xImpresionFE = Calcular(" SELECT tImpresionFE as codigo FROM vTipodocumento WHERE Codigo=(SELECT TTIPODOCUMENTO FROM MDOCUMENTO WHERE tDocumento='" & RsImpresion!tDocumento & "')", Cn)
                     ImprimeXCentro xImpresionFE, 40
                     Printer.Print " "
                     '------------------
                     
                     If lImprimeImagPieDocumento Then
                            Printer.Print " "
                            If pie <> 0 Then
                                Printer.PaintPicture pie, 500, Printer.CurrentY, 2860, 1600
                            End If
                     End If
                                        
                     Printer.EndDoc
              
    End Select
End Sub

Public Function Llena(nNumero As Double, nSpace As Integer)
   Llena = Mid(String(nSpace, "0"), 1, nSpace - Len(Trim(str(nNumero)))) & Trim(str(nNumero))
End Function

Public Function Periodo(Fecha As Date)
    Dim RsPeriodo As Recordset
    Dim sPeriodo As String
    sPeriodo = Format(Fecha, "YYYYMM")
    Set RsPeriodo = Lib.OpenRecordset("select * from MCIERRE where tPeriodo ='" & sPeriodo & "'", Cn)
    If RsPeriodo.RecordCount = 0 Then
       Periodo = False
    Else
       If RsPeriodo!lCierre Then
          Periodo = True
          MsgBox "Error : Periodo cerrado movimiento no permitido", vbExclamation, sMensaje
       Else
          Periodo = False
       End If
    End If
    Set RsPeriodo = Nothing
End Function

Public Sub ImprimeDocumento(Documento As String, RsTD As Recordset, TipoEmision As String, sConsumo As String)
   Dim RsImpresion As Recordset

   If TipoEmision = "Consolidado" Then
      Isql = "SELECT dbo.DDOCUMENTO.tCodigoProducto, dbo.DDOCUMENTO.nPrecioVenta, MAX(dbo.MDOCUMENTO.tDocumento) AS tDocumento, MAX(dbo.MPEDIDO.tCodigoPedido) AS tCodigoPedido, MAX(dbo.MDOCUMENTO.fRegistro) AS fRegistro, MAX(dbo.MDOCUMENTO.fRegistro) AS fFecha, " & _
             "MAX(dbo.MDOCUMENTO.nNeto) AS nNeto, MAX(dbo.MDOCUMENTO.nRecargo) AS nRecargo, MAX(dbo.MDOCUMENTO.nDescuento) AS nDescuento, MAX(dbo.MDOCUMENTO.nPrecioImpuesto1) AS nPrecioImpuesto1, MAX(dbo.MDOCUMENTO.nPrecioImpuesto2) AS nPrecioImpuesto2, " & _
             "MAX(dbo.MDOCUMENTO.nPrecioImpuesto3) AS nPrecioImpuesto3, MAX(dbo.MDOCUMENTO.nVenta) AS nVenta, MAX(dbo.vCortesia.Descripcion) AS Cortesia, MAX(dbo.TCLIENTE.tEmpresa) AS Cliente, MAX(dbo.TCLIENTE.tIdentidad) AS RUC, MAX(dbo.TCLIENTE.tDireccion) AS Direccion, " & _
             "MAX(dbo.DDOCUMENTO.tItem) AS tItem, MAX(dbo.vMozo.Descripcion) AS Mozo, MAX(dbo.vSalon.Descripcion + N' - ' + dbo.TMESA.tDetallado) AS Mesa, MAX(dbo.MPEDIDO.tObservacion) AS tObservacion, MAX(dbo.MPEDIDO.tMesa) AS tMesa, MAX(dbo.TPRODUCTO.tResumido) AS Producto, " & _
             "MAX(dbo.MDOCUMENTO.nPrecioOficial) AS nPrecioOficial, SUM(dbo.DDOCUMENTO.nCantidad) AS nCantidad, SUM(dbo.DDOCUMENTO.nVenta) AS Venta " & _
             "FROM dbo.vMozo RIGHT OUTER JOIN dbo.TMESA LEFT OUTER JOIN dbo.vSalon ON dbo.TMESA.tSalon = dbo.vSalon.Codigo RIGHT OUTER JOIN dbo.MPEDIDO ON dbo.TMESA.tCodigoMesa = dbo.MPEDIDO.tMesa ON dbo.vMozo.Codigo = dbo.MPEDIDO.tMozo RIGHT OUTER JOIN dbo.MDOCUMENTO LEFT OUTER JOIN " & _
             "dbo.TCLIENTE ON dbo.MDOCUMENTO.tCodigoCliente = dbo.TCLIENTE.tCodigoCliente LEFT OUTER JOIN dbo.TPRODUCTO RIGHT OUTER JOIN dbo.DDOCUMENTO ON dbo.TPRODUCTO.tCodigoProducto = dbo.DDOCUMENTO.tCodigoProducto ON dbo.MDOCUMENTO.tDocumento = dbo.DDOCUMENTO.tDocumento LEFT OUTER JOIN " & _
             "dbo.vCortesia ON dbo.MDOCUMENTO.tCortesia = dbo.vCortesia.Codigo ON dbo.MPEDIDO.tCodigoPedido = dbo.DDOCUMENTO.tCodigoPedido " & _
             "WHERE dbo.MDOCUMENTO.tDocumento ='" & Documento & "'" & _
             "GROUP BY dbo.DDOCUMENTO.nPrecioVenta, dbo.DDOCUMENTO.tCodigoProducto "
   Else
      Isql = "select * from vDocumentoImpresora where tDocumento ='" & Documento & "'"
   End If

   Set RsImpresion = Lib.OpenRecordset(Isql, Cn)

   RsTD.MoveFirst
   RsTD.Find ("Prefijo='" & Mid(Documento, 1, 1) & "'")
   If RsTD.EOF Then
      MsgBox "Error: Configure los Documentos", vbCritical, sMensaje
      Exit Sub
   End If

   If RsImpresion.RecordCount = 0 Then
      LimpiaRs
      MsgBox "No existen Datos a Imprimir", vbExclamation, sMensaje
   Else
      'Configura la Impresora
      If Not Imprimir(RsTD!timpresora) Then
         Exit Sub
      End If

      Printer.FontName = sFont
      Printer.FontBold = False

      If RsTD!prefijo = "0" Then  'Cortesias
         ImprimeCortesia RsImpresion

      ElseIf RsTD!Cliente Then      'con Cliente - Factura
         If RsTD!tFormulario = "01" Then 'Ticket
            If TipoEmision = "Consumo" Then
               ImprimeFacturaConsumoT RsImpresion, sConsumo
            Else
               ImprimeFacturaT RsImpresion
            End If
         Else                             'Variable
            If TipoEmision = "Consumo" Then
               ImprimeFacturaConsumoN RsImpresion, sConsumo, sEmpresa
            Else
               ImprimeFacturaN RsImpresion, sEmpresa
            End If
         End If
      Else                          'sin Cliente - Boleta / Ticket
         If RsTD!tFormulario = "01" Then 'Ticket
            If TipoEmision = "Consumo" Then
               ImprimeBoletaConsumoT RsImpresion, sConsumo
            Else
               ImprimeBoletaT RsImpresion
            End If
         Else                             'Variable
            If TipoEmision = "Consumo" Then
               ImprimeBoletaConsumoN RsImpresion, sConsumo, sEmpresa
            Else
               ImprimeBoletaN RsImpresion, sEmpresa
            End If
         End If
      End If
   End If
End Sub

Public Sub ImprimePreCuenta(RsImpresion As Recordset, Impresora As String, Optional Cabecera As Image, Optional pie As Image)
    On Error Resume Next
    Dim Item As String
    Dim xObservacion As String
    Dim sLinea As String
    Dim zSubTotal As Double
    Dim zImpuesto1 As Double
    Dim zImpuesto2 As Double
    Dim zImpuesto3 As Double
    Dim zTotal As Double
    Dim zDescuento As Double
    Dim zRecargo As Double
    Dim txt As String
    Dim xRsPropiedad As ADODB.Recordset
    Dim xRsPropiedadCombo As ADODB.Recordset

    Dim zGTotal As Double
    
    '---CESAR IMP
    Dim imp1 As Double
    Dim imp2 As Double
    Dim impxT As Double
    Dim impx1 As Double
    Dim impx2 As Double
    Dim impG As Double
    Dim xDescuento As Double
    Dim xRecargo As Double
    Dim xSubTotal As Double
    Dim xDiferencia As Double
    Dim xAumento As Double
    Dim Y As Integer
    Y = 0
    Y = Calcular("select case when lCanalCentralPedidos=1 then 1 else 0 end codigo from  vTipoPedido where Codigo='" & RsImpresion!tTipoPedido & "'", Cn)

    Dim xClienteImp As String
    Dim xTelefonoImp As String
    Dim xDireccionImp As String
    
    xClienteImp = Calcular("select isnull(tclientedelivery,'') codigo from mpedido where tcodigopedido='" & RsImpresion!codigo & "'", Cn)
    xTelefonoImp = Calcular("select isnull(ttelefono,'') codigo from tdelivery where tcodigodelivery='" & xClienteImp & "'", Cn)
    xDireccionImp = Calcular("select isnull(tDireccion,'') codigo from tdelivery where tcodigodelivery='" & xClienteImp & "'", Cn)
    
    
    imp1 = Calcular("select ISNULL(Impuesto1,0) as Codigo from TPARAMETRO", Cn)
    imp2 = Calcular("select ISNULL(Impuesto2,0) as Codigo from TPARAMETRO", Cn)
    impxT = 1 + (imp1 / 100) + (imp2 / 100)
    impx1 = 1 + (imp1 / 100)
    impx2 = 1 + (imp2 / 100)
    lPrecioNetoPrecuenta = Calcular("select ISNULL(lPrecioNetoPrecuenta,0) as Codigo from TCAJA where tCaja = '" & sCaja & "' ", Cn)
    '------------------
    
    ' marzo 2011
    Dim xSql As String
    If lAlmacen Then
        Dim RsOp As Recordset
        Set RsOp = Lib.OpenRecordset("select Codigo, Descripcion from vOperador where lStockMenos=1", Cn)
        If RsOp.RecordCount > 0 Then
        xSql = "select tCodigoPropiedad as Codigo, TPROPIEDAD.tDetallado as Descripcion, tProducto, TOPERADOR.tOperador as tOperador, TOPERADOR.tDetallado as Operador, nPrecio, tEnlace, " & _
               "nInsumo, nGasto, nManoObra " & _
               "FROM dbo.TPROPIEDAD LEFT OUTER JOIN dbo.TOPERADOR ON dbo.TPROPIEDAD.tOperador = dbo.TOPERADOR.tOperador " & _
               "Where TPROPIEDAD.lActivo = 1 And IsNull(TOPERADOR.lStockMenos, 0) <> 1 union " & _
               "select '9999' as Codigo, tDetallado as Descripcion, tCodigoPlato as tProducto, '" & RsOp!codigo & "' as tOperador, '" & RsOp!Descripcion & "' as Operador, 0, " & sAlmacenMDB & ".dbo.DRECETAVENTA.tCodigoProducto as tEnlace, nCantidad * nPrecio as nInsumo, 0, 0 " & _
               "FROM " & sAlmacenMDB & ".dbo.DRECETAVENTA INNER JOIN " & sAlmacenMDB & ".dbo.MRECETAVENTA ON " & sAlmacenMDB & ".dbo.DRECETAVENTA.tLocal = " & sAlmacenMDB & ".dbo.MRECETAVENTA.tLocal AND " & sAlmacenMDB & ".dbo.DRECETAVENTA.tRecetaVenta = " & sAlmacenMDB & ".dbo.MRECETAVENTA.tRecetaVenta INNER JOIN " & sAlmacenMDB & ".dbo.TPRODUCTO ON " & sAlmacenMDB & ".dbo.DRECETAVENTA.tCodigoProducto = " & sAlmacenMDB & ".dbo.TPRODUCTO.tCodigoProducto " & _
               "Where lNoDescargo = 1 and " & sAlmacenMDB & ".dbo.DRECETAVENTA.tLocal='" & sLocal & "'"
        Else
        xSql = "select tCodigoPropiedad as Codigo, TPROPIEDAD.tDetallado as Descripcion, tProducto, TPROPIEDAD.tOperador, nPrecio, tEnlace, " & _
               "nInsumo, nGasto, nManoObra, tOperador.tDetallado AS Operador " & _
               "FROM dbo.TPROPIEDAD LEFT OUTER JOIN dbo.TOPERADOR ON dbo.TPROPIEDAD.tOperador = dbo.TOPERADOR.tOperador " & _
               "Where TPROPIEDAD.lActivo = 1 And IsNull(TOPERADOR.lStockMenos, 0) <> 1"
        End If
    Else
         xSql = "select tCodigoPropiedad as Codigo, TPROPIEDAD.tDetallado as Descripcion, tProducto, TPROPIEDAD.tOperador, nPrecio, tEnlace, " & _
                "nInsumo, nGasto, nManoObra, tOperador.tDetallado AS Operador " & _
                "FROM dbo.TPROPIEDAD LEFT OUTER JOIN dbo.TOPERADOR ON dbo.TPROPIEDAD.tOperador = dbo.TOPERADOR.tOperador " & _
                "Where TPROPIEDAD.lActivo = 1 And IsNull(TOPERADOR.lStockMenos, 0) <> 1"
    End If
   
    Isql = "SELECT dbo.TPRODUCTOPROPIEDAD.tCodigoPedido, dbo.TPRODUCTOPROPIEDAD.tItem, dbo.TPRODUCTOPROPIEDAD.tCodigoPropiedad, dbo.TPRODUCTOPROPIEDAD.tProducto, t1.Descripcion AS Descripcion, Operador, dbo.TPRODUCTOPROPIEDAD.nCantidad " & _
           " FROM    dbo.TOPERADOR INNER JOIN dbo.TPRODUCTOPROPIEDAD INNER JOIN (" & xSql & ")T1 ON dbo.TPRODUCTOPROPIEDAD.tCodigoPropiedad = T1.Codigo AND dbo.TPRODUCTOPROPIEDAD.tProducto = T1.tProducto AND dbo.TPRODUCTOPROPIEDAD.tEnlace = T1.tEnlace ON dbo.TOPERADOR.tOperador = T1.tOperador COLLATE Modern_Spanish_CI_AS LEFT OUTER JOIN dbo.TPROPIEDAD ON dbo.TOPERADOR.tOperador = dbo.TPROPIEDAD.tOperador AND dbo.TPRODUCTOPROPIEDAD.tCodigoPropiedad = dbo.TPROPIEDAD.tCodigoPropiedad AND dbo.TPRODUCTOPROPIEDAD.tProducto = dbo.TPROPIEDAD.tProducto " & _
           " where tCodigoPedido ='" & sPedido & "' and toperador.limprime=1 ORDER BY dbo.TOPERADOR.nBoton "
    Set xRsPropiedad = Lib.OpenRecordset(Isql, Cn)
    
    Isql = " SELECT dbo.TCOMBOPROPIEDAD.tCodigoPedido, dbo.TCOMBOPROPIEDAD.tItem, dbo.TCOMBOPROPIEDAD.tItemCombo, T1.Descripcion, T1.Operador, dbo.TCOMBOPROPIEDAD.nCantidad " & _
           " FROM     dbo.TCOMBOPROPIEDAD INNER JOIN  (" & xSql & ") T1 ON dbo.TCOMBOPROPIEDAD.tCodigoPropiedad = T1.Codigo AND dbo.TCOMBOPROPIEDAD.tProducto = T1.tProducto AND  dbo.TCOMBOPROPIEDAD.tEnlace = T1.tEnlace LEFT OUTER JOIN dbo.TPROPIEDAD ON dbo.TCOMBOPROPIEDAD.tCodigoPropiedad = dbo.TPROPIEDAD.tCodigoPropiedad AND dbo.TCOMBOPROPIEDAD.tProducto = dbo.TPROPIEDAD.tProducto RIGHT OUTER JOIN dbo.TOPERADOR ON dbo.TPROPIEDAD.tOperador = dbo.TOPERADOR.tOperador AND T1.tOperador COLLATE Modern_Spanish_CI_AS = dbo.TOPERADOR.tOperador  " & _
            " where tCodigoPedido ='" & sPedido & "' and toperador.limprime=1  order by toperador.nboton"
    Set xRsPropiedadCombo = Lib.OpenRecordset(Isql, Cn)
    

    'Configura la impresora la impresion Font
    If Not Imprimir(Impresora) Then
       Exit Sub
    End If
    Printer.FontName = sFont
    Printer.FontBold = False
    
    If lImprimeImagCabPrecuenta Then
        If Cabecera <> 0 Then
            Printer.PaintPicture Cabecera, 500, Printer.CurrentY, 2860, 1600
            For p = 1 To 10
            Printer.Print
            Next p
        End If
    End If
    
    'Cabecera
    ImprimeXCentro sRazonSocial, 40
    ImprimeXCentro sRazonComercial, 40
    
    Select Case pais
        Case "001" 'Bolivia
            sLinea = String((40 - Len(Trim("N.I.T.: " + sRUC))) / 2, " ") & "N.I.T.: " + sRUC
        Case Else 'Peru, Ecuador
            sLinea = String((40 - Len(Trim("R.U.C.: " + sRUC))) / 2, " ") & "R.U.C.: " + sRUC
    End Select
    
    Printer.Print sLinea
    ImprimeXCentro sDireccion, 40
    If Trim(sDireccion2) <> "" Then
        ImprimeXCentro sDireccion2, 40
    End If
    sLinea = String((40 - Len(Trim("Telefono: " + sTelefono))) / 2, " ") & "Telefono: " + sTelefono
    Printer.Print sLinea
    Printer.Print
    
    Printer.Print "Pedido    : " & sPedido
    'Printer.Print "Fecha     : " & FechaServidor()
                            If lImpresionDiaContable Then
                                If lReimpresion = True Then
                                    Printer.Print "Fecha    : " & Format(Calcular("select fdiacontable as codigo from mpedido where tcodigopedido ='" & sPedido & "'", Cn), "dd/MM/yyyy") & " " & Calcular("exec DiacontableHora '" & fImpresionDiaContable & "'", Cn)
                                    Else
                                    Printer.Print "Fecha    : " & fImpresionDiaContable & " " & Calcular("exec DiacontableHora '" & fImpresionDiaContable & "'", Cn)
                                End If
                            Else
                                 Printer.Print "Fecha    : " & FechaServidor() 'RsImpresion!fRegistro
                            End If
                            
    
    Printer.Print "Tipo      : " & RsImpresion!tipopedido
    Printer.Print "Caja      : " & sCaja & " - " & IIf(Mid(sUsuario, 1, 1) = "*", Mid(sUsuario, 2, 15), sUsuario)
    Printer.Print "Mesero    : " & RsImpresion!Mozo
    ImprimeXLinea "Cliente   : " & Trim(RsImpresion!Cliente), 40, 13
    
    If xTelefonoImp <> "" And xTelefono <> 0 Then
        ImprimeXLinea "Telefono  : " & Trim(xTelefonoImp), 40, 13
    End If
    If xDireccionImp <> "" And xDireccionImp <> 0 Then
        ImprimeXLinea "Direccion : " & Trim(xDireccionImp), 40, 13
    End If
    
    If Calcular("SELECT ISNULL(TENTREGARA,'') codigo FROM MPEDIDO WHERE TCODIGOPEDIDO='" & RsImpresion!codigo & "'", Cn) <> "" Then
        Printer.Print "Entregar A" & Calcular("SELECT ISNULL(TENTREGARA,'') codigo FROM MPEDIDO WHERE TCODIGOPEDIDO='" & RsImpresion!codigo & "'", Cn)
    End If
    
    If Y = 1 Then
    'telefono
    Dim tcliente As String
    Dim tTelefono As String
            tcliente = Calcular("select isnull(tclientedelivery,'') codigo from mpedido where tcodigopedido='" & RsImpresion!codigo & "'", Cn)
            If tcliente <> "" And tcliente <> "0" Then
                tTelefono = Calcular("select isnull(ttelefono,'') codigo from tdelivery where tcodigodelivery='" & tcliente & "'", Cn)
                If tTelefono <> "" And tTelefono <> "0" Then
                Printer.Print "Identif   : " & tTelefono
                End If
            End If
    End If
    
    Printer.Print "Descuento : " & Mid(Trim(RsImpresion!DESCUENTO), 1, 28)
    Printer.Print "T/Cambio  : " & Format(nTC, "###,##0.00")
    
    If Y = 1 Then
            If Calcular("select fprogramacion as codigo from mpedido where tcodigopedido='" & RsImpresion!codigo & "'", Cn) <> 0 Then
                    Printer.FontBold = True
                    Printer.Print
                    Printer.Print "F Entrega : " & Calcular("select fprogramacion as codigo from mpedido where tcodigopedido='" & RsImpresion!codigo & "'", Cn)
            End If
    End If
    Printer.Print
    Printer.FontBold = True
    txt = "MESA      : " & IIf(IsNull(RsImpresion!Mesa), "", Trim(RsImpresion!Mesa)) & " " & IIf(IsNull(RsImpresion!tObservacion), "", Trim(RsImpresion!tObservacion)) & IIf(RsImpresion!nAdulto > 0, " Pax " & RsImpresion!nAdulto, "")
    ImprimeXLinea txt, 40, 12
    Printer.FontBold = False
    
    Printer.Print
    Printer.Print String(40, "-")
    Printer.Print "Cantid. Producto                SubTotal"
    Printer.Print String(40, "-")
        
    RsImpresion.MoveFirst
    zSubTotal = 0
    zImpuesto1 = 0
    zImpuesto2 = 0
    zImpuesto3 = 0
    zDescuento = 0
    zRecargo = 0
    zTotal = 0
    
    xSubTotal = 0

    'Cuerpo
    Item = ""
    
    Do While Not RsImpresion.EOF
       If Item <> RsImpresion!tItem Then
            'Impresion de Propiedades
            If lPropiedadPrecuenta Then
               xRsPropiedad.Filter = "tItem='" & Item & "'"
               If Not xRsPropiedad.EOF Then
                  xRsPropiedad.MoveFirst
                  Do While Not xRsPropiedad.EOF
                     'ImprimeXLinea "        * " & xRsPropiedad!Operador & " " & xRsPropiedad!Descripcion, 40, 8
                     ImprimeXLinea "        * " & IIf(xRsPropiedad!nCantidad = 1, "", "(" & xRsPropiedad!nCantidad & ")") & xRsPropiedad!Operador & " " & xRsPropiedad!Descripcion, 31, 10
                     xRsPropiedad.MoveNext
                  Loop
               End If
                                        
               'Impresion de la Observacion
               If lObservacionPrecuenta And Len(Trim(xObservacion)) > 0 Then
                  ImprimeXLinea "        - " & Trim(xObservacion), 33, 10
               End If
            End If

            If RsImpresion!nImpuesto1 > 0 And RsImpresion!nImpuesto2 > 0 Then
                  impG = impxT
            ElseIf RsImpresion!nImpuesto1 > 0 And RsImpresion!nImpuesto2 = 0 Then
                  impG = impx1
            ElseIf RsImpresion!nImpuesto1 = 0 And RsImpresion!nImpuesto2 > 0 Then
                  impG = impx2
            Else
                  impG = 1
            End If
          

          If lPrecioNetoPrecuenta Then
             sLinea = Right(String(7, " ") & Format(RsImpresion!nCantidad, "###0.00"), 7) & " " & Mid(RsImpresion!Producto & String(19, " "), 1, 19) & " " & Right(String(12, " ") & Format((RsImpresion!nPrecioOficial * RsImpresion!nCantidad) / impG, "#,###,##0.00"), 12)
          Else
                If IsNull(RsImpresion!tOferta) Or RsImpresion!tOferta = "" Then
                   sLinea = Right(String(7, " ") & Format(RsImpresion!nCantidad, "###0.00"), 7) & " " & Mid(RsImpresion!Producto & String(19, " "), 1, 19) & " " & Right(String(12, " ") & Format(RsImpresion!nPrecioOficial * RsImpresion!nCantidad, "#,###,##0.00"), 12)
                Else
                   sLinea = Right(String(7, " ") & Format(RsImpresion!nCantidad, "###0.00"), 7) & " " & Mid(RsImpresion!Producto & String(19, " "), 1, 19)
                   Printer.Print sLinea
                   sLinea = String(8, " ") & Mid(RsImpresion!tOferta & String(19, " "), 1, 19) & " " & Right(String(12, " ") & Format(RsImpresion!nPrecioOficial * RsImpresion!nCantidad, "#,###,##0.00"), 12)
                End If
            
          End If
          
          
          Printer.Print sLinea
          '0035-2013 CESAR
          zGTotal = zGTotal + (RsImpresion!nPrecioOficial * RsImpresion!nCantidad)
          zTotal = zTotal + RsImpresion!nVenta
          zImpuesto1 = zImpuesto1 + RsImpresion!nImpuesto1
          zImpuesto2 = zImpuesto2 + RsImpresion!nImpuesto2
          zImpuesto3 = zImpuesto3 + RsImpresion!nImpuesto3
          '---CESAR IMP
          xDiferencia = ((RsImpresion!nPrecioOficial * RsImpresion!nCantidad) / impG) - (RsImpresion!nVenta - RsImpresion!nImpuesto1 - RsImpresion!nImpuesto2)
          xDescuento = xDescuento + xDiferencia
          xAumento = (RsImpresion!nVenta - RsImpresion!nImpuesto1 - RsImpresion!nImpuesto2) - ((RsImpresion!nPrecioOficial * RsImpresion!nCantidad) / impG)
          xRecargo = xRecargo + xAumento
          xSubTotal = xSubTotal + ((RsImpresion!nPrecioOficial * RsImpresion!nCantidad) / impG)
          '------------
          zDescuento = zDescuento + (RsImpresion!nDescuento * RsImpresion!nCantidad)
          zRecargo = zRecargo + (RsImpresion!nRecargo * RsImpresion!nCantidad)
       End If
       
       'Combos
       If lComboPrecuenta And IIf(IsNull(RsImpresion!Combo), 0, Len(Trim(RsImpresion!Combo))) > 0 Then
          sLinea = Mid("       " & Right(String(5, " ") & Format(RsImpresion!nCantidadCombo, "#0.00"), 5) & " " & RsImpresion!Combo, 1, 40)
          Printer.Print sLinea
          
          'Combos Propiedades
          If lPropiedadPrecuenta And Len(Trim(IIf(IsNull(RsImpresion!Combo), "", RsImpresion!Combo))) > 0 Then
             xRsPropiedadCombo.Filter = "tItem='" & RsImpresion!tItem & "' and tItemCombo='" & RsImpresion!tItemCombo & "'"
             If Not xRsPropiedadCombo.EOF Then
                xRsPropiedadCombo.MoveFirst
                Do While Not xRsPropiedadCombo.EOF
                   'Printer.Print "        * " & xRsPropiedadCombo!Operador & " " & xRsPropiedadCombo!Descripcion
                    ImprimeXLinea "             * " & xRsPropiedadCombo!Operador & " " & xRsPropiedadCombo!Descripcion, 40, 13
                   xRsPropiedadCombo.MoveNext
                Loop
             End If
          
             'Impresion de la Observacion
              If lObservacionPrecuenta And Len(Trim(RsImpresion!tObservacionCombo)) > 0 Then
                 ImprimeXLinea "        - " & Trim(RsImpresion!tObservacionCombo), 33, 2
              End If
          End If
       End If
       xObservacion = IIf(IsNull(RsImpresion!tObservacionPedido), "", RsImpresion!tObservacionPedido)
       Item = RsImpresion!tItem
       RsImpresion.MoveNext
    Loop
    If lPropiedadPrecuenta Then
       xRsPropiedad.Filter = "tItem='" & Item & "'"
       If Not xRsPropiedad.EOF Then
          xRsPropiedad.MoveFirst
          Do While Not xRsPropiedad.EOF
             'Printer.Print "        * " & xRsPropiedad!Operador & " " & xRsPropiedad!Descripcion
              ImprimeXLinea "        * " & IIf(xRsPropiedad!nCantidad = 1, "", "(" & xRsPropiedad!nCantidad & ")") & xRsPropiedad!Operador & " " & xRsPropiedad!Descripcion, 31, 10
             xRsPropiedad.MoveNext
          Loop
       End If
                   
       'Impresion de la Observacion
       If lObservacionPrecuenta And Len(Trim(xObservacion)) > 0 Then
          ImprimeXLinea "        - " & Trim(xObservacion), 33, 2
       End If
    End If
            
            
    zSubTotal = Round(zTotal - zImpuesto1 - zImpuesto2 - zImpuesto3, 2)
    zTotal = Round(zTotal, 2)
    
'    zSubTotal = zTotal - zImpuesto1 - zImpuesto2 - zImpuesto3
'    zTotal = zTotal
    
    Printer.Print String(40, "-")
    
'    If lPrecioNetoPrecuenta Then
'        Printer.Print Right(String(27, " ") & "Sub Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xSubTotal, "##,###,##0.00"), 13)
'        Printer.Print String(40, " ")
'    Else
'        Printer.Print Right(String(27, " ") & "Sub Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(zGTotal, "##,###,##0.00"), 13)
'        Printer.Print String(40, " ")
'    End If
'
    If zDescuento > 0 Then
        If lPrecioNetoPrecuenta Then
           Printer.Print Right(String(27, " ") & "Descuento " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xDescuento, "##,###,##0.00"), 13)
        Else
           Printer.Print Right(String(27, " ") & "Sub Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(zGTotal, "##,###,##0.00"), 13)
           Printer.Print " "
           Printer.Print Right(String(27, " ") & "Descuento " & sMonN & " : ", 27) & Right(String(13, " ") & Format(zDescuento, "##,###,##0.00"), 13)
        End If
    End If
    
    If zRecargo > 0 Then
       If lPrecioNetoPrecuenta Then
          Printer.Print Right(String(27, " ") & "Recargo " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xRecargo, "##,###,##0.00"), 13)
       Else
          Printer.Print Right(String(27, " ") & "Recargo " & sMonN & " : ", 27) & Right(String(13, " ") & Format(zRecargo, "##,###,##0.00"), 13)
       End If
    End If
    
    If lImpuestoPrecuenta Then
        Printer.Print Right(String(27, " ") & "Valor venta " & sMonN & " : ", 27) & Right(String(13, " ") & Format(zSubTotal, "##,###,##0.00"), 13)
        If zImpuesto1 > 0 Then
           Printer.Print Right(String(27, " ") & sImpuesto1 & " " & Format(nPorcentaje1, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(zImpuesto1, "##,###,##0.00"), 13)
        End If
           
        If zImpuesto2 > 0 Then
           Printer.Print Right(String(27, " ") & sImpuesto2 & " " & Format(nPorcentaje2, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(zImpuesto2, "##,###,##0.00"), 13)
        End If
           
        If zImpuesto3 > 0 Then
           Printer.Print Right(String(27, " ") & sImpuesto3 & " " & Format(nPorcentaje3, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(zImpuesto3, "##,###,##0.00"), 13)
        End If
     End If
     
    Printer.Print " "
    Printer.FontName = sFont1
    If lPrecioNetoPrecuenta Then
        If lImpuestoPrecuenta Then
            Printer.Print Right(String(27, " ") & "Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(zTotal, "##,###,##0.00"), 13)
        Else
            Printer.Print Right(String(27, " ") & "Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(zSubTotal, "##,###,##0.00"), 13)
        End If
    Else
        Printer.Print Right(String(27, " ") & "Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(zTotal, "##,###,##0.00"), 13)
    End If
    '=================Nov2010
    If lImpreEquivaPrecuenta Then
        Printer.Print Right(String(27, " ") & "Total " & sMonE & " :", 27) & Right(String(13, " ") & Format(zTotal / nTC, "##,###,##0.00"), 13)
    End If
    '=================
    Printer.FontName = sFont
    Printer.Print " "
    
    If pais = "002" Then
       Printer.Print " "
       Printer.Print " Propina : _____________"
       Printer.Print " "
    End If
    
    Printer.Print
    If lPrecioNetoPrecuenta Then
        If lImpuestoPrecuenta Then
            txt = "Son: " & NumeroCadena(str(zTotal)) & " " & sMonedaN
        Else
            txt = "Son: " & NumeroCadena(str(zSubTotal)) & " " & sMonedaN
        End If
    Else
        txt = "Son: " & NumeroCadena(str(zTotal)) & " " & sMonedaN
    End If
    ImprimeXLinea txt, 40, 5
    Printer.Print
    Printer.Print String(40, "-")
        
    If lImpPropina Then
        'Printer.Print String(40, "_")
        Printer.Print '"|" & String(38, " ") & "|"
        Printer.Print '"|" & String(38, " ") & "|"
        Printer.Print " Propina(TIP) : ________________________"
        Printer.Print '"|" & String(38, " ") & "|"
        Printer.Print '"|" & String(38, " ") & "|"
        Printer.Print " Monto Total  : ________________________"
        Printer.Print '"|" & String(38, " ") & "|"
        Printer.Print '"|" & String(38, " ") & "|"
        Printer.Print '"|" & String(38, " ") & "|"
        Printer.Print '"|" & String(38, " ") & "|"
        Printer.Print '"|" & String(38, " ") & "|"
        Printer.Print '"|" & String(9, " ") & "--------------------" & String(9, " ") & "|"
        ImprimeXCentro "--------------------", 40
        'Printer.Print "|" & String(9, " ") & "    Firma Cliente   " & String(9, " ") & "|"
        ImprimeXCentro "Firma Cliente", 40
        'Printer.Print "|" & String(38, " ") & "|"
        'Printer.Print String(40, "_")
        Printer.Print String(40, "-")
    End If
    Printer.Print
    
    If pais = "002" Then
       Printer.FontName = sFont1
       Printer.FontBold = True
       ImprimeXCentro "DATOS PARA SU FACTURA", 40
       Printer.Print " "
       Printer.FontName = sFont
       Printer.FontBold = False
    End If
    
    Printer.Print " Razon Social : ________________________"
    Printer.Print
    Printer.Print "              : ________________________"
    Printer.Print
    
    Select Case pais
       Case "001" 'Bolivia
               Printer.Print " N.I.T.       : ________________________"
       Case Else 'Peru, Ecuador
               Printer.Print " R.U.C.       : ________________________"
    End Select
    
    If pais = "002" Then
        Printer.Print " Direccion    : ___________________________________"
        Printer.Print
        Printer.Print " Telefono     : ___________________________________"
    End If
     
    Printer.Print " "
    Printer.Print " Correo       : ________________________"
    Printer.Print " "
    Printer.Print String(40, "-")

    RsImpresion.MoveLast
    If Len(LTrim(sClub)) > 0 And RsImpresion!lPuntos And RsImpresion!nDisponible > 0 Then
       Printer.Print " "
       ImprimeXCentro "Ud. Tiene " & Format(RsImpresion!nDisponible, "###,##0.00") & " Puntos Acumulados", 40
       Printer.Print " "
    End If
      
    Printer.FontName = sFont
    Printer.FontBold = True
    ImprimeXCentro sPiePreCuenta, 40
    Printer.FontName = sFont
    Printer.FontBold = False
    Set xRsPropiedad = Nothing
    Set xRsPropiedadCombo = Nothing
    
    If lImprimeImagPiePrecuenta Then
        If pie <> 0 Then
            Printer.PaintPicture pie, 500, Printer.CurrentY, 2860, 1600
        End If
    End If
    
    Printer.Print " "
    Printer.EndDoc
End Sub

Public Sub ImprimePedido(RsImpresion As Recordset, sEstado As String, sImpresora As String, sArea As String, ReImp As Boolean, RsProductoPropiedadPedido As Recordset, RsPropiedadComboPedido As Recordset, sModulo As String)
    On Error Resume Next
    Dim Item As String
    Dim sLinea As String
    Dim nCorteCombo As Integer
    Dim nCorte As Integer
    Dim lCorte As Boolean
    Dim lCorteCombo As Boolean
    Dim xPedidox As String
        Dim RsOrigenVentas As Recordset
    RsProductoPropiedadPedido.Requery
    RsPropiedadComboPedido.Requery
    
    lCorte = False
    lCorteCombo = False
    'origen de ventas----------------------------------------------------------------------------------------------------
    Isql = "select b.tDescripcion from MPEDIDO a inner join TORIGENVENTA b on b.tCodigoOrigenVenta = a.CodigoOrigenVenta where a.tCodigoPedido = '" & sPedido & "'  "
    Set RsOrigenVentas = Lib.OpenRecordset(Isql, Cn)
    sOrigenVenta = RsOrigenVentas!tDescripcion
    '---------------------------------------------------------------------------------------------------------------------

    'Configura la Impresora la impresion Font
    If Not Imprimir(sImpresora) Then
       Exit Sub
    End If
    
    '----------Cabecera-----------------------------------------------------------------
    
    Dim tamanio As Double

    If lImpComandaf2 Then
        Printer.FontName = sFont1
        tamanio = Printer.FontSize
        Printer.Font.Size = tamanio + 3
        Printer.FontBold = True
        
        If ReImp Then
           ImprimeXCentro "<< REIMPRESION >>", 30
        End If
         If sEstado = "A" Then
            ImprimeXCentro sElimina, 30
         End If
         
         Dim nped As String
         nped = Calcular("select ltrim(rtrim(isnull(Descripcion,''))) as codigo from vtipopedido where codigo='" & RsImpresion!tipopedido & "'", Cn)
         Printer.Print "*" & Right(String((28 - Len(nped)) / 2, "*") & " " & nped & " " & String((28 - Len(nped)) / 2, "*"), 28) & "*"
         
         If IIf(IsNull(RsImpresion!Mesa2), "", Trim(RsImpresion!Mesa2)) <> "" Then
            'Printer.Print "**** " & IIf(IsNull(RsImpresion!Mesa2), "", Trim(RsImpresion!Mesa2)) & " **** "
             Printer.Print "*" & Right(String((28 - Len(Trim(RsImpresion!Mesa2))) / 2, "*") & " " & Trim(RsImpresion!Mesa2) & " " & String((28 - Len(Trim(RsImpresion!Mesa2))) / 2, "*"), 28) & "*"
         End If
         
         If IIf(IsNull(RsImpresion!Mesa), "", Trim(RsImpresion!Mesa)) <> "" Then
            'Printer.Print "**** Mesa " & IIf(IsNull(RsImpresion!Mesa), "", Trim(RsImpresion!Mesa)) & " **** "
            Printer.Print "*" & Right(String((28 - Len(RsImpresion!Mesa) + 5) / 2, "*") & " MESA:" & RsImpresion!Mesa & " " & String((28 - Len(RsImpresion!Mesa) + 5) / 2, "*"), 28) & "*"
         End If
         
         Printer.Print "Area: " & sArea
         
         If sEstado <> "N" And sEstado <> "R" Then
             ImprimeXLinea ">MOTIVO: " & IIf(RsImpresion!tMotivoEliminacion = "000", RsImpresion!tObservacionAnulado, RsImpresion!MotivoEliminacion), 30, 0
         End If
         
         Printer.FontName = sFont1
         Printer.Font.Size = tamanio
         Printer.Print " "
        
         Printer.Print "Orden   : " & RsImpresion!orden
         Printer.Print "Pedido  : " & sPedido & " - " & IIf(RsImpresion!Prioridad, "Urgente", "Regular")
         Printer.Print "Fecha   : " & FechaServidor()

        Select Case RsImpresion!tipopedido
               Case Is = "01"
                    Printer.Print "Mesero  : " & RsImpresion!Mozo
                    'ImprimeXLinea "T/Pedido : " & sBoton1 & " " & IIf(RsImpresion!Prioridad, "Urgente", "Regular"), 35, 11
                    'mprimeXLinea "Prioridad: " & sBoton1 & " " & IIf(RsImpresion!Prioridad, "Urgente", "Regular"), 33, 11
                    
                    If RsImpresion!nAdulto > 0 Then
                       Printer.Print "Personas: " & RsImpresion!nAdulto '& " - " & IIf(RsImpresion!Prioridad, "Urgente", "Regular")
                    End If
                    
               Case Is = "02"
                    xPedidox = sPedido
                    Printer.Print "Motoriz.: " & frmVenta.txtMotorizado.Caption
                    sPedido = xPedidox
                    'ImprimeXLinea "T/Pedido : " & sBoton2 & " " & IIf(RsImpresion!Prioridad, "Urgente", "Regular"), 35, 11
                    'ImprimeXLinea "Prioridad: " & sBoton1 & " " & IIf(RsImpresion!Prioridad, "Urgente", "Regular"), 33, 11
                    'origen de ventas
                    If sOrigenVenta <> "" Then
                    Printer.Print "Origen de Ventas:   " & sOrigenVenta
                    End If
                    '--------------------------------------
    
                    Case Is = "03"
                    'ImprimeXLinea "T/Pedido : " & sBoton3 & " " & IIf(RsImpresion!Prioridad, "Urgente", "Regular"), 35, 11
                    'ImprimeXLinea "Prioridad: " & sBoton1 & " " & IIf(RsImpresion!Prioridad, "Urgente", "Regular"), 33, 11
               
               Case Is = "04"
                    If RsImpresion!Mozo <> "" Then
                       Printer.Print "Mesero   : " & RsImpresion!Mozo
                    End If
                    'ImprimeXLinea "T/Pedido : " & sBoton4 & " " & IIf(RsImpresion!Prioridad, "Urgente", "Regular"), 35, 11
                    'ImprimeXLinea "Prioridad: " & sBoton1 & " " & IIf(RsImpresion!Prioridad, "Urgente", "Regular"), 33, 11
                    If RsImpresion!nAdulto > 0 Then
                       Printer.Print "Personas: " & RsImpresion!nAdulto '& " - " & IIf(RsImpresion!Prioridad, "Urgente", "Regular")
                    End If
                    
               Case Is = "05"
                    If RsImpresion!Mozo <> "" Then
                       Printer.Print "Mesero  : " & RsImpresion!Mozo
                    End If
                    'ImprimeXLinea "T/Pedido : Room Service " & IIf(RsImpresion!Prioridad, "Urgente", "Regular"), 35, 11
                    If RsImpresion!nAdulto > 0 Then
                       Printer.Print "Personas: " & RsImpresion!nAdulto
                    End If
                    
        End Select
        If RsImpresion!tipopedido = "02" Then
           ImprimeXLinea "Cliente : " & IIf(IsNull(RsImpresion!Cliente), "", Trim(RsImpresion!Cliente)), 35, 10
        End If
        
        If Calcular("select isnull(lcanalcentralpedidos,0) as codigo from vTipoPedido where codigo='" & RsImpresion!tipopedido & "'", Cn) Then
            ImprimeXLinea "FechaEntrega: " & IIf(IsNull(RsImpresion!fProgramacion), "", Format(Trim(RsImpresion!fProgramacion), "dd/mm/yyyy")), 35, 11
            ImprimeXLinea "HoraEntrega : " & IIf(IsNull(RsImpresion!fProgramacion), "", Format(Trim(RsImpresion!fProgramacion), "HH:MM")), 35, 11
        End If
        
          'entregarA
        If RsImpresion!TEntregarA <> "" Then
            ImprimeXLinea "Entregar A:" & IIf(IsNull(RsImpresion!TEntregarA), "", Trim(RsImpresion!TEntregarA)), 37, 11
        End If
        
        ImprimeXLinea "Obs.: " & IIf(IsNull(RsImpresion!Observacion), "", Trim(RsImpresion!Observacion)), 37, 6
        
    
        '----------------------------------------------------------------------------------------------------------
        '--------------------------------------Fin de Cabecera-----------------------------------------------------
        '----------------------------------------------------------------------------------------------------------
        'Envios Directos
        Printer.FontBold = False
        Printer.Font.Size = tamanio + 2
        If Not lDirecto Then
           Isql = "SELECT COUNT(dbo.DPEDIDO.tCodigoPedido) AS Codigo FROM dbo.DPEDIDO INNER JOIN dbo.TPRODUCTOAREA ON dbo.DPEDIDO.tCodigoProducto = dbo.TPRODUCTOAREA.tCodigoProducto " & _
                  "WHERE dbo.DPEDIDO.tCodigoPedido = '" & sPedido & "' and lImprime = 1 and dbo.TPRODUCTOAREA.tArea = '" & RsImpresion!tArea & "'"
        
           If Val(Calcular(Isql, Cn)) > 0 And sEstado = "N" Then
           
              If lOrden Then
                 ' set 11
                 'Isql = "select count(norden) as Codigo from (select nOrden, limprime FROM dbo.DPEDIDO INNER JOIN dbo.TPRODUCTOAREA ON dbo.DPEDIDO.tCodigoProducto = dbo.TPRODUCTOAREA.tCodigoProducto " & _
                        "WHERE dbo.DPEDIDO.tCodigoPedido = '" & sPedido & "' and dbo.TPRODUCTOAREA.tArea = '" & RsImpresion!tArea & "' group by norden, limprime) T1 group by norden Having Count(nOrden) > 1 "
                        
                 Isql = "select count(norden) as Codigo from (select nOrden, limprime FROM dbo.DPEDIDO INNER JOIN dbo.TPRODUCTOAREA ON dbo.DPEDIDO.tCodigoProducto = dbo.TPRODUCTOAREA.tCodigoProducto " & _
                        "WHERE dbo.DPEDIDO.tCodigoPedido = '" & sPedido & "' and dbo.TPRODUCTOAREA.tArea = '" & RsImpresion!tArea & "' and limprime=0 group by norden, limprime) T1 group by norden Having Count(nOrden) > "
                      
                 If Val(Calcular(Isql, Cn)) = 0 And sEstado = "N" Then
                    If MsgBox("Envio Directo al Area " & Calcular("select Descripcion as Codigo from vArea where Codigo='" & RsImpresion!tArea & "'", Cn) & "?", vbQuestion + vbYesNo + vbDefaultButton2, sMensaje) = vbYes Then
                       Printer.Print "------------ DIRECTO ------------"
                       Cn.Execute "update DPEDIDO set nOrden=0 where tCodigoPedido='" & sPedido & "' and lImprime=0"
                    Else
                       Printer.Print "-------------| " & Format(RsImpresion!nOrden, "00") & " |--------------"
                    End If
                 Else
                    Printer.Print "-------------| " & Format(RsImpresion!nOrden, "00") & " |--------------"
                 End If
             Else
                 If MsgBox("Envio Directo al Area " & Calcular("select Descripcion as Codigo from vArea where Codigo='" & RsImpresion!tArea & "'", Cn) & "?", vbQuestion + vbYesNo + vbDefaultButton2, sMensaje) = vbYes Then
                    Printer.Print "------------ DIRECTO ------------"
                    Cn.Execute "update DPEDIDO set nOrden=0 where tCodigoPedido='" & sPedido & "' and lImprime=0"
                 Else
                    Printer.Print "-------------| " & Format(RsImpresion!nOrden, "00") & " |--------------"
                 End If
              End If
              
           Else
              Printer.Print "-------------| " & Format(RsImpresion!nOrden, "00") & " |--------------"
           End If
        Else
           'Printer.Print String(33, "-")
           'IMPRIME X ORDEN SI > 0
           If RsImpresion!nOrden = "0" Then
                Printer.Print String(33, "-")
           Else
                Printer.Print "-------------| " & Format(RsImpresion!nOrden, "00") & " |--------------"
           End If
        End If
        '------------------------------------------------------------
        '---------------------------- Cuerpo ------------------------
        '------------------------------------------------------------
        Item = ""
        Do While Not RsImpresion.EOF
           Item = RsImpresion!tItem
           nCorte = RsImpresion!nOrden
               
           Printer.FontBold = True
           'Printer.FontName = sFont1
           'Printer.Print " "
           If lOrden Then
              If RsImpresion!lImprime Then
                 If sEstado = "A" Then
                    ImprimeXLinea "[ANU] " & Format(RsImpresion!nCantidad, "#,##0.00") & " " & Trim(RsImpresion!Producto), 30, 5
                 Else
                    ImprimeXLinea "[IMP] " & Format(RsImpresion!nCantidad, "#,##0.00") & " " & Trim(RsImpresion!Producto), 30, 5
                 End If
              Else
                 ImprimeXLinea Format(RsImpresion!nCantidad, "#,##0.00") & " " & Trim(RsImpresion!Producto), 30, 5
              End If
           Else
              ImprimeXLinea Format(RsImpresion!nCantidad, "#,##0.00") & " " & Trim(RsImpresion!Producto), 30, 5
           End If
           'Printer.FontName = sFont1
           Printer.FontBold = False
                  
           If Len(Trim(IIf(IsNull(RsImpresion!Combo), "", RsImpresion!Combo))) > 0 Then
              If sModulo = "Rapido" Then
                 RsProductoPropiedadPedido.Filter = "tItem='" & RsImpresion!tItem & "'"
              Else
                 RsProductoPropiedadPedido.Filter = "tCodigoPedido='" & sPedido & "' and tItem='" & RsImpresion!tItem & "'"
              End If
              If Not RsProductoPropiedadPedido.EOF Then
                 RsProductoPropiedadPedido.MoveFirst
                 Do While Not RsProductoPropiedadPedido.EOF
                    Printer.Print "* " & IIf(RsProductoPropiedadPedido!nCantidad = 1, "", "(" & RsProductoPropiedadPedido!nCantidad & ")") & RsProductoPropiedadPedido!Operador & " " & RsProductoPropiedadPedido!Descripcion
                    RsProductoPropiedadPedido.MoveNext
                Loop
              End If
            
              'Impresion de la Observacion
              If Len(Trim(RsImpresion!tObservacion)) > 0 Then
                'Printer.FontSize = Printer.FontSize + 1
                 ImprimeXLinea "! " & Trim(RsImpresion!tObservacion), 30, 2
                 'Printer.FontSize = Printer.FontSize - 1
              End If
              
              Do While IIf(RsImpresion.EOF, "END", RsImpresion!tItem) = Item And Not RsImpresion.EOF
                 nCorteCombo = IIf(IsNull(RsImpresion!nOrdenCombo), 0, RsImpresion!nOrdenCombo)
                 sLinea = Mid("- " & RsImpresion!Combo & String(26, " "), 1, 26) & Right(String(7, " ") & Format(RsImpresion!nCombo, "###0.00"), 7)
                 'Printer.Print " "
                 Printer.Print sLinea
                 
                 'Impresion de Propiedades del Combo
                 If sModulo = "Rapido" Then
                    RsPropiedadComboPedido.Filter = "tItem='" & RsImpresion!tItem & "' and tItemCombo='" & RsImpresion!tItemCombo & "'"
                 Else
                    RsPropiedadComboPedido.Filter = "tCodigoPedido='" & sPedido & "' and tItem='" & RsImpresion!tItem & "' and tItemCombo='" & RsImpresion!tItemCombo & "'"
                 End If
                 If Not RsPropiedadComboPedido.EOF Then
                    RsPropiedadComboPedido.MoveFirst
                    Do While Not RsPropiedadComboPedido.EOF
                       Printer.Print "  * " & IIf(RsPropiedadComboPedido!nCantidad = 1, "", "(" & RsPropiedadComboPedido!nCantidad & ") ") & RsPropiedadComboPedido!Operador & " " & RsPropiedadComboPedido!Descripcion
                       RsPropiedadComboPedido.MoveNext
                    Loop
                 End If
                 
                 'Impresion de la Observacion
                 If Len(Trim(RsImpresion!tObservacionCombo)) > 0 Then
                    ImprimeXLinea "  ! " & Trim(RsImpresion!tObservacionCombo), 30, 4
                 End If
                 
                 'Corte
                 If IIf(IsNull(RsImpresion!lCorteCombo), False, RsImpresion!lCorteCombo) Then
                    lCorteCombo = True
                 End If
                 
                 If IIf(IsNull(RsImpresion!lCorte), False, RsImpresion!lCorte) Then
                    lCorte = True
                 End If
                 
                 RsImpresion.MoveNext
                 If Not RsImpresion.EOF Then
                    If lCorteCombo Or IIf(IsNull(RsImpresion!nOrdenCombo), 0, RsImpresion!nOrdenCombo) <> nCorteCombo Then
                       lCorteCombo = False
                       Printer.Print "  " & String(31, ".")
                    End If
                 End If
              Loop
           Else
              'Corte
              If IIf(IsNull(RsImpresion!lCorte), False, RsImpresion!lCorte) Then
                 lCorte = True
              End If
              
              'Impresion de Propiedades
              If sModulo = "Rapido" Then
                 RsProductoPropiedadPedido.Filter = "tItem='" & RsImpresion!tItem & "'"
              Else
                 RsProductoPropiedadPedido.Filter = "tCodigoPedido='" & sPedido & "' and tItem='" & RsImpresion!tItem & "'"
              End If
              
              If Not RsProductoPropiedadPedido.EOF Then
                 RsProductoPropiedadPedido.MoveFirst
                 Do While Not RsProductoPropiedadPedido.EOF
                    ImprimeXLinea " * " & IIf(RsProductoPropiedadPedido!nCantidad = 1, "", "(" & RsProductoPropiedadPedido!nCantidad & ")") & RsProductoPropiedadPedido!Operador & " " & RsProductoPropiedadPedido!Descripcion, 30, 3
                    RsProductoPropiedadPedido.MoveNext
                Loop
              End If
            
              'Impresion de la Observacion
              If Len(Trim(RsImpresion!tObservacion)) > 0 Then
                'Printer.FontBold = True
                 ImprimeXLinea " ! " & Trim(RsImpresion!tObservacion), 30, 3
                'Printer.FontBold = False
              End If
              
              RsImpresion.MoveNext
           End If
           
           
           If lCorte Or IIf(RsImpresion.EOF, "END", RsImpresion!nOrden) <> nCorte Then
              'Printer.Print String(33, "-")
              If RsImpresion.EOF Then
                 Printer.Print String(33, "-")
              Else
                 Printer.Print "-------------| " & Format(RsImpresion!nOrden, "00") & " |--------------"
              End If
              lCorte = False
           End If
        Loop
        Printer.Font.Size = tamanio
        'Final
        RsImpresion.MoveLast
        Printer.Print "Caja     : " & sCaja & " - " & IIf(Mid(sUsuario, 1, 1) = "*", Mid(sUsuario, 2, 15), sUsuario)
        'Printer.Print " "
    
        
        Printer.Print "                  -x-"
        Printer.Print
        Printer.EndDoc
    '--------------------------------------------------------------------------------
    Else '----------------------------Formato antiguo ---------------------------------------------------------
    '---------------------------------------------------------------------
        '----------Cabecera-----------------------------------------------------------------
        'Printer.Font.Size = 8.51
        Printer.Print ""
        Printer.Print ""
        Printer.FontName = sFont2
        Printer.FontBold = True
        If ReImp Then
           Printer.Print "REIMPRESION"
           Printer.Print " "
        End If
        
        If sEstado <> "N" And sEstado <> "R" Then
            Printer.Font.Size = Printer.Font.Size + 2
            ImprimeXLinea "ANULACION POR " & IIf(RsImpresion!tMotivoEliminacion = "000", RsImpresion!tObservacionAnulado, RsImpresion!MotivoEliminacion), 17, 0
            Printer.Font.Size = Printer.Font.Size - 2
            Printer.Print " "
        End If
        
        
        Printer.Print "Orden : " & RsImpresion!orden
        Printer.Print ""
        Printer.Print "Hora  : " & Format(Time, "HH:mm:ss")
        Printer.Print " "
        If IIf(IsNull(RsImpresion!Mesa), "", Trim(RsImpresion!Mesa)) <> "" Then
           ImprimeXLinea "Mesa  : " & IIf(IsNull(RsImpresion!Mesa), "", Trim(RsImpresion!Mesa)), 38, 8
           Printer.Print " "
        End If
        '-------------------------------------------------------------------------------
        'Printer.Font.Size = (Printer.Font.Size) + 3
        Printer.FontName = sFont1
        Printer.FontBold = False
        
        Printer.Print "Pedido   : " & sPedido
        'Printer.Print "Pedido   : " & RsImpresion!codigo
        Printer.Print "Fecha    : " & FechaServidor()
        
        'Dim tamanio As Integer
        tamanio = Printer.FontSize
        Printer.FontBold = True
        Printer.Font.Size = tamanio + 3
        Printer.Print "Area     : " & sArea
        
        Printer.FontBold = False
        Printer.FontSize = tamanio
        
        Select Case RsImpresion!tipopedido
               Case Is = "01"
                    Printer.Print "Mesero   : " & RsImpresion!Mozo
                    ImprimeXLinea "T/Pedido : " & sBoton1 & " " & IIf(RsImpresion!Prioridad, "Urgente", "Regular"), 23, 11
                    
                    If RsImpresion!nAdulto > 0 Then
                       Printer.Print "Personas : " & RsImpresion!nAdulto
                    End If
                    
               Case Is = "02"
                    xPedidox = sPedido
                    Printer.Print "Motoriz. : " & frmVenta.txtMotorizado.Caption
                    sPedido = xPedidox
                    ImprimeXLinea "T/Pedido : " & sBoton2 & " " & IIf(RsImpresion!Prioridad, "Urgente", "Regular"), 23, 11
                    'origen de ventas
                    If sOrigenVenta <> "" Then
                    Printer.Print "Origen de Ventas:   " & sOrigenVenta
                    End If
                    '--------------------------------------
    
                    Case Is = "03"
                    ImprimeXLinea "T/Pedido : " & sBoton3 & " " & IIf(RsImpresion!Prioridad, "Urgente", "Regular"), 23, 11
               
               Case Is = "04"
                    If RsImpresion!Mozo <> "" Then
                       Printer.Print "Mesero   : " & RsImpresion!Mozo
                    End If
                    ImprimeXLinea "T/Pedido : " & sBoton4 & " " & IIf(RsImpresion!Prioridad, "Urgente", "Regular"), 23, 11
                    If RsImpresion!nAdulto > 0 Then
                       Printer.Print "Personas : " & RsImpresion!nAdulto
                    End If
                    
               Case Is = "05"
                    If RsImpresion!Mozo <> "" Then
                       Printer.Print "Mesero   : " & RsImpresion!Mozo
                    End If
                    ImprimeXLinea "T/Pedido : Room Service " & IIf(RsImpresion!Prioridad, "Urgente", "Regular"), 23, 11
                    If RsImpresion!nAdulto > 0 Then
                       Printer.Print "Personas : " & RsImpresion!nAdulto
                    End If
                    
        End Select
        If RsImpresion!tipopedido = "02" Then
           ImprimeXLinea "Cliente  : " & IIf(IsNull(RsImpresion!Cliente), "", Trim(RsImpresion!Cliente)), 23, 11
        End If
        
        If Calcular("select isnull(lcanalcentralpedidos,0) as codigo from vTipoPedido where codigo='" & RsImpresion!tipopedido & "'", Cn) Then
            ImprimeXLinea "FechaEntrega: " & IIf(IsNull(RsImpresion!fProgramacion), "", Format(Trim(RsImpresion!fProgramacion), "dd/mm/yyyy")), 25, 11
            ImprimeXLinea "HoraEntrega : " & IIf(IsNull(RsImpresion!fProgramacion), "", Format(Trim(RsImpresion!fProgramacion), "HH:MM")), 25, 11
        End If
        
          'entregarA
        If RsImpresion!TEntregarA <> "" Then
            ImprimeXLinea "Entregar A:" & IIf(IsNull(RsImpresion!TEntregarA), "", Trim(RsImpresion!TEntregarA)), 23, 11
        End If
        
        Printer.FontSize = Printer.FontSize + 1
        ImprimeXLinea "Observac.: " & IIf(IsNull(RsImpresion!Observacion), "", Trim(RsImpresion!Observacion)), 23, 11
        Printer.FontSize = Printer.FontSize - 1
    
        'Envios Directos
        If Not lDirecto Then
           Isql = "SELECT COUNT(dbo.DPEDIDO.tCodigoPedido) AS Codigo FROM dbo.DPEDIDO INNER JOIN dbo.TPRODUCTOAREA ON dbo.DPEDIDO.tCodigoProducto = dbo.TPRODUCTOAREA.tCodigoProducto " & _
                  "WHERE dbo.DPEDIDO.tCodigoPedido = '" & sPedido & "' and lImprime = 1 and dbo.TPRODUCTOAREA.tArea = '" & RsImpresion!tArea & "'"
        
           If Val(Calcular(Isql, Cn)) > 0 And sEstado = "N" Then
           
              If lOrden Then
                 ' set 11
                 'Isql = "select count(norden) as Codigo from (select nOrden, limprime FROM dbo.DPEDIDO INNER JOIN dbo.TPRODUCTOAREA ON dbo.DPEDIDO.tCodigoProducto = dbo.TPRODUCTOAREA.tCodigoProducto " & _
                        "WHERE dbo.DPEDIDO.tCodigoPedido = '" & sPedido & "' and dbo.TPRODUCTOAREA.tArea = '" & RsImpresion!tArea & "' group by norden, limprime) T1 group by norden Having Count(nOrden) > 1 "
                        
                 Isql = "select count(norden) as Codigo from (select nOrden, limprime FROM dbo.DPEDIDO INNER JOIN dbo.TPRODUCTOAREA ON dbo.DPEDIDO.tCodigoProducto = dbo.TPRODUCTOAREA.tCodigoProducto " & _
                        "WHERE dbo.DPEDIDO.tCodigoPedido = '" & sPedido & "' and dbo.TPRODUCTOAREA.tArea = '" & RsImpresion!tArea & "' and limprime=0 group by norden, limprime) T1 group by norden Having Count(nOrden) > "
                      
                 If Val(Calcular(Isql, Cn)) = 0 And sEstado = "N" Then
                    If MsgBox("Envio Directo al Area " & Calcular("select Descripcion as Codigo from vArea where Codigo='" & RsImpresion!tArea & "'", Cn) & "?", vbQuestion + vbYesNo + vbDefaultButton2, sMensaje) = vbYes Then
                       Printer.Print "------------ DIRECTO ------------"
                       Cn.Execute "update DPEDIDO set nOrden=0 where tCodigoPedido='" & sPedido & "' and lImprime=0"
                    Else
                       Printer.Print "-------------| " & Format(RsImpresion!nOrden, "00") & " |--------------"
                    End If
                 Else
                    Printer.Print "-------------| " & Format(RsImpresion!nOrden, "00") & " |--------------"
                 End If
             Else
                 If MsgBox("Envio Directo al Area " & Calcular("select Descripcion as Codigo from vArea where Codigo='" & RsImpresion!tArea & "'", Cn) & "?", vbQuestion + vbYesNo + vbDefaultButton2, sMensaje) = vbYes Then
                    Printer.Print "------------ DIRECTO ------------"
                    Cn.Execute "update DPEDIDO set nOrden=0 where tCodigoPedido='" & sPedido & "' and lImprime=0"
                 Else
                    Printer.Print "-------------| " & Format(RsImpresion!nOrden, "00") & " |--------------"
                 End If
              End If
              
           Else
              Printer.Print "-------------| " & Format(RsImpresion!nOrden, "00") & " |--------------"
           End If
        Else
           'Printer.Print String(33, "-")
           'IMPRIME X ORDEN SI > 0
           If RsImpresion!nOrden = "0" Then
                Printer.Print String(33, "-")
           Else
                Printer.Print "-------------| " & Format(RsImpresion!nOrden, "00") & " |--------------"
           End If
        End If
        
        'Cuerpo
        Item = ""
        Do While Not RsImpresion.EOF
           Item = RsImpresion!tItem
           nCorte = RsImpresion!nOrden
               
           Printer.FontBold = True
           Printer.FontName = sFont2
           Printer.Print " "
           If lOrden Then
              If RsImpresion!lImprime Then
                 If sEstado = "A" Then
                    ImprimeXLinea "[ANU] " & Format(RsImpresion!nCantidad, "#,##0.00") & " " & Trim(RsImpresion!Producto), 33, 5
                 Else
                    ImprimeXLinea "[IMP] " & Format(RsImpresion!nCantidad, "#,##0.00") & " " & Trim(RsImpresion!Producto), 33, 5
                 End If
              Else
                 ImprimeXLinea Format(RsImpresion!nCantidad, "#,##0.00") & " " & Trim(RsImpresion!Producto), 33, 5
              End If
           Else
              ImprimeXLinea Format(RsImpresion!nCantidad, "#,##0.00") & " " & Trim(RsImpresion!Producto), 33, 5
           End If
           Printer.FontName = sFont1
           Printer.FontBold = False
                  
           If Len(Trim(IIf(IsNull(RsImpresion!Combo), "", RsImpresion!Combo))) > 0 Then
              If sModulo = "Rapido" Then
                 RsProductoPropiedadPedido.Filter = "tItem='" & RsImpresion!tItem & "'"
              Else
                 RsProductoPropiedadPedido.Filter = "tCodigoPedido='" & sPedido & "' and tItem='" & RsImpresion!tItem & "'"
              End If
              If Not RsProductoPropiedadPedido.EOF Then
                 RsProductoPropiedadPedido.MoveFirst
                 Do While Not RsProductoPropiedadPedido.EOF
                    Printer.Print "* " & IIf(RsProductoPropiedadPedido!nCantidad = 1, "", "(" & RsProductoPropiedadPedido!nCantidad & ")") & RsProductoPropiedadPedido!Operador & " " & RsProductoPropiedadPedido!Descripcion
                    RsProductoPropiedadPedido.MoveNext
                Loop
              End If
            
              'Impresion de la Observacion
              If Len(Trim(RsImpresion!tObservacion)) > 0 Then
                Printer.FontSize = Printer.FontSize + 1
                 ImprimeXLinea "! " & Trim(RsImpresion!tObservacion), 33, 2
                 Printer.FontSize = Printer.FontSize - 1
              End If
              
              Do While IIf(RsImpresion.EOF, "END", RsImpresion!tItem) = Item And Not RsImpresion.EOF
                 nCorteCombo = IIf(IsNull(RsImpresion!nOrdenCombo), 0, RsImpresion!nOrdenCombo)
                 sLinea = Mid("- " & RsImpresion!Combo & String(26, " "), 1, 26) & Right(String(7, " ") & Format(RsImpresion!nCombo, "###0.00"), 7)
                 Printer.Print " "
                 Printer.Print sLinea
                 
                 'Impresion de Propiedades del Combo
                 If sModulo = "Rapido" Then
                    RsPropiedadComboPedido.Filter = "tItem='" & RsImpresion!tItem & "' and tItemCombo='" & RsImpresion!tItemCombo & "'"
                 Else
                    RsPropiedadComboPedido.Filter = "tCodigoPedido='" & sPedido & "' and tItem='" & RsImpresion!tItem & "' and tItemCombo='" & RsImpresion!tItemCombo & "'"
                 End If
                 If Not RsPropiedadComboPedido.EOF Then
                    RsPropiedadComboPedido.MoveFirst
                    Do While Not RsPropiedadComboPedido.EOF
                       Printer.Print "  * " & IIf(RsPropiedadComboPedido!nCantidad = 1, "", "(" & RsPropiedadComboPedido!nCantidad & ") ") & RsPropiedadComboPedido!Operador & " " & RsPropiedadComboPedido!Descripcion
                       RsPropiedadComboPedido.MoveNext
                    Loop
                 End If
                 
                 'Impresion de la Observacion
                 If Len(Trim(RsImpresion!tObservacionCombo)) > 0 Then
                    ImprimeXLinea "  ! " & Trim(RsImpresion!tObservacionCombo), 33, 4
                 End If
                 
                 'Corte
                 If IIf(IsNull(RsImpresion!lCorteCombo), False, RsImpresion!lCorteCombo) Then
                    lCorteCombo = True
                 End If
                 
                 If IIf(IsNull(RsImpresion!lCorte), False, RsImpresion!lCorte) Then
                    lCorte = True
                 End If
                 
                 RsImpresion.MoveNext
                 If Not RsImpresion.EOF Then
                    If lCorteCombo Or IIf(IsNull(RsImpresion!nOrdenCombo), 0, RsImpresion!nOrdenCombo) <> nCorteCombo Then
                       lCorteCombo = False
                       Printer.Print "  " & String(31, ".")
                    End If
                 End If
              Loop
           Else
              'Corte
              If IIf(IsNull(RsImpresion!lCorte), False, RsImpresion!lCorte) Then
                 lCorte = True
              End If
              
              'Impresion de Propiedades
              If sModulo = "Rapido" Then
                 RsProductoPropiedadPedido.Filter = "tItem='" & RsImpresion!tItem & "'"
              Else
                 RsProductoPropiedadPedido.Filter = "tCodigoPedido='" & sPedido & "' and tItem='" & RsImpresion!tItem & "'"
              End If
              
              If Not RsProductoPropiedadPedido.EOF Then
                 RsProductoPropiedadPedido.MoveFirst
                 Do While Not RsProductoPropiedadPedido.EOF
                    Printer.Print "* " & IIf(RsProductoPropiedadPedido!nCantidad = 1, "", "(" & RsProductoPropiedadPedido!nCantidad & ")") & RsProductoPropiedadPedido!Operador & " " & RsProductoPropiedadPedido!Descripcion
                    RsProductoPropiedadPedido.MoveNext
                Loop
              End If
            
              'Impresion de la Observacion
              If Len(Trim(RsImpresion!tObservacion)) > 0 Then
                Printer.FontBold = True
                 ImprimeXLinea "! " & Trim(RsImpresion!tObservacion), 33, 2
                Printer.FontBold = False
              End If
              
              RsImpresion.MoveNext
           End If
           
           If lCorte Or IIf(RsImpresion.EOF, "END", RsImpresion!nOrden) <> nCorte Then
              'Printer.Print String(33, "-")
              If RsImpresion.EOF Then
                 Printer.Print String(33, "-")
              Else
                 Printer.Print "-------------| " & Format(RsImpresion!nOrden, "00") & " |--------------"
              End If
              lCorte = False
           End If
        Loop
        
        'Final
        RsImpresion.MoveLast
        Printer.Print "Caja     : " & sCaja & " - " & IIf(Mid(sUsuario, 1, 1) = "*", Mid(sUsuario, 2, 15), sUsuario)
    
        If sEstado = "A" Then
           Printer.FontName = sFont2
           Printer.Print " "
           ImprimeXCentro sElimina, 20
           Printer.FontName = sFont1
        End If
    
        Printer.Print
        Printer.EndDoc
    End If
End Sub

Public Sub ImprimeAnulaCombo(RsImpresion As Recordset, sImpresora As String, sArea As String, RsPropiedadCombo As Recordset)
    On Error Resume Next
    Dim Item As String
    Dim sLinea As String
    Dim Observacion As String
    Dim Propiedad As String
    Dim Combo As String
    Dim wPrim As Boolean
    Dim nCorte As Integer
    Dim nCorteCombo As Integer
    
    'Configura la Impresora la impresion Font
    If Not Imprimir(sImpresora) Then
       Exit Sub
    End If
        
    'Cabecera
    Printer.Print ""
    Printer.Print ""
    Printer.FontName = sFont2
    Printer.FontBold = True
    Printer.Print "ANULACION ITEM COMBO"
    
    Printer.Print "Orden : " & RsImpresion!orden
    Printer.Print ""
    Printer.Print "Hora  : " & Format(Time, "HH:mm:ss")
    
    Printer.Print " "
    If RsImpresion!tipopedido = "01" Then
       ImprimeXLinea "Mesa  : " & IIf(IsNull(RsImpresion!Mesa), "", Trim(RsImpresion!Mesa)), 17, 0
       Printer.Print " "
    End If
    Printer.FontName = sFont1
    Printer.FontBold = False
    
    Printer.Print "Pedido   : " & sPedido
    Printer.Print "Fecha    : " & FechaServidor()
    Printer.Print "Area     : " & sArea
    
    Select Case RsImpresion!tipopedido
           Case Is = "01"
                Printer.Print "Mesero   : " & RsImpresion!Mozo
                ImprimeXLinea "T/Pedido : " & sBoton1 & " " & IIf(RsImpresion!Prioridad, "Urgente", "Regular"), 23, 11
                Printer.Print "Personas : " & RsImpresion!nAdulto
           Case Is = "02"
                Printer.Print "Motoriz. : " & txtMotorizado.Caption
                ImprimeXLinea "T/Pedido : " & sBoton2 & " " & IIf(RsImpresion!Prioridad, "Urgente", "Regular"), 23, 11
           Case Is = "03"
                ImprimeXLinea "T/Pedido : " & sBoton3 & " " & IIf(RsImpresion!Prioridad, "Urgente", "Regular"), 23, 11
           Case Is = "05"
                Printer.Print "Mesero   : " & RsImpresion!Mozo
                ImprimeXLinea "T/Pedido : Room Service " & IIf(RsImpresion!Prioridad, "Urgente", "Regular"), 23, 11
    End Select
    If RsImpresion!tipopedido = "02" Then
       ImprimeXLinea "Cliente  : " & IIf(IsNull(RsImpresion!Cliente), "", Trim(RsImpresion!Cliente)), 23, 11
    End If
    ImprimeXLinea "Observac.: " & IIf(IsNull(RsImpresion!Observacion), "", Trim(RsImpresion!Observacion)), 23, 11
    
    Printer.Print String(33, "-")
    
    'Cuerpo
    Printer.FontBold = True
    Printer.FontName = sFont2
    ImprimeXLinea Trim(RsImpresion!Producto), 17, 0
    Printer.FontName = sFont1
    Printer.FontBold = False
                                        
    sLinea = Mid("- " & RsImpresion!Combo & String(26, " "), 1, 26) & Right(String(7, " ") & Format(RsImpresion!nCombo, "###0.00"), 7)
    Printer.Print sLinea
                          
    RsPropiedadCombo.Filter = "tCodigoPedido='" & sPedido & "' and tItem='" & RsImpresion!tItem & "' and tItemCombo='" & RsImpresion!tItemCombo & "'"
    If Not RsPropiedadCombo.EOF Then
       RsPropiedadCombo.MoveFirst
       Do While Not RsPropiedadCombo.EOF
          Printer.Print "  * " & RsPropiedadCombo!Operador & " " & RsPropiedadCombo!Descripcion
          RsPropiedadCombo.MoveNext
       Loop
    End If
                           
    If Len(Trim(RsImpresion!tObservacionCombo)) > 0 Then
       ImprimeXLinea "  ! " & Trim(RsImpresion!tObservacionCombo), 33, 4
    End If
                            
    'Final
    RsImpresion.MoveLast
    Printer.Print " "
    Printer.Print String(33, "-")
    Printer.Print "Caja     : " & sCaja & " - " & IIf(Mid(sUsuario, 1, 1) = "*", Mid(sUsuario, 2, 15), sUsuario)
    
    Printer.FontName = sFont2
    Printer.Print " "
    Printer.Print "ANULACION ITEM COMBO"
    Printer.FontName = sFont1
        
    Printer.Print
    Printer.EndDoc

End Sub

Public Sub ImprimeDelivery(RsImpresion As Recordset, RsPropiedad As Recordset, RsPropiedadCombo As Recordset, Optional Cabecera As Image, Optional pie As Image)
    On Error Resume Next
    Dim Item As String
    Dim xObservacion As String
    Dim sLinea As String
    Dim zSubTotal As Double
    Dim zImpuesto1 As Double
    Dim zImpuesto2 As Double
    Dim zImpuesto3 As Double
    Dim zTotal As Double
    Dim zDescuento As Double
    Dim zRecargo As Double
    Dim txt As String
    Dim RsPrepago As Recordset
    Dim RsDocumento As Recordset
        Dim RsOrigenVentas As Recordset
    
    Dim xRsPropiedad As ADODB.Recordset
    Dim xRsPropiedadCombo As ADODB.Recordset
    
    Isql = "SELECT dbo.TPRODUCTOPROPIEDAD.tItem, dbo.TOPERADOR.tDetallado AS Operador, dbo.TPROPIEDAD.tDetallado AS Descripcion " & _
           "FROM dbo.TPRODUCTOPROPIEDAD INNER JOIN dbo.TPROPIEDAD ON dbo.TPRODUCTOPROPIEDAD.tCodigoPropiedad = dbo.TPROPIEDAD.tCodigoPropiedad AND dbo.TPRODUCTOPROPIEDAD.tProducto = dbo.TPROPIEDAD.tProducto INNER JOIN dbo.TOPERADOR ON dbo.TPROPIEDAD.tOperador = dbo.TOPERADOR.tOperador " & _
           "where tCodigoPedido='" & sPedido & "' and TOPERADOR.lImprime=1"
    Set xRsPropiedad = Lib.OpenRecordset(Isql, Cn)
    Isql = "SELECT dbo.TCOMBOPROPIEDAD.tItem, dbo.TCOMBOPROPIEDAD.tItemCombo, dbo.TOPERADOR.tDetallado AS Operador, dbo.TPROPIEDAD.tDetallado AS Descripcion, dbo.TCOMBOPROPIEDAD.tCodigoPedido " & _
           "FROM dbo.TOPERADOR INNER JOIN dbo.TPROPIEDAD ON dbo.TOPERADOR.tOperador = dbo.TPROPIEDAD.tOperador RIGHT OUTER JOIN dbo.TCOMBOPROPIEDAD ON dbo.TPROPIEDAD.tProducto = dbo.TCOMBOPROPIEDAD.tProducto AND dbo.TPROPIEDAD.tCodigoPropiedad = dbo.TCOMBOPROPIEDAD.tCodigoPropiedad " & _
           "where tCodigoPedido='" & sPedido & "'  and TOPERADOR.lImprime=1"
    Set xRsPropiedadCombo = Lib.OpenRecordset(Isql, Cn)

    'origen de ventas----------------------------------------------------------------------------------------------------
    Isql = "select b.tDescripcion from MPEDIDO a inner join TORIGENVENTA b on b.tCodigoOrigenVenta = a.CodigoOrigenVenta where a.tCodigoPedido = '" & sPedido & "'  "
    Set RsOrigenVentas = Lib.OpenRecordset(Isql, Cn)
    sOrigenVenta = RsOrigenVentas!tDescripcion
    '---------------------------------------------------------------------------------------------------------------------

   'Configura la impresora la impresion Font
    If Not Imprimir(sPreCuenta) Then
       Exit Sub
    End If
    Printer.FontName = sFont
    Printer.FontBold = False
    
    If lImprimeImagCabPrecuenta Then
        If Cabecera <> 0 Then
        Printer.PaintPicture Cabecera, 500, Printer.CurrentY, 2860, 1600
        For p = 1 To 10
        Printer.Print
        Next p
        End If
    End If
    
    
    'Cabecera
    ImprimeXCentro sRazonSocial, 40
    ImprimeXCentro sRazonComercial, 40
    sLinea = String((40 - Len(Trim("R.U.C.: " + sRUC))) / 2, " ") & "R.U.C.: " + sRUC
    Printer.Print sLinea
    ImprimeXCentro sDireccion, 40
    sLinea = String((40 - Len(Trim("Telefono: " + sTelefono))) / 2, " ") & "Telefono: " + sTelefono
    Printer.Print sLinea
    Printer.Print
    
    If IIf(IsNull(RsImpresion!lpagoWeb), 0, Trim(RsImpresion!lpagoWeb)) = True Then
        Printer.Print "Pedido : " & sPedido & " - " & "PAGADO"
    Else
        Printer.Print "Pedido : " & sPedido
    End If
    
    'origen de ventas
    If sOrigenVenta <> "" Then
    Printer.Print "Origen de Ventas:   " & sOrigenVenta
    End If
    '--------------------------------------
    
    
    'Printer.Print "Pedido : " & sPedido
    Printer.Print "Fecha  : " & FechaServidor()
    Printer.Print "Caja   : " & sCaja & " - " & IIf(Mid(sUsuario, 1, 1) = "*", Mid(sUsuario, 2, 15), sUsuario)
    Printer.Print
    Printer.Print "Telefono   : " & Trim(RsImpresion!tTelefono)
    Printer.Print "Cliente    : " & Trim(RsImpresion!tApellido) & ", " & Trim(RsImpresion!tNombre)
    ImprimeXLinea "Cliente.Obs: " & Trim(RsImpresion!ObservacionCliente), 40, 13
    Printer.Print "Descuento  : " & Mid(Trim(RsImpresion!DESCUENTO), 1, 27)
    ImprimeXLinea "Direccion  : " & Trim(RsImpresion!tDireccion), 40, 13
    ImprimeXLinea "Referencia : " & Trim(RsImpresion!tReferencia), 40, 13
    Printer.Print "Zona       : " & Trim(RsImpresion!Zona) '& "-" & IIf(IsNull(RsImpresion!tResumido), "", Trim(RsImpresion!tResumido))
    ImprimeXLinea "Entregar a : " & IIf(IsNull(RsImpresion!tEntrega), "", Trim(RsImpresion!tEntrega)), 40, 13
    Printer.Print ""
    Printer.Print "Hora Entreg: ..........................."
    If IIf(IsNull(RsImpresion!lpagoWeb), 0, Trim(RsImpresion!lpagoWeb)) Then
    'ImprimeXLinea " : " & IIf(IsNull(RsImpresion!lpagoWeb), "", Trim(RsImpresion!lpagoWeb)), 40, 13
    End If
    
    
    ImprimeXLinea "Observacion: " & Trim(RsImpresion!tObservacion), 40, 13
    
    Printer.Print
    Printer.Print String(40, "-")
    Printer.Print "Cantid. Producto                SubTotal"
    Printer.Print String(40, "-")
        
    RsImpresion.MoveFirst
    zSubTotal = 0
    zImpuesto1 = 0
    zImpuesto2 = 0
    zImpuesto3 = 0
    zTotal = 0
    Item = ""
    
    Do While Not RsImpresion.EOF
       If Item <> RsImpresion!tItem Then
          'Impresion de Propiedades
          If lPropiedadPrecuenta Then
             xRsPropiedad.Filter = "tItem='" & Item & "'"
             If Not xRsPropiedad.EOF Then
                xRsPropiedad.MoveFirst
                Do While Not xRsPropiedad.EOF
                   Printer.Print "        * " & xRsPropiedad!Operador & " " & xRsPropiedad!Descripcion
                   xRsPropiedad.MoveNext
                Loop
             End If
                         
             'Impresion de la Observacion
             If Len(Trim(xObservacion)) > 0 Then
                ImprimeXLinea "        - " & Trim(xObservacion), 33, 2
             End If
          End If
          'printer.print
          If lPrecioNetoPrecuenta Then
            sLinea = Right(String(7, " ") & Format(RsImpresion!nCantidad, "###0.00"), 7) & " " & Mid(RsImpresion!Producto & String(19, " "), 1, 19) & " " & Right(String(12, " ") & Format(RsImpresion!nVenta - RsImpresion!nImpuesto1 - RsImpresion!nImpuesto2 - RsImpresion!nImpuesto3, "#,###,##0.00"), 12)
          Else
            sLinea = Right(String(7, " ") & Format(RsImpresion!nCantidad, "###0.00"), 7) & " " & Mid(RsImpresion!Producto & String(19, " "), 1, 19) & " " & Right(String(12, " ") & Format(RsImpresion!nVenta, "#,###,##0.00"), 12)
          End If
          Printer.Print sLinea
          zTotal = zTotal + RsImpresion!nVenta
          zImpuesto1 = zImpuesto1 + RsImpresion!nImpuesto1
          zImpuesto2 = zImpuesto2 + RsImpresion!nImpuesto2
          zImpuesto3 = zImpuesto3 + RsImpresion!nImpuesto3
          zDescuento = zDescuento + (RsImpresion!nDescuento * RsImpresion!nCantidad)
          zRecargo = zRecargo + (RsImpresion!nRecargo * RsImpresion!nCantidad)
       End If
       
       'Combos
       If lComboPrecuenta And IIf(IsNull(RsImpresion!Combo), 0, Len(Trim(RsImpresion!Combo))) > 0 Then
          sLinea = Mid("       " & Right(String(5, " ") & Format(RsImpresion!nCantidadCombo, "#0.00"), 5) & " " & RsImpresion!Combo, 1, 40)
          Printer.Print sLinea
          
          'Combos Propiedades
          If lPropiedadPrecuenta And Len(Trim(IIf(IsNull(RsImpresion!Combo), "", RsImpresion!Combo))) > 0 Then
             xRsPropiedadCombo.Filter = "tItem='" & RsImpresion!tItem & "' and tItemCombo='" & RsImpresion!tItemCombo & "'"
             If Not xRsPropiedadCombo.EOF Then
                xRsPropiedadCombo.MoveFirst
                Do While Not xRsPropiedadCombo.EOF
                    ImprimeXLinea "        * " & xRsPropiedadCombo!Operador & " " & xRsPropiedadCombo!Descripcion, 31, 10
                   'Printer.Print "        * " & xRsPropiedadCombo!Operador & " " & xRsPropiedadCombo!Descripcion
                   xRsPropiedadCombo.MoveNext
                Loop
             End If
          
             'Impresion de la Observacion
              If Len(Trim(RsImpresion!ObservacionCombo)) > 0 Then
                 ImprimeXLinea "        - " & Trim(RsImpresion!ObservacionCombo), 33, 2
              End If
          End If
       End If
       xObservacion = IIf(IsNull(RsImpresion!ObservacionDetalle), "", RsImpresion!ObservacionDetalle)
       Item = RsImpresion!tItem
       RsImpresion.MoveNext
    Loop
    
    If lPropiedadPrecuenta Then
       xRsPropiedad.Filter = "tItem='" & Item & "'"
       If Not xRsPropiedad.EOF Then
          xRsPropiedad.MoveFirst
          Do While Not xRsPropiedad.EOF
             Printer.Print "        * " & xRsPropiedad!Operador & " " & xRsPropiedad!Descripcion
             xRsPropiedad.MoveNext
          Loop
       End If
                   
       'Impresion de la Observacion
       If Len(Trim(xObservacion)) > 0 Then
          ImprimeXLinea "        - " & Trim(xObservacion), 33, 2
       End If
    End If
    
    zSubTotal = Round(zTotal - zImpuesto1 - zImpuesto2 - zImpuesto3, 2)
    zTotal = Round(zTotal, 2)
    
    Printer.Print String(40, "-")
    If zDescuento > 0 Then
       Printer.Print Right(String(27, " ") & "Descuento " & sMonN & " : ", 27) & Right(String(13, " ") & Format(zDescuento, "##,###,##0.00"), 13)
    End If
    If zRecargo > 0 Then
       Printer.Print Right(String(27, " ") & "Recargo " & sMonN & " : ", 27) & Right(String(13, " ") & Format(zRecargo, "##,###,##0.00"), 13)
    End If
    
    If lImpuestoPrecuenta Then
    'CESAR - Consumo PRECUENTA DELIVERY
        Printer.Print Right(String(27, " ") & "Valor Venta " & sMonN & " : ", 27) & Right(String(13, " ") & Format(zSubTotal, "##,###,##0.00"), 13)
        If zImpuesto1 > 0 Then
           Printer.Print Right(String(27, " ") & sImpuesto1 & " " & Format(nPorcentaje1, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(zImpuesto1, "##,###,##0.00"), 13)
        End If
           
        If zImpuesto2 > 0 Then
           Printer.Print Right(String(27, " ") & sImpuesto2 & " " & Format(nPorcentaje2, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(zImpuesto2, "##,###,##0.00"), 13)
        End If
           
        If zImpuesto3 > 0 Then
           Printer.Print Right(String(27, " ") & sImpuesto3 & " " & Format(nPorcentaje3, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(zImpuesto3, "##,###,##0.00"), 13)
        End If
     End If
        
    'Printer.Print
    If lPrecioNetoPrecuenta Then
        If lImpuestoPrecuenta Then
            Printer.Print Right(String(27, " ") & "Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(zTotal, "##,###,##0.00"), 13)
        Else
            Printer.Print Right(String(27, " ") & "Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(zSubTotal, "##,###,##0.00"), 13)
        End If
    Else
        Printer.Print Right(String(27, " ") & "Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(zTotal, "##,###,##0.00"), 13)
    End If
    
    Printer.Print
    If lPrecioNetoPrecuenta Then
        If lImpuestoPrecuenta Then
            txt = "Son " & NumeroCadena(str(zTotal)) & " " & sMonedaN
        Else
            txt = "Son " & NumeroCadena(str(zSubTotal)) & " " & sMonedaN
        End If
    Else
        txt = "Son " & NumeroCadena(str(zTotal)) & " " & sMonedaN
    End If
    ImprimeXLinea txt, 40, 5
    Printer.Print String(40, "-")
    Printer.Print ""
    Set RsDocumento = Lib.OpenRecordset("select tDocumento from DPEDIDO where tCodigoPedido='" & sPedido & "' and (isnull(tDocumento,'0') <> '0' or len(ltrim(tDocumento)) <> 0) GROUP BY tDocumento", Cn)
    If RsDocumento.RecordCount > 0 Then
       RsDocumento.MoveFirst
       
       Do While Not RsDocumento.EOF
          Set RsPrepago = Lib.OpenRecordset("select dbo.DPREPAGO.*, dbo.TTARJETACREDITO.tDetallado AS Tarjeta FROM dbo.DPREPAGO LEFT OUTER JOIN dbo.TTARJETACREDITO ON dbo.DPREPAGO.tTarjeta = dbo.TTARJETACREDITO.tCodigoTarjeta where tdocumento='" & RsDocumento!tDocumento & "'", Cn)
          If RsPrepago.RecordCount > 0 Then
             RsPrepago.MoveFirst
             Printer.Print " Documento  : " & RsDocumento!tDocumento
             Printer.Print
             Do While Not RsPrepago.EOF
                Select Case RsPrepago!tTipoPago
                       Case Is = "01" 'Efectivo
                            zTotal = RsPrepago!nMonto
                            If RsPrepago!tMoneda = "01" Then
                               Printer.Print " Efectivo   : " & Right(String(26, " ") & sMonN & " " & Format(zTotal, "##,###,##0.00"), 26)
                             Else
                               Printer.Print " Efectivo   : " & Right(String(26, " ") & sMonE & " " & Format(zTotal, "##,###,##0.00"), 26)
                            End If
                            If IIf(IsNull(RsPrepago!nvuelto), 0, RsPrepago!nvuelto) > 0 Then
                               nvuelto = RsPrepago!nvuelto
                            Else
                               nvuelto = 0
                            End If
                       
                       Case Is = "02" 'Tarjeta
                            zTotal = RsPrepago!nMonto
                            Printer.Print " T/Tarjeta  : " & Trim(RsPrepago!tarjeta)
                            Printer.Print " Numero     : " & RsPrepago!tNumero
                            Printer.Print " Fec.Vencim.: " & Left(RsPrepago!tFechaVencimiento, 2) & "/" & Right(RsPrepago!tFechaVencimiento, 2)
                            Printer.Print " Monto      : " & Right(String(26, " ") & sMonN & " " & Format(zTotal, "##,###,##0.00"), 26)
                            
                       Case Is = "03" 'cheque
                            zTotal = RsPrepago!nMonto
                            Printer.Print " Cheque Nro.: " & RsPrepago!tNumero & " Banco : " & RsPrepago!tBanco
                            Printer.Print " Monto      : " & Right(String(26, " ") & sMonN & " " & Format(zTotal, "##,###,##0.00"), 26)
                            
                       Case Is = "04" 'Documento
                            zTotal = RsPrepago!nMonto
                            Printer.Print Left(" " & Trim(Calcular("select Descripcion as Codigo from vTipoCancelacion where Codigo='" & RsPrepago!tOtroTipoPago & "'", Cn)) & Space(11), 12) & ": " & Right(String(26, " ") & sMonN & " " & Format(zTotal, "##,###,##0.00"), 26)
                       
                End Select
                'Printer.Print " "
                RsPrepago.MoveNext
             Loop
             RsPrepago.MoveLast
              zTotal = IIf(IsNull(RsPrepago!nvuelto), 0, RsPrepago!nvuelto)
             Printer.Print " Vuelto     : " & Right(String(26, " ") & sMonN & " " & Format(zTotal, "##,###,##0.00"), 26)
             'Printer.Print " Observacion: " & RsPrepago!tObservacion
              ImprimeXLinea " Observacion: " & RsPrepago!tObservacion, 40, 14
          End If
          Printer.Print String(40, "-")
          RsDocumento.MoveNext
       Loop
    End If
    
    RsImpresion.MoveLast
    If Len(LTrim(sClub)) > 0 And RsImpresion!lPuntos And RsImpresion!nDisponible > 0 Then
       ImprimeXCentro "Ud. Tiene " & Format(RsImpresion!nDisponible, "###,##0.00") & " Puntos Acumulados", 40
       Printer.Print " "
    End If
        
    ImprimeXLinea sPiePreCuenta, 40, 0
    Set xRsPropiedad = Nothing
    Set xRsPropiedadCombo = Nothing
    
    If lImprimeImagPiePrecuenta Then
        If pie <> 0 Then
            Printer.PaintPicture pie, 500, Printer.CurrentY, 2860, 1600
        End If
    End If
    
    Printer.Print
    Printer.EndDoc
End Sub

Public Sub ImprimeXLinea(Detalle As String, Ancho As Integer, Sangria As Integer)
   Dim txt As String
   Dim tOt As Integer
   Dim pri As Boolean
   Dim pos As Integer
   Dim i As Integer
   Dim j As Integer
      Dim leer As String
   txt = Detalle
   tOt = Len(txt)
   pri = True
   j = 0
   
   Do While tOt <> 0
      j = j + 1
      If pri Then
         lin = Mid(txt, 1, Ancho + 1)
      Else
         lin = Mid(txt, 1, Ancho + 1 - Sangria)
      End If

      For i = Ancho To 1 Step -1
        If pri Then
            If tOt <= Ancho Then
              pos = Ancho
              Exit For
            End If
        Else
            If tOt + Sangria <= Ancho Then
              pos = Ancho
              Exit For
            End If
        End If
        If Mid(lin, i, 1) = " " Then
           pos = i
           Exit For
        End If
      Next i

      If pri Then
         sLinea = Mid(txt, 1, IIf(pos = 0, Ancho, pos))
         pri = False
      Else
         sLinea = String(Sangria, " ") & Mid(txt, 1, pos)
      End If
      txt = Mid(txt, pos + 1, tOt)
      tOt = Len(txt)
      Printer.Print sLinea
      leer = leer + sLinea
   Loop
End Sub

Public Sub ConfGrilla(ByVal CantCol As Integer, ByVal NomGrid As Variant, ParamArray Lista())
    Dim i As Integer
    Dim Cx As TrueOleDBGrid80.Column
    
    For i = 0 To CantCol - 1
        If i = 0 Then
           NomGrid.Columns(i).Caption = Lista(i)
           NomGrid.Columns(i).HeadAlignment = Lista(i + 1)
           NomGrid.Columns(i).DataField = Lista(i + 2)
           NomGrid.Columns(i).Width = Lista(i + 3)
           NomGrid.Columns(i).Alignment = Lista(i + 4)
           NomGrid.Columns(i).ValueItems.Presentation = Lista(i + 5)
           NomGrid.Columns(i).NumberFormat = Lista(i + 6)
        Else
           Set Cx = NomGrid.Columns.Add(i)
           NomGrid.Splits(0).Columns(i).AllowSizing = False
           NomGrid.Columns(i).Visible = True
           NomGrid.Columns(i).Caption = Lista((i * 6) + i)
           NomGrid.Columns(i).HeadAlignment = Lista((i * 6) + i + 1)
           NomGrid.Columns(i).DataField = Lista((i * 6) + i + 2)
           NomGrid.Columns(i).Width = Lista((i * 6) + i + 3)
           NomGrid.Columns(i).Alignment = Lista((i * 6) + i + 4)
           NomGrid.Columns(i).ValueItems.Presentation = Lista((i * 6) + i + 5)
           NomGrid.Columns(i).NumberFormat = Lista((i * 6) + i + 6)
        End If
    Next i
End Sub

Public Sub ImprimeReciboIngreso(RsImpresion As Recordset, Optional bar As PictureBox)
    On Error Resume Next
    Dim Item As String
    Dim sLinea As String
    Dim txt As String
    Dim tOt As Integer
    Dim pri As Boolean
    Dim pos As Integer
    Dim i As Integer
    Dim j As Integer
    
    'Configura la impresora la impresion Font
    If Not Imprimir(sPreCuenta) Then
       Exit Sub
    End If
    Printer.FontName = sFont
    Printer.FontBold = False
    
    'Cabecera
    ImprimeXCentro sRazonSocial, 40
    ImprimeXCentro sRazonComercial, 40
    sLinea = String((40 - Len(Trim("R.U.C.: " + sRUC))) / 2, " ") & "R.U.C.: " + sRUC
    Printer.Print sLinea
    ImprimeXCentro sDireccion, 40
    sLinea = String((40 - Len(Trim("Telefono: " + sTelefono))) / 2, " ") & "Telefono: " + sTelefono
    Printer.Print sLinea
    Printer.Print
    
    Printer.Print "Ingreso de Caja"
    Printer.Print "Recibo    : " & RsImpresion!tRecibo
    Printer.Print "Fecha     : " & RsImpresion!fRegistro
    Printer.Print "Caja      : " & sCaja & " - " & IIf(Mid(sUsuario, 1, 1) = "*", Mid(sUsuario, 2, 15), sUsuario)
    Printer.Print "Turno     : " & RsImpresion!tTurno
    ImprimeXLinea "Autorizac.: " & Trim(RsImpresion!tAutoriza), 40, 12
    Printer.Print "Forma     : " & RsImpresion!tipoPago
    Printer.Print "Moneda    : " & IIf(RsImpresion!tMoneda = "01", sMonedaN, sMonedaE)
    Printer.Print "Referencia: " & RsImpresion!tReferencia
    Printer.Print
    Printer.Print String(40, "-")
    Printer.Print "Concepto                        SubTotal"
    Printer.Print String(40, "-")
        
    'Cuerpo
    Printer.Print
    txt = RsImpresion!tDescripcion
    tOt = Len(Trim(txt))
    pri = True
    j = 0
    Do While tOt <> 0
       j = j + 1
       lin = Mid(txt & " ", 1, 27)
       For i = 27 To 1 Step -1
           If Mid(lin, i, 1) = " " Then
              pos = i
              Exit For
           End If
       Next i
       pos = IIf(pos = 0, 27, pos)
       If pri Then
          sLinea = Mid(Mid(txt, 1, pos - 1) & String(27, " "), 1, 27) & " " & Right(String(12, " ") & Format(RsImpresion!nMonto, "#,###,##0.00"), 12)
          pri = False
       Else
          sLinea = Mid(txt, 1, pos - 1)
       End If
       txt = Mid(txt, pos + 1, tOt)
       tOt = Len(txt)
       Printer.Print sLinea
    Loop
        
    Printer.Print
    Printer.Print String(40, "-")
    Printer.Print
    txt = "Son: " & NumeroCadena(str(RsImpresion!nMonto)) & " " & IIf(RsImpresion!tMoneda = "01", sMonedaN, sMonedaE)
    ImprimeXLinea txt, 40, 4
    Printer.Print
    If lCodigoReciboIngreso Then
        Printer.PaintPicture bar, 400, Printer.CurrentY, 3800, 1000
    End If
    Printer.EndDoc
End Sub

Public Sub ImprimePreCuentaDetallada(RsImpresion As Recordset, Impresora As String, Optional Cabecera As Image, Optional pie As Image)
    On Error Resume Next
    Dim Item As String
    Dim sLinea As String
    Dim zSubTotal As Double
    Dim zImpuesto1 As Double
    Dim zImpuesto2 As Double
    Dim zImpuesto3 As Double
    Dim zTotal As Double
    Dim txt As String
    Dim Y As Integer
    'Configura la impresora la impresion Font
    If Not Imprimir(Impresora) Then
       Exit Sub
    End If
    Printer.FontName = sFont
    Printer.FontBold = False
    If lImprimeImagCabPrecuenta Then
        If Cabecera <> 0 Then
            Printer.PaintPicture Cabecera, 500, Printer.CurrentY, 2860, 1600
            For p = 1 To 10
            Printer.Print
            Next p
        End If
    End If
    
    Y = 0
    Y = Calcular("select case when lCanalCentralPedidos=1 then 1 else 0 end codigo from  vTipoPedido where Codigo='" & RsImpresion!tTipoPedido & "'", Cn)

     
    
    'Cabecera
    ImprimeXCentro sRazonSocial, 40
    ImprimeXCentro sRazonComercial, 40
    Select Case pais
        Case "001" 'Bolivia
            sLinea = String((40 - Len(Trim("N.I.T.: " + sRUC))) / 2, " ") & "N.I.T.: " + sRUC
            
        Case Else 'Peru, Ecuador
            sLinea = String((40 - Len(Trim("R.U.C.: " + sRUC))) / 2, " ") & "R.U.C.: " + sRUC
            
    End Select
    Printer.Print sLinea
    ImprimeXCentro sDireccion, 40
    If Trim(sDireccion2) <> "" Then
        ImprimeXCentro sDireccion2, 40
    End If
    sLinea = String((40 - Len(Trim("Telefono: " + sTelefono))) / 2, " ") & "Telefono: " + sTelefono
    Printer.Print sLinea
    Printer.Print
    
    Printer.Print "Pedido : " & sPedido
    Printer.Print "Fecha  : " & FechaServidor()
    
    If Calcular("SELECT ISNULL(TENTREGARA,'') codigo FROM MPEDIDO WHERE TCODIGOPEDIDO='" & RsImpresion!codigo & "'", Cn) <> "" Then
        Printer.Print "Entregar A" & Calcular("SELECT ISNULL(TENTREGARA,'') codigo FROM MPEDIDO WHERE TCODIGOPEDIDO='" & RsImpresion!codigo & "'", Cn)
    End If
    
    If Y = 1 Then
    'telefono
    Dim tcliente As String
    Dim tTelefono As String
            tcliente = Calcular("select isnull(tclientedelivery,'') codigo from mpedido where tcodigopedido='" & RsImpresion!codigo & "'", Cn)
            If tcliente <> "" And tcliente <> "0" Then
                tTelefono = Calcular("select isnull(ttelefono,'') codigo from tdelivery where tcodigodelivery='" & tcliente & "'", Cn)
                If tTelefono <> "" And tTelefono <> "0" Then
                Printer.Print "Identif   : " & tTelefono
                End If
            End If
    End If
    
    
    Printer.Print "Tipo   : " & RsImpresion!tipopedido
    Printer.Print "T/Camb.: " & Format(nTC, "###,##0.00")
    If Y = 1 Then
            If Calcular("select fprogramacion as codigo from mpedido where tcodigopedido='" & RsImpresion!codigo & "'", Cn) <> 0 Then
                    Printer.FontBold = True
                    Printer.Print
                    Printer.Print "F Entrega : " & Calcular("select fprogramacion as codigo from mpedido where tcodigopedido='" & RsImpresion!codigo & "'", Cn)
            End If
    End If
    Printer.Print
    Printer.FontBold = True
    Printer.Print "MESA   : " & IIf(RsImpresion!tMesa = "000" Or Len(Trim((RsImpresion!tMesa))) = 0, RsImpresion!tObservacion, RsImpresion!Mesa)
    Printer.FontBold = False
    Printer.Print
    Printer.Print String(40, "-")
    Printer.Print "Cantid. Producto                SubTotal"
    Printer.Print String(40, "-")
        
    RsImpresion.MoveFirst
    zSubTotal = 0
    zImpuesto1 = 0
    zImpuesto2 = 0
    zImpuesto3 = 0
    zTotal = 0
    
    Item = ""
    'Cuerpo
    Do While Not RsImpresion.EOF
       If Item <> RsImpresion!Fecha & RsImpresion!tUsuarioD Then
          If Item <> "" Then
             Printer.Print ""
          End If
          sLinea = "Fecha Cargo: " & Trim(RsImpresion!tUsuarioD) & " " & RsImpresion!Fecha
          Printer.Print sLinea
          If lPrecioNetoPrecuenta Then
            sLinea = Right(String(7, " ") & Format(RsImpresion!nCantidad, "###0.00"), 7) & " " & Mid(RsImpresion!Producto & String(19, " "), 1, 19) & " " & Right(String(12, " ") & Format(RsImpresion!nVenta - RsImpresion!nImpuesto1 - RsImpresion!nImpuesto2 - RsImpresion!nImpuesto3, "#,###,##0.00"), 12)
          Else
            sLinea = Right(String(7, " ") & Format(RsImpresion!nCantidad, "###0.00"), 7) & " " & Mid(RsImpresion!Producto & String(19, " "), 1, 19) & " " & Right(String(12, " ") & Format(RsImpresion!nVenta, "#,###,##0.00"), 12)
          End If
          Printer.Print sLinea
       Else
            If lPrecioNetoPrecuenta Then
                sLinea = Right(String(7, " ") & Format(RsImpresion!nCantidad, "###0.00"), 7) & " " & Mid(RsImpresion!Producto & String(19, " "), 1, 19) & " " & Right(String(12, " ") & Format(RsImpresion!nVenta - RsImpresion!nImpuesto1 - RsImpresion!nImpuesto2 - RsImpresion!nImpuesto3, "#,###,##0.00"), 12)
            Else
                sLinea = Right(String(7, " ") & Format(RsImpresion!nCantidad, "###0.00"), 7) & " " & Mid(RsImpresion!Producto & String(19, " "), 1, 19) & " " & Right(String(12, " ") & Format(RsImpresion!nVenta, "#,###,##0.00"), 12)
            End If
          Printer.Print sLinea
       End If
       zTotal = zTotal + RsImpresion!nVenta
       zImpuesto1 = zImpuesto1 + RsImpresion!nImpuesto1
       zImpuesto2 = zImpuesto2 + RsImpresion!nImpuesto2
       zImpuesto3 = zImpuesto3 + RsImpresion!nImpuesto3
       
       Item = RsImpresion!Fecha & RsImpresion!tUsuarioD
       RsImpresion.MoveNext
    Loop
    zSubTotal = Round(zTotal - zImpuesto1 - zImpuesto2 - zImpuesto3, 2)
    zTotal = Round(zTotal, 2)
    
    Printer.Print String(40, "-")
    Printer.Print
    If lPrecioNetoPrecuenta Then
        Printer.Print Right(String(27, " ") & "Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(zSubTotal, "##,###,##0.00"), 13)
    Else
        Printer.Print Right(String(27, " ") & "Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(zTotal, "##,###,##0.00"), 13)
    End If
    '=================Nov2010
    If lImpreEquivaPrecuenta Then
        Printer.Print Right(String(27, " ") & "Total " & sMonE & " :", 27) & Right(String(13, " ") & Format(zTotal / nTC, "##,###,##0.00"), 13)
    End If
    '=================
    
    Printer.Print
    If lPrecioNetoPrecuenta Then
        txt = "Son: " & NumeroCadena(str(zSubTotal)) & " " & sMonedaN
    Else
        txt = "Son: " & NumeroCadena(str(zTotal)) & " " & sMonedaN
    End If
    
    ImprimeXLinea txt, 40, 5
    Printer.Print
    Printer.Print String(40, "-")
        
    If lImpPropina Then
        'Printer.Print String(40, "_")
        Printer.Print '"|" & String(38, " ") & "|"
        Printer.Print '"|" & String(38, " ") & "|"
        Printer.Print " Propina(TIP) : ________________________"
        Printer.Print '"|" & String(38, " ") & "|"
        Printer.Print '"|" & String(38, " ") & "|"
        Printer.Print " Monto Total  : ________________________"
        Printer.Print '"|" & String(38, " ") & "|"
        Printer.Print '"|" & String(38, " ") & "|"
        Printer.Print '"|" & String(38, " ") & "|"
        Printer.Print '"|" & String(38, " ") & "|"
        Printer.Print '"|" & String(38, " ") & "|"
        Printer.Print '"|" & String(9, " ") & "--------------------" & String(9, " ") & "|"
        ImprimeXCentro "--------------------", 40
        'Printer.Print "|" & String(9, " ") & "    Firma Cliente   " & String(9, " ") & "|"
        ImprimeXCentro "Firma Cliente", 40
        'Printer.Print "|" & String(38, " ") & "|"
        'Printer.Print String(40, "_")
        Printer.Print String(40, "-")
    End If
    Printer.Print
    Printer.Print " Razon Social : ___________________________________"
    Printer.Print
    Printer.Print "                ___________________________________"
    Printer.Print
     Select Case pais
        Case "001" 'Bolivia
                Printer.Print " N.I.T.       : ___________________________________"
                
        Case Else 'Peru, Ecuador
                Printer.Print " R.U.C.       : ___________________________________"
     End Select
    If pais = "002" Then
        Printer.Print " Direccion    : ___________________________________"
        Printer.Print
        Printer.Print " Telefono     : ___________________________________"
    End If
    Printer.Print " "
    Printer.Print " Correo       : ________________________"
    Printer.Print " "
    Printer.Print String(40, "-")

    RsImpresion.MoveLast
    
    If RsImpresion!lPuntos And RsImpresion!nDisponible > 0 Then
       ImprimeXCentro "Ud. Tiene " & Format(RsImpresion!nDisponible, "###,##0.00") & " Puntos Acumulados", 40
       Printer.Print " "
    End If
    
    ImprimeXLinea sPiePreCuenta, 40, 0
   ' Printer.Print
    If lImprimeImagPiePrecuenta Then
        If pie <> 0 Then
            Printer.PaintPicture pie, 500, Printer.CurrentY, 2860, 1600
        End If
    End If
    Printer.EndDoc
End Sub




Public Sub ImprimeReciboEgreso(RsImpresion As Recordset)
    On Error Resume Next
    Dim Item As String
    Dim sLinea As String
    Dim txt As String
    Dim tOt As Integer
    Dim pri As Boolean
    Dim pos As Integer
    Dim i As Integer
    Dim j As Integer
    
    'Configura la impresora la impresion Font
    If Not Imprimir(sPreCuenta) Then
       Exit Sub
    End If
    Printer.FontName = sFont
    Printer.FontBold = False
    
    'Cabecera
    ImprimeXCentro sRazonSocial, 40
    ImprimeXCentro sRazonComercial, 40
    sLinea = String((40 - Len(Trim("R.U.C.: " + sRUC))) / 2, " ") & "R.U.C.: " + sRUC
    Printer.Print sLinea
    ImprimeXCentro sDireccion, 40
    sLinea = String((40 - Len(Trim("Telefono: " + sTelefono))) / 2, " ") & "Telefono: " + sTelefono
    Printer.Print sLinea
    Printer.Print

    Printer.Print "Egreso de Caja"
    Printer.Print "Recibo    : " & RsImpresion!tRecibo
    Printer.Print "Tipo Egr. : " & RsImpresion!tipoEgreso
    Printer.Print "Fecha     : " & RsImpresion!fRegistro
    Printer.Print "Caja      : " & sCaja & " - " & IIf(Mid(sUsuario, 1, 1) = "*", Mid(sUsuario, 2, 15), sUsuario)
    Printer.Print "Turno     : " & RsImpresion!tTurno
    ImprimeXLinea "Autorizac.: " & Trim(RsImpresion!tAutoriza), 40, 12
    Printer.Print "Moneda    : " & IIf(RsImpresion!tMoneda = "01", sMonedaN, sMonedaE)
 
    Printer.Print
    Printer.Print String(40, "-")
    Printer.Print "Concepto                        SubTotal"
    Printer.Print String(40, "-")
        
    'Cuerpo
    Printer.Print
    txt = RsImpresion!tDescripcion
    tOt = Len(Trim(txt))
    pri = True
    j = 0
    Do While tOt <> 0
       j = j + 1
       lin = Mid(txt & " ", 1, 27)
       For i = 27 To 1 Step -1
           If Mid(lin, i, 1) = " " Then
              pos = i
              Exit For
           End If
       Next i
       pos = IIf(pos = 0, 27, pos)
       If pri Then
          sLinea = Mid(Mid(txt, 1, pos - 1) & String(27, " "), 1, 27) & " " & Right(String(12, " ") & Format(RsImpresion!nMonto, "#,###,##0.00"), 12)
          pri = False
       Else
          sLinea = Mid(txt, 1, pos - 1)
       End If
       txt = Mid(txt, pos + 1, tOt)
       tOt = Len(txt)
       Printer.Print sLinea
    Loop
        
    Printer.Print
    Printer.Print String(40, "-")
    Printer.Print
    Printer.Print
    Printer.Print String(25, " ") & String(15, "-")
    Printer.Print String(25, " ") & "     FIRMA"
    Printer.Print
    txt = "Son: " & NumeroCadena(str(RsImpresion!nMonto)) & " " & IIf(RsImpresion!tMoneda = "01", sMonedaN, sMonedaE)
    ImprimeXLinea txt, 40, 4
    Printer.Print
    Printer.EndDoc
End Sub


Public Sub ImprimeXCentro(Detalle As String, Ancho As Integer)
'   Dim txt As String
'   Dim tOt As Integer
'   Dim pri As Boolean


   Dim txt As String
   Dim tOt As Integer
   Dim pri As Boolean
   Dim pos As Integer
   Dim i As Integer
   Dim j As Integer
   Dim leer As String
   
   txt = Detalle
   tOt = Len(txt)
   pri = True
   j = 0

   Do While tOt <> 0
      j = j + 1
      If pri Then
         lin = Mid(txt, 1, Ancho + 1)
      Else
         lin = Mid(txt, 1, Ancho + 1 - Sangria)
      End If
        
        'pos = InStr(1, Detalle, " ", vbTextCompare)

      For i = Ancho To 1 Step -1
        If pri Then
            If tOt <= Ancho Then
              pos = Ancho
              Exit For
            End If
        Else
            If tOt + Sangria <= Ancho Then
              pos = Ancho
              Exit For
            End If
        End If
        If Mid(lin, i, 1) = " " Then
           pos = i
           Exit For
        End If
      Next i

      If pri Then
         sLinea = Mid(txt, 1, IIf(pos = 0, Ancho, pos))
         pri = False
      Else
         sLinea = String(Sangria, " ") & Mid(txt, 1, pos)
      End If
      txt = Mid(txt, pos + 1, tOt)
      tOt = Len(txt)
      Printer.Print String((Ancho - Len(Trim(sLinea))) / 2, " ") & sLinea
      'Printer.Print sLinea
      leer = leer + sLinea
   Loop
End Sub

Public Sub Seguridad(formulario As Form)
   Dim RsModulo As Recordset
   Set RsModulo = Lib.OpenRecordset("select * from TMODULOGRUPO where tFormulario='" & formulario.Name & "' and tModulo='" & sModulo & "' and tGrupoUsuario='" & sGrupoUsuario & "'", Cn)
   If RsModulo.RecordCount > 0 Then
      For Each Control In formulario.Controls
          RsModulo.MoveFirst
          RsModulo.Find ("tObjeto='" & Control.Name & "'")
          If Not RsModulo.EOF Then
             Control.Enabled = False
          End If
      Next Control
   End If
   Set RsModulo = Nothing
End Sub

'Public Function CambioUsuario() As Boolean
'    Dim RsPW As Recordset
'
'    Set RsPW = Lib.OpenRecordset("select * from TUSUARIO where lActivo = 1", Cn)
'    If RsPW.RecordCount = 0 Then
'       Set RsPW = Nothing
'       CambioUsuario = False
'       Exit Function
'    End If
'    frmPassword.Show vbModal
'    If Not wEnter Then
'       Set RsPW = Nothing
'       CambioUsuario = False
'       Exit Function
'    End If
'
'    RsPW.MoveFirst
'    Do While Not RsPW.EOF
'       If sDescrip = Desencapsula(RsPW!tPassword) Then
'          sUsuario = RsPW!tResumido
'          CambioUsuario = True
'          Set RsPW = Nothing
'          Exit Function
'       End If
'       RsPW.MoveNext
'    Loop
'    CambioUsuario = False
'    Set RsPW = Nothing
'End Function

Public Sub Centrar(frmNombre As Form)
    With frmNombre
        .Left = (Screen.Width - .Width) / 2
        .Top = (Screen.Height - .Height) / 2
    End With
End Sub

Public Sub ImprimeInfhotel(RsImpresion As Recordset, Impresora As String, Optional Cabecera As Image, Optional pie As Image)
    On Error Resume Next
    Dim Item As String
    Dim sLinea As String
    Dim zSubTotal As Double
    Dim zImpuesto1 As Double
    Dim zImpuesto2 As Double
    Dim zImpuesto3 As Double
    Dim zTotal As Double
    Dim txt As String
    Dim tCompania As String
    Dim nExonerado As Integer

    Dim xRsPropiedad As ADODB.Recordset
    Dim xRsPropiedadCombo As ADODB.Recordset
    
    '0035-2013 CESAR
    Dim zGTotal As Double
    '---CESAR IMP
    Dim imp1 As Double
    Dim imp2 As Double
    Dim impxT As Double
    Dim impx1 As Double
    Dim impx2 As Double
    Dim impG As Double
    Dim xDescuento As Double
    Dim xRecargo As Double
    Dim xSubTotal As Double
    Dim xDiferencia As Double
    Dim xAumento As Double
    
    imp1 = Calcular("select ISNULL(Impuesto1,0) as Codigo from TPARAMETRO", Cn)
    imp2 = Calcular("select ISNULL(Impuesto2,0) as Codigo from TPARAMETRO", Cn)
    impxT = 1 + (imp1 / 100) + (imp2 / 100)
    impx1 = 1 + (imp1 / 100)
    impx2 = 1 + (imp2 / 100)
    lPrecioNetoPrecuenta = Calcular("select ISNULL(lPrecioNetoPrecuenta,0) as Codigo from TCAJA where tCaja = '" & sCaja & "' ", Cn)
    '------------------
    
    
    
    Isql = "SELECT dbo.TPRODUCTOPROPIEDAD.tItem, dbo.TOPERADOR.tDetallado AS Operador, dbo.TPROPIEDAD.tDetallado AS Descripcion " & _
           "FROM dbo.TPRODUCTOPROPIEDAD INNER JOIN dbo.TPROPIEDAD ON dbo.TPRODUCTOPROPIEDAD.tCodigoPropiedad = dbo.TPROPIEDAD.tCodigoPropiedad AND dbo.TPRODUCTOPROPIEDAD.tProducto = dbo.TPROPIEDAD.tProducto INNER JOIN dbo.TOPERADOR ON dbo.TPROPIEDAD.tOperador = dbo.TOPERADOR.tOperador " & _
           "where tCodigoPedido='" & sPedido & "' and TOPERADOR.lImprime=1 Order by dbo.TOPERADOR.nBoton"
    Set xRsPropiedad = Lib.OpenRecordset(Isql, Cn)
    
    Isql = "SELECT dbo.TCOMBOPROPIEDAD.tItem, dbo.TCOMBOPROPIEDAD.tItemCombo, dbo.TOPERADOR.tDetallado AS Operador, dbo.TPROPIEDAD.tDetallado AS Descripcion, dbo.TCOMBOPROPIEDAD.tCodigoPedido " & _
           "FROM dbo.TOPERADOR INNER JOIN dbo.TPROPIEDAD ON dbo.TOPERADOR.tOperador = dbo.TPROPIEDAD.tOperador RIGHT OUTER JOIN dbo.TCOMBOPROPIEDAD ON dbo.TPROPIEDAD.tProducto = dbo.TCOMBOPROPIEDAD.tProducto AND dbo.TPROPIEDAD.tCodigoPropiedad = dbo.TCOMBOPROPIEDAD.tCodigoPropiedad " & _
           "where tCodigoPedido='" & sPedido & "'  and TOPERADOR.lImprime=1 Order by dbo.TOPERADOR.nBoton"
    Set xRsPropiedadCombo = Lib.OpenRecordset(Isql, Cn)
    
    

    'Configura la impresora la impresion Font
    If Not Imprimir(Impresora) Then
       Exit Sub
    End If
    
    Printer.FontName = sFont
    Printer.FontBold = False
    Dim p As Integer
 
    
    If lImprimeImagCabPrecuenta Then
        If Cabecera <> 0 Then
           Printer.PaintPicture Cabecera, 500, Printer.CurrentY, 2860, 1600
            For p = 1 To 10
            Printer.Print
            Next p
        End If
    End If
    ImprimeXCentro sRazonSocial, 40
    ImprimeXCentro sRazonComercial, 40
    Select Case pais
        Case "001" 'Bolivia
            ImprimeXCentro "N.I.T.: " & sRUC, 40
        Case Else 'Peru, Ecuador
            ImprimeXCentro "R.U.C.: " & sRUC, 40
    End Select
    ImprimeXCentro sDireccion, 40
    ImprimeXCentro "Telefono: " & sTelefono, 40
    Printer.Print
    
    tCompania = Calcular("select tCodigoCompania as Codigo from MRESERVA where tCodigoReserva='" & sReserva & "'", CnInfhotel)
    
    If tCompania = "99999" Then
       nExonerado = Calcular("SELECT count(tCodigoPasajero) as Codigo FROM TEXONERACIONPASAJERO where tCodigoPasajero='" & sFichaPasajero & "' and tCodigoExoneracion ='01'", CnInfhotel)
       If nExonerado > 0 Then
          ImprimeXCentro "DETALLE DE CONSUMO", 40
          Printer.Print ""
       End If
    Else
       nExonerado = Calcular("SELECT COUNT(tCodigoReserva) AS Codigo FROM dbo.MPASAJERO LEFT OUTER JOIN dbo.TEXONERACIONPASAJERO ON dbo.MPASAJERO.tCodigoPasajero = dbo.TEXONERACIONPASAJERO.tCodigoPasajero where tCodigoReserva='" & sReserva & "' and tCodigoExoneracion ='01'", CnInfhotel)
       If nExonerado > 0 Then
          ImprimeXCentro "DETALLE DE CONSUMO - PAQUETE TURISTICO", 40
          Printer.Print ""
       End If
    End If
    
    Printer.Print "Pedido   : " & sPedido
    Printer.Print "Fecha    : " & FechaServidor()
    Printer.Print "Tipo     : " & RsImpresion!tipopedido
    Printer.Print "Caja     : " & sCaja & " - " & IIf(Mid(sUsuario, 1, 1) = "*", Mid(sUsuario, 2, 15), sUsuario)
    Printer.Print "Mesero   : " & RsImpresion!Mozo
    Printer.Print "Cliente  : " & Mid(RsImpresion!Cliente, 1, 28)
    If Calcular("SELECT ISNULL(TENTREGARA,'') codigo FROM MPEDIDO WHERE TCODIGOPEDIDO='" & RsImpresion!codigo & "'", Cn) <> "" Then
        Printer.Print "Entregar A" & Calcular("SELECT ISNULL(TENTREGARA,'') codigo FROM MPEDIDO WHERE TCODIGOPEDIDO='" & RsImpresion!codigo & "'", Cn)
    End If
    Printer.Print "Descuento : " & Mid(Trim(RsImpresion!DESCUENTO), 1, 28)
    ImprimeXLinea "Observac.: " & IIf(IsNull(RsImpresion!tObservacion), "", Trim(RsImpresion!tObservacion)), 33, 12
    Printer.Print
    Printer.FontBold = True
    ImprimeXLinea "MESA     : " & IIf(IsNull(RsImpresion!Mesa), "", Trim(RsImpresion!Mesa)), 33, 12
    Printer.FontBold = False
    
    Printer.Print
    Printer.Print String(40, "-")
    Printer.Print "Cantid. Producto                SubTotal"
    Printer.Print String(40, "-")
        
    RsImpresion.MoveFirst
    zSubTotal = 0
    zImpuesto1 = 0
    zImpuesto2 = 0
    zImpuesto3 = 0
    zDescuento = 0
    zRecargo = 0
    zTotal = 0
    
    'CESAR IMP
    xDescuento = (xDescuento / 100)
    xSubTotal = 0
    '-------
    
    Item = ""
    'Cuerpo
    Do While Not RsImpresion.EOF
       If Item <> RsImpresion!tItem Then
          'Impresion de Propiedades
          If lPropiedadPrecuenta Then
             xRsPropiedad.Filter = "tItem='" & Item & "'"
             If Not xRsPropiedad.EOF Then
                xRsPropiedad.MoveFirst
                Do While Not xRsPropiedad.EOF
                   Printer.Print "        * " & xRsPropiedad!Operador & " " & xRsPropiedad!Descripcion
                   xRsPropiedad.MoveNext
                Loop
             End If
                         
             'Impresion de la Observacion
             If lObservacionPrecuenta And Len(Trim(xObservacion)) > 0 Then
                ImprimeXLinea "        - " & Trim(xObservacion), 33, 2
             End If
          End If
          
          '---CESAR IMP
            If RsImpresion!nImpuesto1 > 0 And RsImpresion!nImpuesto2 > 0 Then
                  impG = impxT
            ElseIf RsImpresion!nImpuesto1 > 0 And RsImpresion!nImpuesto2 = 0 Then
                  impG = impx1
            ElseIf RsImpresion!nImpuesto1 = 0 And RsImpresion!nImpuesto2 > 0 Then
                  impG = impx2
            Else
                  impG = 1
            End If
          
          
          
          If lPrecioNetoPrecuenta Then
              'sLinea = Right(String(7, " ") & Format(RsImpresion!nCantidad, "###0.00"), 7) & " " & Mid(RsImpresion!Producto & String(19, " "), 1, 19) & " " & IIf(sTipoComanda <> "02" Or sTipoComanda = "", Right(String(12, " ") & Format(RsImpresion!nVenta - RsImpresion!nImpuesto1 - RsImpresion!nImpuesto2 - RsImpresion!nImpuesto3, "#,###,##0.00"), 12), "")
               sLinea = Right(String(7, " ") & Format(RsImpresion!nCantidad, "###0.00"), 7) & " " & Mid(RsImpresion!Producto & String(19, " "), 1, 19) & " " & IIf(sTipoComanda <> "02" Or sTipoComanda = "", Right(String(12, " ") & Format((RsImpresion!nPrecioOficial * RsImpresion!nCantidad) / impG, "#,###,##0.00"), 12), "")
          Else
            
                If IsNull(RsImpresion!tOferta) Or RsImpresion!tOferta = "" Then
                   sLinea = Right(String(7, " ") & Format(RsImpresion!nCantidad, "###0.00"), 7) & " " & Mid(RsImpresion!Producto & String(19, " "), 1, 19) & " " & IIf(sTipoComanda <> "02" Or sTipoComanda = "", Right(String(12, " ") & Format(RsImpresion!nPrecioOficial * RsImpresion!nCantidad, "#,###,##0.00"), 12), "")
                Else
                   sLinea = Right(String(7, " ") & Format(RsImpresion!nCantidad, "###0.00"), 7) & " " & Mid(RsImpresion!Producto & String(19, " "), 1, 19)
                   Printer.Print sLinea
                   sLinea = String(8, " ") & Mid(RsImpresion!tOferta & String(19, " "), 1, 19) & " " & IIf(sTipoComanda <> "02" Or sTipoComanda = "", Right(String(12, " ") & Format(RsImpresion!nPrecioOficial * RsImpresion!nCantidad, "#,###,##0.00"), 12), "")
                End If
            
           End If
          
          Printer.Print sLinea
          zGTotal = zGTotal + (RsImpresion!nPrecioOficial * RsImpresion!nCantidad)
          zTotal = zTotal + RsImpresion!nVenta
          zImpuesto1 = zImpuesto1 + RsImpresion!nImpuesto1
          zImpuesto2 = zImpuesto2 + RsImpresion!nImpuesto2
          zImpuesto3 = zImpuesto3 + RsImpresion!nImpuesto3
          
          '---CESAR IMP
          xDiferencia = ((RsImpresion!nPrecioOficial * RsImpresion!nCantidad) / impG) - (RsImpresion!nVenta - RsImpresion!nImpuesto1 - RsImpresion!nImpuesto2)
          xDescuento = xDescuento + xDiferencia
          xAumento = (RsImpresion!nVenta - RsImpresion!nImpuesto1 - RsImpresion!nImpuesto2) - ((RsImpresion!nPrecioOficial * RsImpresion!nCantidad) / impG)
          xRecargo = xRecargo + xAumento
          xSubTotal = xSubTotal + ((RsImpresion!nPrecioOficial * RsImpresion!nCantidad) / impG)
          '------------
          zDescuento = zDescuento + (RsImpresion!nDescuento * RsImpresion!nCantidad)
          zRecargo = zRecargo + (RsImpresion!nRecargo * RsImpresion!nCantidad)
       End If
       '
       'Combos
       If lComboPrecuenta And IIf(IsNull(RsImpresion!Combo), 0, Len(Trim(RsImpresion!Combo))) > 0 Then
          sLinea = Mid("       " & Right(String(5, " ") & Format(RsImpresion!nCantidadCombo, "#0.00"), 5) & " " & RsImpresion!Combo, 1, 40)
          Printer.Print sLinea
          
          'Combos Propiedades
          If lPropiedadPrecuenta And Len(Trim(IIf(IsNull(RsImpresion!Combo), "", RsImpresion!Combo))) > 0 Then
             xRsPropiedadCombo.Filter = "tItem='" & RsImpresion!tItem & "' and tItemCombo='" & RsImpresion!tItemCombo & "'"
             If Not xRsPropiedadCombo.EOF Then
                xRsPropiedadCombo.MoveFirst
                Do While Not xRsPropiedadCombo.EOF
                    ImprimeXLinea "        * " & xRsPropiedadCombo!Operador & " " & xRsPropiedadCombo!Descripcion, 31, 10
                   'Printer.Print "        * " & xRsPropiedadCombo!Operador & " " & xRsPropiedadCombo!Descripcion
                   xRsPropiedadCombo.MoveNext
                Loop
             End If
          
             'Impresion de la Observacion
              If lObservacionPrecuenta And Len(Trim(RsImpresion!tObservacionCombo)) > 0 Then
                 ImprimeXLinea "        - " & Trim(RsImpresion!tObservacionCombo), 33, 2
              End If
          End If
       End If
       xObservacion = IIf(IsNull(RsImpresion!tObservacionPedido), "", RsImpresion!tObservacionPedido)
       Item = RsImpresion!tItem
       RsImpresion.MoveNext
    Loop


        
        
        

    If lPropiedadPrecuenta Then
       xRsPropiedad.Filter = "tItem='" & Item & "'"
       If Not xRsPropiedad.EOF Then
          xRsPropiedad.MoveFirst
          Do While Not xRsPropiedad.EOF
             Printer.Print "        * " & xRsPropiedad!Operador & " " & xRsPropiedad!Descripcion
             xRsPropiedad.MoveNext
          Loop
       End If
                   
       'Impresion de la Observacion
       If lObservacionPrecuenta And Len(Trim(xObservacion)) > 0 Then
          ImprimeXLinea "        - " & Trim(xObservacion), 33, 2
       End If
    End If
    
    If sTipoComanda = "01" Or sTipoComanda = "" Then
        zSubTotal = Round(zTotal - zImpuesto1 - zImpuesto2 - zImpuesto3, 2)
        zTotal = Round(zTotal, 2)
        
        Printer.Print String(40, "-")
        RsImpresion.MoveLast
        
        'CESAR IPM impresion subTotal
        If lPrecioNetoPrecuenta Then
           Printer.Print Right(String(27, " ") & "Sub Total : ", 27) & Right(String(13, " ") & Format(xSubTotal, "##,###,##0.00"), 13)
        Else
           Printer.Print Right(String(27, " ") & "Sub Total : ", 27) & Right(String(13, " ") & Format(zGTotal, "##,###,##0.00"), 13)
        End If
        
        If zDescuento > 0 Then
           Printer.Print
           If lPrecioNetoPrecuenta Then
                Printer.Print Right(String(27, " ") & "Descuento : ", 27) & Right(String(13, " ") & Format(xDescuento, "##,###,##0.00"), 13)
           Else
                Printer.Print Right(String(27, " ") & "Descuento : ", 27) & Right(String(13, " ") & Format(zDescuento, "##,###,##0.00"), 13)
           End If
        End If
        '------------------------
        
        
        If zRecargo > 0 Then
           Printer.Print
           If lPrecioNetoPrecuenta Then
                Printer.Print Right(String(27, " ") & "Recargo : ", 27) & Right(String(13, " ") & Format(xRecargo, "##,###,##0.00"), 13)
           Else
                Printer.Print Right(String(27, " ") & "Recargo : ", 27) & Right(String(13, " ") & Format(zRecargo, "##,###,##0.00"), 13)
           End If
        End If
        
        If RsImpresion!tTipoPedido = "03" Then
           Printer.Print
           Printer.Print Right(String(27, " ") & sBoton3 & " :", 27) & Right(String(13, " ") & Format(zTotal - (zTotal / (1 + (nLlevar / 100))), "##,###,##0.00"), 13)
        End If
        
        'CESAR IMP impuestos
        If lImpuestoPrecuenta Then
            If zImpuesto1 > 0 Then
               Printer.Print Right(String(27, " ") & sImpuesto1 & " " & Format(nPorcentaje1, "##0.00") & "% : ", 27) & Right(String(13, " ") & Format(zImpuesto1, "##,###,##0.00"), 13)
            End If
               
            If zImpuesto2 > 0 Then
               Printer.Print Right(String(27, " ") & sImpuesto2 & " " & Format(nPorcentaje2, "##0.00") & "% : ", 27) & Right(String(13, " ") & Format(zImpuesto2, "##,###,##0.00"), 13)
            End If
               
            If zImpuesto3 > 0 Then
               Printer.Print Right(String(27, " ") & sImpuesto3 & " " & Format(nPorcentaje3, "##0.00") & "% : ", 27) & Right(String(13, " ") & Format(zImpuesto3, "##,###,##0.00"), 13)
            End If
         End If
        '---------------
        
        Printer.Print " "
        Printer.Print Right(String(27, " ") & "Total " & sMonN & " :", 27) & Right(String(13, " ") & Format(zTotal, "##,###,##0.00"), 13)
        'CarlosD 01/12/2006
        If lEquivalencia = True Then
        Printer.Print " "
        Printer.Print Right(String(27, " ") & "Total " & sMonE & " :", 27) & Right(String(13, " ") & Format(zTotal / nTC, "##,###,##0.00"), 13)
        End If

        Printer.Print
        txt = "Son: " & NumeroCadena(str(zTotal)) & " " & sMonedaN
        ImprimeXLinea txt, 40, 5
    End If
    Printer.Print
    Printer.Print String(40, "-")
    Printer.Print
    Printer.Print " Razon Social : ________________________"
    Printer.Print
    Select Case pais
        Case "001" 'Bolivia
            Printer.Print " N.I.T.       : ________________________"
        Case Else 'Peru, Ecuador
            Printer.Print " R.U.C.       : ________________________"
    End Select
    Printer.Print
    If RsImpresion!tComanda = "" Or IsNull(RsImpresion!tComanda) Then
       Printer.Print " Comanda      : ________________________"
    Else
       Printer.Print " Comanda      : " & RsImpresion!tComanda
    End If
    If sTipoComanda <> "" Then
        If sTipoComanda = "01" Then
            Printer.Print
            Printer.Print " Tipo         : Facturable"
        Else
            Printer.Print
            Printer.Print " Tipo         : Incluido "
        End If
    End If
    
    If Mid(RsImpresion!tObservacion, 1, 3) = "Hab" Then
        Printer.Print
        If RsImpresion!tHabitacion = "" Then
           Printer.Print " Habitacion   : ________________________"
        Else
           Printer.Print " Habitacion   : " & RsImpresion!tHabitacion
        End If
        Printer.Print
        If RsImpresion!tPasajero = "" Then
           Printer.Print " Pasajero     : ________________________"
        Else
           Printer.Print " Pasajero     : " & Mid(RsImpresion!tPasajero, 1, 24)
        End If
    ElseIf Mid(RsImpresion!tObservacion, 1, 3) = "Res" Then
        Printer.Print
        If RsImpresion!tReserva = "" Then
           Printer.Print " Reserva      : ________________________"
        Else
           Printer.Print " Reserva      : " & RsImpresion!tReserva
           Dim RsReserva As Recordset
           Set RsReserva = Lib.OpenRecordset("select tGrupo, tCodigoCompania from MRESERVA where tCodigoReserva='" & RsImpresion!tReserva & "'", CnInfhotel)
           If RsReserva.RecordCount > 0 Then
              RsReserva.MoveFirst
              Printer.Print " Nombre       : " & RsReserva!tgrupo
              Printer.Print " Paga Compañia: " & Calcular("select tRazonSocialCompania as Codigo from TCOMPANIA where tCodigoCompania='" & RsReserva!tCodigoCompania & "'", CnInfhotel)
           End If
        End If
        Printer.Print
        If RsImpresion!tPasajero = "" Then
           Printer.Print " Pasajero     : ________________________"
        Else
           Printer.Print " Pasajero     : " & Mid(RsImpresion!tPasajero, 1, 24)
        End If
    End If
    
    Printer.Print " "
    If Val(sPropina) > 0 Then
        Printer.Print " Propina / Tip: " & _
        IIf(sMonPropina <> "02", "S/.", "U$.") & " " & _
        IIf(sPropina = 0, "____________________", Format(sPropina, "##,###,##0.00"))
    Else
        Printer.Print " Propina / Tip: ________________________"
    End If
    Printer.Print " "
    Printer.Print String(40, "-")
    Printer.Print
    
    If nExonerado > 0 Then
       If tCompania = "99999" Then
          Printer.Print "Datos del Pasajero"
          Printer.Print
          ImprimeXLinea "Nombre   : " & Calcular("select ltrim(tNombre) + ' ' + ltrim(tPaterno) + ' ' + ltrim(tMaterno) as Codigo from MPASAJERO where tCodigoPasajero='" & sFichaPasajero & "' and tCodigoReserva='" & sReserva & "'", CnInfhotel), 33, 11
          ImprimeXLinea "Documento: " & Calcular("select tDocumento as Codigo from MPASAJERO where tCodigoPasajero='" & sFichaPasajero & "' and tCodigoReserva='" & sReserva & "'", CnInfhotel), 33, 11
       Else
          Printer.Print "Datos de la Compania"
          Printer.Print
          ImprimeXLinea "R. Social: " & Calcular("select tRazonSocialCompania as Codigo from TCOMPANIA where tCodigoCompania='" & tCompania & "'", CnInfhotel), 33, 11
          Printer.Print "Id.Tribut: " & Calcular("select tCodigoTributario as Codigo from TCOMPANIA where tCodigoCompania='" & tCompania & "'", CnInfhotel)
       End If
    End If
    
    Printer.Print
    Printer.Print
    Printer.Print
    Printer.Print "         __________________________"
    Printer.Print "                    Firma          "
    Printer.Print
        
    txt = Calcular("SELECT dbo.TEXONERACION.mMensajeEmite as Codigo FROM dbo.MPASAJERO INNER JOIN dbo.TEXONERACIONPASAJERO ON dbo.MPASAJERO.tCodigoPasajero = dbo.TEXONERACIONPASAJERO.tCodigoPasajero INNER JOIN dbo.TEXONERACION ON dbo.TEXONERACIONPASAJERO.tCodigoExoneracion = dbo.TEXONERACION.tCodigoExoneracion where tCodigoReserva='" & RsImpresion!tReserva & "' and tNumeroHabitacion='" & RsImpresion!tHabitacion & "'", CnInfhotel)
    If txt <> "0" And txt <> "" Then
       ImprimeXCentro txt, 40
    End If
    
    ImprimeXCentro sPiePreCuenta, 40
    
    
    If lImprimeImagPiePrecuenta Then
        If pie <> 0 Then
              Printer.PaintPicture pie, 500, Printer.CurrentY, 2860, 1600
        End If
    End If
    Printer.EndDoc
End Sub



Sub InicializaGrilla(NombGrilla As Variant)
    Dim Cx As TrueOleDBGrid80.Column
    
    NombGrilla.Columns.Clear
    Set Cx = NombGrilla.Columns.Add(0)
    NombGrilla.Columns(0).Visible = True
End Sub

Public Sub ImprimeGuiaTransporte(RsImpresion As Recordset, Empresa As String)
    On Error Resume Next
    Dim Item As String
    Dim sLinea As String
    Dim sNum As String
    Dim i As Integer
    Dim xproducto As String
    'Cabecera
    Printer.PaperSize = vbPRPSUser
    Printer.Orientation = vbPRORPortrait
    RsImpresion.MoveFirst
    
    Select Case Empresa
           Case Is = "000" 'Estandar
                 For i = 1 To nCabeceraGuia
                     Printer.Print
                 Next i
                 
                 Printer.Print "       " & RsImpresion!tGuiaTransporte
                 Printer.Print
                 Printer.Print "Fecha : " & Format(RsImpresion!fRegistro, "dd MMMM yyyy")
                 Printer.Print
                 Printer.Print Left("Destinatario : " & RsImpresion!Destinatario & String(60, " "), 60) & " " & Left("Punto de Partida : " & sDireccion, 50)
                 Printer.Print Left("RUC          : " & RsImpresion!Identidad & String(60, " "), 60) & " " & Left("Punto de Llegada : " & IIf(RsImpresion!Tienda = "", RsImpresion!direccion, RsImpresion!DireccionTienda), 50)
                 Printer.Print
                 Printer.Print "Datos del Transportista                                     Datos de la Unidad de Transporte y Conductor"
                 Printer.Print Left("Transportista : " & RsImpresion!Transportista & String(60, " "), 60) & " " & Left("Marca y Placa : " & RsImpresion!Marca & " " & RsImpresion!Placa, 50)
                 Printer.Print Left("RUC           : " & RsImpresion!IdentidadTransportista & String(60, " "), 60) & " " & Left("Licencia      : " & RsImpresion!Licencia, 50)
                  
                 For i = 1 To nDetalleGuia
                     Printer.Print
                 Next i
                                  
                 'Cuerpo
                 Item = ""
                 i = 0
                 j = 0
                 
                 Do While Not RsImpresion.EOF
                    If RsImpresion!lImprimeResumen Then
                        xproducto = RsImpresion!tDetallado
                    Else
                        xproducto = RsImpresion!tResumido
                    End If
                    i = i + 1
                    sLinea = RsImpresion!tItem & "   " & Left(xproducto & String(40, " "), 40) & "  " & Right(String(7, " ") & Format(RsImpresion!nCantidad, "###0.00"), 7) & "   " & Right(String(8, " ") & Format(RsImpresion!nprecioVenta, "#,##0.00"), 8) & "   " & Right(String(9, " ") & Format(RsImpresion!nVenta, "##,##0.00"), 9)
                    Printer.Print sLinea
                    RsImpresion.MoveNext
                 Loop
                 
                 For j = i To nFItem
                     Printer.Print " "
                 Next j
                 
           Case Is = "005" 'Ancel
                 For i = 1 To 9
                     Printer.Print
                 Next i
                 
                 Printer.Print "       " & RsImpresion!tGuia
                 Printer.Print "       " & Mid(Format(RsImpresion!fRegistro, "dd        MMMM ") & String(20, " "), 1, 20) & "       " & Mid(Format(RsImpresion!fRegistro, "yy"), 2, 1)
                 Printer.Print
                 Printer.Print "          " & Mid(RsImpresion!Destinatario & String(50, " "), 1, 50) & String(17, " ") & RsImpresion!RUCDESTINATARIO
                 Printer.Print
                 Printer.Print "                " & Mid(RsImpresion!tDomicilioPartida & String(40, " "), 1, 40) & String(2, " ") & Mid(RsImpresion!DireccionDestinatario, 1, 38)
                 Printer.Print " "
                 Printer.Print " "
                 Printer.Print " "

                 Printer.Print
                 Printer.Print
                 Printer.Print " " & Mid(RsImpresion!Transportista & String(38, " "), 1, 38) & String(2, " ") & Mid(RsImpresion!DireccionTransportista & String(33, " "), 1, 33) & String(2, " ") & Mid(RsImpresion!RUCTransportista & String(15, " "), 1, 15)
                 Printer.Print
                 Printer.Print
                 Printer.Print
                 Printer.Print
                 
                 'Cuerpo
                 Item = ""
                 i = 0
                 j = 0
                 
                 Do While Not RsImpresion.EOF
                    i = i + 1
                    sLinea = " " & Mid(RsImpresion!codigoProducto & String(12, "  "), 1, 12) & "   " & Mid(RsImpresion!Producto & String(40, " "), 1, 40) & Right(String(7, " ") & Format(RsImpresion!nCantidad, "###0.00"), 7) & " " & String(6, "  ") & Mid(RsImpresion!tUnidad, 1, 4)
                    Printer.Print sLinea
                    RsImpresion.MoveNext
                 Loop
                 
                 For j = i To nFItem
                     Printer.Print " "
                 Next j

                 RsImpresion.MoveLast
                 Printer.Print String(6, " ") & "Chofer     : " & Mid(RsImpresion!Chofer & String(20, " "), 1, 20) & Mid("  Lic  : " & RsImpresion!Licencia & String(20, " "), 1, 20)
                 Printer.Print String(6, " ") & "Placa      : " & Mid(RsImpresion!Vehiculo & String(20, " "), 1, 20) & Mid("  Marca: " & RsImpresion!Marca & String(20, " "), 1, 20) & "Serie     : " & RsImpresion!Serie
                 Printer.Print String(6, " ") & "Peso Bruto : " & Mid(Format(RsImpresion!nTotal, "###,##0.00") & String(20, " "), 1, 20) & Mid("  Tara : " & Format(RsImpresion!nTara, "###,##0.00") & String(20, " "), 1, 20) & "Documento : " & Mid(RsImpresion!tDocumento, 1, 6) & "-" & Mid(RsImpresion!tDocumento, 7, 9)
                 Printer.Print String(6, " ") & "Observacion: " & RsImpresion!tObservacion


           Case Is = "007" ' CONFITERIA
                 For i = 1 To nCabeceraGuia
                     Printer.Print
                 Next i
                 
                 Printer.Print "Fecha : " & Format(RsImpresion!fRegistro, "dd MMMM yyyy")
                 Printer.Print Left("Destinatario : " & RsImpresion!Destinatario & String(60, " "), 60) & " " & Left("Punto de Partida : " & sDireccion, 50)
                 Printer.Print Left("RUC          : " & RsImpresion!Identidad & String(60, " "), 60) & " " & Left("Punto de Llegada : " & IIf(RsImpresion!Tienda = "", RsImpresion!direccion, RsImpresion!DireccionTienda), 50)
                 Printer.Print
                 'Printer.Print "Datos del Transportista                                     Datos de la Unidad de Transporte y Conductor"
                 Printer.Print Left("Transportista : " & RsImpresion!Transportista & String(60, " "), 60) & " " & Left("Marca y Placa : " & RsImpresion!Marca & " " & RsImpresion!Placa, 50)
                 Printer.Print Left("RUC           : " & RsImpresion!IdentidadTransportista & String(60, " "), 60) & " " & Left("Licencia      : " & RsImpresion!Licencia, 50)
                  
                 For i = 1 To nDetalleGuia
                     Printer.Print
                 Next i
                 
                 'Cuerpo
                 Item = ""
                 i = 0
                 j = 0
                 
                 Do While Not RsImpresion.EOF
                    If RsImpresion!lImprimeResumen Then
                        xproducto = RsImpresion!tDetallado
                    Else
                        xproducto = RsImpresion!tResumido
                    End If
                    i = i + 1
                    sLinea = Format(RsImpresion!nCantidad, "###0.00") & String(10, " ") & Left(xproducto & String(40, " "), 40) & String(30, " ") & Right(String(8, " ") & Format(RsImpresion!nprecioVenta, "#,##0.00"), 8) & String(8, " ") & Right(String(9, " ") & Format(RsImpresion!nVenta, "##,##0.00"), 9)
                    Printer.Print sLinea
                    RsImpresion.MoveNext
                 Loop
                 
                 For j = i To nFItem
                     Printer.Print " "
                 Next j

           Case Is = "011" 'PUNTO AZUL
                 For i = 1 To nCabeceraGuia
                     Printer.Print
                 Next i
                 
                 Printer.Print Format(RsImpresion!fRegistro, "  dd" & "        " & "MMMM" & "                " & "yyyy")
                 Printer.Print " " 'Espacio
                 Printer.Print String(8, " ") + RsImpresion!Destinatario
                 Printer.Print String(8, " ") + RsImpresion!DireccionDestinatario
                 Printer.Print String(8, " ") + RsImpresion!Identidad
                 Printer.Print String(8, " ") + RsImpresion!Transportista
                 Printer.Print String(8, " ") + RsImpresion!DireccionTransportista
                 Printer.Print String(8, " ") + RsImpresion!IdentidadTransportista & "                            " & RsImpresion!Placa
                 Printer.Print String(12, " ") + Left(sDireccion, 50) & String(28, " ") & IIf(RsImpresion!Tienda = "", RsImpresion!direccion, RsImpresion!DireccionTienda)
                 'Printer.Print String(12, " ") + Left(sDireccion, 50) & String(28, " ") & IIf(RsImpresion!Tienda = "", RsImpresion!direccion, RsImpresion!DireccionTienda)

                 For i = 1 To nDetalleGuia
                     Printer.Print
                 Next i
                                  
                 'Cuerpo
                 Item = ""
                 i = 0
                 j = 0
                 
                 Do While Not RsImpresion.EOF
                    If RsImpresion!lImprimeResumen Then
                        xproducto = RsImpresion!tDetallado
                    Else
                        xproducto = RsImpresion!tResumido
                    End If
                    i = i + 1
                    'sLinea = RsImpresion!tItem & "   " & Left(RsImpresion!tResumido & String(40, " "), 40) & "  " & Right(String(7, " ") & Format(RsImpresion!nCantidad, "###0.00"), 7) & "   " & Right(String(8, " ") & Format(RsImpresion!nprecioVenta, "#,##0.00"), 8) & "   " & Right(String(9, " ") & Format(RsImpresion!nVenta, "##,##0.00"), 9)
                    sLinea = RsImpresion!tItem & String(14, " ") & Left(xproducto & String(40, " "), 40) & String(56, " ") & Right(String(7, " ") & Format(RsImpresion!nCantidad, "###0.00"), 7)
                    Printer.Print sLinea
                    RsImpresion.MoveNext
                 Loop
                 
                 For j = i To nFItem
                     Printer.Print " "
                 Next j
                 
           Case Is = "012" '28082018 Cliente : Duzka
                 For i = 1 To nCabeceraGuia
                     Printer.Print
                 Next i
                Dim fec As Date
                 If IsNull(RsImpresion!fentrega) Or (RsImpresion!fentrega) = "01/01/1900" Then
                    fec = RsImpresion!fRegistro
                 Else
                    fec = RsImpresion!fentrega
                 End If
                 
                 Printer.Print String(2, " ") + "Fecha de Translado : " & Format(fec, "dd" & " " & "MMMM" & " " & "yyyy")
                 Printer.Print " " 'Espacio
                 Printer.Print String(2, " ") + Left("DOMICILIO DE PARTIDA" & String(62, " "), 62) & String(9, " ") & "DOMICILIO DE LLEGADA"
                 Printer.Print String(2, " ") + Left(sDireccion & String(62, " "), 62) & String(9, " ") & Left(IIf(RsImpresion!Tienda = "", RsImpresion!direccion, RsImpresion!DireccionTienda) & String(62, " "), 62) 'Left(RsImpresion!DireccionDestinatario & String(62, " "), 62)
                 Printer.Print " " 'Espacio
                 Printer.Print String(2, " ") + "DESTINATARIO" 'Espacio
                 'Printer.Print String(1, " ") + Left(RsImpresion!Destinatario & String(62, " "), 62) & String(5, " ") & Left("UNIDAD TRANSPORTE / " & RsImpresion!Marca & String(62, " "), 62)
                 Printer.Print String(2, " ") + Left(IIf(RsImpresion!Tienda = "", RsImpresion!Destinatario, RsImpresion!Tienda) & String(62, " "), 62) & String(9, " ") & Left("UNIDAD TRANSPORTE / " & RsImpresion!Marca & String(62, " "), 62)
                 Printer.Print String(2, " ") + "RUC " + RsImpresion!Identidad
                 xObservacionPedido = IIf(IsNull(RsImpresion!PedidoObservacion), "", RsImpresion!PedidoObservacion)
                 'Printer.Print String(8, " ") + RsImpresion!Identidad
                 'Printer.Print String(8, " ") + RsImpresion!Transportista
                 'Printer.Print String(8, " ") + RsImpresion!DireccionTransportista
                 'Printer.Print String(8, " ") + RsImpresion!IdentidadTransportista & "                            " & RsImpresion!Placa
                 'Printer.Print String(12, " ") + Left(sDireccion, 50) & String(28, " ") & IIf(RsImpresion!Tienda = "", RsImpresion!direccion, RsImpresion!DireccionTienda)
                 'Printer.Print String(12, " ") + Left(sDireccion, 50) & String(28, " ") & IIf(RsImpresion!Tienda = "", RsImpresion!direccion, RsImpresion!DireccionTienda)

                 For i = 1 To nDetalleGuia
                     Printer.Print
                 Next i
                                  
                 'Cuerpo
                 Item = ""
                 i = 0
                 j = 0
                 
                 Do While Not RsImpresion.EOF
                    If RsImpresion!lImprimeResumen Then
                        xproducto = RsImpresion!tDetallado
                    Else
                        xproducto = RsImpresion!tResumido
                    End If
                    i = i + 1
                    'sLinea = RsImpresion!tItem & "   " & Left(RsImpresion!tResumido & String(40, " "), 40) & "  " & Right(String(7, " ") & Format(RsImpresion!nCantidad, "###0.00"), 7) & "   " & Right(String(8, " ") & Format(RsImpresion!nprecioVenta, "#,##0.00"), 8) & "   " & Right(String(9, " ") & Format(RsImpresion!nVenta, "##,##0.00"), 9)
                    sLinea = String(2, " ") & Right(String(3, " ") & Format(RsImpresion!tItem, "000"), 3) & String(9, " ") & Left(xproducto & String(80, " "), 80) & Right(String(7, " ") & Format(RsImpresion!nCantidad, "###0.00"), 7) & String(8, " ") & Left(xObservacionPedido, 30)
                    Printer.Print sLinea
                    
                    If (Len(xObservacionPedido) > 30) Then
                        xObservacionPedido = Right(xObservacionPedido, Len(xObservacionPedido) - 30)
                        Else
                        xObservacionPedido = ""
                    End If
                    RsImpresion.MoveNext
                 Loop
                 Do While Len(xObservacionPedido) > 1
                    sLinea = String(109, " ") & Left(xObservacionPedido, 30)
                    Printer.Print sLinea
                    If (Len(xObservacionPedido) > 30) Then
                        xObservacionPedido = Right(xObservacionPedido, Len(xObservacionPedido) - 30)
                        Else
                        xObservacionPedido = ""
                    End If
                 Loop
                 
                    
                 
                 For j = i To nFItem
                     Printer.Print " "
                 Next j
                 
           Case Is = "100" 'estandar  --- erick -- tablon

                For i = 1 To nCabeceraGuia
                    Printer.Print
                Next i
                
                nAlto = Printer.TextHeight("A") '
                nSalto = 0.754
                
                Printer.CurrentY = nAlto * 11
                Printer.Print String(13, " ") & Format(RsImpresion!fRegistro, "dd        MMMM            yyyy") & String(60, " ") & RsImpresion!Guia '& "-" & RsImpresion!tNumGuia
                Printer.CurrentY = nAlto * 12 + nAlto * nSalto * 1
                Printer.Print String(18, " ") & RsImpresion!Destinatario & String(106 - Len(RsImpresion!Destinatario), " ") & RsImpresion!Motivo
                Printer.CurrentY = nAlto * 13 + nAlto * nSalto * 2
                Printer.Print String(18, " ") & RsImpresion!DireccionDestinatario & String(114 - Len(RsImpresion!DireccionDestinatario), " ")
                Printer.CurrentY = nAlto * 14 + nAlto * nSalto * 3
                Printer.Print String(18, " ") & RsImpresion!Identidad & String(114 - Len(RsImpresion!Identidad), " ")
                Printer.CurrentY = nAlto * 15 + nAlto * nSalto * 4
                Printer.Print String(18, " ") & RsImpresion!Transportista & String(56 - Len(RsImpresion!Transportista), " ") & RsImpresion!Placa & String(32 - Len(RsImpresion!Placa), " ") '& RsImpresion!tLicencia
                Printer.CurrentY = nAlto * 16 + nAlto * nSalto * 5
                Printer.Print String(18, " ") & RsImpresion!DireccionTransportista & String(114 - Len(RsImpresion!DireccionTransportista), " ")
                Printer.CurrentY = nAlto * 17 + nAlto * nSalto * 6
                Printer.Print String(18, " ") & RsImpresion!IdentidadTransportista & String(24, " ")
                Printer.CurrentY = nAlto * 18 + nAlto * nSalto * 7
                nAncho = Len(RsImpresion!tDomicilioPartida)
                'Printer.Print String(22, " ") & RsImpresion!tDomicilioPartida & String(74 - nAncho, " ") & RsImpresion!tDomicilioDestino
                Printer.Print String(22, " ") + Left(sDireccion, 50) & String(35, " ") & IIf(RsImpresion!Tienda = "", RsImpresion!direccion, RsImpresion!DireccionTienda)
                
                For i = 1 To nDetalleGuia
                    Printer.Print
                Next i
                
                'Cuerpo
                Item = ""
                i = 0
                j = 0
                
                Do While Not RsImpresion.EOF
                    If RsImpresion!lImprimeResumen Then
                        xproducto = RsImpresion!tDetallado
                    Else
                        xproducto = RsImpresion!tResumido
                    End If
                   i = i + 1
                   'sLinea = String(6, " ") & Format(str(RsImpresion!nItem), "00") & String(7, " ") & RsImpresion!tCodigoProducto & String(4, " ") & RsImpresion!Producto & String(79 - Len(RsImpresion!Producto), " ") & RsImpresion!tResumido & String(19 - Len(RsImpresion!tResumido), " ") & RsImpresion!nCantidad
                   sLinea = String(6, " ") & Right(String(3, " ") & Format(RsImpresion!tItem, "000"), 3) & String(9, " ") & Right(String(7, " ") & Format(RsImpresion!tEnlace, "0000000"), 7) & String(5, " ") & Left(xproducto & String(40, " "), 40) & String(42, " ") & Left(RsImpresion!UM & String(10, " "), 10) & String(5, " ") & Right(String(7, " ") & Format(RsImpresion!nCantidad, "###0.00"), 7)
                   Printer.Print sLinea
                   RsImpresion.MoveNext
                Loop
                
                For j = i To nItemGuia
                    Printer.Print " "
                Next j
                
                Printer.Print


        End Select
        Printer.EndDoc
End Sub
Public Sub TabNext(Tecla)
   If Tecla = vbKeyReturn Then
      Tecla = 0
      
      SendKeys "{Tab}"
   End If
End Sub
Public Sub Numerico(Tecla As Integer, texto As String)
    If Tecla = vbKeyBack Then Exit Sub
    If Tecla = 46 And InStr(1, texto, ".") = 0 Then
       Exit Sub
    End If
    If Chr(Tecla) < "0" Or Chr(Tecla) > "9" Then Tecla = 0: Beep
End Sub

Public Sub Visor(Mensaje1 As String, Mensaje2 As String, Puerto As Integer, Tipo As String)
   'MsgBox Mensaje
   'On Error Resume Next
   With frmMsComm.MSCommPort
        .CommPort = Puerto
        .PortOpen = True
        .Output = "" & Chr(13) & Chr(10)
        .Output = "" & Chr(12)
        .Output = Mid(Mensaje1 & String(19, " "), 1, 19) & Chr(13) & Chr(10)
        
        If Tipo = "N" Then
           .Output = Mid(Mensaje2 & String(19, " "), 1, 19) & Chr(13)
        Else
           .Output = "" & Chr(12)
        End If
        .PortOpen = False
   End With
   
End Sub

Public Sub InsertaBMP(BMPRuta As String)
   On Error Resume Next
   If BMPRuta <> "" Then
      imgFondo.Picture = LoadPicture(BMPRuta)
   Else
      imgFondo.Picture = LoadPicture()
   End If
End Sub

Public Sub ImprimeMensaje(Impresora As String, texto As String, RsImpresion As Recordset)
    On Error Resume Next
    Dim txt As String

    'Configura la impresora la impresion Font
    If Not Imprimir(Impresora) Then
       Exit Sub
    End If
    Printer.FontName = sFont
    Printer.FontBold = False
    
    'Cabecera
    Printer.Print ""
    Printer.FontName = sFont2
    Printer.FontBold = True
    Printer.Print String(39, "-")
    Printer.Print "NO VALIDO COMO COMPROBANTE DE PAGO"
    Printer.Print "NO VALIDO PARA PRODUCCION"
    Printer.Print String(39, "-")
    Printer.Print ""
    ImprimeXLinea "Mesa  : " & IIf(IsNull(RsImpresion!Mesa), "", Trim(RsImpresion!Mesa)), 17, 0
    Printer.FontBold = False
    Printer.FontName = sFont1
    
    Printer.Print ""
    Printer.Print "Pedido   : " & sPedido
    Printer.Print "Fecha    : " & FechaServidor()
    Printer.Print "Tipo     : " & RsImpresion!tipopedido
    Printer.Print "Mesero   : " & RsImpresion!Mozo
    Printer.Print "Personas : " & RsImpresion!Pax
    ImprimeXLinea "Observac.: " & IIf(IsNull(RsImpresion!Observacion), "", Trim(RsImpresion!Observacion)), 23, 11
    Printer.Print String(39, "-")
    Printer.FontName = sFont2
    ImprimeXLinea texto, 17, 0
    Printer.FontName = sFont1
    Printer.Print " "
    Printer.Print String(39, "-")
    Printer.Print "Caja      : " & sCaja & " - " & IIf(Mid(sUsuario, 1, 1) = "*", Mid(sUsuario, 2, 15), sUsuario)
    Printer.Print " "
    Printer.EndDoc
End Sub
Public Sub Mensaje(Mensaje As String, Titulo As String, Delay As Integer)
  frmMsgBox.Caption = Titulo
  frmMsgBox.lblMensaje.Caption = Mensaje
  frmMsgBox.Timer.Interval = Delay
  frmMsgBox.Show vbModal
End Sub

Public Function ValidaIP(ip As String, Puerto As Long) As Boolean
   wEnter = False
   frmWinSock.ip = ip
   frmWinSock.Puerto = Puerto
   frmWinSock.Show vbModal
   If wEnter Then
      ValidaIP = True
   Else
      ValidaIP = False
   End If
End Function

Public Function Apostrofe(Cad As Variant) As String
    If Not IsNull(Cad) Then
        Apostrofe = Replace(Cad, "'", "''", 1, , vbTextCompare)
    Else
        Apostrofe = ""
    End If
End Function

Public Function Apostrofe_v2(Cad As Variant) As String
    If Not IsNull(Cad) Then
        Apostrofe_v2 = Replace(Cad, "'", " ", 1, , vbTextCompare)
    Else
        Apostrofe_v2 = ""
    End If
End Function

Public Sub ValidaStr(Cad As TextBox)
  Dim sCad As String
  Dim nRes As Integer
  nRes = 0
  sCad = Trim(Cad.Text)
  nRes = InStr(1, sCad, "&")
  If nRes > 0 Then
     MsgBox "Caracter (&) no permitido, favor corregir", vbExclamation, sMensaje
     Cad.SelStart = nRes - 1
     Cad.SetFocus
     Exit Sub
  End If
  
  nRes = InStr(1, sCad, "'")
  If nRes > 0 Then
     MsgBox "Caracter (') no permitido, favor corregir", vbExclamation, sMensaje
     Cad.SelStart = nRes - 1
     Cad.SetFocus
     Exit Sub
  End If
  
  nRes = InStr(1, sCad, """")
  If nRes > 0 Then
     MsgBox "Caracter ("") no permitido, favor corregir", vbExclamation, sMensaje
     Cad.SelStart = nRes - 1
     Cad.SetFocus
     Exit Sub
  End If
End Sub

Public Sub Accesos(formulario As Form, tModulo As String, tUsuario As String)
    Dim Rs As Recordset
    Dim sGrupo As String
    Dim sControl As String
    Dim xObj As Object
    
'    sGrupo = Calcular("select tGrupoUsuario as Codigo from TUSUARIO where tResumido='" & tUsuario & "' and lActivo=1", Cn)
'    Isql = "select tNombreObjeto FROM dbo.TACCESO INNER JOIN  dbo.TGRUPOACCESO ON dbo.TACCESO.tCodigoAcceso = dbo.TGRUPOACCESO.tCodigoAcceso " & _
'           "where tGrupoUsuario='" & sGrupo & "' and TACCESO.tModulo='" & tModulo & "' and tFormulario='" & Formulario.Name & "'"


    Set Rs = Lib.OpenRecordset("usp_Inforest_ObtieneAccesoMenu '" & tUsuario & "','" & tModulo & "', '" & formulario.Name & "'", Cn)
    Do While Not Rs.EOF
       Set xObj = formulario.Controls(Rs!tnombreObjeto)
       xObj.Enabled = False
       Rs.MoveNext
    Loop
End Sub
   
Public Function Extrae(texto As String) As String
   Dim i As Integer
   Dim nVar As String
   Dim sNuevo As String
   sNuevo = ""
   For i = 1 To Len(Trim(texto))
       nVar = Mid(texto, i, 1)
       If Asc(nVar) >= 48 And Asc(nVar) <= 57 Then
          sNuevo = sNuevo + nVar
       End If
   Next i
   Extrae = sNuevo
End Function

Public Function LeerIni(lpFileName As String, lpAppName As String, lpKeyName As String, Optional vDefault) As String
    'Los parámetros son:
    'lpFileName:    La Aplicación (fichero INI)
    'lpAppName:     La sección que suele estar entrre corchetes
    'lpKeyName:     Clave
    'vDefault:      Valor opcional que devolverá
    '               si no se encuentra la clave.
    '
    Dim lpString As String
    Dim LTmp As Long
    Dim sRetVal As String
    
    'Si no se especifica el valor por defecto,
    'asignar incialmente una cadena vacía
    If IsMissing(vDefault) Then
        lpString = ""
    Else
        lpString = vDefault
    End If
    
    sRetVal = String$(255, 0)
    
    LTmp = GetPrivateProfileString(lpAppName, lpKeyName, lpString, sRetVal, Len(sRetVal), lpFileName)
    If LTmp = 0 Then
        LeerIni = lpString
    Else
        LeerIni = Left(sRetVal, LTmp)
    End If
End Function

Public Function FileExists(fname As String) As Boolean

If fname = "" Or Right(fname, 1) = "\" Then
  FileExists = False: Exit Function
End If

FileExists = (Dir(fname) <> "")

End Function

Public Function MultiCajeroOk() As Boolean
    Dim RsPW As Recordset
    Set RsPW = Lib.OpenRecordset("select * from TUSUARIO where lActivo = 1", Cn)
    If RsPW.RecordCount = 0 Then
       Set RsPW = Nothing
       MultiCajeroOk = False
       MsgBox "Usuario no Corresponde a la sesión", vbCritical, sMensaje
       Exit Function
    End If
    frmPassword.Show vbModal
   
    If Not wEnter Or LTrim(sDescrip) = "" Then
       Set RsPW = Nothing
       MultiCajeroOk = False
       MsgBox "Error en prueba de validación" & Chr(13) & "Salga y vuelva entrar al módulo", vbCritical, sMensaje
       Exit Function
    End If

    RsPW.MoveFirst
    Do While Not RsPW.EOF
       If sDescrip = Desencapsula(RsPW!tpassword) Or Encapsula(sDescrip) = IIf(IsNull(RsPW!tBandaMagnetica), "", "´" & RsPW!tBandaMagnetica) Then
          If RsPW!tResumido = IIf(Mid(sUsuario, 1, 1) = "*", Mid(sUsuario, 2, 20), sUsuario) Then
             MultiCajeroOk = True
             Set RsPW = Nothing
             Exit Function
          End If
       End If
       RsPW.MoveNext
    Loop
    MultiCajeroOk = False
    MsgBox "Error en prueba de validación" & Chr(13) & "Salga y vuelva entrar al módulo", vbCritical, sMensaje
    Set RsPW = Nothing
End Function

Public Function ValidaExistenciaProducto() As Boolean
    If Calcular("select count(tCodigoPedido) as codigo from MPEDIDO where tEstadoPedido='01' and tUsuario='" & sUsuario & "' and tCodigoPedido='" & sPedido & "'", Cn) = 0 Then
        ValidaExistenciaProducto = False
    Else
        ValidaExistenciaProducto = True
    End If
End Function
Public Function ObtenerDirectorioSO() As String
      Dim strBuf As String
      Dim lngSize As Long
      Dim retval As Long
      strBuf = String(255, 0)
      lngSize = 255
      retval = GetWindowsDirectoryA(strBuf, lngSize)
      strBuf = Left(strBuf, retval)
      strBuf = String(255, 0)
      lngSize = 255
      retval = GetSystemDirectoryA(strBuf, lngSize)
      strBuf = Left(strBuf, retval)
      ObtenerDirectorioSO = strBuf
   End Function

Public Function obtieneAnoMes(Ruta As String) As String
        Open Ruta For Input As #1
        Dim linea As String, TOTAL As String
        Dim a, b, c, d, e, f As String
        Do Until EOF(1)
        Line Input #1, linea
        TOTAL = TOTAL + linea
        Loop
        Close #1
        a = Mid(TOTAL, 17, 1)
        b = Mid(TOTAL, 6, 1)
        c = Mid(TOTAL, 30, 1)
        d = Mid(TOTAL, 14, 1)
        e = Mid(TOTAL, 8, 1)
        f = Mid(TOTAL, 25, 1)
        obtieneAnoMes = c & d & e & f & a & b
End Function

Public Function validaConexion(servidor As String, bd As String) As Boolean
 On Error GoTo err:
     Dim verificaEstadoServidor As Boolean
    verificaEstadoServidor = conectaPCServidor(servidor)
    If verificaEstadoServidor = False Then: GoTo err

    DoEvents
    
    Dim con As New Connection
    Set con = New Connection
    con.Provider = "SQLOLEDB"
    con.CursorLocation = adUseClient
    con.ConnectionString = "User ID=" & sUserName & _
                          ";password=" & sUserPassword & _
                          ";Data Source=" & servidor & _
                          ";Initial Catalog=" & bd
    con.ConnectionTimeout = 8
    DoEvents
    con.Open
    DoEvents
    If con.State Then
        validaConexion = True
    Else
        validaConexion = False
    End If
Exit Function
err:
         validaConexion = False
End Function
Public Function devuelveConexion(servidor As String, bd As String) As Connection
On Error GoTo err:
    Dim Conx As New Connection
    Set Conx = New Connection
    Conx.Provider = "SQLOLEDB"
    Conx.CursorLocation = adUseServer
    Conx.ConnectionString = "User ID=" & sUserName & _
                          ";password=" & sUserPassword & _
                          ";Data Source=" & servidor & _
                          ";Initial Catalog=" & bd
    Conx.ConnectionTimeout = 8
    Conx.Open
    If Conx.State Then
      Set devuelveConexion = Conx
    End If
Exit Function
err:
       Set devuelveConexion = Conx
End Function

'Public Function devuelveServidores() As ADODB.Recordset
'    Dim sTemporal As String
'    Dim cadena As Boolean
'    Dim Estado As String
'    Dim RST As New ADODB.Recordset
'    sTemporal = dbTemporal(sCaja, 7, "codigo", "nvarchar(2)", "Sector", "nvarchar(30)", "Local", "nvarchar(30)", "Ip", "nvarchar(30)", "BD", "nvarchar(30)", "Estado", "nvarchar(15)", "BDAlm", "nvarchar(30)")
'
'   ' Isql = "select * from vLocal WHERE LACTIVO=1"
'   Isql = "select * from vlocal where lactivo=1 and sector<>'' and ip<>'' and bdinf<>''" ' and bdalm<>'' "
'   Set RST = Lib.OpenRecordset(Isql, Cn)
'   If Not (RST.EOF Or RST.BOF) Then
'            RST.MoveFirst
'            For x = 0 To RST.RecordCount - 1
'                Estado = "No Conectado"
'                Isql = "insert into " & sTemporal & " values ( '" & RST.Fields(0) & "','" & RST.Fields(1) & "','" & RST.Fields(3) & "','" & RST.Fields(4) & "','" & RST.Fields(5) & "','" & Estado & "','" & RST.Fields(6) & "' )"
'                Cn.Execute Isql
'                RST.MoveNext
'            Next x
'            Isql = "select * from " & sTemporal & " order by 2,3"
'            Set RST = Lib.OpenRecordset(Isql, Cn)
'            Set devuelveServidores = RST
'            Set rsListaServidores = RST
'    Else
'        Set devuelveServidores = Nothing
'        Set rsListaServidores = Nothing
'    End If
'End Function
'Public Function devuelveServidoresConectados() As ADODB.Recordset
'    Dim sTemporal As String
'    Dim cadena As Boolean
'    Dim Estado As String
'    Dim RST As New ADODB.Recordset
'    sTemporal = dbTemporal(sCaja, 7, "codigo", "nvarchar(2)", "Sector", "nvarchar(30)", "Local", "nvarchar(30)", "Ip", "nvarchar(30)", "BD", "nvarchar(30)", "Estado", "nvarchar(15)", "BDAlm", "nvarchar(30)")
'
'   ' Isql = "select * from vLocal WHERE LACTIVO=1"
'   Isql = "select * from vlocal where lactivo=1 and sector<>'' and ip<>'' and bdinf<>'' " 'and bdalm<>'' "
'   Set RST = Lib.OpenRecordset(Isql, Cn)
'   If Not (RST.EOF Or RST.BOF) Then
'            RST.MoveFirst
'            For x = 0 To RST.RecordCount - 1
'                 cadena = validaConexion(RST.Fields("ip"), RST.Fields("bdInf"))
'                    If cadena = False Then
'                         Estado = "Desconectado"
'                     Else
'                        Estado = "En Linea"
'                    End If
'                 Isql = "insert into " & sTemporal & " values ( '" & RST.Fields(0) & "','" & RST.Fields(1) & "','" & RST.Fields(3) & "','" & RST.Fields(4) & "','" & RST.Fields(5) & "','" & Estado & "' ,'" & RST.Fields(6) & "')"
'                 Cn.Execute Isql
'             RST.MoveNext
'            Next x
'            Isql = "select * from " & sTemporal & " order by 2,3"
'            Set RST = Lib.OpenRecordset(Isql, Cn)
'             Set devuelveServidoresConectados = RST
'             Set rsListaServidores = RST
'    Else
'        Set devuelveServidoresConectados = Nothing
'             Set rsListaServidores = Nothing
'    End If
'End Function

Public Function devuelveServidores() As ADODB.Recordset
    Dim sTemporal As String
    Dim cadena As Boolean
    Dim Estado As String
    Dim RST As New ADODB.Recordset
    sTemporal = dbTemporal(sCaja, 8, "codigo", "nvarchar(2)", "Sector", "nvarchar(30)", "Local", "nvarchar(30)", "Ip", "nvarchar(30)", "BD", "nvarchar(30)", "Estado", "nvarchar(15)", "IpAlm", "nvarchar(30)", "BDAlm", "nvarchar(30)")
    
   'Isql = "select * from vlocal where lactivo=1 and sector<>'' and ip<>'' and bdinf<>''" ' and bdalm<>'' "
   Isql = "select * from vLocalidades where lactivo=1 and ip<>'' and bdinf<>'' And IpAlm<>'' And  bdalm<>'' "
   Set RST = Lib.OpenRecordset(Isql, CnAlmacen)
   If Not (RST.EOF Or RST.BOF) Then
            RST.MoveFirst
            For X = 0 To RST.RecordCount - 1
                Estado = "No Conectado"
                Isql = "insert into " & sTemporal & " values ( '" & RST.Fields(0) & "','" & RST.Fields(1) & "','" & RST.Fields(3) & "','" & RST.Fields(4) & "','" & RST.Fields(5) & "','" & Estado & "','" & RST.Fields(6) & "','" & RST.Fields(7) & "')"
                Cn.Execute Isql
                RST.MoveNext
            Next X
            Isql = "select * from " & sTemporal & " order by 2,3"
            Set RST = Lib.OpenRecordset(Isql, Cn)
            Set devuelveServidores = RST
            Set rsListaServidores = RST
    Else
        Set devuelveServidores = Nothing
        Set rsListaServidores = Nothing
    End If
End Function
Public Function devuelveServidoresConectados() As ADODB.Recordset
    Dim sTemporal As String
    Dim cadena As Boolean
    Dim Estado As String
    Dim RST As New ADODB.Recordset
    sTemporal = dbTemporal(sCaja, 8, "codigo", "nvarchar(2)", "Sector", "nvarchar(30)", "Local", "nvarchar(30)", "Ip", "nvarchar(30)", "BD", "nvarchar(30)", "Estado", "nvarchar(15)", "IpAlm", "nvarchar(30)", "BDAlm", "nvarchar(30)")
    
   ' Isql = "select * from vLocal WHERE LACTIVO=1"
   'Isql = "select * from vlocal where lactivo=1 and sector<>'' and ip<>'' and bdinf<>'' " 'and bdalm<>'' "
   Isql = "select * from vlocalidades where lactivo=1 and sector<>'' and ip<>'' and bdinf<>'' and IpAlm<>'' And bdalm<>''"
   Set RST = Lib.OpenRecordset(Isql, CnAlmacen)
   If Not (RST.EOF Or RST.BOF) Then
            RST.MoveFirst
            For X = 0 To RST.RecordCount - 1
                 'cadena = validaConexion(RST.Fields("ip"), RST.Fields("bdInf"))
                 cadena = validaConexion(RST.Fields("ipAlm"), RST.Fields("bdAlm"))
                    If cadena = False Then
                         Estado = "Desconectado"
                     Else
                        Estado = "En Linea"
                    End If
                 Isql = "insert into " & sTemporal & " values ( '" & RST.Fields(0) & "','" & RST.Fields(1) & "','" & RST.Fields(3) & "','" & RST.Fields(4) & "','" & RST.Fields(5) & "','" & Estado & "' ,'" & RST.Fields(6) & "','" & RST.Fields(7) & "')"
                 Cn.Execute Isql
             RST.MoveNext
            Next X
            Isql = "select * from " & sTemporal & " order by 2,3"
            Set RST = Lib.OpenRecordset(Isql, Cn)
             Set devuelveServidoresConectados = RST
             Set rsListaServidores = RST
    Else
        Set devuelveServidoresConectados = Nothing
             Set rsListaServidores = Nothing
    End If
End Function

'administracion centralizada
Public Function devuelveConexionCentral(servidor As String, bd As String) As Connection
On Error GoTo err:
    Dim Conx As New Connection
    Set Conx = New Connection
    Conx.Provider = "SQLOLEDB"
    Conx.CursorLocation = adUseServer
       
     Conx.ConnectionString = "User ID=" & sUserName & _
                          ";password=" & sUserPassword & _
                          ";Data Source=" & servidor & _
                          ";Initial Catalog=" & bd '& "; Trusted_Connection=yes"
    Conx.ConnectionTimeout = 5
    Conx.Open
    If Conx.State Then
      Set devuelveConexionCentral = Conx
    End If
Exit Function
err:
       Set devuelveConexionCentral = Conx
End Function

'un exe multilocal
Public Function conectaServidores(servidor As String, bdinf As String, bdalm As String, servidoralmacen As String) As Boolean
On Error GoTo error:
    Dim conexAnterior As New ADODB.Connection
    Set conexAnterior = Cn
    Dim rstUsua As New ADODB.Recordset
    Dim rstEnlace As ADODB.Recordset
    Dim enAlma As Boolean ' PARA VER SI HAY ENLACE CON ALMACEN
    conectaServidores = True
    sRuta = servidor
    sMDB = bdinf
    Dim cnNueva As ADODB.Connection
     Set cnNueva = New Connection
    cnNueva.Provider = "SQLOLEDB"
    cnNueva.CursorLocation = adUseClient
    cnNueva.ConnectionString = "User ID=" & sUserName & _
                          ";password=" & sUserPassword & _
                          ";Data Source=" & servidor & _
                          ";Initial Catalog=" & bdinf
    DoEvents
    cnNueva.CommandTimeout = 5
    cnNueva.Open
    DoEvents
    Set Cn = cnNueva
    Set rstUsua = Lib.OpenRecordset("select * from vgrupousuario where tresumido='" & sUsuario & "' and lactivo=1", Cn)
    If Not (rstUsua.EOF Or rstUsua.BOF) Then
                        Isql = "select * from TPARAMETRO"
                        
                        Set RsParametro = Lib.OpenRecordset(Isql, Cn)
                        enAlma = IIf(IsNull(RsParametro!lAlmacen), False, RsParametro!lAlmacen)
                        sImpuesto1 = IIf(IsNull(RsParametro!tImpuesto1), "", RsParametro!tImpuesto1)
                        sImpuesto2 = IIf(IsNull(RsParametro!tImpuesto2), "", RsParametro!tImpuesto2)
                        sImpuesto3 = IIf(IsNull(RsParametro!tImpuesto3), "", RsParametro!tImpuesto3)
                        nPorcentaje1 = IIf(IsNull(RsParametro!IMPUESTO1), 0, RsParametro!IMPUESTO1)
                        nPorcentaje2 = IIf(IsNull(RsParametro!IMPUESTO2), 0, RsParametro!IMPUESTO2)
                        nPorcentaje3 = IIf(IsNull(RsParametro!IMPUESTO3), 0, RsParametro!IMPUESTO3)
                        nTiempo = IIf(IsNull(RsParametro!nTiempo), 0, RsParametro!nTiempo)
                        nChkTiempo = IIf(IsNull(RsParametro!nChkTiempo), 0, RsParametro!nChkTiempo)
                        nDELIVERY = IIf(IsNull(RsParametro!nDELIVERY), 0, RsParametro!nDELIVERY)
                        nLlevar = IIf(IsNull(RsParametro!nLlevar), 0, RsParametro!nLlevar)
                        sRazonSocial = IIf(IsNull(RsParametro!tRazonSocial), "", RsParametro!tRazonSocial)
                        sRazonComercial = IIf(IsNull(RsParametro!tRazonComercial), "", RsParametro!tRazonComercial)
                        sDireccion = IIf(IsNull(RsParametro!tDireccion), "", RsParametro!tDireccion)
                        sTelefono = IIf(IsNull(RsParametro!tTelefono), "", RsParametro!tTelefono)
                        sWeb = IIf(IsNull(RsParametro!tWebPage), "", RsParametro!tWebPage)
                        nCabecera = IIf(IsNull(RsParametro!nCabecera), 0, RsParametro!nCabecera)
                        nDetalle = IIf(IsNull(RsParametro!nDetalle), 0, RsParametro!nDetalle)
                        sMail = IIf(IsNull(RsParametro!tEmail), "", RsParametro!tEmail)
                        sRUC = IIf(IsNull(RsParametro!tIdentificacionTributaria), "", RsParametro!tIdentificacionTributaria)
                        sMonN = IIf(IsNull(RsParametro!tMonN), "", RsParametro!tMonN)
                        sMonedaN = IIf(IsNull(RsParametro!tMonedaN), "", RsParametro!tMonedaN)
                        sMonE = IIf(IsNull(RsParametro!tMonE), "", RsParametro!tMonE)
                        sMonedaE = IIf(IsNull(RsParametro!tMonedaE), "", RsParametro!tMonedaE)
                        sPAdmin = UCase(Desencapsula(IIf(IsNull(RsParametro!tpassword), "", RsParametro!tpassword)))
                        lBotonTrans = IIf(IsNull(RsParametro!lBotonTrans), False, RsParametro!lBotonTrans)
                        lLongitud = IIf(IsNull(RsParametro!lLongitud), False, RsParametro!lLongitud)
                        nLongitud = IIf(IsNull(RsParametro!nLongitud), 11, RsParametro!nLongitud)
                        lInfhotel = IIf(IsNull(RsParametro!lInfhotel), False, RsParametro!lInfhotel)
                        sBoton1 = IIf(IsNull(RsParametro!tBoton1), "", RsParametro!tBoton1)
                        sBoton2 = IIf(IsNull(RsParametro!tBoton2), "", RsParametro!tBoton2)
                        sBoton3 = IIf(IsNull(RsParametro!tBoton3), "", RsParametro!tBoton3)
                        sBoton4 = IIf(IsNull(RsParametro!tBoton4), "", RsParametro!tBoton4)
                        sBoton5 = IIf(IsNull(RsParametro!tBoton5), "", RsParametro!tBoton5)
                        nDecimal = IIf(IsNull(RsParametro!nDecimal), 11, RsParametro!nDecimal)
                        
                        sBoton1 = Calcular("select tDetallado as Codigo from TCANALVENTA where tCodigoCanalVenta='01'", Cn)
                        sBoton2 = Calcular("select tDetallado as Codigo from TCANALVENTA where tCodigoCanalVenta='02'", Cn)
                        sBoton3 = Calcular("select tDetallado as Codigo from TCANALVENTA where tCodigoCanalVenta='03'", Cn)
                        sBoton4 = Calcular("select tDetallado as Codigo from TCANALVENTA where tCodigoCanalVenta='04'", Cn)
                        sBoton5 = Calcular("select tDetallado as Codigo from TCANALVENTA where tCodigoCanalVenta='05'", Cn)

                        lAlmacen = enAlma


                            If enAlma = True And bdalm <> "" Then
                            
                                        If bdalm = "" Then: GoTo error
                                        sAlmacenRuta = servidor
                                        sAlmacenMDB = bdalm
                                        Set cnNueva = New Connection
                                        cnNueva.Provider = "SQLOLEDB"
                                        cnNueva.CursorLocation = adUseServer
                                        cnNueva.ConnectionString = "User ID=" & sUserName & _
                                                                   ";password=" & sUserPassword & _
                                                                   ";Data Source=" & servidoralmacen & _
                                                                   ";Initial Catalog=" & sAlmacenMDB
                                       cnNueva.CommandTimeout = 10
                                       cnNueva.Open
                                       
                                          Set CnAlmacen = cnNueva
                                          sLocal = Calcular("SELECT ISNULL(TCODIGOLOCAL,'001') AS CODIGO From TLOCALIDADES WHERE TIP='" & servidor & "' AND TBASEDATOSINF='" & bdinf & "' AND TIPALM='" & servidoralmacen & "' AND TBASEDATOSALM='" & bdalm & "'", CnAlmacen)

                                    Else
                                        Set CnAlmacen = Nothing
                                        lAlmacen = False
                                    End If
    Else
        MsgBox "El Usuario actual, No existe en el Local " & Chr(13) & " al que desea Acceder", vbCritical, sMensaje
        GoTo error
    End If
    If conectaServidores = True Then
        cnDefault.Execute "update tlocal set ultconlocal=0"
        cnDefault.Execute "update tlocal set ultconlocal=1 where tip='" & servidor & "' and tbasedatosinf='" & bdinf & "'"
    End If
    Exit Function
error:
    Set Cn = conexAnterior
    conectaServidores = False
End Function


Public Sub GuardarIni(lpFileName As String, lpAppName As String, lpKeyName As String, lpString As String)
    Dim LTmp As Long
    LTmp = WritePrivateProfileString(lpAppName, lpKeyName, lpString, lpFileName)
End Sub

Public Function verificaUltimoLocalConectado(servidor As String, bdinf As String, bdalm As String) As Boolean
    Dim s As String
    Dim RST As New ADODB.Recordset
    Dim conectado As Boolean
    s = "select * from vlocal where ultconlocal=1"
    Set RST = Cn.Execute(s)
    If Not (RST.EOF Or RST.BOF) Then
        RST.MoveFirst
        If servidor = RST.Fields("ip") And bdinf = RST.Fields("bdinf") Then
            verificaUltimoLocalConectado = True
            Else
               conectado = conectaServidoresEnlaceUltimo(RST.Fields("ip"), RST.Fields("bdinf"), RST.Fields("bdalm"))
               If conectado = True Then
                        verificaUltimoLocalConectado = True
                Else
                verificaUltimoLocalConectado = False
                ultimoConectado = False
                End If
        End If
    End If
End Function
Public Function conectaServidoresEnlaceUltimo(servidor As String, bdinf As String, bdalm As String) As Boolean
On Error GoTo error:
    Dim conexAnteriorInforest As New ADODB.Connection
    Dim conexAnteriorAlmacen As New ADODB.Connection
    Set conexAnteriorInforest = Cn
    Set conexAnteriorAlmacen = CnAlmacen
    Dim rstUsua As New ADODB.Recordset
    Dim rstEnlace As ADODB.Recordset
    Dim enAlma As Boolean ' PARA VER SI HAY ENLACE CON ALMACEN
    Dim lAnteriorAlmacen As Boolean
    
    Dim cnNueva As ADODB.Connection
    Set cnNueva = New Connection
    
    servidoranterior = sRuta
    inforestanterior = sMDB
    almacenanterior = sAlmacenMDB
    lanterioroalmacen = lAlmacen
    
    conectaServidoresEnlaceUltimo = True
    sRuta = servidor
    sMDB = bdinf
    
    cnNueva.Provider = "SQLOLEDB"
    cnNueva.CursorLocation = adUseServer
    cnNueva.ConnectionString = "User ID=" & sUserName & _
                          ";password=" & sUserPassword & _
                          ";Data Source=" & servidor & _
                          ";Initial Catalog=" & bdinf
    cnNueva.CommandTimeout = 6
    DoEvents
    cnNueva.Open
    Set Cn = cnNueva
    localConectado = Calcular("select tresumido as codigo from vlocal where ip='" & servidor & "' and bdinf='" & bdinf & "'", cnDefault)
    Isql = "select * from TPARAMETRO"
    
    Set RsParametro = Lib.OpenRecordset(Isql, Cn)
    enAlma = IIf(IsNull(RsParametro!lAlmacen), False, RsParametro!lAlmacen)
    lBotonTrans = IIf(IsNull(RsParametro!lBotonTrans), False, RsParametro!lBotonTrans)
    lAlmacen = enAlma
                            If enAlma = True And bdalm <> "" Then
                                
                                sAlmacenRuta = servidor
                                sAlmacenMDB = bdalm
                                Set cnNueva = New Connection
                                cnNueva.Provider = "SQLOLEDB"
                                cnNueva.CursorLocation = adUseServer
                                cnNueva.ConnectionString = "User ID=" & sUserName & _
                                                           ";password=" & sUserPassword & _
                                                           ";Data Source=" & sAlmacenRuta & _
                                                           ";Initial Catalog=" & sAlmacenMDB
                               cnNueva.CommandTimeout = 10
                               cnNueva.Open
                                  Set CnAlmacen = cnNueva
                            Else
                                Set CnAlmacen = Nothing
                                lAlmacen = False
                            End If
    Exit Function
error:
    Set Cn = conexAnteriorInforest
    Set CnAlmacen = conexAnteriorAlmacen
    conectaServidoresEnlaceUltimo = False
    lAlmacen = lanterioroalmacen
    sRuta = servidoranterior
    sMDB = inforestanterior
    sAlmacenMDB = almacenanterior
End Function

Function dbTemporalEnlace(Usuario As String, nCampo As Integer, ParamArray Lista())
   On Error GoTo err
   Do While True
      'sNombre = "TMP" & Usuario & Mid("000000", 1, 6 - Len(Trim(str(DateDiff("s", Date, Now))))) + Trim(str(DateDiff("s", Date, Now)))
      'If Calcular("select count(name) as Codigo from dbo.sysobjects where id = object_id(N'[dbo].[" & sNombre & "]')", Cn) < 1 Then
      sNombre = "#TMP" & Usuario & Mid("000000", 1, 6 - Len(Trim(str(DateDiff("s", Date, Now))))) + Trim(str(DateDiff("s", Date, Now)))
      If Calcular("select count(name) as Codigo from tempdb.dbo.sysobjects where id = object_id(N'tempdb.[dbo].[" & sNombre & "]')", Cn) < 1 Then
         Exit Do
      End If
   Loop
   
   Isql = "Create Table " & sNombre & " ( "
   For i = 0 To nCampo - 1
       'Isql = Isql & Lista(i * 2) & " " & Lista((i * 2) + 1) & ", "
       If UCase(Left(LTrim(Lista((i * 2) + 1)), 8)) = "NVARCHAR" Or UCase(Left(LTrim(Lista((i * 2) + 1)), 7)) = "VARCHAR" Then
        Isql = Isql & Lista(i * 2) & " " & Lista((i * 2) + 1) & " COLLATE Modern_Spanish_CI_AS, "
       Else
        Isql = Isql & Lista(i * 2) & " " & Lista((i * 2) + 1) & ", "
       End If
   Next i
   Isql = Mid(Isql, 1, Len(Trim(Isql)) - 1) & " )"
   
   cnDefault.Execute Isql
   dbTemporalEnlace = sNombre
Exit Function
err:
   'Cn.Execute "drop table " & sNombre
   'Cn.Execute Isql
   'dbTemporal = sNombre
End Function

Function VerificaFormAbiertos() As Boolean
    Dim formulario As Form
    Select Case moduloUso
    Case "Administracion"
            For Each formulario In Forms
                    If formulario.Visible And formulario.Name <> "mdiAdministracion" Then
                    VerificaFormAbiertos = True
                    Exit For
                    End If
           Next
    Case "PuntoVenta"
            For Each formulario In Forms
                    If formulario.Visible And formulario.Name <> "mdiPuntoVenta" Then
                    VerificaFormAbiertos = True
                    Exit For
                    End If
           Next
    End Select
End Function

Sub Llena_Combo(Isql As String, oCombo As Object, Rs As Recordset, sCodigo As String, sDescripcion As String)
    With oCombo
        Set Rs = Lib.OpenRecordset(Isql, CnAlmacen)
        Set .RowSource = Rs
            .DataField = sDescripcion
            .ListField = sDescripcion
            .BoundColumn = sCodigo
            .BoundText = ""
    End With
End Sub

Public Function Recordset_a_TXT(Rs As ADODB.Recordset, nombre As String) As Boolean
On Error GoTo errFunction
    Dim Datos_Csv As String
       
    If Rs.RecordCount > 0 Then
    
        Datos_Csv = Rs.GetString(adClipString, -1, "|", vbCrLf, "")
        'Datos_Csv = Replace(Datos_Csv, "-1", "1")
        Datos_Csv = Replace(Datos_Csv, "Null", "0")
        xRuta = "c:\" & nombre & ".txt"
        Open xRuta For Output As #1
        Print #1, Datos_Csv
        Close
        Recordset_a_TXT = True
        
    End If
    
    Exit Function
errFunction:
    Recordset_a_TXT = False
    MsgBox err.Description, vbCritical
End Function

Public Sub CreaArchivos(sTabla As String)
    Dim RsTempo As Recordset
    Dim lValor As Boolean
    
    Select Case sTabla
        Case "TPARAMETRO"
            Set RsTempo = Lib.OpenRecordset("SELECT tRazonSocial, tRazonComercial, tDireccion, tIdentificacionTributaria, tTelefono, tEmail, tWebPage, tMonedaN, tMonN, tMonedaE, tMonE, tMonBase, " & _
                                            "nImpuesto1, nImpuesto2, nImpuesto3, tImpuesto1, tImpuesto2, tImpuesto3, tPassword, CASE WHEN lLongitud=0 THEN '0' ELSE '1' END, CASE WHEN lInfhotel=0 THEN '0' ELSE '1' END, CASE WHEN lInforest=0 THEN '0' ELSE '1' END, CASE WHEN lCostos=0 THEN '0' ELSE '1' END, nLongitud, nVPrecio, CASE WHEN lTesoreria=0 THEN '0' ELSE '1' END, " & _
                                            "nPlazoIngDoc, CASE WHEN lPresentacion=0 THEN '0' ELSE '1' END, CASE WHEN lContabilidad='0' THEN '0' ELSE '1' END, tNombreID, tRetencion1, tRetencion2, tRetencion3, nRetencion1, nRetencion2, nRetencion3, tVersion, CASE WHEN lPercepcion=0 THEN '0' ELSE '1' END, " & _
                                            "CASE WHEN lDetraccion=0 THEN '0' ELSE '1' END, CASE WHEN lUnidadMedida=0 THEN '0' ELSE '1' END, CASE WHEN lCanal=0 THEN '0' ELSE '1' END, CASE WHEN lFecha=0 THEN '0' ELSE '1' END, nDiasFP, tNumeroVersion, tNumeroVersionA, CASE WHEN lCierre=0 THEN '0' ELSE '1' END, CASE WHEN lOrdenCompra=0 THEN '0' ELSE '1' END, tOCFacturar, tOCIdTributario, tOCLugarEntrega, " & _
                                            "tOCObservacion, tOCLocal, CASE WHEN lOCAudita=0 THEN '0' ELSE '1' END, CASE WHEN lPorcionable=0 THEN '0' ELSE '1' END, CASE WHEN lPorcionableSS=0 THEN '0' ELSE '1' END, CASE WHEN lPorcionablePl=0 THEN '0' ELSE '1' END, CASE WHEN lExportar=0 THEN '0' ELSE '1' END, CASE WHEN lExportaOtroFormato=0 THEN '0' ELSE '1' END, CASE WHEN lTransferencia=0 THEN '0' ELSE '1' END, CASE WHEN lPagoCajaChica=0 THEN '0' ELSE '1' END, CASE WHEN lCompraDocumento=0 THEN '0' ELSE '1' END, " & _
                                            "CASE WHEN lRegeneraKardex=0 THEN '0' ELSE '1' END, CASE WHEN lTemporalTabla=0 THEN '0' ELSE '1' END, CASE WHEN lProyeccion=0 THEN '0' ELSE '1' END, CASE WHEN lArticuloArea=0 THEN '0' ELSE '1' END, CASE WHEN lVeTodoMovimiento=0 THEN '0' ELSE '1' END, CASE WHEN lDocumentoFecha=0 THEN '0' ELSE '1' END, CASE WHEN lInterfaseOtroSistema=0 THEN '0' ELSE '1' END, tLeyC1, tLeyC2, tLeyC3, tLeyD1, tLeyD2, tLeyD3," & _
                                            "CASE WHEN lLeyC2=0 THEN '0' ELSE '1' END, CASE WHEN lLeyC3=0 THEN '0' ELSE '1' END, CASE WHEN lLeyD2=0 THEN '0' ELSE '1' END, CASE WHEN lLeyD3=0 THEN '0' ELSE '1' END, tTipoDocumentoPref, CASE WHEN lExportaVPN=0 THEN '0' ELSE '1' END, CASE WHEN lPrecioTransferencia='0' THEN '0' ELSE '1' END, CASE WHEN lObligaHerencia=0 THEN '0' ELSE '1' END, CASE WHEN lMultiLocal=0 THEN '0' ELSE '1' END, CASE WHEN lCodigoBarra =0 THEN '0' ELSE '1' END, IdXml, case when  lModificarDocumento=0 then '0' else '1' end,  case when  lActualizaPrecioPromedio=0 then '0' else '1' end, case when  lGuia=0 then '0' else '1' end,  tempresa,  " & _
                                            "CASE WHEN lPrecioPromSubAlmacen=0 THEN '0' ELSE '1' END,  CASE WHEN lDiaContableAutomatico=0 THEN '0' ELSE '1' END,  tHoraCierreDiaContable, case when lDiaContableManual=0 then '0' else '1' end  FROM TPARAMETRO", CnAlmacenRemoto)
        Case "TPRODUCTO"
            Set RsTempo = Lib.OpenRecordset("SELECT tCodigoProducto, tResumido, tDetallado, nStockActual, nStockMaximo, nStockMinimo, " & _
                                            "nPrecioCosto, nPrecioUltimo, nFactor, tObservacion, tPresentacion, CASE WHEN lActivo=0 THEN '0' ELSE '1' END, tUsuario, tUnidadEntrada, " & _
                                            "tUnidadSalida, nPrecioPromedio, nPrecioPromedioUltimo, CONVERT(NVARCHAR(30), fRegistro, 121), nMerma, tCodigoFamilia, tCodigoSubFamilia, " & _
                                            "tTipoProducto, CASE WHEN lPorcionable=0 THEN '0' ELSE '1' END, CASE WHEN lPerecible=0 THEN '0' ELSE '1' END, nCorrelativo, CASE WHEN lDDirecto=0 THEN '0' ELSE '1' END, CASE WHEN lDReceta=0 THEN '0' ELSE '1' END, CASE WHEN lRecetaBase=0 THEN '0' ELSE '1' END, tCodigoBarra, " & _
                                            "CASE WHEN lPercepcion=0 THEN '0' ELSE '1' END, nPrecioMinimo, nPrecioMaximo, CONVERT(NVARCHAR(30), fmodificacion, 121), nPorcentajeLey, CASE WHEN lReplica = 0 THEN '0' ELSE '1' END,CASE WHEN lControlDiario = 0 THEN '0' ELSE '1' END , nPrecioTransf, tCuentaConta FROM TPRODUCTO", CnAlmacenRemoto)
                                            
        Case "TSUBFAMILIA"
            Set RsTempo = Lib.OpenRecordset("SELECT tCodigoFamilia, tCodigoSubFamilia, tDetallado, tResumido, tTipoProducto, tCuentaContable, case when nImp1=0 then '0' else '1' end , case when nImp2=0 then '0' else '1' end ,case when nImp3=0 then '0' else '1' end , CASE WHEN lVencimiento=0 THEN '0' ELSE '1' END, nPorcMinimo, nPorcMaximo, tCriterioAgrupacion, tCodigoExistencia, CASE WHEN lActivo=0 THEN '0' ELSE '1' END, CASE WHEN lReplica=0 THEN '0' ELSE '1' END , case when lPPConsolidadoSA=0 then '0' else '1' end FROM TSUBFAMILIA", CnAlmacenRemoto)
        Case "TTABLA"
            Set RsTempo = Lib.OpenRecordset("SELECT tTabla, tCodigo, nTamano, tDetallado, tResumido, tValor, nValor, CASE WHEN lVencimiento=0 THEN '0' ELSE '1' END, CASE WHEN lActivo=0 THEN '0' ELSE '1' END, CASE WHEN lReplica=0 THEN '0' ELSE '1' END FROM TTABLA", CnAlmacenRemoto)
            
        Case "MRECETAVENTA"
            Set RsTempo = Lib.OpenRecordset("SELECT tLocal, tRecetaVenta, tCodigoArea, tCodigoPlato, tDescripcion, nInsumo, nInsumo2, nInsumo3, nInsumo4, nInsumo5, nManoObra, nManoObra2, nManoObra3, " & _
                                            "nManoObra4, nManoObra5, nPorcentajeManoObra, nPorcentajeManoObra2, nPorcentajeManoObra3, nPorcentajeManoObra4, nPorcentajeManoObra5, nGastoGeneral, nGastoGeneral2, " & _
                                            "nGastoGeneral3, nGastoGeneral4, nGastoGeneral5, nPorcentajeGastoGeneral, nPorcentajeGastoGeneral2, nPorcentajeGastoGeneral3, nPorcentajeGastoGeneral4, nPorcentajeGastoGeneral5, " & _
                                            "nPorcentajeUtilidad, nPorcentajeUtilidad2, nPorcentajeUtilidad3, nPorcentajeUtilidad4, nPorcentajeUtilidad5, nVenta, tObservacion, tUsuario, CONVERT(NVARCHAR(30), fRegistro, 121), CASE WHEN lActivo=0 THEN '0' ELSE '1' END FROM MRECETAVENTA WHERE tLocal = '" & sLocal & "'", CnAlmacenRemoto)
                                            
        Case "DRECETAVENTA"
            Set RsTempo = Lib.OpenRecordset("SELECT tLocal, tRecetaVenta, tItem, tCodigoProducto, nCantidad, nPrecio, CASE WHEN lDescargo=0 THEN '0' ELSE '1' END, CASE WHEN lProducto=0 THEN '0' ELSE '1' END, CASE WHEN lCanal1=0 THEN '0' ELSE '1' END, CASE WHEN lCanal2=0 THEN '0' ELSE '1' END, CASE WHEN lCanal3=0 THEN '0' ELSE '1' END, CASE WHEN lCanal4=0 THEN '0' ELSE '1' END, CASE WHEN lCanal5=0 THEN '0' ELSE '1' END, tSubArea, CASE WHEN lNoDescargo=0 THEN '0' ELSE '1' END FROM DRECETAVENTA WHERE tLocal = '" & sLocal & "'", CnAlmacenRemoto)
        Case "MRECETAPROPIEDAD"
            Set RsTempo = Lib.OpenRecordset("SELECT tLocal, tRecetaPropiedad, tCodigoArea, tCodigoPropiedad, tDescripcion, nInsumo, nManoObra, nPorcentajeManoObra, nGastoGeneral, nPorcentajeGastoGeneral, tObservacion, tUsuario, CONVERT(NVARCHAR(30), fRegistro, 121), CASE WHEN lActivo=0 THEN '0' ELSE '1' END FROM MRECETAPROPIEDAD WHERE tLocal = '" & sLocal & "'", CnAlmacenRemoto)
        Case "DRECETAPROPIEDAD"
            Set RsTempo = Lib.OpenRecordset("SELECT tLocal, tRecetaPropiedad, tItem, tCodigoProducto, nCantidad, nPrecio, CASE WHEN lDescargo=0 THEN '0' ELSE '1' END, CASE WHEN lProducto=0 THEN '0' ELSE '1' END, tSubArea FROM DRECETAPROPIEDAD WHERE tLocal = '" & sLocal & "'", CnAlmacenRemoto)
        Case "MRECETABASE"
            Set RsTempo = Lib.OpenRecordset("SELECT tRecetaBase, tCodigoArea, tCodigoProducto, tDescripcion, nTotalCosto, tObservacion, tUsuario, CONVERT(NVARCHAR(30), fRegistro, 121), CASE WHEN lActivo=0 THEN '0' ELSE '1' END FROM MRECETABASE", CnAlmacenRemoto)
        Case "DRECETABASE"
            Set RsTempo = Lib.OpenRecordset("SELECT tRecetaBase, tItem, tCodigoProducto, nCantidad, nPrecio, CASE WHEN lDescargo=0 THEN '0' ELSE '1' END, CASE WHEN lProducto=0 THEN '0' ELSE '1' END, tSubArea FROM DRECETABASE", CnAlmacenRemoto)
'        Case "TLOCALIDADES"
'            Set RsTempo = Lib.OpenRecordset("SELECT tCodigoLocal, tDetallado, tResumido, tCodigoSector, tIP, tBaseDatosINF, tIpAlm, tBaseDatosALM, tBaseDatosLocalINF, CASE WHEN lActivo=0 THEN '0' ELSE '1' END, CASE WHEN lReplica=0 THEN '0' ELSE '1' END, ultConLocal FROM TLOCALIDADES", CnAlmacenRemoto)
    End Select
    lValor = Recordset_a_TXT(RsTempo, sTabla)
End Sub

Public Sub CopiaArchivos(sTabla As String)
    Dim lProcessID As Long
    Dim sCaracter As String
        
    sCaracter = Chr(34) & "|" & Chr(34) & " -r" & Chr(34) & "\n" & Chr(34)
    If CnAlmacenRemoto.State Then
        lProcessID = Shell("bcp " & sAlmacenMDB & ".dbo." & sTabla & " in c:\" & sTabla & ".txt -c -q -t" & sCaracter & " -S" & sAlmacenRuta & " -Uinfhotel -4gust1n-fl0r14n")
    End If
End Sub

'******************************** trae tablas vpn (remoto)
Public Sub CargaTablasAlmacenRemoto()
    If CnAlmacenRemoto.State Then
        'Inicializa las tablas
        CnAlmacen.Execute "Delete from ttabla"
        CnAlmacen.Execute "Delete from tsubfamilia"
        CnAlmacen.Execute "Delete from tproducto"
        CnAlmacen.Execute "Delete from mrecetapropiedad"
        CnAlmacen.Execute "Delete from drecetapropiedad"
        CnAlmacen.Execute "Delete from mrecetaventa"
        CnAlmacen.Execute "Delete from drecetaventa"
'        CnAlmacen.Execute "Delete from tlocalidades"
        
        'Crea los archivos txt
        CreaArchivos "TTABLA"
        CreaArchivos "TSUBFAMILIA"
        CreaArchivos "TPRODUCTO"
        CreaArchivos "MRECETAPROPIEDAD"
        CreaArchivos "DRECETAPROPIEDAD"
        CreaArchivos "MRECETAVENTA"
        CreaArchivos "DRECETAVENTA"
'        CreaArchivos "TLOCALIDADES"
        
        'Copia los archivos a las tablas
        CopiaArchivos "TTABLA"
        CopiaArchivos "TSUBFAMILIA"
        CopiaArchivos "TPRODUCTO"
        CopiaArchivos "MRECETAPROPIEDAD"
        CopiaArchivos "DRECETAPROPIEDAD"
        CopiaArchivos "MRECETAVENTA"
        CopiaArchivos "DRECETAVENTA"
'        CopiaArchivos "TLOCALIDADES"
        
        Sleep (2000) '1 Segundo para que termine de procesar en memoria
    End If
'err:
'    MsgBox "Falló el enlace con el Servidor Remoto de Almacen", vbCritical, sMensaje
'    MsgBox err.Description
End Sub

'descripcionalternativa
Public Function validaImpresionAlternativa(sDocumento As String) As Boolean
    Dim rstResultado As New ADODB.Recordset
    Dim sQuery As String
    validaImpresionAlternativa = False
    sQuery = "select sum(case when talternativa is null then 0 else (case when len(talternativa)=0 then 0 else 1 end ) end)   as codigo From tProducto Where tCodigoProducto in (select tcodigoproducto From ddocumento where tdocumento='" & sDocumento & "' group by tcodigoproducto)"
    Set rstResultado = Lib.OpenRecordset(sQuery, Cn)
    If Not (rstResultado.EOF Or rstResultado.BOF) Then
        If Val(rstResultado.Fields("codigo")) <= 0 Then
            validaImpresionAlternativa = True
        Else
            validaImpresionAlternativa = False
        End If
    End If
End Function


'extranjero bolivia
Public Function ObtienePais() As String
    ObtienePais = "000"
    Dim rstPais As New ADODB.Recordset
    Set rstPais = Lib.OpenRecordset("select tcodigo from vpaisorigen", Cn)
    If Not (rstPais.EOF Or rstPais.BOF) Then
        If rstPais.RecordCount = 1 Then
            ObtienePais = rstPais.Fields("tcodigo")
        End If
    End If
End Function

'obtiene tautorizacion y dosificacion
Public Function obtieneAutorizacionDosificacion(ccaja As String, Tipo As String) As String
    obtieneAutorizacionDosificacion = ""
    Select Case Tipo
        Case "1" ' codigoautorizacion
                obtieneAutorizacionDosificacion = Calcular("select tautorizacion AS CODIGO from torigencodigocontrol where tcaja='" & ccaja & "' and lactivo=1 and (finicio <= getdate() and ffin >= getdate())", Cn)
        Case "2" ' dosificacion
                obtieneAutorizacionDosificacion = Calcular("select tdosificacion AS CODIGO from torigencodigocontrol where tcaja='" & ccaja & "' and lactivo=1 and (finicio <= getdate() and ffin >= getdate())", Cn)
    End Select
    obtieneAutorizacionDosificacion = IIf(obtieneAutorizacionDosificacion = "0", "", obtieneAutorizacionDosificacion)
End Function

Public Function devuelveCodigoControl(ccaja As String, cCorrela As String, cAutorizacion As String, cDosificacion As String, cCodigoCliente As String, nMonto As Double) As String
    Dim cfecha As String
    Dim nitCliente As String
    devuelveCodigoControl = ""
    cfecha = Calcular("select convert(nvarchar,getdate(),112) as codigo", Cn)
    nitCliente = Calcular("Select tidentidad as codigo From Tcliente Where tcodigocliente='" & cCodigoCliente & "'", Cn)
    
    'Debug.Print cAutorizacion & " " & cCorrela & " " & nitCliente & " " & cfecha & " " & nMonto & " " & cDosificacion
    devuelveCodigoControl = ObtenerCodigoFinal(cAutorizacion, cCorrela, Mid(nitCliente, 1, 10), cfecha, nMonto, cDosificacion)
End Function

Public Sub verificaFechaCodigoControl()
    If Calcular("select  count(*) as codigo from torigencodigocontrol where tcaja='" & sCaja & "'", Cn) > 0 Then
        If FechaServidor() + 10 >= DateValue(Calcular("Select max(fFin) as codigo from TORIGENCODIGOCONTROL where    tCaja='" & sCaja & "'", Cn)) Then
                Dim Dias As Integer
                Dias = DateDiff("d", FechaServidor(), DateValue(Calcular("Select max(fFin) as Codigo from TORIGENCODIGOCONTROL where   tCaja='" & sCaja & "'", Cn)))
                MsgBox "Faltan " & Abs(Dias) & " días para que llegue a la fecha  limite el código de Autorización", vbCritical, sMensaje
        End If
    Else
        MsgBox "Debe registrar Código Autorización y N. Dosificación para esta Caja", vbInformation, sMensaje
    End If
End Sub
Public Function obtieneAdministradorControler(tCodigoUsuario As String, Tipo As String) As Boolean
    'tipo 17=administrador /// 18 = controler
    Dim RST As New ADODB.Recordset
    Dim sql As String
    obtieneAdministradorControler = True
    sql = "SELECT   ISNULL(dbo.vGRUPOUSUARIO.lOpcion" & Tipo & ", 1) AS resultado FROM  dbo.vGRUPOUSUARIO    WHERE  ( TcodigoUSUARIO = '" & tCodigoUsuario & "')"
    sql = "SELECT   ISNULL(dbo.vGRUPOUSUARIO.lOpcion" & Tipo & ", 1) AS resultado FROM  dbo.vGRUPOUSUARIO    WHERE  ( tresumido= '" & sUsuario & "')"

    Set RST = Lib.OpenRecordset(sql, Cn)
    If Not (RST.EOF Or RST.BOF) Then
        If RST.Fields("resultado") = True Then
            obtieneAdministradorControler = True
        ElseIf RST.Fields("resultado") = False Then
            obtieneAdministradorControler = False
        Else
            obtieneAdministradorControler = False
        End If
    End If
End Function


Public Function obtieneEliminaItemFijoCombo(codigocombo As String, codigoProducto As String) As Boolean
    obtieneEliminaItemFijoCombo = False
    Dim RST As New Recordset
    Dim sql As String
    sql = "SELECT CASE WHEN ISNULL(LELIMINAFijo,0)=0 THEN '0' ELSE '1' END AS ELIMINA FROM TCOMBO WHERE TCODIGOPRODUCTO='" & codigoProducto & "' AND TCOMBO='" & codigocombo & "'"
    Set RST = Lib.OpenRecordset(sql, Cn)
    
    If Not (RST.EOF Or RST.BOF) Then
        If RST.Fields(0) = "1" Then
            obtieneEliminaItemFijoCombo = True
        End If
    End If
    
End Function

'SUNAT
Public Function obtieneNumeroSerieImpresora(tCaja As String, timpresora As String) As String
    Dim rec As New Recordset
    Dim cadena As String
    obtieneNumeroSerieImpresora = ""
    cadena = "select isnull(tnumeroserie,'') as tnumeroserie  from timpresora where tcaja='" & tCaja & "' and timpresora='" & timpresora & "'"
    Set rec = Lib.OpenRecordset(cadena, Cn)
    
    If Not (rec.EOF Or rec.BOF) Then
        obtieneNumeroSerieImpresora = rec.Fields(0)
    End If
    
End Function

'insumos criticos
Public Function verificaStockProductoInsumoCritico(tcodigoInsumoC As String, Cantidad As Double) As Boolean
    Dim rInsumo As New Recordset
    Dim cadena As String
                     Set rInsumo = Lib.OpenRecordset("select isnull(nstock,0) as nstock from tinsumo where tcodigo='" & tcodigoInsumoC & "'", Cn)
                        If Not (rInsumo.EOF Or rInsumo.BOF) Then
                                If rInsumo.Fields(0) >= Cantidad Then
                                        verificaStockProductoInsumoCritico = True
                                Else
                                        verificaStockProductoInsumoCritico = False
                                End If
                        End If
               
End Function

Public Sub modificaStockInsumo(tcodigoinsumo As String, Cantidad As Double, Tipo As String)
    Select Case Tipo
        Case "S" 'SALIDA - RESTA STOCK
                Cn.Execute "UPDATE TINSUMO SET NSTOCK= NSTOCK - " & Cantidad & " WHERE TCODIGO='" & tcodigoinsumo & "'"
        Case "I" ' INGRESO - REPONE STOCK
                Cn.Execute "UPDATE TINSUMO SET NSTOCK= NSTOCK + " & Cantidad & " WHERE TCODIGO='" & tcodigoinsumo & "'"
    End Select
End Sub

Public Function obtieneProductos(tCodigoPedido As String, tcodigoinsumo As String) As String
 obtieneProductos = ""
 Dim rstProductos As New ADODB.Recordset
 Dim k As Integer
 Set rstProductos = Lib.OpenRecordset("select isnull(tdetallado,'') as producto FROM         dbo.TPRODUCTO INNER JOIN  dbo.DPEDIDO ON dbo.TPRODUCTO.tCodigoProducto = dbo.DPEDIDO.tCodigoProducto INNER JOIN  dbo.TINSUMO ON dbo.TPRODUCTO.tcodigoInsumo = dbo.TINSUMO.tcodigo where dpedido.tcodigopedido='" & tCodigoPedido & "' and tproducto.tcodigoinsumo='" & tcodigoinsumo & "' and lcontrolinsumocritico=1 and isnull(limprime,0)=0 AND   (tinsumo.lactivo=1) group by isnull(tdetallado,'') ", Cn)
 If Not (rstProductos.EOF Or rstProductos.BOF) Then
        rstProductos.MoveFirst
        For k = 0 To rstProductos.RecordCount - 1
                    obtieneProductos = IIf(Len(obtieneProductos) = 0, rstProductos.Fields(0), obtieneProductos & " / " & rstProductos.Fields(0))
            rstProductos.MoveNext
        Next k
 End If
 
 
End Function


Public Function validadIngresoProducto(tCodigoProducto As String) As Boolean
    validadIngresoProducto = True
    If Calcular("select isnull(lcontrolinsumocritico ,0) as codigo From tProducto where tcodigoproducto='" & tCodigoProducto & "'", Cn) = True Then
            If Calcular("select isnull(nstock,0) as codigo from tinsumo inner join tproducto on tinsumo.tcodigo=tproducto.tcodigoinsumo where tproducto.tcodigoproducto='" & tCodigoProducto & "'", Cn) <= 0 Then
                MsgBox "Cantidad disponible no válida del Insumo Crítico"
                 validadIngresoProducto = False
            End If
    Else
            validadIngresoProducto = True
    End If
End Function
'insumos criticos


'para chefcontrol
Public Function validadProductoenAreaPantalla(ByVal tCodigoProducto As String, ByVal tArea As String) As Boolean
On Error GoTo errUno
        Dim RsArea As New Recordset
        Set RsArea = Lib.OpenRecordset("select count(*) as cantidad from varea where codigo='" & tArea & "' and lcheffcontrol=1", Cn)
        If (RsArea!Cantidad > 0) Then

                    Dim rsproductoArea As Recordset
                    Set rsproductoArea = Lib.OpenRecordset("USP_INF_verificaProductoAreaPantalla '" & tCodigoProducto & "'", Cn)
                    If (rsproductoArea!Cantidad > 0) Then
                        validadProductoenAreaPantalla = True 'no se puede insertar
                    Else
                        validadProductoenAreaPantalla = False 'permiso para insertar
                    End If
        Else
        validadProductoenAreaPantalla = False
        End If
    Exit Function
errUno:
    validadProductoenAreaPantalla = True
End Function

Function Pesar(Puerto As Integer) As Double
   Dim nValor As Double
   Dim lOk As Boolean
   Dim lcambia As Boolean
   nValor = 0
   lOk = False
   On Error GoTo errPeso
       With frmMsComm.MSCommBalanza
         If .PortOpen Then
            .PortOpen = False
         End If
          .CommPort = nBalanzaPuerto
          .Settings = nBalanzaBS & "," & nBalanzaParidad & "," & nBalanzaBD & "," & nBalanzaBP '"9600,n,8,1"'"9600,n,8,1"
          .InBufferSize = 1024
          .OutBufferSize = 512
          .RThreshold = 15
          .SThreshold = 1
          .InputLen = 15
          .InputMode = comInputModeText
          .RTSEnable = True
          .PortOpen = True

        For i = 1 To lBalTiempo

            If lcambia Then
                .Output = nBalanzaComando + vbNewLine 'Chr(80)
                lcambia = False
            Else
                .Output = Chr(Asc(nBalanzaComando)) + Chr(Asc(vbNewLine)) 'Chr(80)
                lcambia = True
            End If
            
            Mensaje "Poner el producto en la Balanza. Esperando...", "Balanza Electrónica", 500
            Dim v, b As String
            v = .Input
            b = v
            v = Replace(v, vbNewLine, "")
            If InStr(1, v, "KG") > 0 And InStr(1, v, ".") > 2 Then
                v = Mid(v, InStr(1, v, ".") - 2, InStr(1, v, ".") + 2)
            End If
            If IsNumeric(v) Then
                nValor = CDbl(v)
            Else
                nValor = 0
            End If
            If nValor > 0 Then
               i = lBalTiempo
               lOk = True
            End If
        Next i
        If lBalTiempo = 0 Then
            GoTo errPeso
        End If
        
        If lOk Then
           Pesar = nValor
        Else
        Pesar = 0
           MsgBox "Colocar Producto en Balanza y volver a Intentarlo!!!", vbInformation, "Balanza Electrónica"
        End If
   End With
   frmMsComm.MSCommBalanza.PortOpen = False
   Exit Function
errPeso:
   Pesar = 0
   MsgBox "Error de comunicación con la balanza" + vbNewLine + "Favor de verificar Configuracion", vbCritical, sMensaje
End Function


Public Sub AsignaComandoColor(nBoton As Integer, RsAsigna As Recordset, cmdBoton As Object)
    Screen.MousePointer = vbHourglass
   With RsAsigna
        If .RecordCount > 0 Then
           .MoveFirst
           For i = 1 To IIf(.RecordCount > nBoton, nBoton, .RecordCount)
               cmdBoton(i).Visible = True
               cmdBoton(i).Caption = !Descripcion
               cmdBoton(i).backColor = !nValor
               .MoveNext
           Next i
           
           For i = IIf(.RecordCount > nBoton, nBoton, .RecordCount) + 1 To nBoton
               cmdBoton(i).Visible = False
           Next i
        Else
           For i = 1 To nBoton
               cmdBoton(i).Visible = False
           Next i
        End If
  End With
  Screen.MousePointer = vbDefault
End Sub

Public Function FechaServidor() As Date
    FechaServidor = Calcular("select getdate() as Codigo", Cn)
End Function

Function ValidaRuc(lcNroRuc)
    If pais <> "000" Then
       ValidaRuc = True
    End If
    
    If pais = "000" And IsNumeric(lcNroRuc) = False Then
        ValidaRuc = False
        Exit Function
    End If
    
    Dim aArrayRuc(3, 11) As Integer
    For i = 1 To 11
        aArrayRuc(1, i) = Val(Mid(lcNroRuc, i, 1))
    Next i
    
    aArrayRuc(2, 1) = 5
    aArrayRuc(2, 2) = 4
    aArrayRuc(2, 3) = 3
    aArrayRuc(2, 4) = 2
    aArrayRuc(2, 5) = 7
    aArrayRuc(2, 6) = 6
    aArrayRuc(2, 7) = 5
    aArrayRuc(2, 8) = 4
    aArrayRuc(2, 9) = 3
    aArrayRuc(2, 10) = 2
    aArrayRuc(3, 11) = 0
    
    For i = 1 To 10
        aArrayRuc(3, i) = aArrayRuc(1, i) * aArrayRuc(2, i)
        aArrayRuc(3, 11) = aArrayRuc(3, 11) + aArrayRuc(3, i)
    Next i
    
    lnResiduo = aArrayRuc(3, 11) Mod 11
    lnultdigito = 11 - lnResiduo
    
    Select Case lnultdigito
          Case 1, 11
                lnultdigito = 1
          Case 0, 10
                lnultdigito = 0
    End Select
    
    If lnultdigito = aArrayRuc(1, 11) Then
       ValidaRuc = True
    Else
       ValidaRuc = False
    End If
    
End Function



'Función que comprueba si una diección de email es válida
'*********************************************************************************
Public Function Validar_Email(ByVal Email As String) As Boolean
    
    Dim i As Integer, iLen As Integer, caracter As String
    Dim pos As Integer, bp As Boolean, iPos As Integer, iPos2 As Integer

    On Local Error GoTo Err_Sub

    Email = Trim$(Email)

    If Email = vbNullString Then
        Exit Function
    End If

    Email = LCase$(Email)
    iLen = Len(Email)

    
    For i = 1 To iLen
        caracter = Mid(Email, i, 1)

        If (Not (caracter Like "[a-z]")) And (Not (caracter Like "[0-9]")) Then
            
            If InStr(1, "_-" & "." & "@", caracter) > 0 Then
                If bp = True Then
                   Exit Function
                Else
                    bp = True
                   
                    If i = 1 Or i = iLen Then
                        Exit Function
                    End If
                    
                    If caracter = "@" Then
                        If iPos = 0 Then
                            iPos = i
                        Else
                            
                            Exit Function
                        End If
                    End If
                    If caracter = "." Then
                        iPos2 = i
                    End If
                    
                End If
            Else
                
                Exit Function
            End If
        Else
            bp = False
        End If
    Next i
    If iPos = 0 Or iPos2 = 0 Then
        Exit Function
    End If
    
    If iPos2 < iPos Then
        Exit Function
    End If

    
    Validar_Email = True

    Exit Function
Err_Sub:
    On Local Error Resume Next
    
    Validar_Email = False
End Function


'''fechaservidor
Public Function obtieneFechaServidor() As Date

    Set rst1 = New ADODB.Recordset
   Set oComando = New clsComando
                  If Not oComando.CreateCmdSp("ups_ObtieneFechaHora", Cn) Then
                     Set oComando = Nothing
                     Exit Function
                  End If
                If Not oComando.GetParamOK Then
                   Set oComando = Nothing
                   Exit Function
                End If
                Set rst1 = oComando.GetSP()
                obtieneFechaServidor = rst1.Fields(0)
End Function

Public Function getFilter(cols As TrueOleDBGrid80.Columns) As String
    Dim tmp As String
    Dim n As Integer
    
    For Each col In cols
        If Trim(col.FilterText) <> "" Then
            n = n + 1
            If n > 1 Then
                tmp = tmp & " AND "
            End If
            If col.DataField = "lactivo" Then
                tmp = tmp & col.DataField & " = '" & col.FilterText & "'"
            Else
                tmp = tmp & col.DataField & " LIKE '%" & col.FilterText & "%'"
            End If
        End If
    Next col
    getFilter = tmp
End Function

Public Sub cmdClearFilter_Click(cols As TrueOleDBGrid80.Columns)
    For Each col In cols
        col.FilterText = ""
    Next col
End Sub

Public Function GeneraFacturaElectronica(Ruta As String, tDocumento As String) As String
On Error GoTo fin
    Dim rsCabDocumento As New ADODB.Recordset
    Dim rsDetDocumento As New ADODB.Recordset

    Dim documentoInfoTributario As MSXML2.DOMDocument30
    Dim documentoinfoFactura As MSXML2.DOMDocument30
    Dim documentoDetalle As MSXML2.DOMDocument30
    Dim documento_Completo As MSXML2.DOMDocument30
    Dim nod_union As IXMLDOMElement
    
    Set documento_Completo = New MSXML2.DOMDocument30
    
    Dim InfoTributario As String
    Dim infoFactura As String
    Dim Factura As String
    
    Set documentoInfoTributario = New DOMDocument30
    Set documentoinfoFactura = New DOMDocument30
    Set documentoDetalle = New DOMDocument30
    Set documento_Completo = New DOMDocument30
'    Set nod_union = New IXMLDOMElement
    
   Set nod_union = documento_Completo.createElement("factura")
    nod_union.setAttribute "version", "2_00"

    Set rsCabDocumento = Lib.OpenRecordset("SELECT Right(dbo.MDOCUMENTO.tDocumento,40) AS NumDoc, " & _
    "CONVERT(varchar, dbo.MDOCUMENTO.fRegistro, 103) AS fEmision, ISNULL(dbo.vTipoDocumento.Sunat, N'00') AS tTipoDoc, (case when ISNULL(dbo.vTipoDocumento.Sunat, N'00')=12 then  dbo.MDOCUMENTO.tSerieImpresora else RIGHT(LEFT(dbo.MDOCUMENTO.tDocumento, 6), 4) end) AS tSerie , RIGHT(dbo.MDOCUMENTO.tDocumento, 9) AS tCorrelativo, " & _
    "(CASE WHEN len(dbo.TCLIENTE.tIdentidad) >= 11 AND ((LEFT(dbo.TCLIENTE.tIdentidad, 2) = '20') OR (LEFT(dbo.TCLIENTE.tIdentidad, 2) = '10') OR (LEFT(dbo.TCLIENTE.tIdentidad, 2) = '15')) THEN '6' ELSE (CASE WHEN dbo.TCLIENTE.tIdentidad IS NULL THEN '0' ELSE '1' END) END) AS tTipoDocIdentidad, " & _
    "ISNULL(dbo.TCLIENTE.tIdentidad, N'-') AS tDocIdentidad, left(ISNULL(dbo.TCLIENTE.tEmpresa, N'-'),60) AS NombreCliente, SUM(dbo.DDOCUMENTO.nPrecioNeto * dbo.DDOCUMENTO.nCantidad) as nNeto," & _
    "convert(decimal(12,2),(CASE WHEN mdocumento.testadodocumento <> '04' THEN (CASE WHEN SUM(dbo.DDOCUMENTO.nImpuesto1 + dbo.DDOCUMENTO.nImpuesto2 + dbo.DDOCUMENTO.nImpuesto3) <> 0 THEN SUM(dbo.DDOCUMENTO.nPrecioNeto * dbo.DDOCUMENTO.nCantidad) ELSE 0 END) ELSE 0 END)) AS BaseImponibleGravada, " & _
    "convert(decimal(12,2),(CASE WHEN mdocumento.testadodocumento <> '04' THEN (CASE WHEN SUM(dbo.DDOCUMENTO.nImpuesto1) <> 0 THEN SUM(dbo.DDOCUMENTO.nPrecioNeto * dbo.DDOCUMENTO.nCantidad) ELSE 0 END) ELSE 0 END)) AS BaseImponibleIGV, " & _
    "convert(decimal(12,2),(CASE WHEN mdocumento.testadodocumento <> '04' THEN (CASE WHEN SUM(dbo.DDOCUMENTO.nImpuesto1 + dbo.DDOCUMENTO.nImpuesto2 + dbo.DDOCUMENTO.nImpuesto3) = 0 THEN SUM(dbo.DDOCUMENTO.nPrecioNeto * dbo.DDOCUMENTO.nCantidad) ELSE 0 END) ELSE 0 END)) AS ImporteOperacionInafecta, " & _
    "convert(decimal(12,2),(CASE WHEN mdocumento.testadodocumento <> '04' THEN (CASE WHEN SUM(dbo.DDOCUMENTO.nImpuesto1) = 0 THEN SUM(dbo.DDOCUMENTO.nPrecioNeto * dbo.DDOCUMENTO.nCantidad) ELSE 0 END) ELSE 0 END)) AS ImporteInafectaIGV, " & _
    "convert(decimal(12,2),(CASE WHEN mdocumento.testadodocumento <> '04' THEN SUM(dbo.DDOCUMENTO.nImpuesto1) ELSE 0 END)) AS nIgv, " & _
    "convert(decimal(12,2),(CASE WHEN mdocumento.testadodocumento <> '04' THEN SUM(dbo.DDOCUMENTO.nImpuesto2) ELSE 0 END)) AS nImpuesto2, convert(decimal(12,2),(CASE WHEN mdocumento.testadodocumento <> '04' THEN SUM(dbo.DDOCUMENTO.nImpuesto2 + dbo.DDOCUMENTO.nImpuesto3) ELSE 0 END)) AS nImpuesto3," & _
    "convert(decimal(12,2),(CASE WHEN mdocumento.testadodocumento <> '04' THEN SUM(dbo.DDOCUMENTO.nVenta) ELSE 0 END)) AS TotalComprobante, " & _
    "convert(decimal(4,3),'0.000') AS TipoCambio, dbo.TCLIENTE.tDireccion, dbo.MDOCUMENTO.nDescuento,  ISNULL(TEMPDPAGODOCUMENTO.npropina, 0) AS nPropina, dbo.MDOCUMENTO.tAutorizacion, dbo.MDOCUMENTO.fInicio, dbo.MDOCUMENTO.fCaducidad, dbo.MDOCUMENTO.tContribuyenteEspecial " & _
    "FROM dbo.TCLIENTE RIGHT OUTER JOIN " & _
    "  dbo.MDOCUMENTO INNER JOIN " & _
    "  dbo.DDOCUMENTO ON dbo.MDOCUMENTO.tDocumento = dbo.DDOCUMENTO.tDocumento LEFT OUTER JOIN " & _
    "  dbo.TTIPOCAMBIO ON CONVERT(varchar, dbo.MDOCUMENTO.fRegistro, 103) = CONVERT(varchar, dbo.TTIPOCAMBIO.fFecha, 103) LEFT OUTER JOIN " & _
    "  (select tdocumento, max(fregistro) as fregistro,sum(npropina) as npropina from DPAGODOCUMENTO group by tdocumento) TEMPDPAGODOCUMENTO  ON dbo.MDOCUMENTO.tDocumento = TEMPDPAGODOCUMENTO.tDocumento ON " & _
    "  dbo.TCLIENTE.tCodigoCliente = dbo.MDOCUMENTO.tCodigoCliente LEFT OUTER JOIN " & _
    "  dbo.vTipoDocumento ON dbo.MDOCUMENTO.tTipoDocumento = dbo.vTipoDocumento.Codigo " & _
    "WHERE dbo.MDOCUMENTO.tDocumento='" & tDocumento & "' " & _
    "GROUP BY dbo.MDOCUMENTO.tDocumento, dbo.MDOCUMENTO.fRegistro, dbo.MDOCUMENTO.fPago, dbo.vTipoDocumento.Sunat, dbo.TCLIENTE.tEmpresa, " & _
    "  dbo.TCLIENTE.tIdentidad , dbo.mDocumento.tEstadoDocumento, dbo.TTIPOCAMBIO.nVenta, dbo.mDocumento.tSerieImpresora, dbo.TCLIENTE.tDireccion, dbo.MDOCUMENTO.nDescuento, TEMPDPAGODOCUMENTO.nPropina, dbo.MDOCUMENTO.tAutorizacion, dbo.MDOCUMENTO.fInicio, dbo.MDOCUMENTO.fCaducidad, dbo.MDOCUMENTO.tContribuyenteEspecial ", Cn)
    
    Set rsDetDocumento = Lib.OpenRecordset("select tDocumento, tItem, tCodigoPedido, tCodigoProducto, nPrecioNeto, nPrecioImpuesto1, nPrecioImpuesto2, nPrecioImpuesto3, nPrecioVenta, " & _
    "nPrecioOficial , nRecargo, nDescuento, nCantidad, nImpuesto1, nImpuesto2, nImpuesto3, nVenta, tGuia " & _
    "from Ddocumento where tDocumento='" & tDocumento & "'", Cn)

    If rsCabDocumento.RecordCount < 0 Then
        MsgBox "No se encotró el documento", vbExclamation + vbOKOnly, sMensaje
        Exit Function
    End If
    If rsDetDocumento.RecordCount < 0 Then
        MsgBox "No se encotró el documento", vbExclamation + vbOKOnly, sMensaje
        Exit Function
    End If
rsCabDocumento.MoveFirst

InfoTributario = "<infoTributaria>" & vbCrLf & _
        "<razonSocial>" & sRazonSocial & "</razonSocial>" & vbCrLf & "<ruc>" & sRUC & "</ruc>" & vbCrLf & _
        "<numAut>" & rsCabDocumento!tAutorizacion & "</numAut>" & vbCrLf & _
        "<codDoc>1</codDoc>" & vbCrLf & _
        "<estab>" & Right(Left(tDocumento, 4), 3) & "</estab>" & vbCrLf & "<ptoEmi>" & Right(Left(tDocumento, 7), 3) & "</ptoEmi>" & vbCrLf & "<secuencial>" & Right("000000000" & Right(tDocumento, 8), 9) & "</secuencial>" & vbCrLf & _
        "<fechaAutorizacion>" & rsCabDocumento!fInicio & "</fechaAutorizacion>" & vbCrLf & _
        "<caducidad>" & rsCabDocumento!fCaducidad & "</caducidad>" & vbCrLf & _
        "<fechaEmision>" & Format(rsCabDocumento!fEmision, "dd/mm/yyyy") & "</fechaEmision>" & vbCrLf & _
        "<dirMatriz>" & sDireccion & "</dirMatriz>" & vbCrLf & _
        "<razonSocialComprador>" & rsCabDocumento!NombreCliente & "</razonSocialComprador>" & vbCrLf & "<rucCedulaComprador>" & rsCabDocumento!tDocIdentidad & "</rucCedulaComprador>" & vbCrLf & "<guiaRemision></guiaRemision>" & vbCrLf & _
        "<contribuyenteEspecial>" & rsCabDocumento!tContribuyenteEspecial & "</contribuyenteEspecial>" & vbCrLf & _
        "<totalSinImpuestos>" & Format(rsCabDocumento!nNeto, "###,###,##0.00") & "</totalSinImpuestos>" & vbCrLf & _
        "<ICE>0</ICE>" & vbCrLf & _
        "<baseNoObjetoIVA>" & Format(rsCabDocumento!ImporteInafectaIGV, "###,###,##0.00") & "</baseNoObjetoIVA>" & vbCrLf & _
        "<baseIVA0>0</baseIVA0>" & vbCrLf & _
        "<baseIVA12>" & Format(rsCabDocumento!BaseImponibleIGV, "###,###,##0.00") & "</baseIVA12>" & vbCrLf & _
        "<IVA12>" & Format(rsCabDocumento!nIgv, "###,###,##0.00") & "</IVA12>" & vbCrLf & _
        "<propina>" & Format(rsCabDocumento!nImpuesto2, "###,###,##0.00") & "</propina>" & vbCrLf & _
        "<totalConImpuestos>" & Format(rsCabDocumento!TotalComprobante, "###,###,##0.00") & "</totalConImpuestos>" & vbCrLf & _
        "<moneda>DOLAR</moneda>" & vbCrLf & _
    "</infoTributaria>"

    Set rsDetDocumento = Lib.OpenRecordset("SELECT dbo.TPRODUCTO.tCodigoProducto, dbo.TPRODUCTO.tDetallado, dbo.DDOCUMENTO.nCantidad, dbo.DDOCUMENTO.nPrecioVenta, dbo.DDOCUMENTO.nDescuento - (dbo.DDOCUMENTO.nDescuento * ((SELECT Impuesto1 FROM dbo.TPARAMETRO) / 100.00)+dbo.DDOCUMENTO.nDescuento * ((SELECT Impuesto2 FROM dbo.TPARAMETRO) / 100.00)+dbo.DDOCUMENTO.nDescuento * ((SELECT Impuesto3 FROM dbo.TPARAMETRO) / 100.00)) AS nDescuento, " & _
    "dbo.DDOCUMENTO.nPrecioNeto * dbo.DDOCUMENTO.nCantidad AS Neto, dbo.DDOCUMENTO.nVenta, dbo.DDOCUMENTO.tDocumento, dbo.DDOCUMENTO.nImpuesto1, dbo.DDOCUMENTO.nImpuesto2, dbo.DDOCUMENTO.nImpuesto3,(SELECT Impuesto1 FROM dbo.TPARAMETRO) as pImpuesto1 ,(SELECT Impuesto2 FROM dbo.TPARAMETRO) as pImpuesto2,(SELECT Impuesto3 FROM dbo.TPARAMETRO) as pImpuesto3, dbo.DDOCUMENTO.nPrecioNeto " & _
    "FROM dbo.DDOCUMENTO INNER JOIN " & _
    "dbo.TPRODUCTO ON dbo.DDOCUMENTO.tCodigoProducto = dbo.TPRODUCTO.tCodigoProducto " & _
    "WHERE (dbo.DDOCUMENTO.tDocumento = '" & tDocumento & "')", Cn)
    
    If rsDetDocumento.RecordCount > 0 Then
        infoDetalle = "<detalles>" & vbCrLf
        rsDetDocumento.MoveFirst
        For d = 0 To rsDetDocumento.RecordCount - 1
        
        infoDetalle = infoDetalle & "<detalle>" & vbCrLf & _
                "<concepto>" & rsDetDocumento!tDetallado & "</concepto>" & vbCrLf & _
                "<cantidad>" & Format(rsDetDocumento!nCantidad, "###,###,##0.00") & "</cantidad>" & vbCrLf & _
                "<precioUnitario>" & Format(rsDetDocumento!nPrecioNeto, "###,###,##0.00") & "</precioUnitario>" & vbCrLf & _
                "<descuento>" & Format(rsDetDocumento!nDescuento, "###,###,##0.00") & "</descuento>" & vbCrLf & _
                "<precioTotal>" & Format(rsDetDocumento!Neto, "###,###,##0.00") & "</precioTotal>" & vbCrLf & _
            "</detalle>" & vbCrLf
        rsDetDocumento.MoveNext
        Next d
        infoDetalle = infoDetalle & "</detalles>"
    End If
    
    If sDireccion2 <> "" Then
        infoDetalle = infoDetalle & vbCrLf & "<infoAdicional> " & vbCrLf & _
                      "<campoAdicional nombre=""Direccion Establecimiento"">" & sDireccion2 & "</campoAdicional> " & vbCrLf & _
                      "</infoAdicional>"
    End If
    
    InfoTributario = Replace(InfoTributario, "&", "&amp;", , , vbTextCompare)
    infoDetalle = Replace(infoDetalle, "&", "&amp;", , , vbTextCompare)
    documentoInfoTributario.loadXML (InfoTributario)
    documentoDetalle.loadXML (infoDetalle)

    nod_union.appendChild documentoInfoTributario.getElementsByTagName("infoTributaria")(0)
    nod_union.appendChild documentoDetalle.getElementsByTagName("detalles")(0)
    
    documento_Completo.appendChild documento_Completo.createProcessingInstruction("xml", "version='1.0' encoding='UTF-8'")
    documento_Completo.appendChild nod_union
    documento_Completo.Save (Ruta & tDocumento & ".xml")

    Set nod_union = Nothing


    Set documentoInfoTributario = Nothing
    Set documentoinfoFactura = Nothing
    Set documentoDetalle = Nothing
    Set documento_Completo = Nothing
    Exit Function
fin:
    MsgBox error
End Function


Public Function FechaServidorTipoCambio() As Date
    FechaServidorTipoCambio = Calcular("SELECT CONVERT(NVARCHAR,GETDATE(),103) As Codigo", Cn)
End Function


'TVARIABLE CESAR
Public Sub ImprimeFacturaVariable(RsImpresion As Recordset, Empresa As String, Optional tTipoDoc As String)
    ximprimeDetallado = Calcular("select lImprimeresumen as codigo from ttipodocumentoimpresora where ttipoemision='" & tTipoDoc & "' and  tcaja='" & sCaja & "'", Cn)
                    
                    
    On Error Resume Next
    Dim Item As String
    Dim xObservacion As String
    Dim sLinea As String
    Dim txt As String
    Dim nSumaNeto As Double
    
    '---CESAR IMP
    Dim imp1 As Double
    Dim imp2 As Double
    Dim impxT As Double
    Dim impx1 As Double
    Dim impx2 As Double
    Dim impG As Double
    Dim xDescuento As Double
    Dim xRecargo As Double
    Dim xSubTotal As Double
    Dim xDiferencia As Double
    Dim xAumento As Double
    
    Dim RsPagoDocumento As ADODB.Recordset
    Dim lcuentaCobrar As Boolean
                            
    imp1 = Calcular("select ISNULL(Impuesto1,0) as Codigo from TPARAMETRO", Cn)
    imp2 = Calcular("select ISNULL(Impuesto2,0) as Codigo from TPARAMETRO", Cn)
    impxT = 1 + (imp1 / 100) + (imp2 / 100)
    impx1 = 1 + (imp1 / 100)
    impx2 = 1 + (imp2 / 100)
    impG = 1
    '------------------
    
    Dim sNum As String
    Dim i As Integer
        Dim sIGV As Double
    Dim cIGV As Double
    Dim DescuentoCero As Double
    'Cabecera
    Printer.PaperSize = vbPRPSUser
    Printer.Orientation = vbPRORPortrait
    RsImpresion.MoveFirst
    
    Select Case Empresa
           Case Is = "001" 'ESTANDAR
           
                    'CABECERA
                    For i = 1 To nCabeceraV
                        Printer.Print
                    Next i
       
                    sIGV = 0
                    cIGV = 0
                    DescuentoCero = 0
                    
                    '----- CLIENTE -------
                    Printer.Print String(15, "-") & " CLIENTE " & String(16, "-")
                    
                    Printer.Print "Fecha    : " & RsImpresion!fRegistro
                    Printer.Print "Cedul/RUC: " & RsImpresion!Ruc
                    If Len(RsImpresion!Cliente) < 30 Then
                       Printer.Print "Cliente  : " & RsImpresion!Cliente
                       Printer.Print " "
                    Else
                       ImprimeXLinea "Cliente  : " & RsImpresion!Cliente, 40, 11
                    End If
                    Printer.Print "Direccion: " & RsImpresion!direccion
                    Printer.Print String(40, "-")
                                                                     
                    Printer.Print
                    Printer.Print "Pedido   : " & RsImpresion!tCodigoPedido
                    Printer.Print "Mesa     : " & IIf(RsImpresion!tMesa = "", "", Calcular("select isnull(tresumido,'') codigo from tmesa where tcodigomesa='" & RsImpresion!tMesa & "'", Cn))
                    Printer.Print "Caja     : " & RsImpresion!tCaja & " - " & RsImpresion!tUsuario
                    Printer.Print "Mesero   : " & RsImpresion!Mozo
                    Printer.Print "Descuento: " & Mid(Trim(RsImpresion!DESCUENTO), 1, 30)
                    Printer.Print
                    Printer.Print String(40, "-")
                    Printer.Print "Cant. Articulo            P.Unit P.Total"
                    Printer.Print String(40, "-")
                                      
                                      
                    'CUERPO
                    Item = ""
                    i = 0
                    j = 0

                    Do While Not RsImpresion.EOF
                    If ximprimeDetallado = False Then
                        xproducto = RsImpresion!Producto
                    Else
                        xproducto = RsImpresion!ProductoDetallado
                    End If
                    
                       If Item <> RsImpresion!tCodigoPedido + RsImpresion!tItem Then
                       
                            If RsImpresion!nImpuesto1 > 0 Then
                               cIGV = cIGV + (RsImpresion!nPrecioNeto * RsImpresion!nCantidad)
                            Else
                               sIGV = sIGV + (RsImpresion!nPrecioNeto * RsImpresion!nCantidad)
                            End If
                       
                            'CESAR IMPUESTO
                            If RsImpresion!nImpuesto1 > 0 And RsImpresion!nImpuesto2 > 0 Then
                                  impG = impxT
                            ElseIf RsImpresion!nImpuesto1 > 0 And RsImpresion!nImpuesto2 = 0 Then
                                  impG = impx1
                            ElseIf RsImpresion!nImpuesto1 = 0 And RsImpresion!nImpuesto2 > 0 Then
                                  impG = impx2
                            Else
                                  impG = 1
                            End If
                            
                            i = i + 1
                          
                          
                            '---CESAR IMP
                            xDiferencia = ((RsImpresion!nPrecioOficial * RsImpresion!nCantidad) / impG) - (RsImpresion!Venta - (RsImpresion!nImpuesto1 * RsImpresion!nCantidad) - (RsImpresion!nImpuesto2 * RsImpresion!nCantidad))
                            xDescuento = xDescuento + xDiferencia
                            xAumento = (RsImpresion!Venta - (RsImpresion!nImpuesto1 * RsImpresion!nCantidad) - (RsImpresion!nImpuesto2 * RsImpresion!nCantidad)) - ((RsImpresion!nPrecioOficial * RsImpresion!nCantidad) / impG)
                            xRecargo = xRecargo + xAumento
                            xSubTotal = xSubTotal + ((RsImpresion!nPrecioOficial * RsImpresion!nCantidad) / impG)
                            '------------
                          
                            sLinea = Right(String(5, " ") & Format(RsImpresion!nCantidad, "#0.00"), 5) & " " & Mid(xproducto & String(19, " "), 1, 19) & " " & Right(String(6, " ") & Format(RsImpresion!nPrecioOficial / impG, "##0.00"), 6) & " " & Right(String(7, " ") & Format((RsImpresion!nPrecioOficial * RsImpresion!nCantidad) / impG, "###0.00"), 7)
                            Printer.Print sLinea
 
                       End If
                                             
                        Item = RsImpresion!tCodigoPedido + RsImpresion!tItem
                        RsImpresion.MoveNext
                    Loop
                    
                    
                    'ITEM DETALLE
                    For j = i To nItemV
                        Printer.Print " "
                    Next j
                                        
                    'IMPRESION DE PRE PIE DE PAGINA
                    Printer.Print String(40, "-")
                    RsImpresion.MoveLast
                    
                    If lPagoAntesImpresion Then
                        lcuentaCobrar = True
                        If lcuentaCobrar And lPagocortesiaAI = False Then
                            Printer.Print Right(String(27, " ") & "Sub Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xSubTotal, "##,###,##0.00"), 13)
                            Printer.Print String(40, " ")
                        Else
                            Printer.Print Right(String(27, " ") & "Sub Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(0, "##,###,##0.00"), 13)
                            Printer.Print String(40, " ")
                        End If
                    Else
                        Printer.Print Right(String(27, " ") & "Sub Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xSubTotal, "##,###,##0.00"), 13)
                        Printer.Print String(40, " ")
                    End If
                    
                    If RsImpresion!nRecargo > 0 Then
                       Printer.Print
                       Printer.Print Right(String(27, " ") & "Recargo " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xRecargo, "##,###,##0.00"), 13)
                    End If
                    
                    If RsImpresion!nDescuento > 0 Then
                       Printer.Print Right(String(27, " ") & "Descuento " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xDescuento, "##,###,##0.00"), 13)
                    Else
                       Printer.Print Right(String(27, " ") & "Descuento " & sMonN & " : ", 27) & Right(String(13, " ") & Format(DescuentoCero, "##,###,##0.00"), 13)
                    End If
                            
                    Printer.Print Right(String(27, " ") & "Base " & sImpuesto1 & " " & nPorcentaje1 & "%: ", 27) & Right(String(13, " ") & Format(cIGV, "##,###,##0.00"), 13)
                    Printer.Print Right(String(27, " ") & "Base " & sImpuesto1 & " 0%: ", 27) & Right(String(13, " ") & Format(sIGV, "##,###,##0.00"), 13)
                    Printer.Print ""
                    
                    nSumaNeto = RsImpresion!nNeto
                    
                    If IsNull(RsImpresion!lImpuesto1) Or Not RsImpresion!lImpuesto1 Then
                       nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto1
                    End If
                    
                    If IsNull(RsImpresion!lImpuesto2) Or Not RsImpresion!lImpuesto2 Then
                       nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto2
                    End If
                    
                    If IsNull(RsImpresion!lImpuesto3) Or Not RsImpresion!lImpuesto3 Then
                       nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto3
                    End If
                    
                    'CESAR IMPRESION IMPUESTO - FACTURA
                    If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
                       Printer.Print Right(String(27, " ") & "Sub Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(nSumaNeto, "##,###,##0.00"), 13)
                    End If
                                  
                    If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                       Printer.Print Right(String(27, " ") & sImpuesto1 & " " & Format(nPorcentaje1, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,##0.00"), 13)
                    End If
                       
                    If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                       Printer.Print Right(String(27, " ") & sImpuesto2 & " " & Format(nPorcentaje2, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto2, "##,###,##0.00"), 13)
                    End If
                    
                    If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                       Printer.Print Right(String(27, " ") & sImpuesto3 & " " & Format(nPorcentaje3, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto3, "##,###,##0.00"), 13)
                    End If
                    
                    If lPagoAntesImpresion Then
                        lcuentaCobrar = True
                        If lcuentaCobrar And lPagocortesiaAI = False Then
                            Printer.Print Right(String(27, " ") & "Total " & sMonN & " :", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 13)
        
                            Printer.Print
                            txt = "Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
                            ImprimeXLinea txt, 40, 5
                        Else
                            Printer.Print Right(String(27, " ") & "Total " & sMonN & " :", 27) & Right(String(13, " ") & Format(0, "##,###,##0.00"), 13)
        
                            Printer.Print
                            txt = "Son: " & NumeroCadena(str(0)) & " " & sMonedaN
                            ImprimeXLinea txt, 40, 5
                        End If
                    Else
                        Printer.Print Right(String(27, " ") & "Total " & sMonN & " :", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 13)
    
                        Printer.Print
                        txt = "Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
                        ImprimeXLinea txt, 40, 5
                    End If
'                    Printer.Print Right(String(27, " ") & "Total " & sMonN & " :", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 13)
'
'                    Printer.Print
'                    txt = "Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
'                    ImprimeXLinea txt, 40, 5
                    Printer.Print String(40, "-")
                    Printer.Print "Inforest v.4.94 "
                    
                    'Forma de Pago
                    If lPagoAntesImpresion Then
                        lcuentaCobrar = True
                        'Set RsPagoDocumento = Lib.OpenRecordset("select Distinct v.Descripcion + ' ' + M.tResumido as pago , Sum(D.nMonto) as monto from DPAGODOCUMENTO D inner join vTipoPago v on d.tTipoPago = v.Codigo inner join vMoneda M on M.Codigo = D.tMoneda Where D.tDocumento = '" & RsImpresion!tDocumento & "' group by v.Descripcion,  M.tResumido", Cn)
                        Set RsPagoDocumento = Lib.OpenRecordset("exec usp_Inforest_Impresion '" & RsImpresion!tDocumento & "', 9 ", Cn)
                        Printer.Print " "

                        If pais = "000" Then 'PERU
                            Printer.Print String(40, "-")
                            
                            If RsPagoDocumento.RecordCount > 0 Then
                                Printer.Print "Forma de Pago:"
                                For i = 0 To RsPagoDocumento.RecordCount - 1
                                    lcuentaCobrar = False
                                    Printer.Print RsPagoDocumento!pago & " " & Format(RsPagoDocumento!Monto, "##,###,##0.00")
                                    RsPagoDocumento.MoveNext
                                Next i
                                Printer.Print "Vuelto       :" & sMonN & " " & Format(RsImpresion!Vuelto, "##,###,##0.00")
                            Else
                                If lcuentaCobrar And lPagocortesiaAI = False Then
                                    Printer.Print "Forma de Pago:Enviado a Cuenta por Cobrar"
                                Else
                                    'Printer.Print "Forma de Pago:Cortesia"
                                    ImprimeXLinea "Forma de Pago: " & lGlosaTrans, 40, 15
                                End If
                            End If
                            Printer.Print String(40, "-")
                            
                        Else 'ECUADOR
                            If RsPagoDocumento.RecordCount > 0 Then
                                For i = 0 To RsPagoDocumento.RecordCount - 1
                                    lcuentaCobrar = False
                                    Printer.Print "Forma de Pago:" & RsPagoDocumento!pago & " " & Format(RsPagoDocumento!Monto, "##,###,##0.00")
                                    RsPagoDocumento.MoveNext
                                Next i
                            Else
                                If lcuentaCobrar And lPagocortesiaAI = False Then
                                    Printer.Print "Forma de Pago:Enviado a Cuenta por Cobrar"
                                Else
                                    'Printer.Print "Forma de Pago:Cortesia"
                                    ImprimeXLinea "Forma de Pago: " & lGlosaTrans, 40, 15
                                End If
                            End If
                        End If
                        
                        Printer.Print " "
                    End If
                 
                 
                    'PIE
                    i = 0
                    For i = 1 To nPieV
                        Printer.Print " "
                    Next i
                    Printer.Print "."
                    
           '-------------------------------------------------
           
             Case Is = "002" 'mancorita
           
                    'CABECERA
                    For i = 1 To nCabeceraV
                        Printer.Print
                    Next i
           

                    sIGV = 0
                    cIGV = 0
                    DescuentoCero = 0
                    
                    '----- CLIENTE -------
                    Printer.Print String(15, "-") & " CLIENTE " & String(16, "-")
                    
                    Printer.Print "Fecha    : " & RsImpresion!fRegistro
                    Printer.Print "Cedul/RUC: " & RsImpresion!Ruc
                    If Len(RsImpresion!Cliente) < 30 Then
                       Printer.Print "Cliente  : " & RsImpresion!Cliente
                       Printer.Print " "
                    Else
                       ImprimeXLinea "Cliente  : " & RsImpresion!Cliente, 40, 11
                    End If
                    Printer.Print "Direccion: " & RsImpresion!direccion
                    Printer.Print String(40, "-")
                                                                     
                    Printer.Print
                    Printer.Print "Documento: " & RsImpresion!tDocumento
                    Printer.Print
                    Printer.Print String(40, "-")
                    Printer.Print "Cant. Articulo            P.Unit P.Total"
                    Printer.Print String(40, "-")
                                      
                                      
                    'CUERPO
                    Item = ""
                    i = 0
                    j = 0

                    Do While Not RsImpresion.EOF
                    If ximprimeDetallado = False Then
                        xproducto = RsImpresion!Producto
                    Else
                        xproducto = RsImpresion!ProductoDetallado
                    End If
                    
                       If Item <> RsImpresion!tCodigoPedido + RsImpresion!tItem Then
                       
                            If RsImpresion!nImpuesto1 > 0 Then
                               cIGV = cIGV + (RsImpresion!nPrecioNeto * RsImpresion!nCantidad)
                            Else
                               sIGV = sIGV + (RsImpresion!nPrecioNeto * RsImpresion!nCantidad)
                            End If
                       
                            'CESAR IMPUESTO
                            If RsImpresion!nImpuesto1 > 0 And RsImpresion!nImpuesto2 > 0 Then
                                  impG = impxT
                            ElseIf RsImpresion!nImpuesto1 > 0 And RsImpresion!nImpuesto2 = 0 Then
                                  impG = impx1
                            ElseIf RsImpresion!nImpuesto1 = 0 And RsImpresion!nImpuesto2 > 0 Then
                                  impG = impx2
                            Else
                                  impG = 1
                            End If
                            
                            i = i + 1
                          
                            '---CESAR IMP
                            xDiferencia = ((RsImpresion!nPrecioOficial * RsImpresion!nCantidad) / impG) - (RsImpresion!Venta - (RsImpresion!nImpuesto1 * RsImpresion!nCantidad) - (RsImpresion!nImpuesto2 * RsImpresion!nCantidad))
                            xDescuento = xDescuento + xDiferencia
                            xAumento = (RsImpresion!Venta - (RsImpresion!nImpuesto1 * RsImpresion!nCantidad) - (RsImpresion!nImpuesto2 * RsImpresion!nCantidad)) - ((RsImpresion!nPrecioOficial * RsImpresion!nCantidad) / impG)
                            xRecargo = xRecargo + xAumento
                            xSubTotal = xSubTotal + ((RsImpresion!nPrecioOficial * RsImpresion!nCantidad) / impG)
                            '------------
                              
                          sLinea = Right(String(5, " ") & Format(RsImpresion!nCantidad, "#0.00"), 5) & " " & Mid(xproducto & String(19, " "), 1, 19) & " " & Right(String(6, " ") & Format(RsImpresion!nPrecioOficial / impG, "##0.00"), 6) & " " & Right(String(7, " ") & Format((RsImpresion!nPrecioOficial * RsImpresion!nCantidad) / impG, "###0.00"), 7)
                          Printer.Print sLinea
                       End If
                                                                    
                        Item = RsImpresion!tCodigoPedido + RsImpresion!tItem
                        RsImpresion.MoveNext
                    Loop
                    
                    
                    'ITEM DETALLE
                    For j = i To nItemV
                        Printer.Print " "
                    Next j
                                        
                    'IMPRESION DE PRE PIE DE PAGINA
                    Printer.Print String(40, "-")
                    RsImpresion.MoveLast
                    
                    If lPagoAntesImpresion Then
                        lcuentaCobrar = True
                        If lcuentaCobrar And lPagocortesiaAI = False Then
                            Printer.Print Right(String(27, " ") & "Sub Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xSubTotal, "##,###,##0.00"), 13)
                            Printer.Print String(40, " ")
                        Else
                            Printer.Print Right(String(27, " ") & "Sub Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(0, "##,###,##0.00"), 13)
                            Printer.Print String(40, " ")
                        End If
                    Else
                        Printer.Print Right(String(27, " ") & "Sub Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xSubTotal, "##,###,##0.00"), 13)
                        Printer.Print String(40, " ")
                    End If
                    
                    If RsImpresion!nRecargo > 0 Then
                       Printer.Print
                       Printer.Print Right(String(27, " ") & "Recargo " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xRecargo, "##,###,##0.00"), 13)
                    End If
                    
                    If RsImpresion!nDescuento > 0 Then
                       Printer.Print Right(String(27, " ") & "Descuento " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xDescuento, "##,###,##0.00"), 13)
                    Else
                       Printer.Print Right(String(27, " ") & "Descuento " & sMonN & " : ", 27) & Right(String(13, " ") & Format(DescuentoCero, "##,###,##0.00"), 13)
                    End If
                            
                    Printer.Print Right(String(27, " ") & "Base " & sImpuesto1 & " " & nPorcentaje1 & "%: ", 27) & Right(String(13, " ") & Format(cIGV, "##,###,##0.00"), 13)
                    Printer.Print Right(String(27, " ") & "Base " & sImpuesto1 & " 0%: ", 27) & Right(String(13, " ") & Format(sIGV, "##,###,##0.00"), 13)
                    Printer.Print ""
                    
                    nSumaNeto = RsImpresion!nNeto
                    
                    If IsNull(RsImpresion!lImpuesto1) Or Not RsImpresion!lImpuesto1 Then
                       nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto1
                    End If
                    
                    If IsNull(RsImpresion!lImpuesto2) Or Not RsImpresion!lImpuesto2 Then
                       nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto2
                    End If
                    
                    If IsNull(RsImpresion!lImpuesto3) Or Not RsImpresion!lImpuesto3 Then
                       nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto3
                    End If
                    
                    'CESAR IMPRESION IMPUESTO - FACTURA
                    If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
                       Printer.Print Right(String(27, " ") & "Sub Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(nSumaNeto, "##,###,##0.00"), 13)
                    End If
                                  
                    If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                       Printer.Print Right(String(27, " ") & sImpuesto1 & " " & Format(nPorcentaje1, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,##0.00"), 13)
                    End If
                       
                    If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                       Printer.Print Right(String(27, " ") & sImpuesto2 & " " & Format(nPorcentaje2, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto2, "##,###,##0.00"), 13)
                    End If
                    
                    If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                       Printer.Print Right(String(27, " ") & sImpuesto3 & " " & Format(nPorcentaje3, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto3, "##,###,##0.00"), 13)
                    End If
                    
                    If lPagoAntesImpresion Then
                        lcuentaCobrar = True
                        If lcuentaCobrar And lPagocortesiaAI = False Then
                          Printer.Print Right(String(27, " ") & "Total " & sMonN & " :", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 13)
                
                          Printer.Print
                          txt = "Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
                          ImprimeXLinea txt, 40, 5
                        Else
                          Printer.Print Right(String(27, " ") & "Total " & sMonN & " :", 27) & Right(String(13, " ") & Format(0, "##,###,##0.00"), 13)
                
                          Printer.Print
                          txt = txt = "Son: " & NumeroCadena(str(0)) & " " & sMonedaN
                          ImprimeXLinea txt, 40, 5
                        End If
                    Else
                      Printer.Print Right(String(27, " ") & "Total " & sMonN & " :", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 13)
            
                      Printer.Print
                      txt = "Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
                      ImprimeXLinea txt, 40, 5
                    End If

                    Printer.Print Right(String(27, " ") & "Total " & sMonN & " :", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 13)
          
                    Printer.Print
                    txt = "Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
                    ImprimeXLinea txt, 40, 5
                    
                    Printer.Print String(40, "-")
                    Printer.Print "Inforest v.4.94 "
                    
                    'Forma de Pago
                    If lPagoAntesImpresion Then
                        lcuentaCobrar = True
                        'Set RsPagoDocumento = Lib.OpenRecordset("select Distinct v.Descripcion + ' ' + M.tResumido as pago , Sum(D.nMonto) as monto from DPAGODOCUMENTO D inner join vTipoPago v on d.tTipoPago = v.Codigo inner join vMoneda M on M.Codigo = D.tMoneda Where D.tDocumento = '" & RsImpresion!tDocumento & "' group by v.Descripcion,  M.tResumido", Cn)
                        Set RsPagoDocumento = Lib.OpenRecordset("exec usp_Inforest_Impresion '" & RsImpresion!tDocumento & "', 9 ", Cn)
                        Printer.Print " "

                        If pais = "000" Then 'PERU
                            Printer.Print String(40, "-")
                           If RsPagoDocumento.RecordCount > 0 Then
                             Printer.Print "Forma de Pago:"
                                For i = 0 To RsPagoDocumento.RecordCount - 1
                                    lcuentaCobrar = False
                                    Printer.Print RsPagoDocumento!pago & " " & Format(RsPagoDocumento!Monto, "##,###,##0.00")
                                    RsPagoDocumento.MoveNext
                                Next i
                                Printer.Print "Vuelto       :" & sMonN & " " & Format(RsImpresion!Vuelto, "##,###,##0.00")
                            Else
                                If lcuentaCobrar And lPagocortesiaAI = False Then
                                    Printer.Print "Forma de Pago:Enviado a Cuenta por Cobrar"
                                Else
                                    'Printer.Print "Forma de Pago:Cortesia"
                                    ImprimeXLinea "Forma de Pago: " & lGlosaTrans, 40, 15
                                End If
                            End If
                            Printer.Print String(40, "-")
                            
                        Else 'ECUADOR
                            If RsPagoDocumento.RecordCount > 0 Then
                                For i = 0 To RsPagoDocumento.RecordCount - 1
                                    lcuentaCobrar = False
                                    Printer.Print "Forma de Pago:" & RsPagoDocumento!pago & " " & Format(RsPagoDocumento!Monto, "##,###,##0.00")
                                    RsPagoDocumento.MoveNext
                                Next i
                            Else
                                If lcuentaCobrar And lPagocortesiaAI = False Then
                                    Printer.Print "Forma de Pago:Enviado a Cuenta por Cobrar"
                                Else
                                    'Printer.Print "Forma de Pago:Cortesia"
                                    ImprimeXLinea "Forma de Pago: " & lGlosaTrans, 40, 15
                                End If
                            End If
                        End If

                        Printer.Print " "
                    End If
                                       
                    'PIE
                    i = 0
                    For i = 1 To nPieV
                        Printer.Print " "
                    Next i
                    Printer.Print "."
                    
           '-------------------------------------------------
  
        End Select
        Printer.EndDoc
End Sub



Function ValidaEcuadorCedulaRuc(sIdentificacion As String) As Boolean
    Dim lnColumna As Integer
    Dim lcCadena1 As String * 23
    Dim lnResultado As Integer
    Dim lnValor As Integer
    Dim lnDigito As Integer
    Dim lnTotal As Integer
    lnColumna = 1
    lcCadena1 = ""
    
    Do While lnColumna < 10
        lnResultado = lnColumna Mod 2
        If lnResultado = 0 Then
            lcCadena1 = Trim$(lcCadena1) + Mid$(sIdentificacion, lnColumna, 1)
        Else
            lcCadena1 = Trim$(lcCadena1) + str(Val(Mid$(sIdentificacion, lnColumna, 1)) * 2)
        End If
        lnColumna = lnColumna + 1
    Loop

    lnValor = 0
    lnColumna = 1
    
    Do While Len(lcCadena1) > lnColumna
        lnValor = lnValor + Val(Mid$(lcCadena1, lnColumna, 1))
        lnColumna = lnColumna + 1
    Loop
    
    lnDigito = 0
    lnTotal = lnValor
    
    Do While lnResultado <> 0
        lnResultado = lnTotal Mod 10
        If lnResultado = 0 Then
            lnDigito = lnTotal - lnValor
        Else
            lnTotal = lnTotal + 1
        End If
    Loop
    
    If lnDigito = Val(Mid$(sIdentificacion, 10, 1)) Then
        ValidaEcuadorCedulaRuc = True
    Else
        ValidaEcuadorCedulaRuc = False
    End If
    
    If Val(sIdentificacion) <= 0 Then
        ValidaEcuadorCedulaRuc = False
    End If
    
    ' VALIDACION RUC PUBLICOS
    Dim CoeJuridico As String
    Dim CoePublicos As String
    Dim lxColumna As Integer
    Dim lxValor As Integer
    Dim lxResiduo As Integer
    
    lxColumna = 1
    lxValor = 0
    
    CoeJuridico = "432765432"
    CoePublicos = "32765432"
    
    If ValidaEcuadorCedulaRuc = False Then
    
       If 9 = Mid$(sIdentificacion, 3, 1) Then
       
            Do While lxColumna < 10
                    lxValor = lxValor + Val(Mid$(sIdentificacion, lxColumna, 1)) * Val(Mid$(CoeJuridico, lxColumna, 1))
                    lxColumna = lxColumna + 1
            Loop
                        
            lxResiduo = lxValor Mod 11
            
            If lxResiduo = 0 Then
               lxResiduo = 11
            End If
            
            If (11 - lxResiduo) = Val(Mid$(sIdentificacion, 10, 1)) Then
                ValidaEcuadorCedulaRuc = True
            Else
                ValidaEcuadorCedulaRuc = False
            End If
            
       
       ElseIf 6 = Mid$(sIdentificacion, 3, 1) Then
       
            Do While lxColumna < 9
                    lxValor = lxValor + Val(Mid$(sIdentificacion, lxColumna, 1)) * Val(Mid$(CoePublicos, lxColumna, 1))
                    lxColumna = lxColumna + 1
            Loop
                        
            lxResiduo = lxValor Mod 11
            
            If lxResiduo = 0 Then
               lxResiduo = 11
            End If
            
            If (11 - lxResiduo) = Val(Mid$(sIdentificacion, 9, 1)) Then
                ValidaEcuadorCedulaRuc = True
            Else
                ValidaEcuadorCedulaRuc = False
            End If
       
       Else
           ValidaEcuadorCedulaRuc = False
       End If
       
    End If
    
     
End Function



Public Sub ImprimeFacturaVariableConsumo(RsImpresion As Recordset, sConsumo As String, Empresa As String)

    On Error Resume Next
    Dim Item As String
    Dim xObservacion As String
    Dim sLinea As String
    Dim txt As String
    Dim nSumaNeto As Double
    
    Dim i As Integer
    Dim j As Integer
    Dim lin As String
    Dim tOt As Integer
    Dim pos As Integer
    Dim pri As Boolean
    
    '---CESAR IMP
    Dim imp1 As Double
    Dim imp2 As Double
    Dim impxT As Double
    Dim impx1 As Double
    Dim impx2 As Double
    Dim impG As Double
    Dim xDescuento As Double
    Dim xRecargo As Double
    Dim xSubTotal As Double
    Dim xDiferencia As Double
    Dim xAumento As Double
    
    Dim RsPagoDocumento As ADODB.Recordset
    Dim lcuentaCobrar As Boolean
                        
    imp1 = Calcular("select ISNULL(Impuesto1,0) as Codigo from TPARAMETRO", Cn)
    imp2 = Calcular("select ISNULL(Impuesto2,0) as Codigo from TPARAMETRO", Cn)
    impxT = 1 + (imp1 / 100) + (imp2 / 100)
    impx1 = 1 + (imp1 / 100)
    impx2 = 1 + (imp2 / 100)
    impG = 1
    '------------------
    
    Dim sNum As String
            
    Dim sIGV As Double
    Dim cIGV As Double
    Dim DescuentoCero As Double
    'Cabecera
    Printer.PaperSize = vbPRPSUser
    Printer.Orientation = vbPRORPortrait
    RsImpresion.MoveFirst
    
    
    
    Select Case Empresa
           Case Is = "001" ' ECUADOR
           
                    'CABECERA
                    For i = 1 To nCabeceraV
                        Printer.Print
                    Next i

                    sIGV = 0
                    cIGV = 0
                    DescuentoCero = 0
                    
                    '----- CLIENTE -------
                    Printer.Print String(15, "-") & " CLIENTE " & String(16, "-")
                    
                    Printer.Print "Fecha    : " & RsImpresion!fRegistro
                    Printer.Print "Cedul/RUC: " & RsImpresion!Ruc
                    If Len(RsImpresion!Cliente) < 30 Then
                       Printer.Print "Cliente  : " & RsImpresion!Cliente
                       Printer.Print " "
                    Else
                       ImprimeXLinea "Cliente  : " & RsImpresion!Cliente, 40, 11
                    End If
                    Printer.Print "Direccion: " & RsImpresion!direccion
                    Printer.Print String(40, "-")
                                                                     
                    Printer.Print
                    Printer.Print "Pedido   : " & sPedido
                    Printer.Print "Mesa     : " & IIf(RsImpresion!tMesa = "", "", Calcular("select isnull(tresumido,'') codigo from tmesa where tcodigomesa='" & RsImpresion!tMesa & "'", Cn))
                    
                    Printer.Print "Caja     : " & RsImpresion!tCaja & " - " & RsImpresion!tUsuario
                    Printer.Print "Mesero   : " & RsImpresion!Mozo
                    Printer.Print "Descuento: " & Mid(Trim(RsImpresion!DESCUENTO), 1, 30)
                    Printer.Print
                    Printer.Print String(40, "-")
                    Printer.Print "Cant. Articulo            P.Unit P.Total"
                    Printer.Print String(40, "-")


                 For i = 1 To nDetalle
                     Printer.Print
                 Next i

                 'Cuerpo
                 txt = sConsumo
                 tOt = Len(Trim(txt))
                 pri = True
                 j = 0
                 
                 'IMPRESIO POR CONSUMO
                 Do While tOt <> 0
                    j = j + 1
                    lin = Mid(txt & " ", 1, 50)
                    For i = 50 To 1 Step -1
                        If Mid(lin, i, 1) = " " Then
                           pos = i
                           Exit For
                        End If
                    Next i
                    If pri Then
                       sLinea = "         " & Mid(Mid(txt, 1, pos - 1) & String(56, " "), 1, 56) & " " & Right(String(12, " ") & Format(RsImpresion!nVenta, "#,###,##0.00"), 12)
                       pri = False
                    Else
                       sLinea = "         " & Mid(txt, 1, pos - 1)
                    End If
                    txt = Mid(txt, pos + 1, tOt)
                    tOt = Len(txt)
                    Printer.Print sLinea
                 Loop
                 
                 'DATOS DE DETALLE PARA TOTALES
                 Do While Not RsImpresion.EOF

                       If Item <> RsImpresion!tCodigoPedido + RsImpresion!tItem Then
                       
                            If RsImpresion!nImpuesto1 > 0 Then
                               cIGV = cIGV + (RsImpresion!nPrecioNeto * RsImpresion!nCantidad)
                            Else
                               sIGV = sIGV + (RsImpresion!nPrecioNeto * RsImpresion!nCantidad)
                            End If
                    
                            'CESAR IMPUESTO
                            If RsImpresion!nImpuesto1 > 0 And RsImpresion!nImpuesto2 > 0 Then
                                  impG = impxT
                            ElseIf RsImpresion!nImpuesto1 > 0 And RsImpresion!nImpuesto2 = 0 Then
                                  impG = impx1
                            ElseIf RsImpresion!nImpuesto1 = 0 And RsImpresion!nImpuesto2 > 0 Then
                                  impG = impx2
                            Else
                                  impG = 1
                            End If
                            
                            i = i + 1
                          
                            '---CESAR IMP
                            xDiferencia = ((RsImpresion!nPrecioOficial * RsImpresion!nCantidad) / impG) - (RsImpresion!Venta - (RsImpresion!nImpuesto1 * RsImpresion!nCantidad) - (RsImpresion!nImpuesto2 * RsImpresion!nCantidad))
                            xDescuento = xDescuento + xDiferencia
                            xAumento = (RsImpresion!Venta - (RsImpresion!nImpuesto1 * RsImpresion!nCantidad) - (RsImpresion!nImpuesto2 * RsImpresion!nCantidad)) - ((RsImpresion!nPrecioOficial * RsImpresion!nCantidad) / impG)
                            xRecargo = xRecargo + xAumento
                            xSubTotal = xSubTotal + ((RsImpresion!nPrecioOficial * RsImpresion!nCantidad) / impG)
                            '------------
                          
                          sLinea = Right(String(5, " ") & Format(RsImpresion!nCantidad, "#0.00"), 5) & " " & Mid(RsImpresion!Producto & String(19, " "), 1, 19) & " " & Right(String(6, " ") & Format(RsImpresion!nPrecioOficial / impG, "##0.00"), 6) & " " & Right(String(7, " ") & Format((RsImpresion!nPrecioOficial * RsImpresion!nCantidad) / impG, "###0.00"), 7)
                       End If
                                                                    
                        Item = RsImpresion!tCodigoPedido + RsImpresion!tItem
                        RsImpresion.MoveNext
                  Loop
                 '-----------------------------
                    
                 For i = j To nItemV - 2
                     Printer.Print " "
                 Next i
                 
                 
                    'IMPRESION DE PRE PIE DE PAGINA
                    Printer.Print String(40, "-")
                    RsImpresion.MoveLast
                                        
                    Printer.Print Right(String(27, " ") & "Sub Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xSubTotal, "##,###,##0.00"), 13)
                    Printer.Print String(40, " ")
                    
                    If RsImpresion!nRecargo > 0 Then
                       Printer.Print
                       Printer.Print Right(String(27, " ") & "Recargo " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xRecargo, "##,###,##0.00"), 13)
                    End If
                    
                    If RsImpresion!nDescuento > 0 Then
                       Printer.Print Right(String(27, " ") & "Descuento " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xDescuento, "##,###,##0.00"), 13)
                    Else
                       Printer.Print Right(String(27, " ") & "Descuento " & sMonN & " : ", 27) & Right(String(13, " ") & Format(DescuentoCero, "##,###,##0.00"), 13)
                    End If
                            
                    Printer.Print Right(String(27, " ") & "Base " & sImpuesto1 & " " & nPorcentaje1 & "%: ", 27) & Right(String(13, " ") & Format(cIGV, "##,###,##0.00"), 13)
                    Printer.Print Right(String(27, " ") & "Base " & sImpuesto1 & " 0%: ", 27) & Right(String(13, " ") & Format(sIGV, "##,###,##0.00"), 13)
                    Printer.Print ""
                    
                    nSumaNeto = RsImpresion!nNeto
                    
                    If IsNull(RsImpresion!lImpuesto1) Or Not RsImpresion!lImpuesto1 Then
                       nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto1
                    End If
                    
                    If IsNull(RsImpresion!lImpuesto2) Or Not RsImpresion!lImpuesto2 Then
                       nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto2
                    End If
                    
                    If IsNull(RsImpresion!lImpuesto3) Or Not RsImpresion!lImpuesto3 Then
                       nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto3
                    End If
                    
                    'CESAR IMPRESION IMPUESTO - FACTURA
                    If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
                       Printer.Print Right(String(27, " ") & "Sub Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(nSumaNeto, "##,###,##0.00"), 13)
                    End If
                                  
                    If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                       Printer.Print Right(String(27, " ") & sImpuesto1 & " " & Format(nPorcentaje1, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,##0.00"), 13)
                    End If
                       
                    If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                       Printer.Print Right(String(27, " ") & sImpuesto2 & " " & Format(nPorcentaje2, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto2, "##,###,##0.00"), 13)
                    End If
                    
                    If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                       Printer.Print Right(String(27, " ") & sImpuesto3 & " " & Format(nPorcentaje3, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto3, "##,###,##0.00"), 13)
                    End If
                    

                    Printer.Print Right(String(27, " ") & "Total " & sMonN & " :", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 13)
          
                    Printer.Print
                    txt = "Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
                    ImprimeXLinea txt, 40, 5
                    Printer.Print String(40, "-")
                    Printer.Print "Inforest v.4.94 "
                    
                    If lPagoAntesImpresion Then
                        lcuentaCobrar = True
                        'Set RsPagoDocumento = Lib.OpenRecordset("select Distinct v.Descripcion + ' ' + M.tResumido as pago , Sum(D.nMonto) as monto from DPAGODOCUMENTO D inner join vTipoPago v on d.tTipoPago = v.Codigo inner join vMoneda M on M.Codigo = D.tMoneda Where D.tDocumento = '" & RsImpresion!tDocumento & "' group by v.Descripcion,  M.tResumido", Cn)
                        Set RsPagoDocumento = Lib.OpenRecordset("exec usp_Inforest_Impresion '" & RsImpresion!tDocumento & "', 9 ", Cn)
                        Printer.Print " "

                        If pais = "000" Then 'PERU
                            Printer.Print String(40, "-")
                            Printer.Print "Forma de Pago:"
                            If RsPagoDocumento.RecordCount > 0 Then
                                For i = 0 To RsPagoDocumento.RecordCount - 1
                                    lcuentaCobrar = False
                                    Printer.Print RsPagoDocumento!pago & Format(RsPagoDocumento!Monto, "##,###,##0.00")
                                    RsPagoDocumento.MoveNext
                                Next i
                                Printer.Print "Vuelto       :" & sMonN & Format(RsImpresion!Vuelto, "##,###,##0.00")
                            End If
                            If lcuentaCobrar Then
                                Printer.Print "Forma de Pago:Enviado a Cuenta por Cobrar"
                            End If
                            Printer.Print String(40, "-")
                            
                        Else 'ECUADOR
                            For i = 0 To RsPagoDocumento.RecordCount - 1
                                lcuentaCobrar = False
                                Printer.Print "Forma de Pago:" & RsPagoDocumento!pago & Format(RsPagoDocumento!Monto, "##,###,##0.00")
                                RsPagoDocumento.MoveNext
                            Next i
                            If lcuentaCobrar Then
                                Printer.Print "Forma de Pago:Enviado a Cuenta por Cobrar"
                            End If
                        End If

                        Printer.Print " "
                    End If
                                       
                                       
                    'PIE
                    i = 0
                    For i = 1 To nPieV
                        Printer.Print " "
                    Next i
                    Printer.Print "."
                    
           '-------------------------------------------------

 Case Is = "002" ' mancorita
           
                    'CABECERA
                    For i = 1 To nCabeceraV
                        Printer.Print
                    Next i
 
                    sIGV = 0
                    cIGV = 0
                    DescuentoCero = 0
                    
                    '----- CLIENTE -------
                    Printer.Print String(15, "-") & " CLIENTE " & String(16, "-")
                    
                    Printer.Print "Fecha    : " & RsImpresion!fRegistro
                    Printer.Print "Cedul/RUC: " & RsImpresion!Ruc
                    If Len(RsImpresion!Cliente) < 30 Then
                       Printer.Print "Cliente  : " & RsImpresion!Cliente
                       Printer.Print " "
                    Else
                       ImprimeXLinea "Cliente  : " & RsImpresion!Cliente, 40, 11
                    End If
                    Printer.Print "Direccion: " & RsImpresion!direccion
                    Printer.Print String(40, "-")
                                                                     
                    Printer.Print
                    Printer.Print "Documento: " & RsImpresion!tDocumento
                    Printer.Print
                    Printer.Print String(40, "-")
                    Printer.Print "Cant. Articulo            P.Unit P.Total"
                    Printer.Print String(40, "-")


                 For i = 1 To nDetalle
                     Printer.Print
                 Next i

                 'Cuerpo
                 txt = sConsumo
                 tOt = Len(Trim(txt))
                 pri = True
                 j = 0
                 
                 'IMPRESIO POR CONSUMO
                 Do While tOt <> 0
                    j = j + 1
                    lin = Mid(txt & " ", 1, 50)
                    For i = 50 To 1 Step -1
                        If Mid(lin, i, 1) = " " Then
                           pos = i
                           Exit For
                        End If
                    Next i
                    If pri Then
                       sLinea = "         " & Mid(Mid(txt, 1, pos - 1) & String(56, " "), 1, 56) & " " & Right(String(12, " ") & Format(RsImpresion!nVenta, "#,###,##0.00"), 12)
                       pri = False
                    Else
                       sLinea = "         " & Mid(txt, 1, pos - 1)
                    End If
                    txt = Mid(txt, pos + 1, tOt)
                    tOt = Len(txt)
                    Printer.Print sLinea
                 Loop
                 
                 'DATOS DE DETALLE PARA TOTALES
                 Do While Not RsImpresion.EOF
                    
                       If Item <> RsImpresion!tCodigoPedido + RsImpresion!tItem Then
                       
                            If RsImpresion!nImpuesto1 > 0 Then
                               cIGV = cIGV + (RsImpresion!nPrecioNeto * RsImpresion!nCantidad)
                            Else
                               sIGV = sIGV + (RsImpresion!nPrecioNeto * RsImpresion!nCantidad)
                            End If
                       
                            'CESAR IMPUESTO
                            If RsImpresion!nImpuesto1 > 0 And RsImpresion!nImpuesto2 > 0 Then
                                  impG = impxT
                            ElseIf RsImpresion!nImpuesto1 > 0 And RsImpresion!nImpuesto2 = 0 Then
                                  impG = impx1
                            ElseIf RsImpresion!nImpuesto1 = 0 And RsImpresion!nImpuesto2 > 0 Then
                                  impG = impx2
                            Else
                                  impG = 1
                            End If
                            
                            i = i + 1
                          
                            '---CESAR IMP
                            xDiferencia = ((RsImpresion!nPrecioOficial * RsImpresion!nCantidad) / impG) - (RsImpresion!Venta - (RsImpresion!nImpuesto1 * RsImpresion!nCantidad) - (RsImpresion!nImpuesto2 * RsImpresion!nCantidad))
                            xDescuento = xDescuento + xDiferencia
                            xAumento = (RsImpresion!Venta - (RsImpresion!nImpuesto1 * RsImpresion!nCantidad) - (RsImpresion!nImpuesto2 * RsImpresion!nCantidad)) - ((RsImpresion!nPrecioOficial * RsImpresion!nCantidad) / impG)
                            xRecargo = xRecargo + xAumento
                            xSubTotal = xSubTotal + ((RsImpresion!nPrecioOficial * RsImpresion!nCantidad) / impG)
                            '------------
                          
                          sLinea = Right(String(5, " ") & Format(RsImpresion!nCantidad, "#0.00"), 5) & " " & Mid(RsImpresion!Producto & String(19, " "), 1, 19) & " " & Right(String(6, " ") & Format(RsImpresion!nPrecioOficial / impG, "##0.00"), 6) & " " & Right(String(7, " ") & Format((RsImpresion!nPrecioOficial * RsImpresion!nCantidad) / impG, "###0.00"), 7)
                       End If
                                                                    
                        Item = RsImpresion!tCodigoPedido + RsImpresion!tItem
                        RsImpresion.MoveNext
                  Loop
                 '-----------------------------
                    
                 For i = j To nItemV - 2
                     Printer.Print " "
                 Next i
                 
                 
                    'IMPRESION DE PRE PIE DE PAGINA
                    Printer.Print String(40, "-")
                    RsImpresion.MoveLast
                                        
                    Printer.Print Right(String(27, " ") & "Sub Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xSubTotal, "##,###,##0.00"), 13)
                    Printer.Print String(40, " ")
                    
                    If RsImpresion!nRecargo > 0 Then
                       Printer.Print
                       Printer.Print Right(String(27, " ") & "Recargo " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xRecargo, "##,###,##0.00"), 13)
                    End If
                    
                    If RsImpresion!nDescuento > 0 Then
                       Printer.Print Right(String(27, " ") & "Descuento " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xDescuento, "##,###,##0.00"), 13)
                    Else
                       Printer.Print Right(String(27, " ") & "Descuento " & sMonN & " : ", 27) & Right(String(13, " ") & Format(DescuentoCero, "##,###,##0.00"), 13)
                    End If
                            
                    Printer.Print Right(String(27, " ") & "Base " & sImpuesto1 & " " & nPorcentaje1 & "%: ", 27) & Right(String(13, " ") & Format(cIGV, "##,###,##0.00"), 13)
                    Printer.Print Right(String(27, " ") & "Base " & sImpuesto1 & " 0%: ", 27) & Right(String(13, " ") & Format(sIGV, "##,###,##0.00"), 13)
                    Printer.Print ""
                    
                    nSumaNeto = RsImpresion!nNeto
                    
                    If IsNull(RsImpresion!lImpuesto1) Or Not RsImpresion!lImpuesto1 Then
                       nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto1
                    End If
                    
                    If IsNull(RsImpresion!lImpuesto2) Or Not RsImpresion!lImpuesto2 Then
                       nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto2
                    End If
                    
                    If IsNull(RsImpresion!lImpuesto3) Or Not RsImpresion!lImpuesto3 Then
                       nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto3
                    End If
                    
                    'CESAR IMPRESION IMPUESTO - FACTURA
                    If RsImpresion!lImpuesto1 = True Or RsImpresion!lImpuesto2 = True Or RsImpresion!lImpuesto3 = True Then
                       Printer.Print Right(String(27, " ") & "Sub Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(nSumaNeto, "##,###,##0.00"), 13)
                    End If
                                  
                    If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                       Printer.Print Right(String(27, " ") & sImpuesto1 & " " & Format(nPorcentaje1, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,##0.00"), 13)
                    End If
                       
                    If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                       Printer.Print Right(String(27, " ") & sImpuesto2 & " " & Format(nPorcentaje2, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto2, "##,###,##0.00"), 13)
                    End If
                    
                    If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                       Printer.Print Right(String(27, " ") & sImpuesto3 & " " & Format(nPorcentaje3, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto3, "##,###,##0.00"), 13)
                    End If
                    

                    Printer.Print Right(String(27, " ") & "Total " & sMonN & " :", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 13)
          
                    Printer.Print
                    txt = "Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
                    ImprimeXLinea txt, 40, 5
                    Printer.Print String(40, "-")
                    Printer.Print "Inforest v.4.94 "
                                       
                                       
                    If lPagoAntesImpresion Then
                        lcuentaCobrar = True
                        'Set RsPagoDocumento = Lib.OpenRecordset("select Distinct v.Descripcion + ' ' + M.tResumido as pago , Sum(D.nMonto) as monto from DPAGODOCUMENTO D inner join vTipoPago v on d.tTipoPago = v.Codigo inner join vMoneda M on M.Codigo = D.tMoneda Where D.tDocumento = '" & RsImpresion!tDocumento & "' group by v.Descripcion,  M.tResumido", Cn)
                        Set RsPagoDocumento = Lib.OpenRecordset("exec usp_Inforest_Impresion '" & RsImpresion!tDocumento & "', 9 ", Cn)
                        Printer.Print " "
 
                         If pais = "000" Then 'PERU
                            Printer.Print String(40, "-")
                            Printer.Print "Forma de Pago:"
                            If RsPagoDocumento.RecordCount > 0 Then
                                For i = 0 To RsPagoDocumento.RecordCount - 1
                                    lcuentaCobrar = False
                                    Printer.Print RsPagoDocumento!pago & Format(RsPagoDocumento!Monto, "##,###,##0.00")
                                    RsPagoDocumento.MoveNext
                                Next i
                                Printer.Print "Vuelto       :" & sMonN & Format(RsImpresion!Vuelto, "##,###,##0.00")
                            End If
                            If lcuentaCobrar Then
                                Printer.Print "Forma de Pago:Enviado a Cuenta por Cobrar"
                            End If
                            Printer.Print String(40, "-")
                            
                        Else 'ECUADOR
                            For i = 0 To RsPagoDocumento.RecordCount - 1
                                lcuentaCobrar = False
                                Printer.Print "Forma de Pago:" & RsPagoDocumento!pago & Format(RsPagoDocumento!Monto, "##,###,##0.00")
                                RsPagoDocumento.MoveNext
                            Next i
                            If lcuentaCobrar Then
                                Printer.Print "Forma de Pago:Enviado a Cuenta por Cobrar"
                            End If
                        End If
 
                        Printer.Print " "
                    End If
                                       
                                       
                    'PIE
                    i = 0
                    For i = 1 To nPieV
                        Printer.Print " "
                    Next i
                    Printer.Print "."
                    
           '-------------------------------------------------
                    
        End Select
    Printer.EndDoc
End Sub

'FACTURACION_OFISIS
Public Function codigoHashOfisis(ByVal Documento As String) As Boolean
    
            Dim RsimgHash As Recordset
            
            Set RsimgHash = Lib.OpenRecordset("select CO_HASH as codigohash from TCFACT_ELEC where NU_DOCU='" & Documento & "' and (TI_DOCU='B' or TI_DOCU ='F')", CnFE)
         
            If RsimgHash.RecordCount > 0 Then
               codigoHashOfisis = True
            Else
               If xi = 2 Then
                  codigoHashOfisis = False
                  Exit Function
               Else
                  Sleep 2000
                  xi = xi + 1
                  codigoHashOfisis Documento
               End If

            End If
                
End Function

Public Function codigoHashNotaCreditoOfisis(ByVal Documento As String) As Boolean
    
            Dim RsimgHash As Recordset
            
            Set RsimgHash = Lib.OpenRecordset("select CO_HASH as codigohash from TCFACT_ELEC where NU_DOCU='" & Documento & "' and TI_DOCU='D'", CnFE)
         
            If RsimgHash.RecordCount > 0 Then
               codigoHashNotaCreditoOfisis = True
            Else
               If xi = 2 Then
                  codigoHashNotaCreditoOfisis = False
                  Exit Function
               Else
                  Sleep 2000
                  xi = xi + 1
                  codigoHashNotaCreditoOfisis Documento
               End If

            End If
                
End Function
Public Function codigoHashNotaCredito(ByVal Documento As String) As Boolean
    
            Dim RsimgHash As Recordset
            
            'Documento = "BB1100000001"
            Set RsimgHash = Lib.OpenRecordset("select imagen as foto from IMAGENCODIGOBARRA where nro_efact='" & Documento & "' and tipodocu='07'", CnFE)
         
            If RsimgHash.RecordCount > 0 Then
               codigoHashNotaCredito = True
            Else
               If xi = 3 Then
                  codigoHashNotaCredito = False
                  Exit Function
               Else
                  Sleep 3000
                  xi = xi + 1
                  codigoHashNotaCredito Documento
               End If

            End If
                
End Function



Public Function Generar_Imagen(ADO_Connection As ADODB.Connection, sql As String, Campo_Imagen As String, nombreImag As String) As Boolean
  
On Error GoTo error_Function
  
Dim Rs As Recordset
Dim Stream As ADODB.Stream
    
    Set Rs = New Recordset
       
    ' Llena el recordset
    Rs.Open sql, ADO_Connection, adOpenKeyset, adLockOptimistic
      
    ' Si no hay registros sale de la función y retorna como resultado un valor Nothing, es decir ninguna imagen
    If Rs.RecordCount = 0 Then
        Generar_Imagen = False
       Rs.Close
       Set Rs = Nothing
       Exit Function
    End If
      
    ' Nuevo objeto Stream para poder leer el campo de imagen
    Set Stream = New ADODB.Stream
      
    ' Especifica el tipo de datos ( binario )
    Stream.Type = adTypeBinary
    Stream.Open
    
    ' verifica con la función IsNull que el campo no tenga un valor Nulo ya que si no da error, en ese caso sale de la función
    If IsNull(Rs.Fields(Campo_Imagen).value) Then
        GoTo error_Function
    End If
    ' Graba los datos en el objeto stream
    Stream.Write Rs.Fields(Campo_Imagen).value

    ' Este método graba un  archivo temporal  en disco ( en el app.path que luego se elimina )
    Stream.SaveToFile App.Path & nombreImag, adSaveCreateOverWrite
    
    ' Cierra el recordset y el objeto Stream
    If Rs.State = adStateOpen Then
        Rs.Close
    End If
    If Not Rs Is Nothing Then
        Set Rs = Nothing
    End If
      
    If Stream.State = adStateOpen Then
        Stream.Close
    End If
    If Not Stream Is Nothing Then
        Set Stream = Nothing
    End If
    
    Generar_Imagen = True
    
Exit Function
  
error_Function:
 If err.Number <> 0 Then
    MsgBox CStr(err) & "  " & error, vbExclamation
    ' elimina el temporal
    If Len(Dir(App.Path & nombreImag)) Then
       Kill App.Path & nombreImag
    End If
 End If
  
End Function


Public Sub ImprimeNotaCredito(RsImpresion As Recordset, Optional CodigoHash As Image, Optional impTipo As String, Optional cadenaCodigoHash As String, Optional ByVal ImpDolarDelivery As Boolean, Optional Cabecera As Image, Optional pie As Image, Optional tTipoDoc As String)
    On Error Resume Next
    Dim Item As String
    Dim xObservacion As String
    Dim sLinea As String
    Dim sLinea2 As String
    Dim txt As String
    Dim xRsPropiedad As ADODB.Recordset
    Dim xRsPropiedadCombo As ADODB.Recordset
    Dim nSumaNeto As Double
    Dim xTotalS As Double
    
    Dim xImpresionFE As String
    
    
        
    'imprime tipo de cambio
    IsqlTC = "select lVerTCImp from TPARAMETRO"
    Set RsParametroTC = Lib.OpenRecordset(IsqlTC, Cn)
    '------------------------------------------
    
    
    '---CESAR IMP
    Dim imp1 As Double
    Dim imp2 As Double
    Dim impxT As Double
    Dim impx1 As Double
    Dim impx2 As Double
    Dim impG As Double
    Dim xDescuento As Double
    Dim xRecargo As Double
    Dim xSubTotal As Double
    Dim xDiferencia As Double
    Dim xAumento As Double
    
    Dim xMotivoNT As String
    Dim xRsNotaCredito As ADODB.Recordset
    
        
    imp1 = Calcular("select ISNULL(Impuesto1,0) as Codigo from TPARAMETRO", Cn)
    imp2 = Calcular("select ISNULL(Impuesto2,0) as Codigo from TPARAMETRO", Cn)
    impxT = 1 + (imp1 / 100) + (imp2 / 100)
    impx1 = 1 + (imp1 / 100)
    impx2 = 1 + (imp2 / 100)
    impG = 1
    '------------------
    
    lImprimeImagCabDocumento = Calcular("select lImprimeImageCab as codigo from ttipodocumentoimpresora where ttipoemision='" & tTipoDoc & "' and  tcaja='" & sCaja & "'", Cn)
    lImprimeImagPieDocumento = Calcular("select lImprimeImagePie as codigo from ttipodocumentoimpresora where ttipoemision='" & tTipoDoc & "' and  tcaja='" & sCaja & "'", Cn)
    
    xTotalS = 0
    
    Isql = "SELECT tCodigoPedido, dbo.TPRODUCTOPROPIEDAD.tItem, dbo.TOPERADOR.tDetallado AS Operador, dbo.TPROPIEDAD.tDetallado AS Descripcion " & _
           "FROM dbo.TPRODUCTOPROPIEDAD INNER JOIN dbo.TPROPIEDAD ON dbo.TPRODUCTOPROPIEDAD.tCodigoPropiedad = dbo.TPROPIEDAD.tCodigoPropiedad AND dbo.TPRODUCTOPROPIEDAD.tProducto = dbo.TPROPIEDAD.tProducto INNER JOIN dbo.TOPERADOR ON dbo.TPROPIEDAD.tOperador = dbo.TOPERADOR.tOperador " & _
           "where tCodigoPedido='" & sPedido & "' and TOPERADOR.lImprime=1 Order by dbo.TOPERADOR.nBoton"
    Set xRsPropiedad = Lib.OpenRecordset(Isql, Cn)
    
    Isql = "SELECT dbo.TCOMBOPROPIEDAD.tItem, dbo.TCOMBOPROPIEDAD.tItemCombo, dbo.TOPERADOR.tDetallado AS Operador, dbo.TPROPIEDAD.tDetallado AS Descripcion, dbo.TCOMBOPROPIEDAD.tCodigoPedido " & _
           "FROM dbo.TOPERADOR INNER JOIN dbo.TPROPIEDAD ON dbo.TOPERADOR.tOperador = dbo.TPROPIEDAD.tOperador RIGHT OUTER JOIN dbo.TCOMBOPROPIEDAD ON dbo.TPROPIEDAD.tProducto = dbo.TCOMBOPROPIEDAD.tProducto AND dbo.TPROPIEDAD.tCodigoPropiedad = dbo.TCOMBOPROPIEDAD.tCodigoPropiedad " & _
           "where tCodigoPedido='" & sPedido & "'  and TOPERADOR.lImprime=1 Order by dbo.TOPERADOR.nBoton"
    Set xRsPropiedadCombo = Lib.OpenRecordset(Isql, Cn)
    
    xMotivoNT = Calcular("Select ISNULL(tMotivo,'06') As Codigo from MNOTACREDITO Where tNotacredito = '" & RsImpresion!tNotaCredito & "'", Cn)
    
    Isql = "Select * from MNOTACREDITO Where tNotacredito = '" & RsImpresion!tNotaCredito & "'"
    Set xRsNotaCredito = Lib.OpenRecordset(Isql, Cn)
    
    Dim xUnidadNegocio As String
    xUnidadNegocio = Calcular("SELECT tDetallado As Codigo FROM TTABLA WHERE TTABLA = 'UNIDADNEGOCIO' AND TCODIGO = (SELECT tUnidadNegocio FROM TCAJA WHERE TCAJA='" & RsImpresion!tCaja & "')", Cn)
      
      
    Select Case pais
        Case "000"

                    'Cabecera
                    If lImprimeImagCabDocumento Then
                                    If Cabecera <> 0 Then
                                    Printer.PaintPicture Cabecera, 500, Printer.CurrentY, 2860, 1600
                                    For p = 1 To 10
                                    Printer.Print
                                    Next p
                                    End If
                    End If

                    ImprimeXCentro sRazonSocial, 40
                    ImprimeXCentro sRazonComercial, 40
                    sLinea = String((40 - Len(Trim("R.U.C.: " + sRUC))) / 2, " ") & "R.U.C.: " + sRUC
                    Printer.Print sLinea
                    ImprimeXCentro sDireccion, 40
                    If Trim(sDireccion2) <> "" Then
                        ImprimeXCentro sDireccion2, 40
                    End If
                    sLinea = String((40 - Len(Trim("Telefono: " + sTelefono))) / 2, " ") & "Telefono: " + sTelefono
                    Printer.Print sLinea

                    If impTipo = "1" And tCodigoFE <> "999" Then
                        Printer.Print " "
                        ImprimeXCentro "NOTA DE CREDITO ELECTRONICA", 40
                        Printer.Print " "
                        
                        ImprimeXCentro Mid(RsImpresion!tDocumento, 1, 1) & Mid(RsImpresion!tNotaCredito, 4, 3) & "-" & Mid(RsImpresion!tNotaCredito, 8, 8), 40
                        
                        Printer.Print " "
                        Printer.Print "Fecha Emision : " & RsImpresion!fRegistro
                        Printer.Print "Documento     : " & RsImpresion!tDocumento
                        Printer.Print "Local         : " & xUnidadNegocio
                        Printer.Print "Caja          : " & RsImpresion!tCaja & " - " & RsImpresion!tUsuario
                        If ImpDolarDelivery Then
                            Printer.Print "Tipo Moneda   : " & sMonedaE
                        Else
                            Printer.Print "Tipo Moneda   : " & sMonedaN
                        End If
                        'Printer.Print "Nro.Serie     : " & sSerieCaja
                        Printer.Print "Motivo        : " & RsImpresion!tObservacion
                        Printer.Print " "
                        Printer.Print String(40, "-")
                        If Not IsNull(RsImpresion!lImpProdDesc) And (RsImpresion!lImpProdDesc) Then
                            Printer.Print "Codigo      Cant. UM   P.Unit      Total"
                            Printer.Print "Producto                          Dscto."
                        Else
                            Printer.Print "Producto         Cant. P.Unit      Total"
                        End If
                        'Printer.Print "Producto         Cant. P.Unit      Total"
                        Printer.Print String(40, "-")
                    
                    Else
                        Printer.Print " "
                            ImprimeXCentro "NOTA DE CREDITO", 40
                        Printer.Print " "
                        'Printer.Print Mid(RsImpresion!tNotaCredito, 1, 1) & "-" & Mid(RsImpresion!tNotaCredito, 2, 5) & "-" & Mid(RsImpresion!tNotaCredito, 7)
                            ImprimeXCentro Mid(RsImpresion!tNotaCredito, 1, 1) & "-" & Mid(RsImpresion!tNotaCredito, 2, 5) & "-" & Mid(RsImpresion!tNotaCredito, 7), 40
                        Printer.Print " "
                        Printer.Print "Fecha     : " & RsImpresion!fRegistro
                        Printer.Print "Documento : " & RsImpresion!tDocumento
                        Printer.Print "Caja      : " & RsImpresion!tCaja & " - " & RsImpresion!tUsuario
                        Printer.Print "Motivo    : " & RsImpresion!tObservacion
                        Printer.Print String(40, "-")
                        'Printer.Print String(40, "-")

                    End If
                    
                    
                       'tipo de cambio
                       If RsParametroTC!lVerTCImp = True Then
                       Printer.Print "T/Cambio  : " & Format(nTC, "###,##0.00")
                       End If
                       '------------------------------------------------------------
                                  
                                  
                    If impTipo = "1" And tCodigoFE <> "999" Then
                            If xMotivoNT = "06" Or RsImpresion!nVenta = xRsNotaCredito!nVenta Then
                                Item = ""
                                'Cuerpo
                                Do While Not RsImpresion.EOF
                                    If Not IsNull(RsImpresion!lImpProdDesc) And (RsImpresion!lImpProdDesc) Then
                                        If Item <> RsImpresion!tCodigoPedido + RsImpresion!tItem Then
                                            If ImpDolarDelivery Then
                                                sLinea = Mid(RsImpresion!tCodigoProducto & String(8, " "), 1, 8) & " " & Right(String(7, " ") & Format(RsImpresion!nCantidad, "##0.00"), 7) & " " & Right(String(3, " ") & "UN", 3) & " " & Right(String(9, " ") & Format(RsImpresion!nPrecioOficial / nTC, "##0.00"), 9) & " " & Right(String(9, " ") & Format((RsImpresion!nCantidad * RsImpresion!nPrecioOficial) / nTC, "##,##0.00"), 9)
                                                sLinea2 = Mid(RsImpresion!Producto & String(30, " "), 1, 30) & " " & Right(String(9, " ") & Format((RsImpresion!DescUnitario) / nTC, "##,##0.00"), 9)
                                            Else
                                                sLinea = Mid(RsImpresion!tCodigoProducto & String(8, " "), 1, 8) & " " & Right(String(7, " ") & Format(RsImpresion!nCantidad, "##0.00"), 7) & " " & Right(String(3, " ") & "UN", 3) & " " & Right(String(9, " ") & Format(RsImpresion!nPrecioOficial, "##0.00"), 9) & " " & Right(String(9, " ") & Format(RsImpresion!nCantidad * RsImpresion!nPrecioOficial, "##,##0.00"), 9)
                                                sLinea2 = Mid(RsImpresion!Producto & String(30, " "), 1, 30) & " " & Right(String(9, " ") & Format(RsImpresion!DescUnitario, "##,##0.00"), 9)
                                            End If
'                                             If ImpDolarDelivery Then
'                                                 'sLinea = Mid(RsImpresion!Producto & String(15, " "), 1, 15) & " " & Right(String(6, " ") & Format(RsImpresion!nCantidad, "##0.00"), 6) & " " & Right(String(6, " ") & Format(RsImpresion!nPrecioOficial / nTC, "##0.00"), 6) & " " & Right(String(10, " ") & Format((RsImpresion!nCantidad * RsImpresion!nPrecioOficial) / nTC, "###,##0.00"), 10)
'                                             Else
'                                                 'sLinea = Mid(RsImpresion!Producto & String(15, " "), 1, 15) & " " & Right(String(6, " ") & Format(RsImpresion!nCantidad, "##0.00"), 6) & " " & Right(String(6, " ") & Format(RsImpresion!nPrecioOficial, "##0.00"), 6) & " " & Right(String(10, " ") & Format(RsImpresion!nCantidad * RsImpresion!nPrecioOficial, "###,##0.00"), 10)
'                                             End If
                                             xTotalS = xTotalS + (RsImpresion!nCantidad * RsImpresion!nPrecioOficial)
                                              
                                             Printer.Print sLinea
                                             Printer.Print sLinea2
                                        End If
                                    Else
                                        If Item <> RsImpresion!tCodigoPedido + RsImpresion!tItem Then
                                             If ImpDolarDelivery Then
                                                 sLinea = Mid(RsImpresion!Producto & String(15, " "), 1, 15) & " " & Right(String(6, " ") & Format(RsImpresion!nCantidad, "##0.00"), 6) & " " & Right(String(6, " ") & Format(RsImpresion!nPrecioOficial / nTC, "##0.00"), 6) & " " & Right(String(10, " ") & Format((RsImpresion!nCantidad * RsImpresion!nPrecioOficial) / nTC, "###,##0.00"), 10)
                                             Else
                                                 sLinea = Mid(RsImpresion!Producto & String(15, " "), 1, 15) & " " & Right(String(6, " ") & Format(RsImpresion!nCantidad, "##0.00"), 6) & " " & Right(String(6, " ") & Format(RsImpresion!nPrecioOficial, "##0.00"), 6) & " " & Right(String(10, " ") & Format(RsImpresion!nCantidad * RsImpresion!nPrecioOficial, "###,##0.00"), 10)
                                             End If
                                             xTotalS = xTotalS + (RsImpresion!nCantidad * RsImpresion!nPrecioOficial)
                                              
                                             Printer.Print sLinea
                                        End If
                                    End If
                                   xObservacion = IIf(IsNull(RsImpresion!tObservacionPedido), "", RsImpresion!tObservacionPedido)
                                   Item = RsImpresion!tCodigoPedido + RsImpresion!tItem
                                   RsImpresion.MoveNext
                                Loop
                                    
                            Else
                                Printer.Print " "
                                If ImpDolarDelivery Then
                                    sLinea = Mid(xRsNotaCredito!tObservacion & String(27, " "), 1, 27) & " " & Right(String(12, " ") & Format(xRsNotaCredito!nVenta / nTC, "#,###,##0.00"), 12)
                                Else
                                    sLinea = Mid(xRsNotaCredito!tObservacion & String(27, " "), 1, 27) & " " & Right(String(12, " ") & Format(xRsNotaCredito!nVenta, "#,###,##0.00"), 12)
                                End If
                                Printer.Print sLinea
                                Printer.Print " "
                            End If
                    Else
                            Printer.Print " "
                            If ImpDolarDelivery Then
                                sLinea = Mid(xRsNotaCredito!tObservacion & String(27, " "), 1, 27) & " " & Right(String(12, " ") & Format(xRsNotaCredito!nVenta / nTC, "#,###,##0.00"), 12)
                            Else
                                sLinea = Mid(xRsNotaCredito!tObservacion & String(27, " "), 1, 27) & " " & Right(String(12, " ") & Format(xRsNotaCredito!nVenta, "#,###,##0.00"), 12)
                            End If
                            Printer.Print sLinea
                            Printer.Print " "
                    End If
                                        

                    Printer.Print String(40, "-")
                    RsImpresion.MoveLast
                    
                    Dim xGravada As Double
                    Dim xInafecta As Double
                    
                    
                    If impTipo = "1" And tCodigoFE <> "999" Then
                    
                            If xMotivoNT = "06" Then
                                If ImpDolarDelivery Then
                                    Printer.Print Right(String(27, " ") & " Total " & sMonE & " : ", 27) & Right(String(13, " ") & Format(xTotalS / nTC, "##,###,##0.00"), 13)
                                    Printer.Print String(40, " ")
                                                               
                                    xGravada = Calcular("SELECT SUM(D.nPrecioNeto*nCantidad) As Codigo FROM dDocumento D WHERE D.tDocumento = '" & RsImpresion!tDocumento & "' AND ((D.nPrecioImpuesto1>0 AND D.nPrecioImpuesto2=0) OR (D.nPrecioImpuesto1>0 AND D.nPrecioImpuesto2>0))", Cn)
                                    xInafecta = Calcular("SELECT ISNULL(SUM(D.nPrecioNeto*nCantidad),0) As Codigo FROM dDocumento D WHERE ((D.nPrecioImpuesto1<=0 AND D.nPrecioImpuesto2>0)OR(D.nPrecioImpuesto1<=0 AND D.nPrecioImpuesto2<=0)) AND D.tDocumento = '" & RsImpresion!tDocumento & "'", Cn)
                                    
                                    If Not (IsNull(RsImpresion!lOpGravInaf) Or RsImpresion!lOpGravInaf = 0) Then
                                        Printer.Print Right(String(27, " ") & "Op. Gravadas " & sMonE & " : ", 27) & Right(String(13, " ") & Format(xGravada / nTC, "##,###,##0.00"), 13)
                                        Printer.Print Right(String(27, " ") & "Op. Inafecta " & sMonE & " : ", 27) & Right(String(13, " ") & Format(xInafecta / nTC, "##,###,##0.00"), 13)
                                    End If
                                    
                                    If RsImpresion!nDescuento > 0 Then
                                       'Printer.Print
                                        Printer.Print Right(String(27, " ") & "Total Descuento " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nDescuento / nTC, "##,###,##0.00"), 13)
                                    Else
                                        Printer.Print Right(String(27, " ") & "Total Descuento " & sMonE & " : ", 27) & Right(String(13, " ") & Format(0, "##,###,##0.00"), 13)
                                    End If
                                Else
                                    Printer.Print Right(String(27, " ") & " Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xTotalS, "##,###,##0.00"), 13)
                                    Printer.Print String(40, " ")
                                                               
                                    xGravada = Calcular("SELECT SUM(D.nPrecioNeto*nCantidad) As Codigo FROM dDocumento D WHERE D.tDocumento = '" & RsImpresion!tDocumento & "' AND ((D.nPrecioImpuesto1>0 AND D.nPrecioImpuesto2=0) OR (D.nPrecioImpuesto1>0 AND D.nPrecioImpuesto2>0))", Cn)
                                    xInafecta = Calcular("SELECT ISNULL(SUM(D.nPrecioNeto*nCantidad),0) As Codigo FROM dDocumento D WHERE ((D.nPrecioImpuesto1<=0 AND D.nPrecioImpuesto2>0)OR(D.nPrecioImpuesto1<=0 AND D.nPrecioImpuesto2<=0)) AND D.tDocumento = '" & RsImpresion!tDocumento & "'", Cn)
                                    
                                    If Not (IsNull(RsImpresion!lOpGravInaf) Or RsImpresion!lOpGravInaf = 0) Then
                                        Printer.Print Right(String(27, " ") & "Op. Gravadas " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xGravada, "##,###,##0.00"), 13)
                                        Printer.Print Right(String(27, " ") & "Op. Inafecta " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xInafecta, "##,###,##0.00"), 13)
                                    End If
                                    
                                    If RsImpresion!nDescuento > 0 Then
                                       'Printer.Print
                                        Printer.Print Right(String(27, " ") & "Total Descuento " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nDescuento, "##,###,##0.00"), 13)
                                    Else
                                        Printer.Print Right(String(27, " ") & "Total Descuento " & sMonN & " : ", 27) & Right(String(13, " ") & Format(0, "##,###,##0.00"), 13)
                                    End If
                                
                                End If
                
                                    nSumaNeto = RsImpresion!nNeto

                                    If IsNull(RsImpresion!lImpuesto1) Or Not RsImpresion!lImpuesto1 Then
                                       nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto1
                                    End If
                                    
                                    If IsNull(RsImpresion!lImpuesto2) Or Not RsImpresion!lImpuesto2 Then
                                       nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto2
                                    End If
                                    
                                    If IsNull(RsImpresion!lImpuesto3) Or Not RsImpresion!lImpuesto3 Then
                                       nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto3
                                    End If
                                                  
                               If ImpDolarDelivery Then
                                    If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                                       Printer.Print Right(String(27, " ") & sImpuesto1 & " " & Format(nPorcentaje1, "##0.00") & "% " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto1 / nTC, "##,###,##0.00"), 13)
                                    End If
                                       
                                    If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                                       Printer.Print Right(String(27, " ") & sImpuesto2 & " " & Format(nPorcentaje2, "##0.00") & "% " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto2 / nTC, "##,###,##0.00"), 13)
                                    End If
                                    
                                    If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                                       Printer.Print Right(String(27, " ") & sImpuesto3 & " " & Format(nPorcentaje3, "##0.00") & "% " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto3 / nTC, "##,###,##0.00"), 13)
                                    End If
                                    
                                    Printer.Print Right(String(27, " ") & "Importe Total " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 13)
                                Else
            
                                    If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                                       Printer.Print Right(String(27, " ") & sImpuesto1 & " " & Format(nPorcentaje1, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,##0.00"), 13)
                                    End If
                                       
                                    If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                                       Printer.Print Right(String(27, " ") & sImpuesto2 & " " & Format(nPorcentaje2, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto2, "##,###,##0.00"), 13)
                                    End If
                                    
                                    If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                                       Printer.Print Right(String(27, " ") & sImpuesto3 & " " & Format(nPorcentaje3, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto3, "##,###,##0.00"), 13)
                                    End If
                                    
                                    Printer.Print Right(String(27, " ") & "Importe Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 13)
                                    If lEquivalencia = True Or lDocumEquivaPrecuenta = True Then
                                    Printer.Print Right(String(27, " ") & "Total " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta / nTC, "##,###,##0.00"), 13)
                                    Printer.Print
                                    End If
                                End If
                                    'TEXTO AGENTE RETENCION
                                    Printer.Print " "
                                    If Calcular(" SELECT case when  lImpresionRetencion=1 then 1 else 0 end  as codigo FROM vTipodocumento WHERE Codigo=(SELECT TTIPODOCUMENTO FROM MDOCUMENTO WHERE tDocumento='" & RsImpresion!tDocumento & "')", Cn) = 1 Then
                                        ImprimeXLinea tTextoAgenteRetencion, 40, 5
                                    End If
                                    Printer.Print " "
                                If ImpDolarDelivery Then
                                    txt = "Son: " & NumeroCadena(str(RsImpresion!nVenta / nTC)) & " " & sMonedaE
                                Else
                                    txt = "Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
                                End If
                                    ImprimeXLinea txt, 40, 5
                
                                    Printer.Print String(40, "-")
                                    ImprimeXLinea "Empresa: " & RsImpresion!Cliente, 40, 9
                                    Printer.Print "RUC    : " & RsImpresion!Ruc
                                    ImprimeXLinea "Direcc.: " & RsImpresion!direccion, 40, 9
                                    Printer.Print String(40, "-")
                                    
                                    
                            Else
                            
                                If ImpDolarDelivery Then
                                    Printer.Print Right(String(27, " ") & " Total " & sMonE & " : ", 27) & Right(String(13, " ") & Format(xRsNotaCredito!nVenta / nTC, "##,###,##0.00"), 13)
                                    Printer.Print String(40, " ")
                                                               
                                    If xRsNotaCredito!nImpuesto1 = 0 Then
                                        xGravada = 0
                                        xInafecta = xRsNotaCredito!nNeto
                                    Else
                                        xGravada = xRsNotaCredito!nNeto
                                        xInafecta = 0
                                    End If
                                    
                                    If Not (IsNull(RsImpresion!lOpGravInaf) Or RsImpresion!lOpGravInaf = 0) Then
                                        Printer.Print Right(String(27, " ") & "Op. Gravadas " & sMonE & " : ", 27) & Right(String(13, " ") & Format(xGravada / nTC, "##,###,##0.00"), 13)
                                        Printer.Print Right(String(27, " ") & "Op. Inafecta " & sMonE & " : ", 27) & Right(String(13, " ") & Format(xInafecta / nTC, "##,###,##0.00"), 13)
                                    End If
                                                                                            
                                    If RsImpresion!nDescuento > 0 Then
                                       'Printer.Print
                                        Printer.Print Right(String(27, " ") & "Total Descuento " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nDescuento / nTC, "##,###,##0.00"), 13)
                                    Else
                                        Printer.Print Right(String(27, " ") & "Total Descuento " & sMonE & " : ", 27) & Right(String(13, " ") & Format(0, "##,###,##0.00"), 13)
                                    End If
                                    
                                     If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                                       Printer.Print Right(String(27, " ") & sImpuesto1 & " " & Format(nPorcentaje1, "##0.00") & "% " & sMonE & " : ", 27) & Right(String(13, " ") & Format(xRsNotaCredito!nImpuesto1 / nTC, "##,###,##0.00"), 13)
                                    End If
                                       
                                    If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                                       Printer.Print Right(String(27, " ") & sImpuesto2 & " " & Format(nPorcentaje2, "##0.00") & "% " & sMonE & " : ", 27) & Right(String(13, " ") & Format(xRsNotaCredito!nImpuesto2 / nTC, "##,###,##0.00"), 13)
                                    End If
                                    
                                    If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                                       Printer.Print Right(String(27, " ") & sImpuesto3 & " " & Format(nPorcentaje3, "##0.00") & "% " & sMonE & " : ", 27) & Right(String(13, " ") & Format(xRsNotaCredito!nImpuesto3 / nTC, "##,###,##0.00"), 13)
                                    End If
                                    
                                    Printer.Print Right(String(27, " ") & "Importe Total " & sMonE & " : ", 27) & Right(String(13, " ") & Format(xRsNotaCredito!nVenta / nTC, "##,###,##0.00"), 13)
                                    
                                Else
                                
                                    Printer.Print Right(String(27, " ") & " Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xRsNotaCredito!nVenta, "##,###,##0.00"), 13)
                                    Printer.Print String(40, " ")
                                                               
                                    If xRsNotaCredito!nImpuesto1 = 0 Then
                                        xGravada = 0
                                        xInafecta = xRsNotaCredito!nNeto
                                    Else
                                        xGravada = xRsNotaCredito!nNeto
                                        xInafecta = 0
                                    End If
                                    
                                    If Not (IsNull(RsImpresion!lOpGravInaf) Or RsImpresion!lOpGravInaf = 0) Then
                                        Printer.Print Right(String(27, " ") & "Op. Gravadas " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xGravada, "##,###,##0.00"), 13)
                                        Printer.Print Right(String(27, " ") & "Op. Inafecta " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xInafecta, "##,###,##0.00"), 13)
                                    End If
                                                                                            
                                    If RsImpresion!nDescuento > 0 Then
                                       'Printer.Print
                                        Printer.Print Right(String(27, " ") & "Total Descuento " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nDescuento, "##,###,##0.00"), 13)
                                    Else
                                        Printer.Print Right(String(27, " ") & "Total Descuento " & sMonN & " : ", 27) & Right(String(13, " ") & Format(0, "##,###,##0.00"), 13)
                                    End If
                                    
                                     If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                                       Printer.Print Right(String(27, " ") & sImpuesto1 & " " & Format(nPorcentaje1, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xRsNotaCredito!nImpuesto1, "##,###,##0.00"), 13)
                                    End If
                                       
                                    If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                                       Printer.Print Right(String(27, " ") & sImpuesto2 & " " & Format(nPorcentaje2, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xRsNotaCredito!nImpuesto2, "##,###,##0.00"), 13)
                                    End If
                                    
                                    If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                                       Printer.Print Right(String(27, " ") & sImpuesto3 & " " & Format(nPorcentaje3, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xRsNotaCredito!nImpuesto3, "##,###,##0.00"), 13)
                                    End If
                                    
                                    Printer.Print Right(String(27, " ") & "Importe Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xRsNotaCredito!nVenta, "##,###,##0.00"), 13)
                                End If
                                                                
                                'TEXTO AGENTE RETENCION
                                Printer.Print " "
                                If Calcular(" SELECT case when  lImpresionRetencion=1 then 1 else 0 end  as codigo FROM vTipodocumento WHERE Codigo=(SELECT TTIPODOCUMENTO FROM MDOCUMENTO WHERE tDocumento='" & RsImpresion!tDocumento & "')", Cn) = 1 Then
                                    ImprimeXLinea tTextoAgenteRetencion, 40, 5
                                End If
                                Printer.Print " "
                                    
                                If ImpDolarDelivery Then
                                    txt = "Son: " & NumeroCadena(str(xRsNotaCredito!nVenta / nTC)) & " " & sMonedaE
                                Else
                                    txt = "Son: " & NumeroCadena(str(xRsNotaCredito!nVenta)) & " " & sMonedaN
                                End If
                                    ImprimeXLinea txt, 40, 5
                
                                    Printer.Print String(40, "-")
                                    ImprimeXLinea "Empresa: " & RsImpresion!Cliente, 40, 9
                                    Printer.Print "RUC    : " & RsImpresion!Ruc
                                    ImprimeXLinea "Direcc.: " & RsImpresion!direccion, 40, 9
                                    Printer.Print String(40, "-")
                                                                
                            End If
                    
                    
                    Else
                            If ImpDolarDelivery Then
                                    Printer.Print Right(String(27, " ") & " Total " & sMonE & " : ", 27) & Right(String(13, " ") & Format(xRsNotaCredito!nVenta / nTC, "##,###,##0.00"), 13)
                                    Printer.Print String(40, " ")
                                                               
                                    If xRsNotaCredito!nImpuesto1 = 0 Then
                                        xGravada = 0
                                        xInafecta = xRsNotaCredito!nNeto
                                    Else
                                        xGravada = xRsNotaCredito!nNeto
                                        xInafecta = 0
                                    End If
                                    
                                    Printer.Print Right(String(27, " ") & "Sub Total " & sMonE & " : ", 27) & Right(String(13, " ") & Format(xGravada / nTC, "##,###,##0.00"), 13)
                                                      
                                    If RsImpresion!nDescuento > 0 Then
                                       Printer.Print
                                       Printer.Print Right(String(27, " ") & "Descuento " & sMonE & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nDescuento / nTC, "##,###,##0.00"), 13)
                                    End If
                                    
                                     If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                                       Printer.Print Right(String(27, " ") & sImpuesto1 & " " & Format(nPorcentaje1, "##0.00") & "% " & sMonE & " : ", 27) & Right(String(13, " ") & Format(xRsNotaCredito!nImpuesto1 / nTC, "##,###,##0.00"), 13)
                                    End If
                                       
                                    If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                                       Printer.Print Right(String(27, " ") & sImpuesto2 & " " & Format(nPorcentaje2, "##0.00") & "% " & sMonE & " : ", 27) & Right(String(13, " ") & Format(xRsNotaCredito!nImpuesto2 / nTC, "##,###,##0.00"), 13)
                                    End If
                                    
                                    If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                                       Printer.Print Right(String(27, " ") & sImpuesto3 & " " & Format(nPorcentaje3, "##0.00") & "% " & sMonE & " : ", 27) & Right(String(13, " ") & Format(xRsNotaCredito!nImpuesto3 / nTC, "##,###,##0.00"), 13)
                                    End If
                                    
                                    Printer.Print Right(String(27, " ") & "Importe Total " & sMonE & " : ", 27) & Right(String(13, " ") & Format(xRsNotaCredito!nVenta / nTC, "##,###,##0.00"), 13)
                            Else
                                    Printer.Print Right(String(27, " ") & " Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xRsNotaCredito!nVenta, "##,###,##0.00"), 13)
                                    Printer.Print String(40, " ")
                                                               
                                    If xRsNotaCredito!nImpuesto1 = 0 Then
                                        xGravada = 0
                                        xInafecta = xRsNotaCredito!nNeto
                                    Else
                                        xGravada = xRsNotaCredito!nNeto
                                        xInafecta = 0
                                    End If
                                    
                                    Printer.Print Right(String(27, " ") & "Sub Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xGravada, "##,###,##0.00"), 13)
                                                      
                                    If RsImpresion!nDescuento > 0 Then
                                       Printer.Print
                                       Printer.Print Right(String(27, " ") & "Descuento " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nDescuento, "##,###,##0.00"), 13)
                                    End If
                                    
                                     If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                                       Printer.Print Right(String(27, " ") & sImpuesto1 & " " & Format(nPorcentaje1, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xRsNotaCredito!nImpuesto1, "##,###,##0.00"), 13)
                                    End If
                                       
                                    If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                                       Printer.Print Right(String(27, " ") & sImpuesto2 & " " & Format(nPorcentaje2, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xRsNotaCredito!nImpuesto2, "##,###,##0.00"), 13)
                                    End If
                                    
                                    If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                                       Printer.Print Right(String(27, " ") & sImpuesto3 & " " & Format(nPorcentaje3, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xRsNotaCredito!nImpuesto3, "##,###,##0.00"), 13)
                                    End If
                                    
                                    Printer.Print Right(String(27, " ") & "Importe Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xRsNotaCredito!nVenta, "##,###,##0.00"), 13)
                            
                            End If
                                                                
                                    'TEXTO AGENTE RETENCION
                                    Printer.Print " "
                                    If Calcular(" SELECT case when  lImpresionRetencion=1 then 1 else 0 end  as codigo FROM vTipodocumento WHERE Codigo=(SELECT TTIPODOCUMENTO FROM MDOCUMENTO WHERE tDocumento='" & RsImpresion!tDocumento & "')", Cn) = 1 Then
                                        ImprimeXLinea tTextoAgenteRetencion, 40, 5
                                    End If
                                    Printer.Print " "
                            If ImpDolarDelivery Then
                                    txt = "Son: " & NumeroCadena(str(xRsNotaCredito!nVenta / nTC)) & " " & sMonedaE
                            Else
                                     txt = "Son: " & NumeroCadena(str(xRsNotaCredito!nVenta)) & " " & sMonedaN
                            End If
                                    ImprimeXLinea txt, 40, 5
                
                                    Printer.Print String(40, "-")
                                    ImprimeXLinea "Empresa: " & RsImpresion!Cliente, 40, 9
                                    Printer.Print "RUC    : " & RsImpresion!Ruc
                                    ImprimeXLinea "Direcc.: " & RsImpresion!direccion, 40, 9
                                    Printer.Print String(40, "-")
                    End If
                    

                    'FACTURACION_E_PERU
                    If pais = "000" Then
                       If lFacturacionE Then
                          If impTipo = "1" And tCodigoFE <> "999" Then
                                Printer.Print " "
                                
                                If lQRFE Then
                                   Printer.PaintPicture CodigoHash, 1400, Printer.CurrentY, 1323, 1323
                                           Dim d As Integer
                                           For d = 1 To 8
                                               Printer.Print
                                            Next d
                                Else
                                   If lImpresionCodigoBarras Then
                                      Printer.PaintPicture CodigoHash, 250, Printer.CurrentY, 3400, 1200
                                      Printer.CurrentY = Printer.CurrentY + 1200
                                   Else
                                      ImprimeXCentro cadenaCodigoHash, 40
                                   End If
                                End If
                                                     
                                Printer.Print " "
                                xImpresionFE = Calcular(" SELECT tImpresionFE as codigo FROM vTipodocumento WHERE Codigo=(SELECT TTIPODOCUMENTO FROM MNOTACREDITO WHERE tNotaCredito='" & RsImpresion!tNotaCredito & "')", Cn)
                                ImprimeXCentro xImpresionFE, 40
                                Printer.Print " "
                          End If
                       End If
                    End If
                    '------------------

                    If lImprimeImagPieDocumento Then
                            If pie <> 0 Then
                            Printer.Print " "
                            Printer.PaintPicture pie, 500, Printer.CurrentY, 2860, 1600
                            End If
                    End If




                    Printer.EndDoc
                    
        Case "002"
            
                    ImprimeXCentro sRazonSocial, 40
                    ImprimeXCentro sRazonComercial, 40
                    sLinea = String((40 - Len(Trim("R.U.C.: " + sRUC))) / 2, " ") & "R.U.C.: " + sRUC
                    Printer.Print sLinea
                    ImprimeXCentro sDireccion, 40
                    
                    sLinea = String((40 - Len(Trim("Telefono: " + sTelefono))) / 2, " ") & "Telefono: " + sTelefono
                    Printer.Print sLinea
         
                    Printer.Print " "

                    Printer.Print Mid(RsImpresion!tNotaCredito, 1, 1) & "-" & Mid(RsImpresion!tNotaCredito, 2, 6) & "-" & Mid(RsImpresion!tNotaCredito, 8)

                    Printer.Print " "
                                                                                     
                    Printer.Print "Fecha    : " & RsImpresion!fRegistro
                    Printer.Print "Documento: " & RsImpresion!tDocumento
                    Printer.Print "Caja     : " & RsImpresion!tCaja & " - " & RsImpresion!tUsuario
                    Printer.Print " "
                    Printer.Print "Motivo   : " & RsImpresion!tObservacion
                    Printer.Print " "
                    Printer.Print "Cantid. Producto                SubTotal"
                    Printer.Print String(40, "-")
                    
                    Item = ""
                    'Cuerpo
                    Do While Not RsImpresion.EOF
                       If Item <> RsImpresion!tCodigoPedido + RsImpresion!tItem Then
                          
                             sLinea = Right(String(7, " ") & Format(RsImpresion!nCantidad, "###0.00"), 7) & " " & Mid(RsImpresion!Producto & String(19, " "), 1, 19) & " " & Right(String(12, " ") & Format(RsImpresion!nCantidad * RsImpresion!nPrecioOficial, "#,###,##0.00"), 12)
                             xTotalS = xTotalS + (RsImpresion!nCantidad * RsImpresion!nPrecioOficial)
                             
                          Printer.Print sLinea
                       End If
                       
                       xObservacion = IIf(IsNull(RsImpresion!tObservacionPedido), "", RsImpresion!tObservacionPedido)
                       Item = RsImpresion!tCodigoPedido + RsImpresion!tItem
                       RsImpresion.MoveNext
                    Loop
                    
                    'Printer.Print
                    Printer.Print String(40, "-")
                    RsImpresion.MoveLast
                    
                    Printer.Print Right(String(27, " ") & " Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta + RsImpresion!nDescuento - RsImpresion!nRecargo, "##,###,##0.00"), 13)
                    Printer.Print String(40, " ")
                    
                    If RsImpresion!nDescuento > 0 Then
                       Printer.Print
                       Printer.Print Right(String(27, " ") & "Descuento " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nDescuento, "##,###,##0.00"), 13)
                    End If

                    nSumaNeto = RsImpresion!nNeto
                    
                    If IsNull(RsImpresion!lImpuesto1) Or Not RsImpresion!lImpuesto1 Then
                       nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto1
                    End If
                    
                    If IsNull(RsImpresion!lImpuesto2) Or Not RsImpresion!lImpuesto2 Then
                       nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto2
                    End If
                    
                    If IsNull(RsImpresion!lImpuesto3) Or Not RsImpresion!lImpuesto3 Then
                       nSumaNeto = nSumaNeto + RsImpresion!nprecioImpuesto3
                    End If
                                  
                                  
                    If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                       Printer.Print Right(String(27, " ") & sImpuesto1 & " " & Format(nPorcentaje1, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,##0.00"), 13)
                    End If
                       
                    If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                       Printer.Print Right(String(27, " ") & sImpuesto2 & " " & Format(nPorcentaje2, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto2, "##,###,##0.00"), 13)
                    End If
                    
                    If Not (IsNull(RsImpresion!lImpuesto3) Or RsImpresion!lImpuesto3 = 0) Then
                       Printer.Print Right(String(27, " ") & sImpuesto3 & " " & Format(nPorcentaje3, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nprecioImpuesto3, "##,###,##0.00"), 13)
                    End If
                    
                    Printer.Print Right(String(27, " ") & "Importe Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 13)

                    Printer.Print String(40, "-")
                    ImprimeXLinea "Empresa: " & RsImpresion!ClienteDocumento, 40, 9
                    Printer.Print "RUC    : " & RsImpresion!Ruc
                    ImprimeXLinea "Direcc.: " & RsImpresion!direccion, 40, 9
                    Printer.Print String(40, "-")

                    Set xRsPropiedad = Nothing
                    Set xRsPropiedadCombo = Nothing
                    
                    Printer.EndDoc
                    
    End Select
End Sub


Public Sub ImprimeFacturaNEmpresa17(RsImpresion As Recordset, Empresa As String, Optional tTipoDoc As String)
                ximprimeDetallado = Calcular("select lImprimeresumen as codigo from ttipodocumentoimpresora where ttipoemision='" & tTipoDoc & "' and  tcaja='" & sCaja & "'", Cn)

                 For i = 1 To nCabecera
                     Printer.Print
                 Next i
                 
                 Printer.Print String(76, " ") & RsImpresion!tDocumento
                 For i = 1 To 3
                     Printer.Print
                 Next i
                 Printer.Print String(13, " ") & Left(Mid(RsImpresion!Cliente, 1, 50) & String(50, " "), 50) & String(25, " ") & Format(RsImpresion!fRegistro, "dd MM yyyy")
                 Printer.Print String(13, " ") & RsImpresion!Ruc
                 Printer.Print String(13, " ") & RsImpresion!direccion
                 
                 'Printer.Print Mid("   Caja             : " & RsImpresion!tCaja & " - " & RsImpresion!tUsuario & String(53, " "), 1, 53) & "Transportista    : " & RsImpresion!Mozo
                 'Printer.Print "   Destino          : " & IIf((RsImpresion!tMesa = "000" Or Len(Trim(RsImpresion!tMesa)) = 0 Or IsNull(RsImpresion!tMesa)), RsImpresion!tObservacion, RsImpresion!Mesa)
                 
                 For i = 1 To nDetalle
                     Printer.Print
                 Next i
                 
                 'Cuerpo
                 Item = ""
                 i = 0
                 j = 0
                                  
                 Item = ""
                 Do While Not RsImpresion.EOF
                    If ximprimeDetallado = False Then
                        xproducto = RsImpresion!Producto
                    Else
                        xproducto = RsImpresion!ProductoDetallado
                    End If
                    
                    If Item <> RsImpresion!tCodigoPedido + RsImpresion!tItem Then
                       i = i + 1
                       'Printer.Print
                       sLinea = Right(String(18, " ") & Format(RsImpresion!nCantidad, "###0.00"), 7) & "  " & Mid(xproducto & String(68, " "), 1, 68) & " " & Right(String(9, " ") & Format(RsImpresion!nprecioVenta, "##,####0.00"), 9) & "     " & Right(String(12, " ") & Format(RsImpresion!nCantidad * RsImpresion!nprecioVenta, "#,###,##0.00"), 12)
                       Printer.Print sLinea
                    End If
                    Item = RsImpresion!tCodigoPedido + RsImpresion!tItem
                    RsImpresion.MoveNext
                 Loop
                                  
                 For j = i To nFItem
                     Printer.Print " "
                 Next j
                 
 
                 RsImpresion.MoveLast
                 Printer.Print String(13, " ") & UCase("SON: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN)
                 
 
                  For i = 1 To 3
                    Printer.Print
                  Next i
                   
                 Printer.Print String(88, " ") & Right(String(16, " ") & Format(RsImpresion!nNeto, "##,##,###,##0.00"), 16)
                 Dim o As Integer
                
                 If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                    If RsImpresion!nprecioImpuesto2 > 0 Then
                       Printer.Print String(35, " ") & Right(String(30, " ") & Format(RsImpresion!fRegistro, "dd     MMMM          yy"), 30) & String(23, " ") & Right(String(16, " ") & Format(RsImpresion!nprecioImpuesto2, "##,##,###,##0.00"), 16)
                       Else
                       Printer.Print String(35, " ") & Right(String(30, " ") & Format(RsImpresion!fRegistro, "dd     MMMM          yy"), 30) & String(23, " ") & Right(String(16, " ") & Format(0, "##,##,###,##0.00"), 16)
                    End If
                 Else
                        Printer.Print String(35, " ") & Right(String(30, " ") & Format(RsImpresion!fRegistro, "dd     MMMM          yy"), 30) & String(23, " ") & Right(String(16, " ") & Format(0, "##,##,###,##0.00"), 16)
                 End If
                 
                 
                 If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                    If RsImpresion!nprecioImpuesto1 > 0 Then
                        Printer.Print String(88, " ") & Right(String(16, " ") & Format(RsImpresion!nprecioImpuesto1, "##,##,###,##0.00"), 16)
                        Else
                        Printer.Print String(88, " ") & Right(String(16, " ") & Format(0, "##,##,###,##0.00"), 16)
                    End If
                 Else
                       Printer.Print String(88, " ") & Right(String(16, " ") & Format(0, "##,##,###,##0.00"), 16)
                 End If
                 
                  o = Printer.FontSize - 8
                 Printer.FontSize = Printer.FontSize - 8
                 Printer.Print " "
                 Printer.FontSize = o + 8
                 Printer.Print String(88, " ") & Right(String(16, " ") & Format(RsImpresion!nVenta, "##,##,###,##0.00"), 16)
                  Printer.Print " "
                 Printer.Print String(10, " ") & "HORA: " & Format(RsImpresion!fRegistro, "HH:MM:SS")
 
End Sub


Public Sub ImprimeFacturaNEmpresa18(RsImpresion As Recordset, Empresa As String, Optional tTipoDoc As String)
    ximprimeDetallado = Calcular("select lImprimeresumen as codigo from ttipodocumentoimpresora where ttipoemision='" & tTipoDoc & "' and  tcaja='" & sCaja & "'", Cn)

                 For i = 1 To nCabecera
                     Printer.Print
                 Next i
                 
                 Printer.Print String(90, " ") & RsImpresion!tDocumento
                 For i = 1 To 2
                     Printer.Print
                 Next i
                 Printer.Print String(12, " ") & Left(Mid(RsImpresion!Cliente, 1, 50) & String(50, " "), 50) & String(25, " ") & Format(RsImpresion!fRegistro, "dd          MM         yyyy")
                 Printer.Print
                 Printer.Print String(12, " ") & Left(Mid(RsImpresion!direccion, 1, 50) & String(50, " "), 50) & String(25, " ") & RsImpresion!Ruc
                 

                 For i = 1 To nDetalle
                     Printer.Print
                 Next i
                 
                 'Cuerpo
                 Item = ""
                 i = 0
                 j = 0
                                  
                 Item = ""
                 Do While Not RsImpresion.EOF
                    If ximprimeDetallado = False Then
                        xproducto = RsImpresion!Producto
                    Else
                        xproducto = RsImpresion!ProductoDetallado
                    End If
                    If Item <> RsImpresion!tCodigoPedido + RsImpresion!tItem Then
                       i = i + 1
                       'Printer.Print
                       sLinea = Right(String(7, " ") & Format(RsImpresion!nCantidad, "###0.00"), 7) & "  " & Mid(xproducto & String(75, " "), 1, 75) & " " & Right(String(9, " ") & Format(RsImpresion!nprecioVenta, "##,####0.00"), 9) & "     " & Right(String(15, " ") & Format(RsImpresion!nCantidad * RsImpresion!nprecioVenta, "#,###,##0.00"), 15)
                       Printer.Print sLinea
                    End If
                    Item = RsImpresion!tCodigoPedido + RsImpresion!tItem
                    RsImpresion.MoveNext
                 Loop
                                  
                 For j = i To nFItem
                     Printer.Print " "
                 Next j
                 
 
                 RsImpresion.MoveLast
                 Printer.Print Mid(UCase(NumeroCadena(str(RsImpresion!nVenta))) & String(85, " "), 1, 85) & String(13, " ") & Right(String(15, " ") & Format(RsImpresion!nNeto, "##,##,###,##0.00"), 15)
                 Printer.Print
                  If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                    If RsImpresion!nprecioImpuesto1 > 0 Then
                        Printer.Print String(98, " ") & Right(String(15, " ") & Format(RsImpresion!nprecioImpuesto1, "##,##,###,##0.00"), 15)
                        Else
                        Printer.Print String(98, " ") & Right(String(15, " ") & Format(0, "##,##,###,##0.00"), 15)
                    End If
                 Else
                       Printer.Print String(98, " ") & Right(String(15, " ") & Format(0, "##,##,###,##0.00"), 15)
                 End If
                 Printer.Print
                 If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                    If RsImpresion!nprecioImpuesto2 > 0 Then
                       Printer.Print String(41, " ") & Format(RsImpresion!fRegistro, "dd") & String(3, " ") & Mid(Format(RsImpresion!fRegistro, "mmmm") & String(10, " "), 1, 10) & String(9, " ") & Format(RsImpresion!fRegistro, "yy") & String(31, " ") & Right(String(15, " ") & Format(RsImpresion!nprecioImpuesto2, "##,##,###,##0.00"), 15)
                       Else
                       Printer.Print String(41, " ") & Format(RsImpresion!fRegistro, "dd") & String(3, " ") & Mid(Format(RsImpresion!fRegistro, "mmmm") & String(10, " "), 1, 10) & String(9, " ") & Format(RsImpresion!fRegistro, "yy") & String(31, " ") & Right(String(15, " ") & Format(0, "##,##,###,##0.00"), 15)
                    End If
                 Else
                    Printer.Print String(41, " ") & Format(RsImpresion!fRegistro, "dd") & String(3, " ") & Mid(Format(RsImpresion!fRegistro, "mmmm") & String(10, " "), 1, 10) & String(9, " ") & Format(RsImpresion!fRegistro, "yy") & String(31, " ") & Right(String(15, " ") & Format(0, "##,##,###,##0.00"), 15)
                 End If
                
                Printer.Print
                
                Printer.Print String(98, " ") & Right(String(15, " ") & Format(RsImpresion!nVenta, "##,##,###,##0.00"), 15)

End Sub






Public Sub ImprimeFacturaConsumoEmpresa17(RsImpresion As Recordset, sConsumo As String, Empresa As String)

                 For i = 1 To nCabecera
                     Printer.Print
                 Next i
                 
                 Printer.Print String(76, " ") & RsImpresion!tDocumento
                 For i = 1 To 3
                     Printer.Print
                 Next i
                 Printer.Print String(13, " ") & Left(Mid(RsImpresion!Cliente, 1, 50) & String(50, " "), 50) & String(25, " ") & Format(RsImpresion!fRegistro, "dd MM yyyy")
                 Printer.Print String(13, " ") & RsImpresion!Ruc
                 Printer.Print String(13, " ") & RsImpresion!direccion
                 
                 For i = 1 To nDetalle
                     Printer.Print
                 Next i
                 
                 'Cuerpo
                 Printer.Print
                 txt = sConsumo
                 tOt = Len(Trim(txt))
                 pri = True
                 j = 0
                 Do While tOt <> 0
                    j = j + 1
                    lin = Mid(txt & " ", 1, 45)
                    For i = 45 To 1 Step -1
                        If Mid(lin, i, 1) = " " Then
                           pos = i
                           Exit For
                        End If
                    Next i
                    If pri Then
                       sLinea = "              " & Mid(Mid(txt, 1, pos - 1) & String(45, " "), 1, 45) & "                " & Right(String(12, " ") & Format(RsImpresion!nVenta, "#,###,##0.00"), 12)
                       pri = False
                    Else
                       sLinea = "              " & Mid(txt, 1, pos - 1)
                    End If
                    txt = Mid(txt, pos + 1, tOt)
                    tOt = Len(txt)
                    Printer.Print sLinea
                 Loop
                    
                 For i = j To nFItem - 1
                     Printer.Print " "
                 Next i
                 
 
                 RsImpresion.MoveLast
                 Printer.Print String(13, " ") & UCase("SON: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN)
                 
 
                 For i = 1 To 3
                     Printer.Print
                 Next i
     
                 Printer.Print String(88, " ") & Right(String(16, " ") & Format(RsImpresion!nNeto, "##,##,###,##0.00"), 16)
                 Dim o As Integer

                 If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                    If RsImpresion!nprecioImpuesto2 > 0 Then
                       Printer.Print String(35, " ") & Right(String(30, " ") & Format(RsImpresion!fRegistro, "dd     MMMM          yy"), 30) & String(23, " ") & Right(String(16, " ") & Format(RsImpresion!nprecioImpuesto2, "##,##,###,##0.00"), 16)
                       Else
                       Printer.Print String(35, " ") & Right(String(30, " ") & Format(RsImpresion!fRegistro, "dd     MMMM          yy"), 30) & String(23, " ") & Right(String(16, " ") & Format(0, "##,##,###,##0.00"), 16)
                    End If
                 Else
                        Printer.Print String(35, " ") & Right(String(30, " ") & Format(RsImpresion!fRegistro, "dd     MMMM          yy"), 30) & String(23, " ") & Right(String(16, " ") & Format(0, "##,##,###,##0.00"), 16)
                 End If
                 
                 
                 If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                    If RsImpresion!nprecioImpuesto1 > 0 Then
                        Printer.Print String(88, " ") & Right(String(16, " ") & Format(RsImpresion!nprecioImpuesto1, "##,##,###,##0.00"), 16)
                        Else
                        Printer.Print String(88, " ") & Right(String(16, " ") & Format(0, "##,##,###,##0.00"), 16)
                    End If
                 Else
                       Printer.Print String(88, " ") & Right(String(16, " ") & Format(0, "##,##,###,##0.00"), 16)
                 End If
                 
                 
                 o = Printer.FontSize - 8
                 Printer.FontSize = Printer.FontSize - 8
                 Printer.Print ""
                 Printer.FontSize = o + 8


                 Printer.Print String(88, " ") & Right(String(16, " ") & Format(RsImpresion!nVenta, "##,##,###,##0.00"), 16)
                 Printer.Print " "
                 Printer.Print String(10, " ") & "HORA: " & Format(RsImpresion!fRegistro, "HH:MM:SS")
End Sub


Public Sub ImprimeFacturaConsumoEmpresa18(RsImpresion As Recordset, sConsumo As String, Empresa As String)

                 For i = 1 To nCabecera
                     Printer.Print
                 Next i
                 
                 Printer.Print String(90, " ") & RsImpresion!tDocumento
                 For i = 1 To 2
                     Printer.Print
                 Next i
                 Printer.Print String(12, " ") & Left(Mid(RsImpresion!Cliente, 1, 50) & String(50, " "), 50) & String(25, " ") & Format(RsImpresion!fRegistro, "dd          MM         yyyy")
                 Printer.Print
                 Printer.Print String(12, " ") & Left(Mid(RsImpresion!direccion, 1, 50) & String(50, " "), 50) & String(25, " ") & RsImpresion!Ruc
                 

                 For i = 1 To nDetalle
                     Printer.Print
                 Next i
                 
                 'Cuerpo
                 Printer.Print
                 txt = sConsumo
                 tOt = Len(Trim(txt))
                 pri = True
                 j = 0
                 Do While tOt <> 0
                    j = j + 1
                    lin = Mid(txt & " ", 1, 45)
                    For i = 45 To 1 Step -1
                        If Mid(lin, i, 1) = " " Then
                           pos = i
                           Exit For
                        End If
                    Next i
                    If pri Then
                       sLinea = "              " & Mid(Mid(txt, 1, pos - 1) & String(45, " "), 1, 45) & "                " & Right(String(15, " ") & Format(RsImpresion!nVenta, "#,###,##0.00"), 15)
                       pri = False
                    Else
                       sLinea = "              " & Mid(txt, 1, pos - 1)
                    End If
                    txt = Mid(txt, pos + 1, tOt)
                    tOt = Len(txt)
                    Printer.Print sLinea
                 Loop
                    
                 For i = j To nFItem - 1
                     Printer.Print " "
                 Next i
              
                 RsImpresion.MoveLast
                 Printer.Print Mid(UCase(NumeroCadena(str(RsImpresion!nVenta))) & String(85, " "), 1, 85) & String(13, " ") & Right(String(15, " ") & Format(RsImpresion!nNeto, "##,##,###,##0.00"), 15)
                 Printer.Print
                  If Not (IsNull(RsImpresion!lImpuesto1) Or RsImpresion!lImpuesto1 = 0) Then
                    If RsImpresion!nprecioImpuesto1 > 0 Then
                        Printer.Print String(98, " ") & Right(String(15, " ") & Format(RsImpresion!nprecioImpuesto1, "##,##,###,##0.00"), 15)
                        Else
                        Printer.Print String(98, " ") & Right(String(15, " ") & Format(0, "##,##,###,##0.00"), 15)
                    End If
                 Else
                       Printer.Print String(98, " ") & Right(String(15, " ") & Format(0, "##,##,###,##0.00"), 15)
                 End If
                 Printer.Print
                 If Not (IsNull(RsImpresion!lImpuesto2) Or RsImpresion!lImpuesto2 = 0) Then
                    If RsImpresion!nprecioImpuesto2 > 0 Then
                       Printer.Print String(41, " ") & Format(RsImpresion!fRegistro, "dd") & String(3, " ") & Mid(Format(RsImpresion!fRegistro, "mmmm") & String(10, " "), 1, 10) & String(9, " ") & Format(RsImpresion!fRegistro, "yy") & String(31, " ") & Right(String(15, " ") & Format(RsImpresion!nprecioImpuesto2, "##,##,###,##0.00"), 15)
                       Else
                       Printer.Print String(41, " ") & Format(RsImpresion!fRegistro, "dd") & String(3, " ") & Mid(Format(RsImpresion!fRegistro, "mmmm") & String(10, " "), 1, 10) & String(9, " ") & Format(RsImpresion!fRegistro, "yy") & String(31, " ") & Right(String(15, " ") & Format(0, "##,##,###,##0.00"), 15)
                    End If
                 Else
                    Printer.Print String(41, " ") & Format(RsImpresion!fRegistro, "dd") & String(3, " ") & Mid(Format(RsImpresion!fRegistro, "mmmm") & String(10, " "), 1, 10) & String(9, " ") & Format(RsImpresion!fRegistro, "yy") & String(31, " ") & Right(String(15, " ") & Format(0, "##,##,###,##0.00"), 15)
                 End If
                
                Printer.Print
                
                Printer.Print String(98, " ") & Right(String(15, " ") & Format(RsImpresion!nVenta, "##,##,###,##0.00"), 15)

End Sub

Public Sub ImprimePrecuentaNoValorizada(RsImpresion As Recordset, Impresora As String, Optional Cabecera As Image, Optional pie As Image)
    On Error Resume Next
    Dim Item As String
    Dim xObservacion As String
    Dim sLinea As String
    Dim zSubTotal As Double
    Dim zImpuesto1 As Double
    Dim zImpuesto2 As Double
    Dim zImpuesto3 As Double
    Dim zTotal As Double
    Dim zDescuento As Double
    Dim zRecargo As Double
    Dim txt As String
    Dim xRsPropiedad As ADODB.Recordset
    Dim xRsPropiedadCombo As ADODB.Recordset
    '0035-2013 CESAR
    Dim zGTotal As Double
    
    '---CESAR IMP
    Dim imp1 As Double
    Dim imp2 As Double
    Dim impxT As Double
    Dim impx1 As Double
    Dim impx2 As Double
    Dim impG As Double
    Dim xDescuento As Double
    Dim xRecargo As Double
    Dim xSubTotal As Double
    Dim xDiferencia As Double
    Dim xAumento As Double
    Dim Y As Integer
    Y = 0
    Y = Calcular("select case when lCanalCentralPedidos=1 then 1 else 0 end codigo from  vTipoPedido where Codigo='" & RsImpresion!tTipoPedido & "'", Cn)
    
    Dim xClienteImp As String
    Dim xTelefonoImp As String
    Dim xDireccionImp As String
    
    xClienteImp = Calcular("select isnull(tclientedelivery,'') codigo from mpedido where tcodigopedido='" & RsImpresion!codigo & "'", Cn)
    xTelefonoImp = Calcular("select isnull(ttelefono,'') codigo from tdelivery where tcodigodelivery='" & xClienteImp & "'", Cn)
    xDireccionImp = Calcular("select isnull(tDireccion,'') codigo from tdelivery where tcodigodelivery='" & xClienteImp & "'", Cn)
    
    
    imp1 = Calcular("select ISNULL(Impuesto1,0) as Codigo from TPARAMETRO", Cn)
    imp2 = Calcular("select ISNULL(Impuesto2,0) as Codigo from TPARAMETRO", Cn)
    impxT = 1 + (imp1 / 100) + (imp2 / 100)
    impx1 = 1 + (imp1 / 100)
    impx2 = 1 + (imp2 / 100)
    lPrecioNetoPrecuenta = Calcular("select ISNULL(lPrecioNetoPrecuenta,0) as Codigo from TCAJA where tCaja = '" & sCaja & "' ", Cn)
    '------------------
    
    ' marzo 2011
    Dim xSql As String
   If lAlmacen Then
      Dim RsOp As Recordset
      Set RsOp = Lib.OpenRecordset("select Codigo, Descripcion from vOperador where lStockMenos=1", Cn)
      If RsOp.RecordCount > 0 Then
         xSql = "select tCodigoPropiedad as Codigo, TPROPIEDAD.tDetallado as Descripcion, tProducto, TOPERADOR.tOperador as tOperador, TOPERADOR.tDetallado as Operador, nPrecio, tEnlace, " & _
                "nInsumo, nGasto, nManoObra " & _
                "FROM dbo.TPROPIEDAD LEFT OUTER JOIN dbo.TOPERADOR ON dbo.TPROPIEDAD.tOperador = dbo.TOPERADOR.tOperador " & _
                "Where TPROPIEDAD.lActivo = 1 And IsNull(TOPERADOR.lStockMenos, 0) <> 1 union " & _
                "select '9999' as Codigo, tDetallado as Descripcion, tCodigoPlato as tProducto, '" & RsOp!codigo & "' as tOperador, '" & RsOp!Descripcion & "' as Operador, 0, " & sAlmacenMDB & ".dbo.DRECETAVENTA.tCodigoProducto as tEnlace, nCantidad * nPrecio as nInsumo, 0, 0 " & _
                "FROM " & sAlmacenMDB & ".dbo.DRECETAVENTA INNER JOIN " & sAlmacenMDB & ".dbo.MRECETAVENTA ON " & sAlmacenMDB & ".dbo.DRECETAVENTA.tLocal = " & sAlmacenMDB & ".dbo.MRECETAVENTA.tLocal AND " & sAlmacenMDB & ".dbo.DRECETAVENTA.tRecetaVenta = " & sAlmacenMDB & ".dbo.MRECETAVENTA.tRecetaVenta INNER JOIN " & sAlmacenMDB & ".dbo.TPRODUCTO ON " & sAlmacenMDB & ".dbo.DRECETAVENTA.tCodigoProducto = " & sAlmacenMDB & ".dbo.TPRODUCTO.tCodigoProducto " & _
                "Where lNoDescargo = 1 and " & sAlmacenMDB & ".dbo.DRECETAVENTA.tLocal='" & sLocal & "'"
      Else
         xSql = "select tCodigoPropiedad as Codigo, TPROPIEDAD.tDetallado as Descripcion, tProducto, TPROPIEDAD.tOperador, nPrecio, tEnlace, " & _
                "nInsumo, nGasto, nManoObra, tOperador.tDetallado AS Operador " & _
                "FROM dbo.TPROPIEDAD LEFT OUTER JOIN dbo.TOPERADOR ON dbo.TPROPIEDAD.tOperador = dbo.TOPERADOR.tOperador " & _
                "Where TPROPIEDAD.lActivo = 1 And IsNull(TOPERADOR.lStockMenos, 0) <> 1"
      End If
   Else
         xSql = "select tCodigoPropiedad as Codigo, TPROPIEDAD.tDetallado as Descripcion, tProducto, TPROPIEDAD.tOperador, nPrecio, tEnlace, " & _
                "nInsumo, nGasto, nManoObra, tOperador.tDetallado AS Operador " & _
                "FROM dbo.TPROPIEDAD LEFT OUTER JOIN dbo.TOPERADOR ON dbo.TPROPIEDAD.tOperador = dbo.TOPERADOR.tOperador " & _
                "Where TPROPIEDAD.lActivo = 1 And IsNull(TOPERADOR.lStockMenos, 0) <> 1"
   End If
   
      Isql = "SELECT dbo.TPRODUCTOPROPIEDAD.tCodigoPedido, dbo.TPRODUCTOPROPIEDAD.tItem, dbo.TPRODUCTOPROPIEDAD.tCodigoPropiedad, dbo.TPRODUCTOPROPIEDAD.tProducto, t1.Descripcion AS Descripcion, Operador " & _
             " FROM    dbo.TOPERADOR INNER JOIN dbo.TPRODUCTOPROPIEDAD INNER JOIN (" & xSql & ")T1 ON dbo.TPRODUCTOPROPIEDAD.tCodigoPropiedad = T1.Codigo AND dbo.TPRODUCTOPROPIEDAD.tProducto = T1.tProducto AND dbo.TPRODUCTOPROPIEDAD.tEnlace = T1.tEnlace ON dbo.TOPERADOR.tOperador = T1.tOperador COLLATE Modern_Spanish_CI_AS LEFT OUTER JOIN dbo.TPROPIEDAD ON dbo.TOPERADOR.tOperador = dbo.TPROPIEDAD.tOperador AND dbo.TPRODUCTOPROPIEDAD.tCodigoPropiedad = dbo.TPROPIEDAD.tCodigoPropiedad AND dbo.TPRODUCTOPROPIEDAD.tProducto = dbo.TPROPIEDAD.tProducto " & _
             " where tCodigoPedido ='" & sPedido & "' and toperador.limprime=1 ORDER BY dbo.TOPERADOR.nBoton "
      Set xRsPropiedad = Lib.OpenRecordset(Isql, Cn)
      
        Isql = " SELECT dbo.TCOMBOPROPIEDAD.tCodigoPedido, dbo.TCOMBOPROPIEDAD.tItem, dbo.TCOMBOPROPIEDAD.tItemCombo, T1.Descripcion, T1.Operador " & _
             " FROM     dbo.TCOMBOPROPIEDAD INNER JOIN  (" & xSql & ") T1 ON dbo.TCOMBOPROPIEDAD.tCodigoPropiedad = T1.Codigo AND dbo.TCOMBOPROPIEDAD.tProducto = T1.tProducto AND  dbo.TCOMBOPROPIEDAD.tEnlace = T1.tEnlace LEFT OUTER JOIN dbo.TPROPIEDAD ON dbo.TCOMBOPROPIEDAD.tCodigoPropiedad = dbo.TPROPIEDAD.tCodigoPropiedad AND dbo.TCOMBOPROPIEDAD.tProducto = dbo.TPROPIEDAD.tProducto RIGHT OUTER JOIN dbo.TOPERADOR ON dbo.TPROPIEDAD.tOperador = dbo.TOPERADOR.tOperador AND T1.tOperador COLLATE Modern_Spanish_CI_AS = dbo.TOPERADOR.tOperador  " & _
              " where tCodigoPedido ='" & sPedido & "' and toperador.limprime=1  order by toperador.nboton"
      Set xRsPropiedadCombo = Lib.OpenRecordset(Isql, Cn)
    

    'Configura la impresora la impresion Font
    If Not Imprimir(Impresora) Then
       Exit Sub
    End If
    Printer.FontName = sFont
    Printer.FontBold = False
    
    If lImprimeImagCabPrecuenta Then
        If Cabecera <> 0 Then
        Printer.PaintPicture Cabecera, 500, Printer.CurrentY, 2860, 1600
        For p = 1 To 10
        Printer.Print
        Next p
        End If
    
    End If
    

    
    'Cabecera
    ImprimeXCentro sRazonSocial, 40
    ImprimeXCentro sRazonComercial, 40
    
    Select Case pais
        Case "001" 'Bolivia
            sLinea = String((40 - Len(Trim("N.I.T.: " + sRUC))) / 2, " ") & "N.I.T.: " + sRUC
        Case Else 'Peru, Ecuador
            sLinea = String((40 - Len(Trim("R.U.C.: " + sRUC))) / 2, " ") & "R.U.C.: " + sRUC
    End Select
    
    Printer.Print sLinea
    ImprimeXCentro sDireccion, 40
    If Trim(sDireccion2) <> "" Then
        ImprimeXCentro sDireccion2, 40
    End If
    sLinea = String((40 - Len(Trim("Telefono: " + sTelefono))) / 2, " ") & "Telefono: " + sTelefono
    Printer.Print sLinea
    Printer.Print
    
    Printer.Print "Pedido    : " & sPedido
    Printer.Print "Fecha     : " & FechaServidor()
    Printer.Print "Tipo      : " & RsImpresion!tipopedido
    Printer.Print "Caja      : " & sCaja & " - " & IIf(Mid(sUsuario, 1, 1) = "*", Mid(sUsuario, 2, 15), sUsuario)
    Printer.Print "Mesero    : " & RsImpresion!Mozo
    ImprimeXLinea "Cliente   : " & Trim(RsImpresion!Cliente), 40, 13
    
    If xTelefonoImp <> "" And xTelefono <> 0 Then
        ImprimeXLinea "Telefono  : " & Trim(xTelefonoImp), 40, 13
    End If
    If xDireccionImp <> "" And xDireccionImp <> 0 Then
        ImprimeXLinea "Direccion : " & Trim(xDireccionImp), 40, 13
    End If
    
    If Calcular("SELECT ISNULL(TENTREGARA,'') codigo FROM MPEDIDO WHERE TCODIGOPEDIDO='" & RsImpresion!codigo & "'", Cn) <> "" Then
        Printer.Print "Entregar A" & Calcular("SELECT ISNULL(TENTREGARA,'') codigo FROM MPEDIDO WHERE TCODIGOPEDIDO='" & RsImpresion!codigo & "'", Cn)
    End If
    
    If Y = 1 Then
    'telefono
    Dim tcliente As String
    Dim tTelefono As String
            tcliente = Calcular("select isnull(tclientedelivery,'') codigo from mpedido where tcodigopedido='" & RsImpresion!codigo & "'", Cn)
            If tcliente <> "" And tcliente <> "0" Then
                tTelefono = Calcular("select isnull(ttelefono,'') codigo from tdelivery where tcodigodelivery='" & tcliente & "'", Cn)
                If tTelefono <> "" And tTelefono <> "0" Then
                Printer.Print "Identif   : " & tTelefono
                End If
            End If
    End If
    
    Printer.Print "Descuento : " & Mid(Trim(RsImpresion!DESCUENTO), 1, 28)
    Printer.Print "T/Cambio  : " & Format(nTC, "###,##0.00")
    
    If Y = 1 Then
            If Calcular("select fprogramacion as codigo from mpedido where tcodigopedido='" & RsImpresion!codigo & "'", Cn) <> 0 Then
                    Printer.FontBold = True
                    Printer.Print
                    Printer.Print "F Entrega : " & Calcular("select fprogramacion as codigo from mpedido where tcodigopedido='" & RsImpresion!codigo & "'", Cn)
            End If
    End If
    Printer.Print
    Printer.FontBold = True
    txt = "MESA      : " & IIf(IsNull(RsImpresion!Mesa), "", Trim(RsImpresion!Mesa)) & " " & IIf(IsNull(RsImpresion!tObservacion), "", Trim(RsImpresion!tObservacion)) & IIf(RsImpresion!nAdulto > 0, " Pax " & RsImpresion!nAdulto, "")
    ImprimeXLinea txt, 40, 12
    Printer.FontBold = False
    
    Printer.Print
    Printer.Print String(40, "-")
    Printer.Print "Cantid. Producto"
    Printer.Print String(40, "-")
        
    RsImpresion.MoveFirst
    zSubTotal = 0
    zImpuesto1 = 0
    zImpuesto2 = 0
    zImpuesto3 = 0
    zDescuento = 0
    zRecargo = 0
    zTotal = 0
    
    'CESAR IMP
    xSubTotal = 0
    '-------
    'Cuerpo
    Item = ""
    
    Do While Not RsImpresion.EOF
       If Item <> RsImpresion!tItem Then
          'Impresion de Propiedades
          If lPropiedadPrecuenta Then
             xRsPropiedad.Filter = "tItem='" & Item & "'"
             If Not xRsPropiedad.EOF Then
                xRsPropiedad.MoveFirst
                Do While Not xRsPropiedad.EOF
                   'Printer.Print "        * " & xRsPropiedad!Operador & " " & xRsPropiedad!Descripcion
                    ImprimeXLinea "        * " & xRsPropiedad!Operador & " " & xRsPropiedad!Descripcion, 40, 8
                   xRsPropiedad.MoveNext
                Loop
             End If
                                      
             'Impresion de la Observacion
             If lObservacionPrecuenta And Len(Trim(xObservacion)) > 0 Then
                ImprimeXLinea "        - " & Trim(xObservacion), 33, 2
             End If
          End If
          'printer.print
          
          '0035-2013 CESAR
            If RsImpresion!nImpuesto1 > 0 And RsImpresion!nImpuesto2 > 0 Then
                  impG = impxT
            ElseIf RsImpresion!nImpuesto1 > 0 And RsImpresion!nImpuesto2 = 0 Then
                  impG = impx1
            ElseIf RsImpresion!nImpuesto1 = 0 And RsImpresion!nImpuesto2 > 0 Then
                  impG = impx2
            Else
                  impG = 1
            End If
          

          If lPrecioNetoPrecuenta Then
            'sLinea = Right(String(7, " ") & Format(RsImpresion!nCantidad, "###0.00"), 7) & " " & Mid(RsImpresion!Producto & String(19, " "), 1, 19) & " " & Right(String(12, " ") & Format(RsImpresion!nVenta - RsImpresion!nImpuesto1 - RsImpresion!nImpuesto2 - RsImpresion!nImpuesto3, "#,###,##0.00"), 12)
             sLinea = Right(String(7, " ") & Format(RsImpresion!nCantidad, "###0.00"), 7) & " " & Mid(RsImpresion!Producto & String(19, " "), 1, 19)
          Else
                If IsNull(RsImpresion!tOferta) Or RsImpresion!tOferta = "" Then
                   sLinea = Right(String(7, " ") & Format(RsImpresion!nCantidad, "###0.00"), 7) & " " & Mid(RsImpresion!Producto & String(19, " "), 1, 19)
                Else
                   sLinea = Right(String(7, " ") & Format(RsImpresion!nCantidad, "###0.00"), 7) & " " & Mid(RsImpresion!Producto & String(19, " "), 1, 19)
                   Printer.Print sLinea
                   sLinea = String(8, " ") & Mid(RsImpresion!tOferta & String(19, " "), 1, 19)
                End If
            
          End If
          
          
          Printer.Print sLinea
          '0035-2013 CESAR
          zGTotal = zGTotal + (RsImpresion!nPrecioOficial * RsImpresion!nCantidad)
          zTotal = zTotal + RsImpresion!nVenta
          zImpuesto1 = zImpuesto1 + RsImpresion!nImpuesto1
          zImpuesto2 = zImpuesto2 + RsImpresion!nImpuesto2
          zImpuesto3 = zImpuesto3 + RsImpresion!nImpuesto3
          '---CESAR IMP
          xDiferencia = ((RsImpresion!nPrecioOficial * RsImpresion!nCantidad) / impG) - (RsImpresion!nVenta - RsImpresion!nImpuesto1 - RsImpresion!nImpuesto2)
          xDescuento = xDescuento + xDiferencia
          xAumento = (RsImpresion!nVenta - RsImpresion!nImpuesto1 - RsImpresion!nImpuesto2) - ((RsImpresion!nPrecioOficial * RsImpresion!nCantidad) / impG)
          xRecargo = xRecargo + xAumento
          xSubTotal = xSubTotal + ((RsImpresion!nPrecioOficial * RsImpresion!nCantidad) / impG)
          '------------
          zDescuento = zDescuento + (RsImpresion!nDescuento * RsImpresion!nCantidad)
          zRecargo = zRecargo + (RsImpresion!nRecargo * RsImpresion!nCantidad)
       End If
       
       'Combos
       If lComboPrecuenta And IIf(IsNull(RsImpresion!Combo), 0, Len(Trim(RsImpresion!Combo))) > 0 Then
          sLinea = Mid("       " & Right(String(5, " ") & Format(RsImpresion!nCantidadCombo, "#0.00"), 5) & " " & RsImpresion!Combo, 1, 40)
          Printer.Print sLinea
          
          'Combos Propiedades
          If lPropiedadPrecuenta And Len(Trim(IIf(IsNull(RsImpresion!Combo), "", RsImpresion!Combo))) > 0 Then
             xRsPropiedadCombo.Filter = "tItem='" & RsImpresion!tItem & "' and tItemCombo='" & RsImpresion!tItemCombo & "'"
             If Not xRsPropiedadCombo.EOF Then
                xRsPropiedadCombo.MoveFirst
                Do While Not xRsPropiedadCombo.EOF
                   'Printer.Print "        * " & xRsPropiedadCombo!Operador & " " & xRsPropiedadCombo!Descripcion
                    ImprimeXLinea "             * " & xRsPropiedadCombo!Operador & " " & xRsPropiedadCombo!Descripcion, 40, 13
                   xRsPropiedadCombo.MoveNext
                Loop
             End If
          
             'Impresion de la Observacion
              If lObservacionPrecuenta And Len(Trim(RsImpresion!tObservacionCombo)) > 0 Then
                 ImprimeXLinea "        - " & Trim(RsImpresion!tObservacionCombo), 33, 2
              End If
          End If
       End If
       xObservacion = IIf(IsNull(RsImpresion!tObservacionPedido), "", RsImpresion!tObservacionPedido)
       Item = RsImpresion!tItem
       RsImpresion.MoveNext
    Loop
    If lPropiedadPrecuenta Then
       xRsPropiedad.Filter = "tItem='" & Item & "'"
       If Not xRsPropiedad.EOF Then
          xRsPropiedad.MoveFirst
          Do While Not xRsPropiedad.EOF
             'Printer.Print "        * " & xRsPropiedad!Operador & " " & xRsPropiedad!Descripcion
              ImprimeXLinea "        * " & xRsPropiedad!Operador & " " & xRsPropiedad!Descripcion, 40, 8
             xRsPropiedad.MoveNext
          Loop
       End If
                   
       'Impresion de la Observacion
       If lObservacionPrecuenta And Len(Trim(xObservacion)) > 0 Then
          ImprimeXLinea "        - " & Trim(xObservacion), 33, 2
       End If
    End If
            
    zSubTotal = Round(zTotal - zImpuesto1 - zImpuesto2 - zImpuesto3, 2)
    zTotal = Round(zTotal, 2)
    
    Printer.Print String(40, "-")
       
    If pais = "002" Then
       Printer.Print " "
       Printer.Print " Propina : _____________"
       Printer.Print " "
    End If
    
    Printer.Print
    Printer.Print
    Printer.Print String(40, "-")
        
    If lImpPropina Then
        'Printer.Print String(40, "_")
        Printer.Print '"|" & String(38, " ") & "|"
        Printer.Print '"|" & String(38, " ") & "|"
        Printer.Print " Propina(TIP) : ________________________"
        Printer.Print '"|" & String(38, " ") & "|"
        Printer.Print '"|" & String(38, " ") & "|"
        Printer.Print " Monto Total  : ________________________"
        Printer.Print '"|" & String(38, " ") & "|"
        Printer.Print '"|" & String(38, " ") & "|"
        Printer.Print '"|" & String(38, " ") & "|"
        Printer.Print '"|" & String(38, " ") & "|"
        Printer.Print '"|" & String(38, " ") & "|"
        Printer.Print '"|" & String(9, " ") & "--------------------" & String(9, " ") & "|"
        ImprimeXCentro "--------------------", 40
        'Printer.Print "|" & String(9, " ") & "    Firma Cliente   " & String(9, " ") & "|"
        ImprimeXCentro "Firma Cliente", 40
        'Printer.Print "|" & String(38, " ") & "|"
        'Printer.Print String(40, "_")
        Printer.Print String(40, "-")
    End If
    Printer.Print
    
    If pais = "002" Then
       Printer.FontName = sFont1
       Printer.FontBold = True
       ImprimeXCentro "DATOS PARA SU FACTURA", 40
       Printer.Print " "
       Printer.FontName = sFont
       Printer.FontBold = False
    End If
    
    Printer.Print " Razon Social : ________________________"
    Printer.Print
    Printer.Print "              : ________________________"
    Printer.Print
     Select Case pais
        Case "001" 'Bolivia
                Printer.Print " N.I.T.       : ________________________"
        Case Else 'Peru, Ecuador
                Printer.Print " R.U.C.       : ________________________"
     End Select
    If pais = "002" Then
        Printer.Print " Direccion    : ___________________________________"
        Printer.Print
        Printer.Print " Telefono     : ___________________________________"
    End If
    Printer.Print " "
    Printer.Print " Correo       : ________________________"
    Printer.Print " "
    Printer.Print String(40, "-")

    RsImpresion.MoveLast
    If Len(LTrim(sClub)) > 0 And RsImpresion!lPuntos And RsImpresion!nDisponible > 0 Then
       Printer.Print " "
       ImprimeXCentro "Ud. Tiene " & Format(RsImpresion!nDisponible, "###,##0.00") & " Puntos Acumulados", 40
       Printer.Print " "
    End If
      
    Printer.FontName = sFont1
    Printer.FontBold = True
    ImprimeXCentro sPiePreCuenta, 25
    Printer.FontName = sFont
    Printer.FontBold = False
    Set xRsPropiedad = Nothing
    Set xRsPropiedadCombo = Nothing
    
    If lImprimeImagPiePrecuenta Then
        If pie <> 0 Then
            Printer.PaintPicture pie, 500, Printer.CurrentY, 2860, 1600
        End If
    End If
    
  '  Printer.Print " "
    Printer.EndDoc
End Sub


Public Sub ImprimeFacturaNEmpresa12(RsImpresion As Recordset, Empresa As String, Optional tTipoDoc As String)
                 ximprimeDetallado = Calcular("select lImprimeresumen as codigo from ttipodocumentoimpresora where ttipoemision='" & tTipoDoc & "' and  tcaja='" & sCaja & "'", Cn)

                 For i = 1 To nCabecera
                     Printer.Print
                 Next i
                    'Printer.Print " "
                    'Printer.Print " "
                    'Printer.Print " "
                    Printer.Print String(12, " ") & Left(Mid(RsImpresion!Cliente, 1, 60) & String(60, " "), 66)
                    Printer.Print String(12, " ") & Left(Mid(RsImpresion!direccion, 1, 60) & String(60, " "), 66)
                    Printer.Print String(12, " ") & Left(Mid(RsImpresion!Ruc, 1, 60) & String(60, " "), 66)
                    Printer.Print String(12, " ") & Left(Mid(RsImpresion!Mesa, 1, 30) & String(30, " "), 36) & " " & "Mz: " & RsImpresion!Mozo
                    Printer.Print " "
                    
                 For i = 1 To nDetalle
                     Printer.Print
                 Next i
                 'Cuerpo
                 Item = "":                  i = 0:                   j = 0
                 'Cuerpo
                 Item = ""
                 Printer.Print sLinea
                 
                 Do While Not RsImpresion.EOF
                     If ximprimeDetallado = False Then
                        xproducto = RsImpresion!Producto
                    Else
                        xproducto = RsImpresion!ProductoDetallado
                    End If
                    
                    If Item <> RsImpresion!tCodigoPedido + RsImpresion!tItem Then
                       i = i + 1
                       Producto = xproducto
                       
                       sLinea = Right(String(6, " ") & Format(RsImpresion!nCantidad, "##0.00"), 6) & "    " & UCase(Mid(Producto & String(48, " "), 1, 48)) & "            " & Right(String(11, " ") & Format(RsImpresion!nprecioVenta, "##,##0.00"), 11) & " " & Right(String(14, " ") & Format(RsImpresion!nCantidad * RsImpresion!nprecioVenta, "#,###,##0.00"), 14)
                       Printer.Print sLinea
                    End If
                    
                    Item = RsImpresion!tCodigoPedido + RsImpresion!tItem
                    RsImpresion.MoveNext
                 Loop

                    For j = i To nFItem
                        Printer.Print " "
                    Next j
                            
                 Printer.Print
                 RsImpresion.MoveLast
                 Printer.Print "        Son: " & NumeroCadena(str(RsImpresion!nVenta)) & " " & sMonedaN
                 Printer.Print " "
                 Printer.Print " "
                 
                    sImportes = Right(String(20, " ") & Format(RsImpresion!nNeto, "##,###,##0.00"), 20)
                    sImportes1 = Right(String(12, " ") & Format(RsImpresion!nprecioImpuesto1, "##,###,##0.00"), 12)
                    sImportes2 = Right(String(12, " ") & Format(RsImpresion!nprecioImpuesto2, "##,###,##0.00"), 12)
                    sImportes3 = Right(String(20, " ") & Format(RsImpresion!nVenta, "##,###,##0.00"), 20)
                    Printer.Print String(76, " ") & sImportes
                    'Printer.Print String(80, " ") & Format(nPorcentaje1, "##0") & "% " & sImportes1
                    'Printer.Print String(6, " ") & Format(RsImpresion!fRegistro, " dd" & "    " & " MMMM" & "        " & " yyyy ") & String(45, " ") & Format(nPorcentaje2, "##0") & "% " & sImportes2
                    Printer.Print String(84, " ") & sImportes1
                    Printer.Print String(6, " ") & Format(RsImpresion!fRegistro, " dd" & "    " & " MMMM" & "        " & " yyyy ") & String(48, " ") & sImpuesto2 & " " & sImportes2
                    Printer.Print String(76, " ") & sImportes3
 

End Sub

'FACTURACION_E_PERU
Public Function lValidaCodBarra(ByVal lBarraHash As Boolean, ByVal Documento As String) As String
On Error GoTo fallo
    ' Nota en el sp se envia tipo 0 para identificar que es codigo de barra
    If lBarraHash Then
        Dim strPath As String 'Contiene la ruta a checkar si existe
        Dim DocNom As String ' donde se arma el nombre de la imagen
        DocNom = Calcular("exec usp_Inforest_ObtieneCodigoQR_CB_HASH_FACT '" & Documento & "' , 0", Cn)
        strPath = RutaImgFE & "\" & DocNom '"D:\senda_fact\documentoj.gif"
        If Dir(strPath, vbDirectory) <> "" Then
            lValidaCodBarra = strPath
        Else
            lValidaCodBarra = ""
        End If
    Else
         lValidaCodBarra = Calcular("exec usp_Inforest_ObtieneCodigoQR_CB_HASH_FACT '" & Documento & "' , 1", Cn) 'Calcular("select ds_value as codigo from DOCUMENTOVENTA where nro_efact='" & fDocumento & "'", CnFE)
    End If
    
    Exit Function
fallo:
lValidaCodBarra = ""
          
End Function

'FACTURACION_E_SPRING
Public Function ImagenFeSpring(ByVal lQRHash As Boolean, ByVal Documento As String) As String
On Error GoTo fallo
    ' Nota en el sp se envia tipo 0 para identificar que es codigo de barra
    If lQRHash Then
        Dim strPath As String 'Contiene la ruta a checkar si existe
        Dim DocNom As String ' donde se arma el nombre de la imagen
        DocNom = Calcular("exec usp_TransSpring_ObtieneCodigoHash_Qr_Barra '" & Documento & "' , 2", Cn)
        strPath = DocNom '"D:\senda_fact\documentoj.gif"
        If Dir(strPath, vbDirectory) <> "" Then
            ImagenFeSpring = strPath
        Else
            ImagenFeSpring = ""
        End If
    Else
         ImagenFeSpring = Calcular("exec usp_TransSpring_ObtieneCodigoHash_Qr_Barra '" & Documento & "' , 1", Cn) 'Calcular("select ds_value as codigo from DOCUMENTOVENTA where nro_efact='" & fDocumento & "'", CnFE)
    End If
    
    Exit Function
fallo:
ImagenFeSpring = ""
          
End Function

'FACTURACION_E_CARBAJAL
Public Function ImagenFeCarvajal(ByVal TipoImagen As Integer, ByVal Documento As String, ByVal NotaCredito As Integer) As String
On Error GoTo fallo
    
    Dim fso As New FileSystemObject
    
    If TipoImagen = 2 Then
        ImagenFeCarvajal = Calcular("exec usp_FeCarvajal_FactObtieneCodigoBHQ '" & Documento & "' , " & TipoImagen & ", " & NotaCredito & "", Cn)
    ElseIf TipoImagen = 1 Then
        ImagenFeCarvajal = Calcular("exec usp_FeCarvajal_FactObtieneCodigoBHQ '" & Documento & "' , " & TipoImagen & ", " & NotaCredito & "", Cn)
        strPath = ImagenFeCarvajal
        If Dir(strPath, vbDirectory) <> "" Then
            fso.CopyFile strPath, App.Path & "\fact.bmp"
            strPath = App.Path & "\fact.bmp"
            ImagenFeCarvajal = strPath
        Else
            ImagenFeCarvajal = ""
        End If
    Else
        Set rsQr = Lib.OpenRecordset("usp_FeCarvajal_FactObtieneCodigoBHQ'" & Documento & "' , " & TipoImagen & ", " & NotaCredito & "", Cn)
        FastQRCode rsQr.Fields(0), App.Path & "\BaseTempQr.bmp"
        Set imgDocumento = CreateObject("Scripting.FileSystemObject")
        If imgDocumento.FileExists(App.Path & "\BaseTempQr.bmp") Then
            ImagenFeCarvajal = App.Path & "\BaseTempQr.bmp"
        Else
            ImagenFeCarvajal = ""
        End If
    End If
    
    Exit Function
fallo:
ImagenFeCarvajal = ""
          
End Function
Public Function ImagenQR_Ofisis(ByVal OFDocumento As String, ByVal Documento As String) As String
On Error GoTo fallo
        Set rsQr = Lib.OpenRecordset("USP_FactObtenerCodigoBarraOfisis '" & OFDocumento & "','" & Mid(Documento, 1, 1) & "','' ", Cn)
            FastQRCode rsQr.Fields(0), App.Path & "\BaseTempQr.bmp"
            Set imgDocumento = CreateObject("Scripting.FileSystemObject")
            If imgDocumento.FileExists(App.Path & "\BaseTempQr.bmp") Then
                ImagenQR_Ofisis = App.Path & "\BaseTempQr.bmp"
            Else
                ImagenQR_Ofisis = ""
            End If
      Exit Function
fallo:
    ImagenQR_Ofisis = ""
End Function

Public Function ImagenQR(ByVal Documento As String) As String
On Error GoTo fallo
        Set rsQr = Lib.OpenRecordset("usp_Inforest_ObtieneCodigoQR_CB_HASH_FACT'" & Documento & "' ,2", Cn)
            FastQRCode rsQr.Fields(0), App.Path & "\BaseTempQr.bmp"
            Set imgDocumento = CreateObject("Scripting.FileSystemObject")
            If imgDocumento.FileExists(App.Path & "\BaseTempQr.bmp") Then
                ImagenQR = App.Path & "\BaseTempQr.bmp"
            Else
                ImagenQR = ""
            End If
      Exit Function
fallo:
    ImagenQR = ""
End Function
Public Function CrearImagenQR(ByVal str As String) As String
On Error GoTo fallo
    FastQRCode str, App.Path & "\BaseTempQr.bmp"
    Set imgDocumento = CreateObject("Scripting.FileSystemObject")
    If imgDocumento.FileExists(App.Path & "\BaseTempQr.bmp") Then
        CrearImagenQR = App.Path & "\BaseTempQr.bmp"
    Else
        CrearImagenQR = ""
    End If
    Exit Function
fallo:
    CrearImagenQR = ""
End Function
Public Function INSERTAFE(ByVal Documento As String, ByVal ImporteLetra As String, ByVal TipoOper As Integer, Optional Ruc As String) As Boolean ' facturacion electronica senda
'DESARROLLADOR: ERICK LEONARDO DE LA CRUZ QUISPE
'FECHA: 23/11/2017
On Error GoTo fin
    'FACTURACION_E_PERU
    Dim oComandoCabecera As clsComando
    Dim oComandoCliente As clsComando

    If TipoOper = 1 Then ' CABECERA
        '-------------------------------CABECERA-----------------------------------------------------
        Set oComandoCabecera = New clsComando
        If Not oComandoCabecera.CreateCmdSp("USP_FactDocumentoVenta", Cn) Then
             Set oComandoCabecera = Nothing
             INSERTAFE = False
             Exit Function
        End If
        oComandoCabecera.CreateParameter "@CodigoDocumento", adVarChar, adParamInput, 20, Documento
        oComandoCabecera.CreateParameter "@ImporteLetra", adVarChar, adParamInput, 250, ImporteLetra
        If Not oComandoCabecera.GetParamOK Then
             Set oComandoCabecera = Nothing
             INSERTAFE = False
             Exit Function
        End If
        If Not oComandoCabecera.ExecSP Then
             Set oComandoCabecera = Nothing
             INSERTAFE = False
             Exit Function
        End If
        '----------------------------------------------------------------------------------------------
    ElseIf TipoOper = 2 Then ' CLIENTE
        '-------------------------------------------------CLIENTE--------------------------------------
        Set oComandoCliente = New clsComando
        If Not oComandoCliente.CreateCmdSp("USP_FactCliente", Cn) Then
             Set oComandoCliente = Nothing
             INSERTAFE = False
             Exit Function
        End If
        oComandoCliente.CreateParameter "@CodigoDocumento", adVarChar, adParamInput, 20, Documento
        oComandoCliente.CreateParameter "@Identificador", adVarChar, adParamInput, 20, Ruc
        If Not oComandoCliente.GetParamOK Then
             Set oComandoCliente = Nothing
             INSERTAFE = False
             Exit Function
        End If
        If Not oComandoCliente.ExecSP Then
             Set oComandoCliente = Nothing
             INSERTAFE = False
             Exit Function
        End If
        '-------------------------------------------------------------------------------------------------
    End If
    INSERTAFE = True
    Exit Function
fin:
    INSERTAFE = False
End Function


Public Function INSERTADOCUMENTO(ByVal Pedido As String, ByVal Documento As String, ByVal tTipoDocumento As String, ByVal tCodigoCliente As String, ByVal tEstadoDocumento As String, ByVal tCaja As String, ByVal tTurno As String, ByVal tSalon As String, ByVal tUsuario As String, ByVal tUsuarioAutoriza As String, ByVal fdiacontable As Date, ByVal tDescuento As String, ByVal tConsumo As String, ByVal lImpresionMonedaExtranjera As Integer, ByVal tAutorizacion As String, ByVal tcodigoControl As String, ByVal Cortesia As String, ByVal fInicio As Date, ByVal fCaducidad As Date, ByVal tContribuyenteEspecial As String, ByVal TipoOper As Integer) As Boolean
'DESARROLLADOR: ERICK LEONARDO DE LA CRUZ QUISPE
'FECHA: 27/11/2017
On Error GoTo fin
    '@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
    Cn.BeginTrans
    Dim oComando As clsComando
    INSERTADOCUMENTO = True
    Set oComando = New clsComando
    If Not oComando.CreateCmdSp("usp_Inforest_InsertaDocumento", Cn) Then
       Set oComando = Nothing
       GoTo fin
    End If

    oComando.CreateParameter "@Pedido", adVarChar, adParamInput, 50, Pedido
    oComando.CreateParameter "@Documento", adVarChar, adParamInput, 50, Documento
    oComando.CreateParameter "@tTipoDocumento", adVarChar, adParamInput, 50, tTipoDocumento
    oComando.CreateParameter "@tCodigoCliente", adVarChar, adParamInput, 50, tCodigoCliente
    oComando.CreateParameter "@tEstadoDocumento", adVarChar, adParamInput, 50, tEstadoDocumento
    oComando.CreateParameter "@tCaja", adVarChar, adParamInput, 50, tCaja
    oComando.CreateParameter "@tTurno", adVarChar, adParamInput, 50, tTurno
    oComando.CreateParameter "@tSalon", adVarChar, adParamInput, 50, tSalon
    oComando.CreateParameter "@tUsuario", adVarChar, adParamInput, 50, tUsuario
    oComando.CreateParameter "@tUsuarioAutoriza", adVarChar, adParamInput, 50, tUsuarioAutoriza
    oComando.CreateParameter "@fDiaContable", adDate, adParamInput, 50, fdiacontable
    oComando.CreateParameter "@tDescuento", adVarChar, adParamInput, 50, tDescuento
    oComando.CreateParameter "@tConsumo", adVarChar, adParamInput, 300, tConsumo
    oComando.CreateParameter "@lImpresionMonedaExtranjera", adInteger, adParamInput, 50, lImpresionMonedaExtranjera
    oComando.CreateParameter "@tautorizacion", adVarChar, adParamInput, 50, tAutorizacion
    oComando.CreateParameter "@tcodigocontrol", adVarChar, adParamInput, 50, tcodigoControl
    oComando.CreateParameter "@Cortesia", adVarChar, adParamInput, 50, Cortesia
    oComando.CreateParameter "@fInicio", adDate, adParamInput, 50, fInicio
    oComando.CreateParameter "@fcaducidad", adDate, adParamInput, 50, fCaducidad
    oComando.CreateParameter "@tContribuyenteEspecial", adVarChar, adParamInput, 50, tContribuyenteEspecial
    oComando.CreateParameter "@tipooper", adInteger, adParamInput, 50, TipoOper

    If Not oComando.GetParamOK Then
       Set oComando = Nothing
       GoTo fin
    End If
    If Not oComando.ExecSP Then
       Set oComando = Nothing
       GoTo fin
    End If

    '@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
    Cn.CommitTrans
    Exit Function
fin:
    Cn.RollbackTrans
    MsgBox "Error" & error & " | Error al insertar Documento", vbCritical, sMensaje
    INSERTADOCUMENTO = False
End Function

Public Sub FormatoCeldaGrilla(ByVal NomGrid As Variant, ByVal col As Integer, ByVal Filtro As String)
    Dim Negativo As New TrueOleDBGrid80.Style
    
    Negativo.backColor = &HC0E0FF
    Negativo.ForeColor = &HC0&
    NomGrid.Columns(col).AddRegexCellStyle 0, Negativo, Filtro
End Sub

Public Sub ImprimeComprobantePagoMesa247(ByVal DocPago As String)
    On Error GoTo fin

    Dim RsPagoMesa247 As Recordset
    Set RsPagoMesa247 = Lib.OpenRecordset("EXEC usp_WS_MESA_Inforest '" & DocPago & "','',5 ", Cn)
    If RsPagoMesa247.RecordCount = 0 Then
        Exit Sub
    End If
    Imprimir (RsPagoMesa247!Impresora)
    Printer.FontName = sFont
    Printer.FontBold = False
    Printer.Print
    ImprimeXCentro sRazonSocial, 40
    ImprimeXCentro sRazonComercial, 40
    sLinea = String((40 - Len(Trim("R.U.C.: " + sRUC))) / 2, " ") & "R.U.C.: " + sRUC
    Printer.Print sLinea
    ImprimeXCentro sDireccion, 40
    Printer.Print
    ImprimeXCentro "Constancia de Pago MESA24/7", 40
    Printer.FontBold = True
    ImprimeXCentro UCase(RsPagoMesa247!Mesa), 40
    Printer.FontBold = False
    Printer.Print
    Printer.Print String(40, "-")
    Printer.Print "Fecha    : " & RsPagoMesa247!Fecha
    ImprimeXLinea "Cliente  : " & RsPagoMesa247!Cliente, 40, 11
    Printer.Print "Pedido   : " & RsPagoMesa247!Pedido
    Printer.Print "Documento: " & RsPagoMesa247!Documento
    Printer.Print "Caja     : " & RsPagoMesa247!Caja
    ImprimeXLinea "Mesero   : " & RsPagoMesa247!Mesero, 40, 11
    Printer.Print "Monto    : " & Format(RsPagoMesa247!Monto, "###,##0.00")
    Printer.Print "Propina  : " & Format(RsPagoMesa247!Propina, "###,##0.00")
    Printer.Print String(40, "-")
    Printer.Print
    Printer.Print "               ¶¶¶¶¶¶¶¶"
    Printer.Print "          ¶¶¶¶¶        ¶¶¶¶¶"
    Printer.Print "        ¶¶¶                 ¶¶¶"
    Printer.Print "      ¶¶¶                     ¶¶¶"
    Printer.Print "     ¶¶                         ¶¶"
    Printer.Print "    ¶       ¶¶¶     ¶¶¶          ¶¶"
    Printer.Print "   ¶          ¶¶      ¶¶          ¶¶"
    Printer.Print "  ¶¶           ¶¶      ¶¶         ¶¶"
    Printer.Print "  ¶             ¶¶      ¶¶   ¶¶¶   ¶¶"
    Printer.Print " ¶¶      ¶¶     ¶¶      ¶¶     ¶¶  ¶¶"
    Printer.Print " ¶¶    ¶¶¶      ¶¶      ¶¶      ¶¶ ¶¶"
    Printer.Print " ¶¶   ¶¶¶¶¶                  ¶¶ ¶¶ ¶¶"
    Printer.Print "  ¶   ¶¶  ¶¶                 ¶¶    ¶¶"
    Printer.Print "  ¶¶       ¶¶              ¶¶¶     ¶¶"
    Printer.Print "   ¶¶       ¶¶            ¶¶¶     ¶¶"
    Printer.Print "    ¶¶        ¶¶¶¶     ¶¶¶¶      ¶¶"
    Printer.Print "     ¶¶          ¶¶¶¶¶¶¶        ¶¶"
    Printer.Print "       ¶¶                     ¶¶"
    Printer.Print "         ¶¶¶               ¶¶¶"
    Printer.Print "            ¶¶¶¶¶¶¶¶¶¶¶¶¶¶¶"
    Printer.Print
    Printer.FontBold = True
    ImprimeXCentro "Gracias!!!", 40
    Printer.FontBold = False
    Printer.Print
    Printer.EndDoc
fin:
    Exit Sub
End Sub

Public Sub Log_Inforest(ByVal tTabla As String, ByVal Proceso As String, ByVal CodError As String, ByVal ErrorProcedure As String, ByVal ErrorLine As String, ByVal ErrorMensaje As String, ByVal DatoAlternativo As String, ByVal Observaciones As String, ByVal Usuario As String)
On Error GoTo fin
    Dim oComandoError As clsComando
    Set oComandoError = New clsComando
    If Not oComandoError.CreateCmdSp("usp_Inforest_InsertarLogErrores", Cn) Then
       Set oComandoError = Nothing
       Exit Sub
    End If
    oComandoError.CreateParameter "@Ttabla", adVarChar, adParamInput, 100, Trim(tTabla)
    oComandoError.CreateParameter "@Proceso", adVarChar, adParamInput, 100, Proceso
    oComandoError.CreateParameter "@CodError", adVarChar, adParamInput, 100, CodError
    oComandoError.CreateParameter "@ErrorProcedure", adVarChar, adParamInput, 100, ErrorProcedure
    oComandoError.CreateParameter "@ErrorLine", adVarChar, adParamInput, 100, ErrorLine
    oComandoError.CreateParameter "@ErrorMensaje", adVarChar, adParamInput, 500, ErrorMensaje
    oComandoError.CreateParameter "@DatoAlternativo", adVarChar, adParamInput, 100, DatoAlternativo
    oComandoError.CreateParameter "@Observaciones", adVarChar, adParamInput, 100, Observaciones
    oComandoError.CreateParameter "@Usuario", adVarChar, adParamInput, 100, Usuario
    oComandoError.CreateParameter "@tipooper", adInteger, adParamInput, 50, 1
    If Not oComandoError.GetParamOK Then
       Set oComandoError = Nothing
       Exit Sub
    End If
    If Not oComandoError.ExecSP Then
       Set oComandoError = Nothing
       Exit Sub
    End If
fin:
    Exit Sub
End Sub
Function ValidaCierrePosterior(Fecha As String, CodigoArea As String, CodigoAreaT As String, TipoDoc As String)
    
    Dim RsTemp As Recordset
    Isql = "Exec spAlm_ConsultaCierrePosterior '" & Fecha & "', '" & CodigoArea & "', '" & CodigoAreaT & "', '" & TipoDoc & "' "
    Set RsTemp = Lib.OpenRecordset(Isql, IIf(verificaAlmacenRemoto = "ON", CnAlmacenRemoto, CnAlmacen))
    If RsTemp.RecordCount > 0 Then
        ValidaCierrePosterior = RsTemp!ExisteCierre
    End If
    
End Function
Public Function FacturarTCPIP(ByVal TipoProceso As Integer, ByVal Doctcpip As String, ByVal NC As Integer) As Boolean
On Error GoTo fin
    Dim Matr() As String
    FacturarTCPIP = True
    Set clsTramaFE = New clsTrama
    Dim ModoTraing As Integer
    Dim clogFecha, cFechaReg, NcDoc, TipoDoc, tDoc, msError, Ruta, NameArchivo, Conte, UBL21 As String
    clogFecha = Calcular("select convert(nvarchar,getdate(),112) as codigo", Cn)
    cFechaReg = Calcular("select convert(nvarchar,getdate(),120) as codigo", Cn)
    
    ModoTraing = CInt((Trim(LeerIni(App.Path + "\INFOREST.INI", "TCPIP", "MODO", "1"))))
    
    If lFEubl21 Then
        UBL21 = "exec USP_FactDocumentoVentaTCPUBL21 '" & Doctcpip & "'," & NC & "," & sCaja & "," & ModoTraing & "," & TipoProceso & " "
    Else
        UBL21 = "exec USP_FactDocumentoVentaTCP '" & Doctcpip & "'," & NC & "," & sCaja & "," & ModoTraing & "," & TipoProceso & " "
    End If
    
    frmWinSock.TipoOper = 0
    frmWinSock.TramaTCPIP = ConvertStringToUtf8String(clsTramaFE.EncriptaTrama(Lib.OpenRecordset(UBL21, Cn), CStr(TipoProceso)))
    frmWinSock.Show vbModal
    Matr = clsTramaFE.DesencriptaTrama(frmWinSock.Resp, CStr(TipoProceso))
    
    If Matr(1, 1) <> "0" Then

        FacturarTCPIP = False
        If TipoProceso = 1 Then
            MsgBox "Error : Autentificación con e-Pos  Paperlees " & vbNewLine & frmWinSock.Resp, vbCritical, sMensaje
        ElseIf TipoProceso = 2 Then
            MsgBox "Error : Envio de Documento al e-Pos  Paperlees " & vbNewLine & frmWinSock.Resp, vbCritical, sMensaje
        Else
            MsgBox "Error Paperlees: Envio Confirmación de Documento al e-Pos  Paperlees " & vbNewLine & frmWinSock.Resp, vbCritical, sMensaje
        End If
        PapeTermico = ""
        PapeMatricial = ""
        msError = " ERROR" & Replace(Right(cFechaReg, 8), ":", ".")
        tDoc = "ERROR"

    Else

        msError = ""
        PapeMatricial = Matr(1, 5)

        If TipoProceso = 2 Then
            PapeTermico = TCPQR(Matr(1, 4))
            tDoc = "FACTURA"
            If NC = 0 Then
                Cn.Execute " UPDATE MDOCUMENTO SET lEstadoFacturacion=1 , tRespFacturacion='" & Mid(Matr(1, 5), 1, 100) & "', tImprTermica='" & Mid(Matr(1, 4), 1, 500) & "' WHERE tDocumento='" & Doctcpip & "'"
            Else
                Cn.Execute " UPDATE MNOTACREDITO SET lEstadoFacturacion=1 , tRespFacturacion='" & Mid(Matr(1, 5), 1, 100) & "', tImprTermica='" & Mid(Matr(1, 4), 1, 500) & "' WHERE tNotacredito='" & Doctcpip & "'"
            End If
        ElseIf TipoProceso = 1 Then
            tDoc = "CONFIGURA"
        Else
            tDoc = "CONFIRMA"
        End If

    End If
    
    Ruta = App.Path & "\ConfiguracionTrama\Log\" & clogFecha & "\" & tDoc
    
    If Dir(Ruta) = "" Then
        Call CrearCarpetas(Ruta)
    End If
    
    If Doctcpip <> "" Then
        If NC = 0 Then
            TipoDoc = Calcular("select distinct isnull(tcodigoexterno,'00') as codigo from vDocumentoImpresora where tDocumento='" & Doctcpip & "'", Cn)
            Doctcpip = Mid(Doctcpip, 1, 1) + Mid(Doctcpip, 4, 3) + Mid(Doctcpip, 8, 8)
        Else
            TipoDoc = "07"
            NcDoc = Calcular("select isnull(tDocumento,'') as codigo from MNOTACREDITO where tNotaCredito='" & Doctcpip & "'", Cn)
            Doctcpip = Mid(NcDoc, 1, 1) + Mid(Doctcpip, 4, 3) + Mid(Doctcpip, 8, 8)
        End If
    Else
        TipoDoc = "CONF " & clogFecha & " " & Replace(Right(cFechaReg, 8), ":", ".")
    End If
    
    NameArchivo = sRUC & "-" & Doctcpip & "-" & TipoDoc & " " & TipoProceso & msError
    Conte = "FECHA REG: " & cFechaReg & vbNewLine & vbNewLine & "RUC: " & sRUC & vbNewLine & vbNewLine & "SEND: " & frmWinSock.TramaTCPIP & vbNewLine & vbNewLine & "RECEIVE: " & frmWinSock.Resp
    If Not CrearTxt(Ruta, NameArchivo, Conte) Then
        MsgBox "No se guardo el Log de FE Paperlees.... Verificar Escritura de Datos"
    End If

    frmWinSock.TramaTCPIP = ""
    frmWinSock.Resp = ""
    Exit Function
fin:
FacturarTCPIP = False
Call Log_Inforest("Paperlees", "Facturar TCPIP", TipoProceso, "Caja: " + sCaja, Doctcpip, error, NC, "FALLA TCP IP", sUsuario)
End Function

Public Function CrearTxt(ByVal Ruta As String, ByVal NombreArchivo As String, ByVal Contenido As String) As Boolean
On Error GoTo fin
    CrearTxt = True
    Dim FS As Object
    Set FS = CreateObject("Scripting.FileSystemObject")
    Set a = FS.CreateTextFile(Ruta & "\" & NombreArchivo & ".txt", True)
    a.WriteLine Contenido
    '"FECHA REG: " & cFechaReg & vbNewLine & vbNewLine & "RUC: " & sRUC & vbNewLine & vbNewLine & "SEND: " & frmWinSock.TramaTCPIP & vbNewLine & vbNewLine & "RECEIVE: " & frmWinSock.Resp
    Exit Function
fin:
CrearTxt = False
End Function
 Public Function TCPQR(ByVal str As String) As String
 On Error GoTo fin:
     Dim CANT, posicion As Integer
     CANT = CInt((Trim(LeerIni(App.Path + "\INFOREST.INI", "TCPIP", "ITEMQR", "."))))
     posicion = 1
     For i = 1 To CANT
        posicion = InStr(posicion, str, "|") + 1
     Next i
     If posicion = 1 Then
        TCPQR = str
     Else
        TCPQR = CStr(Mid(str, 1, posicion - 2))
     End If
     Exit Function
fin:
 TCPQR = ""
 End Function
Public Sub CrearCarpetas(ByVal Ruta As String)
  
On Error GoTo ErrSub
  
    Dim i As Integer
    Dim Array_Dir As Variant
    Dim Sub_Dir As String
    Dim El_Path As String
  
    El_Path = Ruta
      
    If El_Path = vbNullString Then
        Exit Sub
    End If
      
    Array_Dir = Split(El_Path, "\")
      
    El_Path = vbNullString
      
    For i = LBound(Array_Dir) To UBound(Array_Dir)
        Sub_Dir = Array_Dir(i)
        If Sub_Dir <> vbNullString Then
           El_Path = El_Path & Sub_Dir & "\"
           If Right$(Sub_Dir, 1) <> ":" Then
              ' Verificamos que no exista
              If Dir(El_Path, vbDirectory) = vbNullString Then
                 'Crea la carpeta
                  Call MkDir(El_Path)
              End If
           End If
        End If
    Next
Exit Sub
ErrSub:
'
End Sub

Public Function INSERTAFE_SPRING(ByVal Documento As String, ByVal TipoMetodo As Integer) As Boolean ' facturacion electronica spring
'DESARROLLADOR: ERICK LEONARDO DE LA CRUZ QUISPE || DIEGO ARMANDO LUNA QUINTO
'FECHA: 11/01/2018
On Error GoTo fin
    'FACTURACION_E_SPRING
    Dim oComandoCabecera As clsComando
    Dim oComandoCliente As clsComando

    Set oComandoCabecera = New clsComando
    If Not oComandoCabecera.CreateCmdSp("usp_TransSpring_FactDocumentoVenta", Cn) Then
         Set oComandoCabecera = Nothing
         INSERTAFE_SPRING = False
         Exit Function
    End If
    oComandoCabecera.CreateParameter "@Documento", adVarChar, adParamInputOutput, 20, Documento
        oComandoCabecera.CreateParameter "@TipoMetodo", adInteger, adParamInput, 20, TipoMetodo
    If Not oComandoCabecera.GetParamOK Then
         Set oComandoCabecera = Nothing
         INSERTAFE_SPRING = False
         Exit Function
    End If
    If Not oComandoCabecera.ExecSP Then
         Set oComandoCabecera = Nothing
         INSERTAFE_SPRING = False
         Exit Function
    End If
    
    If oComandoCabecera.GetParameterValue("@Documento") = "" Then
        INSERTAFE_SPRING = False
        Exit Function
    End If
    
    INSERTAFE_SPRING = True
    Exit Function
fin:
    INSERTAFE_SPRING = False
End Function


Public Function INSERTAFE_CARVAJAL(ByVal Documento As String, ByVal ImporteLetra As String, ByVal NotaCredito As Integer, ByVal Anulado As Integer) As Boolean ' facturacion electronica spring
'DESARROLLADOR: ERICK LEONARDO DE LA CRUZ QUISPE || DIEGO ARMANDO LUNA QUINTO
'FECHA: 11/01/2018
On Error GoTo fin
    'FACTURACION_E_SPRING
    Dim oComandoCabecera As clsComando
    Dim oComandoCliente As clsComando

    Set oComandoCabecera = New clsComando
    If Not oComandoCabecera.CreateCmdSp("usp_FeCarvajal_FactFirmaDocumento", Cn) Then
         Set oComandoCabecera = Nothing
         INSERTAFE_CARVAJAL = False
         Exit Function
    End If
    oComandoCabecera.CreateParameter "@Documento", adVarChar, adParamInputOutput, 50, Documento
    oComandoCabecera.CreateParameter "@ImporteLetra", adVarChar, adParamInput, 250, ImporteLetra
    oComandoCabecera.CreateParameter "@NotaCredito", adInteger, adParamInput, 20, NotaCredito
    oComandoCabecera.CreateParameter "@Anulado", adInteger, adParamInput, 20, Anulado
    If Not oComandoCabecera.GetParamOK Then
         Set oComandoCabecera = Nothing
         INSERTAFE_CARVAJAL = False
         Exit Function
    End If
    If Not oComandoCabecera.ExecSP Then
         Set oComandoCabecera = Nothing
         INSERTAFE_CARVAJAL = False
         Exit Function
    End If
    
    If oComandoCabecera.GetParameterValue("@Documento") = "" Then
        INSERTAFE_CARVAJAL = False
        Exit Function
    End If
    
    INSERTAFE_CARVAJAL = True
    Exit Function
fin:
    INSERTAFE_CARVAJAL = False
End Function
Public Function INSERTA_FE_INFOREST(ByVal Documento As String, ByVal TipoOper As Integer, ByVal Fecha As Date) As Boolean ' facturacion electronica spring
'DESARROLLADOR: ERICK LEONARDO DE LA CRUZ QUISPE
'FECHA: 19/10/2018
On Error GoTo fin
    Dim oComandoFE As clsComando
    Set oComandoFE = New clsComando
    If Not oComandoFE.CreateCmdSp("usp_FacturacionElectronica", Cn) Then
         Set oComandoFE = Nothing
         INSERTA_FE_INFOREST = False
         Exit Function
    End If
    oComandoFE.CreateParameter "@Documento", adVarChar, adParamInputOutput, 50, Documento
    oComandoFE.CreateParameter "@tipooper", adInteger, adParamInput, 250, TipoOper
    oComandoFE.CreateParameter "@fecha", adVarChar, adParamInput, 20, CStr(Format(Fecha, "YYYYmmdd"))
    
    If Not oComandoFE.GetParamOK Then
         Set oComandoFE = Nothing
         INSERTA_FE_INFOREST = False
         Exit Function
    End If
    If Not oComandoFE.ExecSP Then
         Set oComandoFE = Nothing
         INSERTA_FE_INFOREST = False
         Exit Function
    End If
    
    If oComandoFE.GetParameterValue("@Documento") = "" Then
        INSERTA_FE_INFOREST = False
        Exit Function
    End If
    
    INSERTA_FE_INFOREST = True
    Exit Function
fin:
    INSERTA_FE_INFOREST = False
End Function
Public Function QRHASH_FE_INFOREST(ByVal TipoImagen As Integer, ByVal Documento As String, ByVal NotaCredito As Integer) As String
On Error GoTo fallo
    
    Dim fso As New FileSystemObject
    
    If TipoImagen = 2 Then
        QRHASH_FE_INFOREST = Calcular("exec usp_FE_FactObtieneCodigoBHQ '" & Documento & "' , " & TipoImagen & ", " & NotaCredito & "", Cn)
    ElseIf TipoImagen = 1 Then
        QRHASH_FE_INFOREST = Calcular("exec usp_FE_FactObtieneCodigoBHQ '" & Documento & "' , " & TipoImagen & ", " & NotaCredito & "", Cn)
        strPath = QRHASH_FE_INFOREST
        If Dir(strPath, vbDirectory) <> "" Then
            fso.CopyFile strPath, App.Path & "\fact.bmp"
            strPath = App.Path & "\fact.bmp"
            QRHASH_FE_INFOREST = strPath
        Else
            QRHASH_FE_INFOREST = ""
        End If
    Else
        Set rsQr = Lib.OpenRecordset("exec usp_FE_FactObtieneCodigoBHQ '" & Documento & "' , " & TipoImagen & ", " & NotaCredito & "", Cn)
        FastQRCode rsQr.Fields(0), App.Path & "\BaseTempQr.bmp"
        Set imgDocumento = CreateObject("Scripting.FileSystemObject")
        If imgDocumento.FileExists(App.Path & "\BaseTempQr.bmp") Then
            QRHASH_FE_INFOREST = App.Path & "\BaseTempQr.bmp"
        Else
            QRHASH_FE_INFOREST = ""
        End If
    End If
    
    Exit Function
fallo:
QRHASH_FE_INFOREST = ""
          
End Function
Public Function validaConexionSistemaExterno(servidor As String, bd As String, UserName As String, passName As String) As Boolean
 On Error GoTo err:
     Dim verificaEstadoServidor As Boolean
    verificaEstadoServidor = conectaPCServidor(servidor)
    If verificaEstadoServidor = False Then: GoTo err

    DoEvents
    
    Dim con As New Connection
    Set con = New Connection
    con.Provider = "SQLOLEDB"
    con.CursorLocation = adUseClient
    con.ConnectionString = "User ID=" & UserName & _
                          ";password=" & passName & _
                          ";Data Source=" & servidor & _
                          ";Initial Catalog=" & bd
    con.ConnectionTimeout = 8
    DoEvents
    con.Open
    DoEvents
    If con.State Then
        validaConexionSistemaExterno = True
    Else
        validaConexionSistemaExterno = False
    End If
Exit Function
err:
         validaConexionSistemaExterno = False
End Function
Public Function ConvertStringToUtf8String(ByRef strText As String) As String

    Dim objStream As ADODB.Stream
    Dim Data() As Byte
    Dim strUTF8String As String
    Dim i As Long
    
    ' init stream
    Set objStream = New ADODB.Stream
    objStream.Charset = "utf-8"
    objStream.Mode = adModeReadWrite
    objStream.Type = adTypeText
    objStream.Open
    
    ' write bytes into stream
    objStream.WriteText strText
    objStream.Flush
    
    ' rewind stream and read text
    objStream.Position = 0
    objStream.Type = adTypeBinary
    objStream.Read 3 ' skip first 3 bytes as this is the utf-8 marker
    Data = objStream.Read()
    
    ' close up and return
    objStream.Close
    
    'Convert back to ascii
    For i = 0 To UBound(Data)
        strUTF8String = strUTF8String & Chr(Data(i))
    Next i
    ConvertStringToUtf8String = strUTF8String

End Function


Public Function ValidarDNI(ByVal strDNI As String) As Boolean

  Dim i As Long
  Dim a As String
  Dim b As String
  strDNI = Trim(strDNI)
  ValidarDNI = strDNI > ""
  If ValidarDNI Then
    ValidarDNI = (LetraDNI(strDNI) = UCase(Right(strDNI, 1)))
    If ValidarDNI Then
      For i = 1 To Len(strDNI) - 1
        If InStr("0123456789.-", Mid(strDNI, i, 1)) = 0 Then
          ValidarDNI = False
        End If
      Next
    End If
  End If
  
End Function


Public Function LetraDNI(strDNI As String) As String

  Dim strNumDNI As String
  Dim sChar As String * 1
  Dim i As Integer
  
  strDNI = UCase(Trim(strDNI))
  
  If InStr("XYZ", Left(strDNI, 1)) Then
    strDNI = Chr(Asc(Left(strDNI, 1)) - 40) + Mid(strDNI, 2)
  End If
  
  For i = 1 To Len(strDNI)
    sChar = Mid(strDNI, i, 1)
    If InStr("0123456789", sChar) Then strNumDNI = strNumDNI & sChar
  Next
  If Len(strNumDNI) = 8 Then
    LetraDNI = Right(strDNI, 1)
    'Mid("123456789", (CLng(strNumDNI) Mod 7) + 1, 1)
  Else
    LetraDNI = ""
  End If
  
End Function
Public Sub ExportaExcel(RST As Recordset)
On Error GoTo fin
    Dim xlApp As Object
    Dim xlWb As Object
    Dim xlWs As Object

    Dim recArray As Variant
    
    Dim strDB As String
    Dim fldCount As Integer
    Dim recCount As Long
    Dim iCol As Integer
    Dim iRow As Integer

    ' Create an instance of Excel and add a workbook
    Set xlApp = CreateObject("Excel.Application")
    Set xlWb = xlApp.Workbooks.Add
    Set xlWs = xlWb.worksheets(xlWb.sheets(1).Name)
  
    ' Display Excel and give user control of Excel's lifetime
    xlApp.Visible = True
    xlApp.UserControl = True
    
    ' Copy field names to the first row of the worksheet
    fldCount = RST.Fields.Count
    For iCol = 1 To fldCount
        xlWs.cells(1, iCol).value = RST.Fields(iCol - 1).Name
    Next
        
    ' Check version of Excel
    If Val(Mid(xlApp.Version, 1, InStr(1, xlApp.Version, ".") - 1)) > 8 Then
        'EXCEL 2000,2002,2003, or 2007: Use CopyFromRecordset
         
        ' Copy the recordset to the worksheet, starting in cell A2
        xlWs.cells(2, 1).CopyFromRecordset RST
        'Note: CopyFromRecordset will fail if the recordset
        'contains an OLE object field or array data such
        'as hierarchical recordsets
        
    Else
        'EXCEL 97 or earlier: Use GetRows then copy array to Excel
    
        ' Copy recordset to an array
        recArray = RST.GetRows
        'Note: GetRows returns a 0-based array where the first
        'dimension contains fields and the second dimension
        'contains records. We will transpose this array so that
        'the first dimension contains records, allowing the
        'data to appears properly when copied to Excel
        
        ' Determine number of records

        recCount = UBound(recArray, 2) + 1 '+ 1 since 0-based array
        
        ' Check the array for contents that are not valid when
        ' copying the array to an Excel worksheet
        For iCol = 0 To fldCount - 1
            For iRow = 0 To recCount - 1
                ' Take care of Date fields
                If IsDate(recArray(iCol, iRow)) Then
                    recArray(iCol, iRow) = Format(recArray(iCol, iRow))
                ' Take care of OLE object fields or array fields
                ElseIf IsArray(recArray(iCol, iRow)) Then
                    recArray(iCol, iRow) = "Array Field"
                End If
            Next iRow 'next record
        Next iCol 'next field
            
        ' Transpose and Copy the array to the worksheet,
        ' starting in cell A2
        xlWs.cells(2, 1).Resize(recCount, fldCount).value = _
            TransposeDim(recArray)
    End If

    ' Auto-fit the column widths and row heights
    xlApp.Selection.CurrentRegion.Columns.AutoFit
    xlApp.Selection.CurrentRegion.Rows.AutoFit

    Set RST = Nothing
    Set Cnt = Nothing
    
    Set xlWs = Nothing
    Set xlWb = Nothing

    Set xlApp = Nothing
    Exit Sub
fin:
MsgBox "Ocurrio un Problema al exportar en Excel, Favor de revisar Office" + vbNewLine + "Mensaje: " + error + vbNewLine + " Maximo de lineas en (*.xls - 65,536),(*.xlsx - 1,048,576)", vbInformation

End Sub
Private Function TransposeDim(v As Variant) As Variant
' Custom Function to Transpose a 0-based array (v)
    
    Dim X As Long, Y As Long, Xupper As Long, Yupper As Long
    Dim tempArray As Variant
    
    Xupper = UBound(v, 2)
    Yupper = UBound(v, 1)
    
    ReDim tempArray(Xupper, Yupper)
    For X = 0 To Xupper
        For Y = 0 To Yupper
            tempArray(X, Y) = v(Y, X)
        Next Y
    Next X
    
    TransposeDim = tempArray


End Function

Public Sub ImprimePreCuentaingles(RsImpresion As Recordset, Impresora As String, Optional Cabecera As Image, Optional pie As Image)
    On Error Resume Next
    Dim Item As String
    Dim xObservacion As String
    Dim sLinea As String
    Dim zSubTotal As Double
    Dim zImpuesto1 As Double
    Dim zImpuesto2 As Double
    Dim zImpuesto3 As Double
    Dim zTotal As Double
    Dim zDescuento As Double
    Dim zRecargo As Double
    Dim txt As String
    Dim xRsPropiedad As ADODB.Recordset
    Dim xRsPropiedadCombo As ADODB.Recordset

    Dim zGTotal As Double
    
    '---CESAR IMP
    Dim imp1 As Double
    Dim imp2 As Double
    Dim impxT As Double
    Dim impx1 As Double
    Dim impx2 As Double
    Dim impG As Double
    Dim xDescuento As Double
    Dim xRecargo As Double
    Dim xSubTotal As Double
    Dim xDiferencia As Double
    Dim xAumento As Double
    Dim Y As Integer
    Y = 0
    Y = Calcular("select case when lCanalCentralPedidos=1 then 1 else 0 end codigo from  vTipoPedido where Codigo='" & RsImpresion!tTipoPedido & "'", Cn)

    Dim xClienteImp As String
    Dim xTelefonoImp As String
    Dim xDireccionImp As String
    
    xClienteImp = Calcular("select isnull(tclientedelivery,'') codigo from mpedido where tcodigopedido='" & RsImpresion!codigo & "'", Cn)
    xTelefonoImp = Calcular("select isnull(ttelefono,'') codigo from tdelivery where tcodigodelivery='" & xClienteImp & "'", Cn)
    xDireccionImp = Calcular("select isnull(tDireccion,'') codigo from tdelivery where tcodigodelivery='" & xClienteImp & "'", Cn)
    
    
    imp1 = Calcular("select ISNULL(Impuesto1,0) as Codigo from TPARAMETRO", Cn)
    imp2 = Calcular("select ISNULL(Impuesto2,0) as Codigo from TPARAMETRO", Cn)
    impxT = 1 + (imp1 / 100) + (imp2 / 100)
    impx1 = 1 + (imp1 / 100)
    impx2 = 1 + (imp2 / 100)
    lPrecioNetoPrecuenta = Calcular("select ISNULL(lPrecioNetoPrecuenta,0) as Codigo from TCAJA where tCaja = '" & sCaja & "' ", Cn)
    '------------------
    
    ' marzo 2011
    Dim xSql As String
    If lAlmacen Then
        Dim RsOp As Recordset
        Set RsOp = Lib.OpenRecordset("select Codigo, Descripcion from vOperador where lStockMenos=1", Cn)
        If RsOp.RecordCount > 0 Then
        xSql = "select tCodigoPropiedad as Codigo, TPROPIEDAD.tDetallado as Descripcion, tProducto, TOPERADOR.tOperador as tOperador, TOPERADOR.tDetallado as Operador, nPrecio, tEnlace, " & _
               "nInsumo, nGasto, nManoObra " & _
               "FROM dbo.TPROPIEDAD LEFT OUTER JOIN dbo.TOPERADOR ON dbo.TPROPIEDAD.tOperador = dbo.TOPERADOR.tOperador " & _
               "Where TPROPIEDAD.lActivo = 1 And IsNull(TOPERADOR.lStockMenos, 0) <> 1 union " & _
               "select '9999' as Codigo, tDetallado as Descripcion, tCodigoPlato as tProducto, '" & RsOp!codigo & "' as tOperador, '" & RsOp!Descripcion & "' as Operador, 0, " & sAlmacenMDB & ".dbo.DRECETAVENTA.tCodigoProducto as tEnlace, nCantidad * nPrecio as nInsumo, 0, 0 " & _
               "FROM " & sAlmacenMDB & ".dbo.DRECETAVENTA INNER JOIN " & sAlmacenMDB & ".dbo.MRECETAVENTA ON " & sAlmacenMDB & ".dbo.DRECETAVENTA.tLocal = " & sAlmacenMDB & ".dbo.MRECETAVENTA.tLocal AND " & sAlmacenMDB & ".dbo.DRECETAVENTA.tRecetaVenta = " & sAlmacenMDB & ".dbo.MRECETAVENTA.tRecetaVenta INNER JOIN " & sAlmacenMDB & ".dbo.TPRODUCTO ON " & sAlmacenMDB & ".dbo.DRECETAVENTA.tCodigoProducto = " & sAlmacenMDB & ".dbo.TPRODUCTO.tCodigoProducto " & _
               "Where lNoDescargo = 1 and " & sAlmacenMDB & ".dbo.DRECETAVENTA.tLocal='" & sLocal & "'"
        Else
        xSql = "select tCodigoPropiedad as Codigo, TPROPIEDAD.tDetallado as Descripcion, tProducto, TPROPIEDAD.tOperador, nPrecio, tEnlace, " & _
               "nInsumo, nGasto, nManoObra, tOperador.tDetallado AS Operador " & _
               "FROM dbo.TPROPIEDAD LEFT OUTER JOIN dbo.TOPERADOR ON dbo.TPROPIEDAD.tOperador = dbo.TOPERADOR.tOperador " & _
               "Where TPROPIEDAD.lActivo = 1 And IsNull(TOPERADOR.lStockMenos, 0) <> 1"
        End If
    Else
         xSql = "select tCodigoPropiedad as Codigo, TPROPIEDAD.tDetallado as Descripcion, tProducto, TPROPIEDAD.tOperador, nPrecio, tEnlace, " & _
                "nInsumo, nGasto, nManoObra, tOperador.tDetallado AS Operador " & _
                "FROM dbo.TPROPIEDAD LEFT OUTER JOIN dbo.TOPERADOR ON dbo.TPROPIEDAD.tOperador = dbo.TOPERADOR.tOperador " & _
                "Where TPROPIEDAD.lActivo = 1 And IsNull(TOPERADOR.lStockMenos, 0) <> 1"
    End If
   
    Isql = "SELECT dbo.TPRODUCTOPROPIEDAD.tCodigoPedido, dbo.TPRODUCTOPROPIEDAD.tItem, dbo.TPRODUCTOPROPIEDAD.tCodigoPropiedad, dbo.TPRODUCTOPROPIEDAD.tProducto, t1.Descripcion AS Descripcion, Operador, dbo.TPRODUCTOPROPIEDAD.nCantidad " & _
           " FROM    dbo.TOPERADOR INNER JOIN dbo.TPRODUCTOPROPIEDAD INNER JOIN (" & xSql & ")T1 ON dbo.TPRODUCTOPROPIEDAD.tCodigoPropiedad = T1.Codigo AND dbo.TPRODUCTOPROPIEDAD.tProducto = T1.tProducto AND dbo.TPRODUCTOPROPIEDAD.tEnlace = T1.tEnlace ON dbo.TOPERADOR.tOperador = T1.tOperador COLLATE Modern_Spanish_CI_AS LEFT OUTER JOIN dbo.TPROPIEDAD ON dbo.TOPERADOR.tOperador = dbo.TPROPIEDAD.tOperador AND dbo.TPRODUCTOPROPIEDAD.tCodigoPropiedad = dbo.TPROPIEDAD.tCodigoPropiedad AND dbo.TPRODUCTOPROPIEDAD.tProducto = dbo.TPROPIEDAD.tProducto " & _
           " where tCodigoPedido ='" & sPedido & "' and toperador.limprime=1 ORDER BY dbo.TOPERADOR.nBoton "
    Set xRsPropiedad = Lib.OpenRecordset(Isql, Cn)
    
    Isql = " SELECT dbo.TCOMBOPROPIEDAD.tCodigoPedido, dbo.TCOMBOPROPIEDAD.tItem, dbo.TCOMBOPROPIEDAD.tItemCombo, T1.Descripcion, T1.Operador, dbo.TCOMBOPROPIEDAD.nCantidad " & _
           " FROM     dbo.TCOMBOPROPIEDAD INNER JOIN  (" & xSql & ") T1 ON dbo.TCOMBOPROPIEDAD.tCodigoPropiedad = T1.Codigo AND dbo.TCOMBOPROPIEDAD.tProducto = T1.tProducto AND  dbo.TCOMBOPROPIEDAD.tEnlace = T1.tEnlace LEFT OUTER JOIN dbo.TPROPIEDAD ON dbo.TCOMBOPROPIEDAD.tCodigoPropiedad = dbo.TPROPIEDAD.tCodigoPropiedad AND dbo.TCOMBOPROPIEDAD.tProducto = dbo.TPROPIEDAD.tProducto RIGHT OUTER JOIN dbo.TOPERADOR ON dbo.TPROPIEDAD.tOperador = dbo.TOPERADOR.tOperador AND T1.tOperador COLLATE Modern_Spanish_CI_AS = dbo.TOPERADOR.tOperador  " & _
            " where tCodigoPedido ='" & sPedido & "' and toperador.limprime=1  order by toperador.nboton"
    Set xRsPropiedadCombo = Lib.OpenRecordset(Isql, Cn)
    

    'Configura la impresora la impresion Font
    If Not Imprimir(Impresora) Then
       Exit Sub
    End If
    Printer.FontName = sFont
    Printer.FontBold = False
    
    If lImprimeImagCabPrecuenta Then
        If Cabecera <> 0 Then
            Printer.PaintPicture Cabecera, 500, Printer.CurrentY, 2860, 1600
            For p = 1 To 10
            Printer.Print
            Next p
        End If
    End If
    
    'Cabecera
    ImprimeXCentro sRazonSocial, 40
    ImprimeXCentro sRazonComercial, 40
    
    Select Case pais
        Case "001" 'Bolivia
            sLinea = String((40 - Len(Trim("N.I.T.: " + sRUC))) / 2, " ") & "N.I.T.: " + sRUC
        Case Else 'Peru, Ecuador
            sLinea = String((40 - Len(Trim("R.U.C.: " + sRUC))) / 2, " ") & "R.U.C.: " + sRUC
    End Select
    
    Printer.Print sLinea
    ImprimeXCentro sDireccion, 40
    If Trim(sDireccion2) <> "" Then
        ImprimeXCentro sDireccion2, 40
    End If
    sLinea = String((40 - Len(Trim("Telephone: " + sTelefono))) / 2, " ") & "Telephone: " + sTelefono
    Printer.Print sLinea
    Printer.Print
    
    Printer.Print "Order    : " & sPedido
    'Printer.Print "Fecha     : " & FechaServidor()
                            If lImpresionDiaContable Then
                                If lReimpresion = True Then
                                    Printer.Print "Date     : " & Format(Calcular("select fdiacontable as codigo from mpedido where tcodigopedido ='" & sPedido & "'", Cn), "dd/MM/yyyy") & " " & Calcular("exec DiacontableHora '" & fImpresionDiaContable & "'", Cn)
                                    Else
                                    Printer.Print "Date     : " & fImpresionDiaContable & " " & Calcular("exec DiacontableHora '" & fImpresionDiaContable & "'", Cn)
                                End If
                            Else
                                 Printer.Print "Date     : " & FechaServidor() 'RsImpresion!fRegistro
                            End If
                            
    
    Printer.Print "Kind     : " & RsImpresion!tipopedido
    Printer.Print "Box      : " & sCaja & " - " & IIf(Mid(sUsuario, 1, 1) = "*", Mid(sUsuario, 2, 15), sUsuario)
    Printer.Print "Waiter   : " & RsImpresion!Mozo
    ImprimeXLinea "Client   : " & Trim(RsImpresion!Cliente), 40, 13
    
    If xTelefonoImp <> "" And xTelefono <> 0 Then
        ImprimeXLinea "Telephone  : " & Trim(xTelefonoImp), 40, 13
    End If
    If xDireccionImp <> "" And xDireccionImp <> 0 Then
        ImprimeXLinea "Address  : " & Trim(xDireccionImp), 40, 13
    End If
    
    If Calcular("SELECT ISNULL(TENTREGARA,'') codigo FROM MPEDIDO WHERE TCODIGOPEDIDO='" & RsImpresion!codigo & "'", Cn) <> "" Then
        Printer.Print "Deliver to" & Calcular("SELECT ISNULL(TENTREGARA,'') codigo FROM MPEDIDO WHERE TCODIGOPEDIDO='" & RsImpresion!codigo & "'", Cn)
    End If
    
    If Y = 1 Then
    'telefono
    Dim tcliente As String
    Dim tTelefono As String
            tcliente = Calcular("select isnull(tclientedelivery,'') codigo from mpedido where tcodigopedido='" & RsImpresion!codigo & "'", Cn)
            If tcliente <> "" And tcliente <> "0" Then
                tTelefono = Calcular("select isnull(ttelefono,'') codigo from tdelivery where tcodigodelivery='" & tcliente & "'", Cn)
                If tTelefono <> "" And tTelefono <> "0" Then
                Printer.Print "Identif   : " & tTelefono
                End If
            End If
    End If
    
    Printer.Print "Discount : " & Mid(Trim(RsImpresion!DESCUENTO), 1, 28)
    Printer.Print "Exchange Rate  : " & Format(nTC, "###,##0.00")
    
    If Y = 1 Then
            If Calcular("select fprogramacion as codigo from mpedido where tcodigopedido='" & RsImpresion!codigo & "'", Cn) <> 0 Then
                    Printer.FontBold = True
                    Printer.Print
                    Printer.Print "F Entrega : " & Calcular("select fprogramacion as codigo from mpedido where tcodigopedido='" & RsImpresion!codigo & "'", Cn)
            End If
    End If
    Printer.Print
    Printer.FontBold = True
    txt = "Table      : " & IIf(IsNull(RsImpresion!Mesa), "", Trim(RsImpresion!Mesa)) & " " & IIf(IsNull(RsImpresion!tObservacion), "", Trim(RsImpresion!tObservacion)) & IIf(RsImpresion!nAdulto > 0, " Pax " & RsImpresion!nAdulto, "")
    ImprimeXLinea txt, 40, 12
    Printer.FontBold = False
    
    Printer.Print
    Printer.Print String(40, "-")
    Printer.Print "Quantity. Product                SubTotal"
    Printer.Print String(40, "-")
        
    RsImpresion.MoveFirst
    zSubTotal = 0
    zImpuesto1 = 0
    zImpuesto2 = 0
    zImpuesto3 = 0
    zDescuento = 0
    zRecargo = 0
    zTotal = 0
    
    xSubTotal = 0

    'Cuerpo
    Item = ""
    
    Do While Not RsImpresion.EOF
       If Item <> RsImpresion!tItem Then
            'Impresion de Propiedades
            If lPropiedadPrecuenta Then
               xRsPropiedad.Filter = "tItem='" & Item & "'"
               If Not xRsPropiedad.EOF Then
                  xRsPropiedad.MoveFirst
                  Do While Not xRsPropiedad.EOF
                     'ImprimeXLinea "        * " & xRsPropiedad!Operador & " " & xRsPropiedad!Descripcion, 40, 8
                     ImprimeXLinea "        * " & IIf(xRsPropiedad!nCantidad = 1, "", "(" & xRsPropiedad!nCantidad & ")") & xRsPropiedad!Operador & " " & xRsPropiedad!Descripcion, 31, 10
                     xRsPropiedad.MoveNext
                  Loop
               End If
                                        
               'Impresion de la Observacion
               If lObservacionPrecuenta And Len(Trim(xObservacion)) > 0 Then
                  ImprimeXLinea "        - " & Trim(xObservacion), 33, 10
               End If
            End If

            If RsImpresion!nImpuesto1 > 0 And RsImpresion!nImpuesto2 > 0 Then
                  impG = impxT
            ElseIf RsImpresion!nImpuesto1 > 0 And RsImpresion!nImpuesto2 = 0 Then
                  impG = impx1
            ElseIf RsImpresion!nImpuesto1 = 0 And RsImpresion!nImpuesto2 > 0 Then
                  impG = impx2
            Else
                  impG = 1
            End If
          

          If lPrecioNetoPrecuenta Then
             sLinea = Right(String(7, " ") & Format(RsImpresion!nCantidad, "###0.00"), 7) & " " & Mid(RsImpresion!Producto & String(19, " "), 1, 19) & " " & Right(String(12, " ") & Format((RsImpresion!nPrecioOficial * RsImpresion!nCantidad) / impG, "#,###,##0.00"), 12)
          Else
                If IsNull(RsImpresion!tOferta) Or RsImpresion!tOferta = "" Then
                   sLinea = Right(String(7, " ") & Format(RsImpresion!nCantidad, "###0.00"), 7) & " " & Mid(RsImpresion!Producto & String(19, " "), 1, 19) & " " & Right(String(12, " ") & Format(RsImpresion!nPrecioOficial * RsImpresion!nCantidad, "#,###,##0.00"), 12)
                Else
                   sLinea = Right(String(7, " ") & Format(RsImpresion!nCantidad, "###0.00"), 7) & " " & Mid(RsImpresion!Producto & String(19, " "), 1, 19)
                   Printer.Print sLinea
                   sLinea = String(8, " ") & Mid(RsImpresion!tOferta & String(19, " "), 1, 19) & " " & Right(String(12, " ") & Format(RsImpresion!nPrecioOficial * RsImpresion!nCantidad, "#,###,##0.00"), 12)
                End If
            
          End If
          
          
          Printer.Print sLinea
          '0035-2013 CESAR
          zGTotal = zGTotal + (RsImpresion!nPrecioOficial * RsImpresion!nCantidad)
          zTotal = zTotal + RsImpresion!nVenta
          zImpuesto1 = zImpuesto1 + RsImpresion!nImpuesto1
          zImpuesto2 = zImpuesto2 + RsImpresion!nImpuesto2
          zImpuesto3 = zImpuesto3 + RsImpresion!nImpuesto3
          '---CESAR IMP
          xDiferencia = ((RsImpresion!nPrecioOficial * RsImpresion!nCantidad) / impG) - (RsImpresion!nVenta - RsImpresion!nImpuesto1 - RsImpresion!nImpuesto2)
          xDescuento = xDescuento + xDiferencia
          xAumento = (RsImpresion!nVenta - RsImpresion!nImpuesto1 - RsImpresion!nImpuesto2) - ((RsImpresion!nPrecioOficial * RsImpresion!nCantidad) / impG)
          xRecargo = xRecargo + xAumento
          xSubTotal = xSubTotal + ((RsImpresion!nPrecioOficial * RsImpresion!nCantidad) / impG)
          '------------
          zDescuento = zDescuento + (RsImpresion!nDescuento * RsImpresion!nCantidad)
          zRecargo = zRecargo + (RsImpresion!nRecargo * RsImpresion!nCantidad)
       End If
       
       'Combos
       If lComboPrecuenta And IIf(IsNull(RsImpresion!Combo), 0, Len(Trim(RsImpresion!Combo))) > 0 Then
          sLinea = Mid("       " & Right(String(5, " ") & Format(RsImpresion!nCantidadCombo, "#0.00"), 5) & " " & RsImpresion!Combo, 1, 40)
          Printer.Print sLinea
          
          'Combos Propiedades
          If lPropiedadPrecuenta And Len(Trim(IIf(IsNull(RsImpresion!Combo), "", RsImpresion!Combo))) > 0 Then
             xRsPropiedadCombo.Filter = "tItem='" & RsImpresion!tItem & "' and tItemCombo='" & RsImpresion!tItemCombo & "'"
             If Not xRsPropiedadCombo.EOF Then
                xRsPropiedadCombo.MoveFirst
                Do While Not xRsPropiedadCombo.EOF
                   'Printer.Print "        * " & xRsPropiedadCombo!Operador & " " & xRsPropiedadCombo!Descripcion
                    ImprimeXLinea "             * " & xRsPropiedadCombo!Operador & " " & xRsPropiedadCombo!Descripcion, 40, 13
                   xRsPropiedadCombo.MoveNext
                Loop
             End If
          
             'Impresion de la Observacion
              If lObservacionPrecuenta And Len(Trim(RsImpresion!tObservacionCombo)) > 0 Then
                 ImprimeXLinea "        - " & Trim(RsImpresion!tObservacionCombo), 33, 2
              End If
          End If
       End If
       xObservacion = IIf(IsNull(RsImpresion!tObservacionPedido), "", RsImpresion!tObservacionPedido)
       Item = RsImpresion!tItem
       RsImpresion.MoveNext
    Loop
    If lPropiedadPrecuenta Then
       xRsPropiedad.Filter = "tItem='" & Item & "'"
       If Not xRsPropiedad.EOF Then
          xRsPropiedad.MoveFirst
          Do While Not xRsPropiedad.EOF
             'Printer.Print "        * " & xRsPropiedad!Operador & " " & xRsPropiedad!Descripcion
              ImprimeXLinea "        * " & IIf(xRsPropiedad!nCantidad = 1, "", "(" & xRsPropiedad!nCantidad & ")") & xRsPropiedad!Operador & " " & xRsPropiedad!Descripcion, 31, 10
             xRsPropiedad.MoveNext
          Loop
       End If
                   
       'Impresion de la Observacion
       If lObservacionPrecuenta And Len(Trim(xObservacion)) > 0 Then
          ImprimeXLinea "        - " & Trim(xObservacion), 33, 2
       End If
    End If
            
            
    zSubTotal = Round(zTotal - zImpuesto1 - zImpuesto2 - zImpuesto3, 2)
    zTotal = Round(zTotal, 2)
    
'    zSubTotal = zTotal - zImpuesto1 - zImpuesto2 - zImpuesto3
'    zTotal = zTotal
    
    Printer.Print String(40, "-")
    
'    If lPrecioNetoPrecuenta Then
'        Printer.Print Right(String(27, " ") & "Sub Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xSubTotal, "##,###,##0.00"), 13)
'        Printer.Print String(40, " ")
'    Else
'        Printer.Print Right(String(27, " ") & "Sub Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(zGTotal, "##,###,##0.00"), 13)
'        Printer.Print String(40, " ")
'    End If
'
    If zDescuento > 0 Then
        If lPrecioNetoPrecuenta Then
           Printer.Print Right(String(27, " ") & "Discount " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xDescuento, "##,###,##0.00"), 13)
        Else
           Printer.Print Right(String(27, " ") & "Sub Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(zGTotal, "##,###,##0.00"), 13)
           Printer.Print " "
           Printer.Print Right(String(27, " ") & "Discount " & sMonN & " : ", 27) & Right(String(13, " ") & Format(zDescuento, "##,###,##0.00"), 13)
        End If
    End If
    
    If zRecargo > 0 Then
       If lPrecioNetoPrecuenta Then
          Printer.Print Right(String(27, " ") & "Surcharge " & sMonN & " : ", 27) & Right(String(13, " ") & Format(xRecargo, "##,###,##0.00"), 13)
       Else
          Printer.Print Right(String(27, " ") & "Surcharge " & sMonN & " : ", 27) & Right(String(13, " ") & Format(zRecargo, "##,###,##0.00"), 13)
       End If
    End If
    
    If lImpuestoPrecuenta Then
        Printer.Print Right(String(27, " ") & "Sale Value " & sMonN & " : ", 27) & Right(String(13, " ") & Format(zSubTotal, "##,###,##0.00"), 13)
        If zImpuesto1 > 0 Then
           Printer.Print Right(String(27, " ") & sImpuesto1 & " " & Format(nPorcentaje1, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(zImpuesto1, "##,###,##0.00"), 13)
        End If
           
        If zImpuesto2 > 0 Then
           Printer.Print Right(String(27, " ") & sImpuesto2 & " " & Format(nPorcentaje2, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(zImpuesto2, "##,###,##0.00"), 13)
        End If
           
        If zImpuesto3 > 0 Then
           Printer.Print Right(String(27, " ") & sImpuesto3 & " " & Format(nPorcentaje3, "##0.00") & "% " & sMonN & " : ", 27) & Right(String(13, " ") & Format(zImpuesto3, "##,###,##0.00"), 13)
        End If
     End If
     
    Printer.Print " "
    Printer.FontName = sFont1
    If lPrecioNetoPrecuenta Then
        If lImpuestoPrecuenta Then
            Printer.Print Right(String(27, " ") & "Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(zTotal, "##,###,##0.00"), 13)
        Else
            Printer.Print Right(String(27, " ") & "Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(zSubTotal, "##,###,##0.00"), 13)
        End If
    Else
        Printer.Print Right(String(27, " ") & "Total " & sMonN & " : ", 27) & Right(String(13, " ") & Format(zTotal, "##,###,##0.00"), 13)
    End If
    '=================Nov2010
    If lImpreEquivaPrecuenta Then
        Printer.Print Right(String(27, " ") & "Total " & sMonE & " :", 27) & Right(String(13, " ") & Format(zTotal / nTC, "##,###,##0.00"), 13)
    End If
    '=================
    Printer.FontName = sFont
    Printer.Print " "
    
    If pais = "002" Then
       Printer.Print " "
       Printer.Print " Tip : _____________"
       Printer.Print " "
    End If
    
    Printer.Print
    If lPrecioNetoPrecuenta Then
        If lImpuestoPrecuenta Then
             txt = "Are: " & NumeroCadenaingles(str(zTotal)) & " " & sMonedaN
'            txt = "Are: " & NumeroCadena(str(zTotal)) & " " & sMonedaN
        Else
            txt = "Are: " & NumeroCadenaingles(str(zSubTotal)) & " " & sMonedaN
           ' txt = "Are: " & NumeroCadena(str(zSubTotal)) & " " & sMonedaN
        End If
    Else
        txt = "Are: " & NumeroCadenaingles(str(zTotal)) & " " & sMonedaN
      '  txt = "Are: " & NumeroCadena(str(zTotal)) & " " & sMonedaN
    End If
    ImprimeXLinea txt, 40, 5
    Printer.Print
    Printer.Print String(40, "-")
    Printer.Print
    
    If pais = "002" Then
       Printer.FontName = sFont1
       Printer.FontBold = True
       ImprimeXCentro "DATA FOR YOUR INVOICE", 40
       Printer.Print " "
       Printer.FontName = sFont
       Printer.FontBold = False
    End If
    
    Printer.Print " Customer Signature : ____________________"
    Printer.Print
    Printer.Print " Bussiness Name : ________________________"
    Printer.Print
    
    Select Case pais
       Case "001" 'Bolivia
               Printer.Print " N.I.T.       : ________________________"
       Case Else 'Peru, Ecuador
               Printer.Print " R.U.C.       : ________________________"
    End Select
    
    If pais = "002" Then
        Printer.Print " Address    : ___________________________________"
        Printer.Print
        Printer.Print " Telephone     : ___________________________________"
    End If
     
    Printer.Print " "
    Printer.Print " E-mail       : ________________________"
    Printer.Print " "
    Printer.Print String(40, "-")
    RsImpresion.MoveLast
    If Len(LTrim(sClub)) > 0 And RsImpresion!lPuntos And RsImpresion!nDisponible > 0 Then
       Printer.Print " "
       ImprimeXCentro "You. Have " & Format(RsImpresion!nDisponible, "###,##0.00") & " Cumulated Points", 40
       Printer.Print " "
    End If
      
    Printer.FontName = sFont
    Printer.FontBold = True
    ImprimeXCentro sPiePreCuenta, 40
    Printer.FontName = sFont
    Printer.FontBold = False
    Set xRsPropiedad = Nothing
    Set xRsPropiedadCombo = Nothing
    
    If lImprimeImagPiePrecuenta Then
        If pie <> 0 Then
            Printer.PaintPicture pie, 500, Printer.CurrentY, 2860, 1600
        End If
    End If
    
    Printer.Print " "
    Printer.EndDoc
End Sub



Public Function NumeroCadenaingles(strnum As String) As String
Dim Valor As String
Dim unidad(0 To 9) As String
Dim decena(0 To 9) As String
Dim centena(0 To 9) As String
Dim especial(1 To 5) As String
Dim compuesto(1 To 9) As String
Dim son As String
Dim Monto As String
Dim Fraccion As String

son = ""
unidad(0) = "zero"
unidad(1) = "One"
unidad(2) = "two"
unidad(3) = "three"
unidad(4) = "four"
unidad(5) = "fix"
unidad(6) = "six"
unidad(7) = "seven"
unidad(8) = "eight"
unidad(9) = "nine"

decena(1) = "ten"
decena(2) = "twenty"
decena(3) = "treint"
decena(4) = "forty"
decena(5) = "fifty"
decena(6) = "sixty"
decena(7) = "seventy"
decena(8) = "eighty"
decena(9) = "ninety"

centena(1) = "one hundred"
centena(2) = "two hundred"
centena(3) = "three hundred"
centena(4) = "four hundred"
centena(5) = "five hundred"
centena(6) = "six hundred"
centena(7) = "seven hundred"
centena(8) = "eigth hundred"
centena(9) = "nine hundred"

especial(1) = "eleven"
especial(2) = "twelve"
especial(3) = "thirteen"
especial(4) = "fourteen"
especial(5) = "fifteen"

compuesto(1) = "dieci"
compuesto(2) = "twenty y "
compuesto(3) = "thirty y "
compuesto(4) = "forty y "
compuesto(5) = "fifty y "
compuesto(6) = "sixty y "
compuesto(7) = "seventy y "
compuesto(8) = "eighty y "
compuesto(9) = "ninety y "

Dim Sw As Boolean
Dim qwe As Boolean
Dim qwa As Boolean


Sw = True
qwe = True
qwa = True

Do While qwa

Do While qwe
   If Sw Then
      Monto = LTrim(Format(strnum, "####0.00"))
      If InStr(Monto, ".") > 0 Then
         Fraccion = Mid(Monto, InStr(Monto, ".") + 1)
         Monto = Mid(Monto, 1, InStr(Monto, ".") - 1)
      Else
         Fraccion = "00"
      End If
   Else
      Sw = True
   End If

   'LM = Len(Monto)
   Select Case Len(Monto)
      Case Is = 0
           Exit Function
           
      Case Is = 1 And Monto <> ""
           son = son + unidad(Val(Monto))
           
      Case Is = 2
           If Right(Monto, 1) = "0" Then
              son = son + decena(Val(Left(Monto, 1)))
           Else
              If Left(Monto, 1) = "1" And InStr("12345", Right(Monto, 1)) > 0 Then
                 son = son + especial(Val(Right(Monto, 1)))
              Else
                 son = son + compuesto(Val(Left(Monto, 1))) + unidad(Val(Right(Monto, 1)))
              End If
           End If
           
      Case Is = 3
           If Right(Monto, 2) = "00" Then
              son = son + centena(Val(Left(Monto, 1)))
           Else
              If Left(Monto, 2) = "10" And InStr("123456789", Right(Monto, 1)) > 0 Then
                 son = son + "HUNDRED" + unidad(Val(Right(Monto, 2)))
              Else
                 If Left(Monto, 1) = "1" And InStr("102030405060708090", Right(Monto, 2)) > 0 Then
                    son = son + "HUNDRED " + decena(Val(Mid(Monto, 2, 1)))
                 Else
                    If Left(Monto, 2) = "11" And InStr("12345", Right(Monto, 1)) > 0 Then
                       son = son + "HUNDRED " + especial(Val(Right(Monto, 1)))
                    Else
                       If Left(Monto, 1) = "1" Then
                          son = son + "HUNDRED " + compuesto(Val(Mid(Monto, 2, 1))) + unidad(Val(Right(Monto, 1)))
                       Else
                          If Right(Monto, 1) = "0" And Mid(Monto, 2, 1) <> "0" Then
                             son = son + centena(Val(Left(Monto, 1))) + " " + decena(Val(Mid(Monto, 2, 1)))
                          Else
                             If Mid(Monto, 2, 1) = "1" And InStr("12345", Right(Monto, 1)) > 0 Then
                                son = son + centena(Val(Left(Monto, 1))) + " " + especial(Val(Right(Monto, 1)))
                             Else
                                If Val(Right(Monto, 2)) > 10 Then
                                   son = son + centena(Val(Left(Monto, 1))) + " " + compuesto(Val(Mid(Monto, 2, 1))) + unidad(Val(Right(Monto, 1)))
                                Else
                                   son = son + centena(Val(Left(Monto, 1))) + " " + unidad(Val(Right(Monto, 1)))
                                End If
                             End If
                          End If
                       End If
                    End If
                 End If
              End If
           End If
      Case Is = 4
           If Left(Monto, 1) = "1" And Right(Monto, 3) = "000" Then
              son = son + "One thousand"
           Else
              If Left(Monto, 1) = "1" Then
                 son = son + "Thousand "
              Else
                 son = son + unidad(Val(Left(Monto, 1))) + " MIL "
              End If
           End If
           Monto = LTrim(Mid(Monto, 2))
           If Left(Monto, 1) = "0" Then
              Monto = LTrim(Mid(Monto, 2))
              If Left(Monto, 1) = "0" Then
                 Monto = LTrim(Mid(Monto, 2))
              End If
              Sw = False
              'Loop
              Exit Do
           End If
           Sw = True
           If Left(Monto, 2) = "10" And InStr("123456789", Right(Monto, 1)) > 0 Then
              son = son + "HUNDRED" + unidad(Val(Right(Monto, 2)))
           Else
              If Left(Monto, 1) = "1" And InStr("102030405060708090", Right(Monto, 2)) > 0 Then
                 son = son + "HUNDRED " + decena(Val(Mid(Monto, 2, 1)))
              Else
                 If Left(Monto, 2) = "11" And InStr("12345", Right(Monto, 1)) > 0 Then
                    son = son + "HUNDRED " + especial(Val(Right(Monto, 1)))
                 Else
                    If Left(Monto, 1) = "1" And Right(Monto, 2) <> "00" Then
                       son = son + "HUNDRED " + compuesto(Val(Mid(Monto, 2, 1))) + unidad(Val(Right(Monto, 1)))
                    Else
                       If Right(Monto, 1) = "0" And Mid(Monto, 2, 1) <> "0" Then
                          son = son + centena(Val(Left(Monto, 1))) + " " + decena(Val(Mid(Monto, 2, 1)))
                       Else
                          If Mid(Monto, 2, 1) = "1" And InStr("12345", Right(Monto, 1)) > 0 Then
                             son = son + centena(Val(Left(Monto, 1))) + " " + especial(Val(Right(Monto, 1)))
                          Else
                             If Val(Right(Monto, 2)) > 10 Then
                                son = son + centena(Val(Left(Monto, 1))) + " " + compuesto(Val(Mid(Monto, 2, 1))) + unidad(Val(Right(Monto, 1)))
                             Else
                                If Right(Monto, 2) = "00" Then
                                   son = son + centena(Val(Left(Monto, 1)))
                                Else
                                   son = son + centena(Val(Left(Monto, 1))) + " " + unidad(Val(Right(Monto, 1)))
                                End If
                             End If
                          End If
                       End If
                    End If
                 End If
              End If
           End If
      Case Is = 5
           If Left(Monto, 1) = "1" And Mid(Monto, 2, 1) < "6" And Mid(Monto, 2, 1) <> "0" Then
              son = son + especial(Val(Mid(Monto, 2, 1))) + " MIL "
           Else
              If Left(Monto, 2) >= "10" And Mid(Monto, 2, 1) > "5" Then
                 son = son + compuesto(Val(Left(Monto, 1))) + unidad(Val(Mid(Monto, 2, 1))) + " MIL "
              Else
                 If Left(Monto, 1) >= "1" And Mid(Monto, 2, 1) = "0" Then
                    son = son + decena(Val(Left(Monto, 1))) + " MIL "
                 Else
                    If Mid(Monto, 2, 1) = "1" Then
                       son = son + compuesto(Val(Left(Monto, 1))) + "UN MIL "
                    Else
                       son = son + compuesto(Val(Left(Monto, 1))) + unidad(Val(Mid(Monto, 2, 1))) + " MIL "
                    End If
                 End If
              End If
           End If
           Monto = LTrim(Mid(Monto, 3))
           If Left(Monto, 1) = "0" Then
              Monto = LTrim(Mid(Monto, 2))
              If Left(Monto, 1) = "0" Then
                 Monto = LTrim(Mid(Monto, 2))
              End If
              Sw = False
              'Loop
              Exit Do
           End If
           Sw = True
           If Left(Monto, 2) = "10" And InStr("123456789", Right(Monto, 1)) > 0 Then
              son = son + "HUNDRED" + unidad(Val(Right(Monto, 2)))
           Else
              If Left(Monto, 1) = "1" And InStr("102030405060708090", Right(Monto, 2)) > 0 Then
                 son = son + "HUNDRED " + decena(Val(Mid(Monto, 2, 1)))
              Else
                 If Left(Monto, 2) = "11" And InStr("12345", Right(Monto, 1)) > 0 Then
                    son = son + "HUNDRED " + especial(Val(Right(Monto, 1)))
                 Else
                    If Left(Monto, 1) = "1" And Right(Monto, 2) <> "00" Then
                       son = son + "HUNDRED " + compuesto(Val(Mid(Monto, 2, 1))) + unidad(Val(Right(Monto, 1)))
                    Else
                       If Right(Monto, 1) = "0" And Mid(Monto, 2, 1) <> "0" Then
                          son = son + centena(Val(Left(Monto, 1))) + " " + decena(Val(Mid(Monto, 2, 1)))
                       Else
                          If Mid(Monto, 2, 1) = "1" And InStr("12345", Right(Monto, 1)) > 0 Then
                             son = son + centena(Val(Left(Monto, 1))) + " " + especial(Val(Right(Monto, 1)))
                          Else
                             If Val(Right(Monto, 2)) > 10 Then
                                son = son + centena(Val(Left(Monto, 1))) + " " + compuesto(Val(Mid(Monto, 2, 1))) + unidad(Val(Right(Monto, 1)))
                             Else
                                If Right(Monto, 2) = "00" Then
                                   son = son + centena(Val(Left(Monto, 1)))
                                Else
                                   son = son + centena(Val(Left(Monto, 1))) + " " + unidad(Val(Right(Monto, 1)))
                                End If
                             End If
                          End If
                       End If
                    End If
                 End If
              End If
           End If
      Case Is = 6
   End Select
   If Fraccion = "00" Then
      son = son + " Y 00/100 "
   Else
      son = son + " Y " + Fraccion + "/100 "
   End If
   qwe = False
   qwa = False
Loop

Loop
  NumeroCadenaingles = UCase(son)
End Function

Public Function NadaSimbolos(KeyAscii As Integer) As Boolean
On Error GoTo fin
    NadaSimbolos = True
    If (KeyAscii >= 33) And (KeyAscii <= 47) Or _
       (KeyAscii >= 91) And (KeyAscii <= 96) Or (KeyAscii >= 123) And (KeyAscii <= 126) Or (KeyAscii = 231) Or (KeyAscii = 180) Or (KeyAscii = 186) Or (KeyAscii = 170) Or (KeyAscii = 191) Or (KeyAscii = 161) Or (KeyAscii = 63) Or (KeyAscii = 183) Or (KeyAscii = 61) Or (KeyAscii = 128) Or (KeyAscii = 172) Or (KeyAscii = 60) Or (KeyAscii = 62) Or (KeyAscii = 58) Or (KeyAscii = 59) Or (KeyAscii = 168) Or (KeyAscii = 199) Then
        'MsgBox "Nada de simbolos"
        NadaSimbolos = False
    End If
    Exit Function
fin:
 NadaSimbolos = False
End Function


